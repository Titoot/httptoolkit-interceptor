{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/components/send/send-card-section.tsx","webpack:///./src/services/server-api-types.ts","webpack:///./src/components/editor/content-viewer.tsx","webpack:///./src/components/common/editable-pairs.tsx","webpack:///./src/services/desktop-api.ts","webpack:///./src/model/http/sources.ts","webpack:///./src/components/common/loading-card.tsx","webpack:///./src/model/rules/rule-serialization.ts","webpack:///./src/components/common/text-content.tsx","webpack:///./src/components/common/format-button.tsx","webpack:///./src/components/common/editable-params.tsx","webpack:///./src/components/editor/image-viewer.tsx","webpack:///./src/model/events/body-formatting.ts","webpack:///./src/model/http/har.ts","webpack:///./src/model/http/exchange.ts","webpack:///./src/metrics.ts","webpack:///./src/routing.tsx","webpack:///./src/model/websockets/websocket-stream.ts","webpack:///./src/model/filters/syntax-matching.ts","webpack:///./src/model/filters/syntax-parts.ts","webpack:///./src/model/filters/search-filters.ts","webpack:///./src/model/ui/context-menu.ts","webpack:///./src/model/ui/ui-store.ts","webpack:///./src/model/account/account-store.ts","webpack:///./src/model/network.ts","webpack:///./src/model/proxy-store.ts","webpack:///./src/model/tls/failed-tls-connection.ts","webpack:///./src/model/tls/tls-tunnel.ts","webpack:///./src/model/webrtc/rtc-connection.ts","webpack:///./src/model/webrtc/rtc-data-channel.ts","webpack:///./src/model/webrtc/rtc-media-track.ts","webpack:///./src/model/events/events-store.ts","webpack:///./src/components/component-utils.tsx","webpack:///./src/components/common/close-button.tsx","webpack:///./src/components/common/docs-link.tsx","webpack:///./src/components/intercept/intercept-option.tsx","webpack:///./src/components/intercept/config/manual-intercept-config.tsx","webpack:///./src/components/common/copy-button.tsx","webpack:///./src/components/intercept/config/existing-terminal-config.tsx","webpack:///./src/components/intercept/config/electron-config.tsx","webpack:///./src/components/intercept/config/android-device-config.tsx","webpack:///./src/components/intercept/config/android-adb-config.tsx","webpack:///./src/components/intercept/config/existing-browser-config.tsx","webpack:///./src/components/intercept/config/intercept-target-list.tsx","webpack:///./src/components/intercept/config/jvm-config.tsx","webpack:///./src/components/intercept/config/docker-attach-config.tsx","webpack:///./src/components/intercept/config/manual-ios-config.tsx","webpack:///./src/model/interception/interceptors.ts","webpack:///./src/model/interception/interceptor-store.ts","webpack:///./src/model/api/api-store.ts","webpack:///./src/services/ui-update-worker.ts","webpack:///./src/services/update-management.ts","webpack:///./src/components/sidebar.tsx","webpack:///./src/components/intercept/connected-sources.tsx","webpack:///./src/components/common/search-box.tsx","webpack:///./src/components/intercept/intercept-page.tsx","webpack:///./src/components/split-pane.tsx","webpack:///./src/components/common/empty-state.tsx","webpack:///./src/components/editor/focus-wrapper.tsx","webpack:///./src/components/editor/editor-context-menu.ts","webpack:///./src/components/editor/base-editor.tsx","webpack:///./src/model/rules/rule-descriptions.ts","webpack:///./src/components/common/status-code.tsx","webpack:///./src/components/view/view-event-list-buttons.tsx","webpack:///./src/model/filters/filter-matching.ts","webpack:///./src/components/view/filters/filter-tag.tsx","webpack:///./src/components/view/filters/filter-suggestion-row.tsx","webpack:///./src/components/view/filters/save-filters-row.tsx","webpack:///./src/components/view/filters/filter-input.tsx","webpack:///./src/components/view/filters/search-filter.tsx","webpack:///./src/components/view/view-event-list-footer.tsx","webpack:///./src/components/view/view-event-list.tsx","webpack:///./src/model/ui/export.ts","webpack:///./src/components/view/view-context-menu-builder.ts","webpack:///./src/components/view/view-details-pane.tsx","webpack:///./src/components/view/stream-message-rows.tsx","webpack:///./src/components/view/stream-message-list-card.tsx","webpack:///./src/components/common/collapsible-section.tsx","webpack:///./src/components/view/websocket-close-card.tsx","webpack:///./src/components/common/optional-image.tsx","webpack:///./src/components/account/pro-placeholders.tsx","webpack:///./src/components/view/http/http-api-card.tsx","webpack:///./src/components/common/source-icon.tsx","webpack:///./src/components/view/http/set-cookie-header-description.tsx","webpack:///./src/components/view/http/user-agent-header-description.tsx","webpack:///./src/components/view/http/header-details.tsx","webpack:///./src/components/view/url-breakdown.tsx","webpack:///./src/components/view/http/http-request-card.tsx","webpack:///./src/components/view/http/http-response-card.tsx","webpack:///./src/components/view/http/http-aborted-card.tsx","webpack:///./src/model/http/caching.ts","webpack:///./src/components/common/duration-pill.tsx","webpack:///./src/components/view/http/http-performance-card.tsx","webpack:///./src/components/view/http/http-export-card.tsx","webpack:///./src/components/view/header-card.tsx","webpack:///./src/components/view/http/http-error-header.tsx","webpack:///./src/components/view/http/http-details-footer.tsx","webpack:///./src/components/view/http/http-breakpoint-header.tsx","webpack:///./src/components/common/editable-headers.tsx","webpack:///./src/components/view/http/http-breakpoint-request-card.tsx","webpack:///./src/components/common/editable-status.tsx","webpack:///./src/components/view/http/http-breakpoint-response-card.tsx","webpack:///./src/components/view/http/http-breakpoint-body-card.tsx","webpack:///./src/components/view/http/http-details-pane.tsx","webpack:///./src/components/view/tls/tls-failure-details-pane.tsx","webpack:///./src/components/view/tls/tls-tunnel-details-pane.tsx","webpack:///./src/components/view/rtc/rtc-data-channel-card.tsx","webpack:///./src/components/view/rtc/rtc-connection-header.tsx","webpack:///./src/components/view/rtc/rtc-data-channel-details-pane.tsx","webpack:///./src/components/common/send-recieve-graph.tsx","webpack:///./src/components/view/rtc/rtc-media-card.tsx","webpack:///./src/components/view/rtc/rtc-media-details-pane.tsx","webpack:///./src/components/view/rtc/rtc-connection-card.tsx","webpack:///./src/components/view/rtc/sdp-card.tsx","webpack:///./src/components/view/rtc/rtc-connection-details-pane.tsx","webpack:///./src/components/view/view-page.tsx","webpack:///./src/components/mock/mock-drag-handle.tsx","webpack:///./src/components/mock/mock-item-menu.tsx","webpack:///./src/components/mock/mock-rule-group.tsx","webpack:///./src/components/mock/matcher-config.tsx","webpack:///./src/components/mock/matcher-selection.tsx","webpack:///./src/components/mock/handler-selection.tsx","webpack:///./src/components/mock/handler-config.tsx","webpack:///./src/components/mock/mock-rule-title.tsx","webpack:///./src/components/mock/mock-rule-row.tsx","webpack:///./src/components/mock/mock-rule-list.tsx","webpack:///./src/components/mock/mock-page.tsx","webpack:///./src/components/send/send-request-headers-card.tsx","webpack:///./src/components/send/send-request-body-card.tsx","webpack:///./src/components/send/request-pane.tsx","webpack:///./src/components/send/sent-response-status.tsx","webpack:///./src/components/send/sent-response-headers.tsx","webpack:///./src/components/send/response-pane.tsx","webpack:///./src/components/send/send-page.tsx","webpack:///./src/components/common/tabbed-options.tsx","webpack:///./src/components/settings/settings-components.tsx","webpack:///./src/components/settings/string-settings-list.tsx","webpack:///./src/components/settings/proxy-settings-card.tsx","webpack:///./src/components/settings/connection-settings-card.tsx","webpack:///./src/components/settings/api-settings-card.tsx","webpack:///./src/components/settings/settings-page.tsx","webpack:///./src/components/account/modal-overlay.tsx","webpack:///./src/components/account/plan-picker.tsx","webpack:///./src/components/account/checkout-spinner.tsx","webpack:///./src/components/html-context-menu.tsx","webpack:///./src/components/app.tsx","webpack:///./src/components/store-powered-theme-provider.tsx","webpack:///./src/components/error-boundary.tsx","webpack:///./src/index.tsx","webpack:///./src/components/common/inputs.tsx","webpack:///./src/model/http/methods.ts","webpack:///./src/model/rules/rules-structure.ts","webpack:///./src/model/rules/definitions/http-rule-definitions.ts","webpack:///./src/util/headers.ts","webpack:///./src/styles.ts","webpack:///./src/components/common/card.tsx","webpack:///./src/util/index.ts","webpack:///./src/util/ui.ts","webpack:///./src/util/error.ts","webpack:///./src/model/events/stream-message.ts","webpack:///./src/model/rules/definitions/ethereum-abi.ts","webpack:///./src/model/api/openapi.ts","webpack:///./src/util/json-schema.ts","webpack:///./src/amiusing.html","webpack:///./src/model/rules/rule-migrations.ts","webpack:///./src/util/streams.ts","webpack:///./src/model/http/editable-body.ts","webpack:///./src/model/http/exchange-breakpoint.ts","webpack:///./src/errors.ts","webpack:///./src/components/common/pill.tsx","webpack:///./src/model/rules/rules.ts","webpack:///./src/model/events/categorization.ts","webpack:///./src/services/server-rest-api.ts","webpack:///./src/model/send/send-request-model.ts","webpack:///./src/components/view/http/http-body-card.tsx","webpack:///./src/util/observable.ts","webpack:///./src/model/rules/definitions/ipfs-rule-definitions.ts","webpack:///./src/components/common/icon-button.tsx","webpack:///./src/model/rules/definitions/ethereum-rule-definitions.ts","webpack:///./src/util/mobx-persist/storage.ts","webpack:///./src/util/mobx-persist/types.ts","webpack:///./src/util/mobx-persist/persist-object.ts","webpack:///./src/util/mobx-persist/persist.ts","webpack:///./src/components/common/card-error-banner.tsx","webpack:///./src/components/editor/body-card-components.tsx","webpack:///./src/model/http/http-docs.ts","webpack:///./src/model/events/content-types.ts","webpack:///./src/model/serialization.ts","webpack:///./src/model/events/bodies.ts","webpack:///./src/model/rules/definitions/websocket-rule-definitions.ts","webpack:///./src/services/ui-worker.ts","webpack:///./src/model/rules/definitions/rtc-rule-definitions.ts","webpack:///./src/util/promise.ts","webpack:///./src/services/ui-worker-api.ts","webpack:///./src/model/api/jsonrpc.ts","webpack:///./src/model/rules/rules-store.ts","webpack:///./src/model/send/send-store.ts","webpack:///./src/images/logo-icon.svg","webpack:///./src/services/server-graphql-api.ts","webpack:///./src/services/server-api.ts","webpack:///./src/components/send/sent-response-body.tsx","webpack:///./src/util/text.ts","webpack:///./src/model/rules/rule-creation.ts","webpack:///./src/icons.ts","webpack:///./src/images/custom-spinner.ts","webpack:///./src/images/brave-browser-logo.ts","webpack:///./src/images/arc-browser-logo.ts","webpack:///./src/model/ui/markdown.ts","webpack:///./src/services/service-versions.ts","webpack:///./src/model/events/event-base.ts","webpack:///./src/components/common/collapsing-buttons.tsx","webpack:///./src/components/common/expand-shrink-button.tsx"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","installedWasmModules","wasmImportObjects","1666","p0i32","exports","p1i32","module","l","e","promises","installedChunkData","promise","Promise","resolve","reject","onScriptComplete","script","document","createElement","charset","timeout","nc","setAttribute","src","p","jsonpScriptSrc","error","Error","event","onerror","onload","clearTimeout","chunk","errorType","type","realSrc","target","message","name","request","undefined","setTimeout","head","appendChild","forEach","wasmModuleId","installedWasmModuleData","importObject","req","fetch","WebAssembly","compileStreaming","all","then","items","instantiate","instantiateStreaming","x","arrayBuffer","bytes","res","w","instance","m","c","d","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","oe","err","console","jsonpArray","this","oldJsonpFunction","slice","SendCardSection","SendBodyCardSection","collapsed","ApiError","operationName","errorCode","super","ScrollableContentContainer","div","expanded","CenteredContentViewerContainer","ContentViewer","props","editorOptions","readOnly","renderedContent","newValue","requestAnimationFrame","onContentRendered","fireImmediately","contentType","text","children","formatter","cache","cacheKey","cachedValue","renderingContent","render","contentBuffer","set","state","formatterConfig","FormatterContainer","layout","Component","content","rawContentType","height","contentId","node","editorNode","options","language","schema","toString","ReadOnlyPairsContainer","EditablePairsContainer","PairDeleteButton","theme","textSize","ReadOnlyPairs","pairs","className","spellCheck","EditablePairs","containerRef","values","lastValuesLength","convert","convertResult","onChangeValues","transformInput","onChange","addedNewRow","container","current","lastInput","querySelector","scrollIntoView","block","behavior","keyTitle","keyPattern","keyPlaceholder","valuePlaceholder","allowEmptyValues","ref","disabled","required","pattern","title","reportValidity","onClick","icon","concat","placeholder","getDesktopInjectedValue","window","addEventListener","DesktopApi","globalThis","desktopApi","formatVersion","version","split","join","replace","getSummary","useragent","hasOS","os","some","hasBrowser","browser","clientName","ua","osDescription","getArticle","nextWord","firstLetter","toLowerCase","getDescription","device","browserDescription","engine","hardwareDescription","vendor","model","cpuDescription","cpu","architecture","deviceDescription","isValidIconName","getIcon","browserName","uaStrings","match","recognizedUaPart","map","Unknown","UNKNOWN_SOURCE","summary","MANUALLY_SENT_SOURCE","description","color","parseSource","userAgentHeader","getResult","userAgent","electronVersion","major","checkForElectron","LoadingCardContent","spin","size","LoadingCard","deserializeByType","lookup","args","typeKey","clazz","MockRuleSerializer","rule","matchers","matcher","steps","step","handler","completionChecker","context","id","activated","CompletionCheckerLookup","MockItemSerializer","item","MockRuleGroupSchema","serializer","oldValue","done","group","deserializer","MockRulesetSchema","isRoot","serializeRules","rules","deserializeRules","SERIALIZED_RULES_MIME_TYPE","ContentLabel","h2","lowlightTextOpacity","ContentValue","ContentLabelBlock","ContentMonoValue","monoFontFamily","ContentMonoValueInline","CopyableMonoValue","span","BlankContentPlaceholder","ExternalContent","Content","dangerouslySetInnerHTML","containerWatermark","linkColor","visitedLinkColor","Markdown","FormatButton","format","onFormatted","canFormat","includes","ImageViewer","isEditorFormatter","input","buildAsyncRenderer","formatKey","observable","Formatters","raw","byteLength","trimRight","base64","markdown","yaml","html","xml","json","inputAsString","JSON","stringify","parse","javascript","css","paramPairs","URLSearchParams","attrs","image","UTF8Decoder","TextDecoder","fatal","generateHar","events","bodySizeLimit","exchanges","otherEvents","isHttp","errors","filter","isTlsFailure","sourcePages","exchangesBySource","source","sourceStartTime","Math","min","timingEvents","startTime","Date","now","startedDateTime","pageTimings","getSourcesAsHarPages","entries","exchange","sendDuration","bodyReceivedTimestamp","startTimestamp","waitDuration","headersSentTimestamp","receiveDuration","responseSentTimestamp","endTimestamp","wsClosedTimestamp","abortedTimestamp","totalDuration","pageref","time","generateHarRequest","response","generateHarResponse","timings","blocked","dns","connect","ssl","send","max","wait","receive","_pinned","pinned","isWebSocket","_resourceType","_webSocketMessages","messages","direction","opcode","isBinary","timestamp","generateHarWebSocketMessage","_webSocketClose","closeState","code","closeCode","reason","closeReason","generateHarHttpEntry","errorEntries","generateHarTlsError","log","creator","pages","_tlsErrors","asHarHeaders","headers","headerValue","headerKey","asHtkHeaders","keyBy","header","mapKeys","_","headerName","mapValues","waitForDecoding","body","decodedPromise","requestEntry","method","url","parsedUrl","httpVersion","cookies","queryString","Array","from","searchParams","paramKey","paramValue","headersSize","bodySize","encoded","decoded","_requestBodyStatus","comment","postData","mimeType","parsedBody","params","generateHarParamsFromParsedQuery","generateHarPostBody","decode","TypeError","_content","encoding","query","innerValue","status","statusText","redirectURL","responseContent","statusCode","statusMessage","assign","failureDuration","failureTimestamp","connectTimestamp","cause","failureCause","hostname","upstreamHostname","clientIPAddress","remoteIpAddress","clientPort","remotePort","sumTimings","keys","k","v","Number","parseHar","harContents","har","entry","serverIPAddress","contentLengthHeader","parseInt","page","cleanRawHarData","baseId","pinnedIds","getTime","wsAcceptedTimestamp","URL","tags","matchedRuleId","protocol","path","pathname","rawHeaders","h","parseHarRequestContents","parseHarPostData","encodedLength","parseHarRequest","parseHarResponse","streamId","Buffer","eventTimestamp","closeEvent","isEncoding","groupBy","valueOf","tryParseUrl","parseable","getFallbackUrl","HttpBody","_decoded","encodedBuffer","_encoded","_contentEncoding","inputBuffer","decodingError","buffer","emptyBuffer","HttpExchange","apiStore","_apiPromise","apiMetadata","_apiMetadataPromise","isCompletedRequest","Map","deep","addRequestMetadata","searchIndex","search","getApi","matchedRule","isCompletedExchange","isSuccessfulExchange","handlerStepTypes","abortMessage","requestBreakpoint","_requestBreakpoint","responseBreakpoint","_responseBreakpoint","addResponseMetadata","requestApiPromise","api","updateWithResponse","clear","cleanup","breakpoint","waitForCompletedResult","responseResult","respondDirectly","bound","POSTHOG_KEY","enabled","navigator","doNotTrack","today","isFirstRun","localStorage","getItem","storedFirstRunDate","firstRunDate","setItem","isFirstRunToday","sessionData","normalizeUrl","seenPages","trackEvent","currentUrl","location","href","capture","category","action","$current_url","$set_once","INITIAL_PARAMS","appHistory","latestState","history","latestLocation","throttledPushState","pushState","leading","trailing","throttledReplaceState","replaceState","removeEventListener","uri","buildThrottledHistorySource","navigate","to","pathString","searchString","accepted","subprotocolHeader","subprotocol","closeData","wasAccepted","markAborted","msg","matchSyntax","syntax","initialIndex","syntaxIndex","stringIndex","fullyConsumed","wasFullMatch","lastConsumingPartSyntaxIndex","lastConsumingPartStringIndex","partMatch","consumed","partiallyConsumed","partsMatched","getSuggestions","syntaxOptions","syntaxMatches","fullMatches","partialMatches","finalSyntaxIndex","suggestion","maxMatchedParts","bestPartialMatches","suggestionsWithMatches","syntaxPartIndex","nextPartToMatch","isLastPart","matchType","canExtend","originalSuggestion","sawTemplate","suggestions","singleSuggestion","updatedText","applySuggestionToText","nextSuggestions","nextSuggestion","showAs","index","matchedAllParts","charRange","charA","charB","charCodeAt","ALPHABETICAL","NUMERIC","ALPHANUMERIC","matchesRange","charCode","range","getNumberAt","getStringAt","NUMBER_CHARS","allowedCharRanges","nextChar","substring","getParsedValue","part","filterContextualSuggestions","existingInput","suggestionGenerator","lowercaseInput","startsWith","FixedStringSyntax","expected","consumedChars","StringSyntax","templateText","allowedChars","AnyAsciiExceptSpaces","allowEmpty","matchingString","SyntaxWrapperSyntax","wrapper","wrappedSyntax","optional","startIndex","isWrapped","endChar","nextEndCharIndex","indexOf","valueToMatch","submatch","hasStartWrapper","wrappedSyntaxStartPosition","needsWrapper","shouldAddStartWrapper","valueSuffix","shownSuffix","extendedValue","extendedShowAs","hasEndWrapper","NumberSyntax","stringSyntax","valueAsString","matches","option","bestMatches","matchingOptions","fullyMatchingOptions","StringOptionsSyntax","subParts","subMatch","parsed","parsedValue","Filter","filterString","constructor","filterDescription","emptyFilterSet","StringFilter","toLocaleLowerCase","operations","numberOperations","stringOperations","endsWith","bufferOperations","equals","operationDescriptions","sizeOperationDescriptions","parseFilter","filterClass","parts","filterSyntax","tryParseFilter","tryParseFilterParts","syntaxParts","parsedParts","op","describeStatus","predicate","requiredLength","matchingNumber","extendedNumber","_v","_i","uniq","Boolean","sort","filterName","CompletedFilter","PendingFilter","AbortedFilter","ErrorFilter","tag","PinnedFilter","categoryString","expectedCategory","MethodFilter","toUpperCase","expectedMethod","HttpVersionFilter","versionString","expectedVersion","ProtocolFilter","expectedProtocol","HostnameFilter","expectedHostname","PROTOCOL_DEFAULT_PORTS","PortFilter","port","expectedPort","explicitPort","PathFilter","expectedPath","QueryFilter","isTemplate","expectedQuery","opIndex","lastIndexOf","getAllHeaders","expectedHeaderValue","flatMap","_k","_hn","isArray","flatten","valueMatchSyntax","expectedHeaderName","headerNameIndex","subPartMatch","subPartSuggestions","expectedSize","requestBody","responseBody","totalSize","bodyContent","expectedBody","hasRequestBody","hasResponseBody","matchesRequestBody","matchesResponseBody","Infinity","ContainsFilter","expectedContent","isRTCConnection","clientURL","remoteURL","isRTCDataChannel","label","isTlsTunnel","upstreamPort","BaseSearchFilterClasses","bestMatch","filterValue","matchingFilterClass","innerFilter","innerFilterSyntax","f","innerValues","trim","innerDescriptions","valuePart","partIsTemplate","innerFilters","delimiterString","minimumRepetitions","placeholderName","delimiterSyntax","matchCount","lastPartMatchEndIndex","nextDelimiterIndex","delimiterMatch","matchSyntaxOnly","wrappedMatch","unshift","SelectableSearchFilterClasses","buildNativeContextMenuItems","callback","EXPANDABLE_VIEW_CARD_KEYS","isExpandableViewCard","isSendRequestCard","isSentResponseCard","EXPANDABLE_SEND_REQUEST_CARD_KEYS","EXPANDABLE_SENT_RESPONSE_CARD_KEYS","isExpandableSendCard","accountStore","initialized","style","backgroundColor","containerBackground","isPaidUser","setTheme","store","darkThemeMq","matchMedia","_setPrefersDarkTheme","_themeName","_prefersDarkTheme","customTheme","viewCardStates","sendCardStates","settingsCardStates","previousElectronAppPaths","activeFilterSet","_customFilters","preferredShell","themeNameOrObject","themeName","animatedExpansionCard","expandedViewCard","onCollapseToggled","toggleViewCardCollapsed","onExpandToggled","toggleViewCardExpanded","cardState","expandedState","expandedSendRequestCard","expandedSentResponseCard","toggleSendCardCollapsed","toggleSendCardExpanded","expandedCardField","toggleSettingsCardCollapsed","preventDefault","openContextMenu","position","pageX","y","pageY","contextMenuState","catch","persist","goToSettings","on","refreshToken","rememberLastLogin","subscriptionPlans","authResult","initialEmailResult","idTokenPayload","email","selectedPlan","updateUser","emit","logIn","setInterval","user","accountDataLastUpdated","isAccountUpdateInProcess","banned","alert","close","getPro","pickPlan","isLoggedIn","userHasSubscription","isPastDueUser","purchasePlan","modal","initialModal","loggedIn","sku","waitForUserUpdate","completedCheck","focused","setFocused","setUnfocused","ticksSinceCheck","focus","cancelSubscription","subscription","featureFlags","subscriptionExpiry","expiry","expiryMargin","isStatusUnexpired","plan","userSubscription","canManageSubscription","isValidPort","isValidHost","host","subnetDescriptionOverrides","getReadableIP","ip","parsedIp","ipaddr","kind","isIPv6","isIPv4MappedAddress","toIPv4Address","subnetType","subnetDescription","toNormalizedString","isValidPortConfiguration","portConfig","endPort","startPort","mockRTCRequestBuilder","externalNetworkAddresses","dnsServers","ruleParameterKeys","loadSettings","startIntercepting","serverVersion","adminClient","AdminClient","adminServerUrl","_http2CurrentlyEnabled","http2Enabled","_currentTlsPassthroughConfig","tlsPassthroughConfig","monitorRemoteClientConnection","startServer","config","maxDelay","delayMs","start","webrtc","http","cors","suggestChanges","http2","https","tlsPassthrough","mockttpRequestBuilder","MockttpAdminRequestBuilder","httpProxyPort","certPath","certificatePath","certContent","certificateContent","certFingerprint","certificateFingerprint","setNetworkAddresses","networkInterfaces","systemProxyConfig","systemProxy","stop","setRequestRules","adminStream","sendQuery","buildAddRequestRulesQuery","setWebSocketRules","buildAddWebSocketRulesQuery","setRTCRules","buildSetRulesQuery","onMockttpEvent","subRequest","buildSubscriptionRequest","subscribe","warn","onMockRTCEvent","refreshNetworkAddresses","setPortConfig","rawData","_portConfig","client","metadata","addresses","iface","a","internal","family","address","failureEvent","openEvent","open","disconnectTimestamp","candidateToUrl","candidate","connectionEvent","sessionId","streams","array","peerId","localSessionDescription","remoteSessionDescription","sourceURL","selectedRemoteCandidate","attachEvent","otherHalf","attachedConnection","externalConnection","ourExternalConnection","theirExternalConnection","ourExternalAddress","selectedLocalCandidate","ourRemoteAddress","theirExternalAddress","remoteCandidate","stream","remove","connection","channelId","rtcConnection","channelLabel","channelProtocol","mid","stats","_totalBytesSent","_totalBytesReceived","trackMid","trackDirection","trackType","previousEvent","round","sentDelta","receivedDelta","totalBytesSent","totalBytesReceived","mockttpEventTypes","mockRTCEventTypes","proxyStore","rulesStore","eventName","eventData","isPaused","eventQueue","queueEventFlush","orphanedEvents","isFlushQueued","updateFromQueuedEvent","queuedEvent","addInitiatedRequest","checkForOrphan","addCompletedRequest","setResponse","addWebSocketRequest","addAcceptedWebSocketResponse","addWebSocketMessage","markWebSocketClosed","markRequestAborted","addTlsTunnel","markTlsTunnelClosed","addFailedTlsRequest","addClientError","addRTCPeerConnection","attachExternalRTCPeer","markRTCPeerDisconnected","addRTCDataChannel","addRTCDataChannelMessage","markRTCDataChannelClosed","addRTCMediaTrack","addRTCMediaTrackStats","markRTCMediaTrackClosed","flushQueuedUpdates","isRTCMediaTrack","uniqBy","orphanEvent","matchedItem","existingEventIndex","updateFromCompletedRequest","getMatchedRule","websockets","setAccepted","addMessage","markClosed","tunnel","conn","rtcConnections","find","isOtherHalfOf","attachExternalPeer","connectOtherHalf","dc","addStream","channel","rtcDataChannels","track","rtcMediaTracks","addStats","removeStream","deleteEvent","clearPinned","pinnedEvents","unpinnedEvents","ex","gc","harParseError","initialEvents","updateEvents","struct","filterProps","clickOnEnter","currentTarget","dispatchEvent","MouseEvent","bubbles","noPropagation","stopPropagation","inputValidation","checkFn","errorMessage","inputValue","setCustomValidity","validity","valid","CloseButton","tabIndex","onClose","onKeyPress","inverted","mainBackground","mainColor","top","right","ExternalLinkIcon","popColor","DocsA","DocsLink","rel","BackgroundIcons","InterceptOptionCard","uiConfig","width","columnWidth","gridWidth","rowHeight","LoadingOverlay","StatusPill","cardRef","onActivationStarted","interceptor","activateInterceptor","activationOptions","interceptorStore","onActivationSuccessful","showRequests","isDisabled","isActivable","ConfigComponent","configComponent","icons","iconProps","onKeyDown","reportStarted","reportSuccess","closeSelf","descParagraph","customPill","CustomPill","isActive","isSupported","notAvailableHelpUrl","getStatusPill","inProgress","InstructionsContainer","InstructionsStep","headingSize","Nowrap","ManualInterceptPill","ExportCertificateButton","ManualInterceptCustomUi","CopyIconButton","useTemporaryFlag","flagResetTimer","setFlagResetTimer","flagged","setFlagged","CopyButtonIcon","success","showSuccess","fixedWidth","CopyButtonPill","CopyableCommand","onCopy","containerBorder","highlightBackground","highlightColor","mainLowlightBackground","ConfigContainer","reportedActivated","shellCommands","command","selectedShell","multipleShellsMaybeSupported","multipleShellsMaybeAvailable","shell","uiStore","commands","intervalId","refreshInterceptors","clearInterval","reportActivated","shellDescription","shouldShowDropdown","selectShell","interceptCommand","ExistingTerminalCustomUi","Spacer","Hr","hr","SelectAndInterceptButton","RememberedOption","InterceptButton","ForgetPathButton","platform","selectApplication","appPicker","pathToApplication","runApplication","rememberElectronPath","forgetElectronPath","binary","binaryArticle","binaryName","pathParts","appPart","getReadablePath","ElectronCustomUi","getConfigRequestIds","eventsStore","setUpAndroidCertificateRule","onNextConfigRequest","ensureRuleExists","GET","SimplePathMatcher","Always","certificate","previousConfigRequestIds","setupParams","serializedSetupParams","AndroidDeviceCustomUi","DeviceList","ul","AdbDevice","li","AdbDeviceButton","inProgressIds","onSuccess","deviceIds","interceptDevice","activating","deviceId","activationPromise","finally","AndroidAdbCustomUi","closeConfirmRequired","confirm","closeConfirmed","ExistingBrowserCustomUi","SpinnerBlock","Spinner","ListScrollContainer","TargetList","Target","TargetButton","TargetIcon","TargetText","ellipseDirection","targetName","targets","interceptTarget","jvmTargets","updateTargets","inProgressPids","updateInterval","interestingTargets","proxyPort","pid","alreadyIntercepted","interceptedByProxy","interceptedByUs","contextName","mainName","packageParts","reverse","packageName","filePath","dirParts","dirPath","PackageName","ClassName","Footer","targetPid","shallow","JvmCustomUi","labels","containerName","names","containerDescription","ContainerName","ImageName","containerId","DockerAttachCustomUi","previousIOSRequestIds","getIOSRequestIds","iOS","ManualIOSCustomUi","BROWSER_TAGS","JVM_TAGS","MOBILE_TAGS","ANDROID_TAGS","IOS_TAGS","TERMINAL_TAGS","androidInterceptIconProps","transform","Android","recoloured","getChromiumOptions","webExtensionEnabled","INTERCEPT_OPTIONS","Docker","Chrome","getActivationOptions","Chromium","Brave","Firefox","checkRequirements","interceptorVersion","Arc","Safari","Edge","Opera","Java","Terminal","clientOnly","Network","Desktop","Electron","getInterceptOptions","serverInterceptorArray","serverInterceptors","serverInterceptor","refreshInterceptorInterval","interceptorId","interceptors","supportedInterceptors","apiMetadataSchema","serializr","spec","serverMatcher","requestMatchers","pathMatcher","queryMatcher","pathSpec","paths","EXTRA_APIS","customOpenApiSpecs","storage","jsonify","publicApiCache","baseUrl","info","rawUrl","urlA","_apiA","urlB","_apiB","apiBaseUrl","customOpenApiSpecsByUrl","specId","fetchApiMetadata","apiSpecId","privateSpec","getPrivateApi","publicSpecId","openApiId","matchingExtraApiKey","apiPrefix","findPublicApi","publicSpecs","getPublicApi","apis","matchingApis","matched","findBestMatchingApi","ServiceWorkerNoSupportError","setPrototypeOf","attemptServerUpdate","showPleaseUpdateMessage","SidebarNav","nav","sidebarItemStyles","SidebarLogo","img","alt","SidebarSelectableItem","selected","Separator","SidebarLink","highlight","SidebarButton","Sidebar","itemContent","component","dedent","ConnectedSource","ConnectedSources","activeSources","SearchInput","ClearSearchButton","visible","SearchBox","autoFocus","onSearch","iconSize","InterceptPageContainer","section","InterceptInstructions","loudHeadingSize","InterceptSearchBox","gridRef","visibleInterceptOptions","onSearchInput","sortBy","StyledInterceptPage","SplitPane","hiddenPane","EmptyState","focusableElementSelector","getFocusableChildren","element","querySelectorAll","offsetParent","buildContextMenuCallback","isReadOnly","baseEditorRef","mouseEvent","editor","selection","getSelection","isEmpty","getModel","getValueInRange","executeEdits","forceMoveMarkers","clipboard","readText","handleContextMenuEvent","MonacoEditor","rmeModulePromise","loadMonacoEditor","retries","rmeModule","monacoEditorModule","onDidChangeMarkers","modelUris","markers","getModelMarkers","modelsMarkers","marker","modelUri","resource","markersSoFar","default","EditorMaxHeightContainer","onResize","relayout","resizeObserver","ResizeObserver","contentHeight","contentUpdate","observe","disconnect","onContextMenu","monacoTheme","onContentSizeChange","ContainerSizedEditorContainer","EditorFocusWrapper","thisElement","shiftKey","allFocusableElements","elementLastChild","currentTabIndex","nextTabbableElement","firstFocussableChild","contains","activeElement","onFocus","parentElement","monacoEditorLoaded","registeredSchemaUri","resetUIState","getContribution","cb","originalFocusMethod","monaco","setSelection","Selection","getMarkerController","onDidChangeModel","newModelUrl","onDidContentSizeChange","withoutFocusingEditor","showAtMarker","structural","existingOptions","languages","jsonDefaults","diagnosticsOptions","newSchemaMappings","schemas","uriString","newSchema","existingMapping","sm","fileMatch","validate","setDiagnosticsOptions","newOptions","showFoldingControls","scrollbar","alwaysConsumeMouseWheel","quickSuggestions","parameterHints","codeLens","minimap","contextmenu","scrollBeyondLastLine","colorDecorators","renderValidationDecorations","fontSize","wordWrap","editorDidMount","onEditorDidMount","withFirstCharUppercased","summarizeMatcherClass","isMethod","nameHandlerClass","summarizeMatcher","explain","summarizeHandler","stepExplanations","StatusCode","ClearAllButton","onClear","ExportAsHarButton","harContent","filename","ImportHarButton","uploadedFile","loadFromHar","PlayPauseButton","togglePause","ScrollToEndButton","onScrollToEnd","matchFilters","filterClasses","remainingString","filters","firstFullMatch","fm","matchedString","trimLeft","applySuggestionToFilters","filterSet","FilterTagDelete","FilterTagName","FilterTagContainer","ignoreTripleClick","detail","FilterTag","isSelected","onMouseDown","onDelete","ExistingText","SuggestedText","SuggestionRowContainer","isHighlighted","SuggestionRowPart","SuggestionDetails","SuggestionDeleteButton","SuggestionDescription","FilterSuggestionRow","partiallyMatchedChars","existingText","suggestedAddition","isSaveFiltersSuggestion","saveFilters","SaveFiltersContainer","SaveFiltersRow","filterCount","FilterInputField","FilterSuggestionsBox","renderInputField","renderSuggestionsBox","containerProps","areSuggestionsVisible","autosuggestRef","autosuggestRoot","listbox","FilterInput","getFilterSuggestions","availableFilters","suggestionContext","considerSuggestion","onFiltersConsidered","activeFilters","updatedFilters","selectSuggestion","onFiltersSaved","onFiltersChanged","clearSuggestions","autosuggest","justSelectedSuggestion","revealSuggestions","resetHighlightedSuggestion","shouldRenderSuggestions","getSuggestionTextValue","onInputChange","inputProps","searchInputRef","shouldShowSave","shouldHighlightFirst","suggestionsWithSave","rowRenderer","buildRowRenderer","onDeleteCustomFilter","onCustomFilterDeleted","isCustomFilter","multiSection","highlightFirstSuggestion","onSuggestionsFetchRequested","onSuggestionsClearRequested","onSuggestionHighlighted","onSuggestionSelected","getSuggestionValue","renderSuggestion","renderInputComponent","renderSuggestionsContainer","SearchFilterBox","hasContents","FloatingSearchButtonStyles","FloatingClearFiltersButton","FloatingFilterDocsButtonLink","boxRef","tagRefs","selectedFilters","undoer","updateSelectedTags","getSelectedFilters","filterBox","selectedFilterElements","isCollapsed","containsNode","getSelectedFilterElements","removeAllRanges","selectAllFilterTags","redo","undo","filterTagElements","filterInput","filterElements","focusedElement","focusedElementIndex","lastCursorPosition","setSelectionRange","elementToSelect","cursorPosition","lastSelectedIndex","deleteSelectedFilters","inputEndPosition","ctrlKey","altKey","metaKey","inputCursorPosition","selectionStart","selectionEnd","inputCursorIndex","isInputSelected","filterIndexToDelete","nextFilter","filtersToCopy","serialization","serialize","onCut","onPaste","pastedFilters","clipboardData","getData","pastedStringInput","currentTextInput","updatedTextInput","endOfPastedContent","onInputChanged","onFiltersCleared","textInput","builtInFilters","customFilters","parsedFilters","filtersToInsert","buildCustomFilter","currentlySelectedFilters","tagElement","delete","setBaseAndExtent","remainingInputText","filterSuggestionContext","stringFilter","otherFilters","textInputValue","RequestCounter","filteredEventCount","eventCount","ButtonsContainer","ViewEventListFooter","allEvents","filteredCount","filteredEvents","EmptyStateOverlay","ListContainer","Column","RowPin","RowMarker","MarkerHeader","Method","Status","Source","Host","PathAndQuery","EventTypeColumn","RTCEventLabel","RTCEventDetails","RTCConnectionDetails","BuiltInApiRequestDetails","EventListRow","TrafficEventListRow","TlsListRow","TableHeader","EventRow","selectedEvent","contextMenuBuilder","TlsRow","tlsEvent","isBuiltInApi","matchedOperation","BuiltInApiRow","ExchangeRow","RTCConnectionRow","RTCStreamRow","role","getContextMenuCallback","isBreakpointed","ConnectedSpinnerIcon","service","shortName","operation","parameters","param","isOpen","listBodyRef","listRef","KeyBoundListWindow","focusSelectedEvent","onListMouseDown","isSelectedEventVisible","selectedEventId","listBody","focusEvent","wasListAtBottom","updateScrolledState","isListAtBottom","button","row","ariaRowIndex","getAttribute","eventIndex","onEventSelected","onEventDeselected","innerRef","outerElementType","itemCount","itemSize","itemData","listItemData","onScroll","rowElement","listWindow","scrollTop","scrollHeight","offsetHeight","scrollToItem","targetIndex","list","rowCount","windowHeight","clientHeight","halfHeight","rowOffset","maxOffset","targetOffset","scrollTo","onSelected","moveSelection","exportHar","generateCodeSnippet","snippetFormat","waitForBodyDecoding","harRequest","harSnippetBase","simplifyHarForSnippetExport","snippetExportOptions","clients","link","getCodeSnippetFormatKey","getCodeSnippetOptionFromKey","getCodeSnippetFormatName","onPin","onBuildRuleFromExchange","BaseOptions","Pin","Delete","preferredExportFormat","exportSnippetFormat","snippetGroupName","snippetOption","PaneOuterContainer","PaneScrollOuterContainer","PaneScrollInnerContainer","PaneScrollContainer","visualDirection","StreamMessageCollapsedRow","CollapsedStreamRowContainer","messageDirection","nextElementSibling","previousElementSibling","MessageArrow","CollapsedStreamContent","onEditorContentRendered","setContentType","onMessageChanged","prevProps","messageIndex","selectedContentType","onExportMessage","compatibleContentTypes","EditorRowContainer","EditorRowHeader","nameFormatter","RowEditorContent","getFilename","filenamePrefix","someBinary","expandedRow","exportMessages","someBinaryMessages","exportMessage","streamType","streamLabel","StreamMessagesList","expandRow","CollapsibleSectionWrapper","withinGrid","SummaryWrapper","SummaryAsSpacer","prefixTrigger","sectionSummary","sectionBody","otherChildren","toArray","hasBody","bodyElement","trigger","CollapsibleTrigger","canOpen","toggleOpen","OPEN_ICON","CLOSED_ICON","CollapsibleSectionSummary","CollapsibleSectionBody","WebSocketCloseCard","closeCodeDocs","responseDetails","showOnceLoaded","display","ProPill","ProHeaderPill","GetProButton","primaryInputColor","primaryInputBackground","CardSalesPitch","CardSalesPitchContainer","BlurOverlay","OverlayContainer","OverlayGetProButton","buttonRef","createRef","inert","ServiceLogo","onLoad","ParametersGrid","ParameterKeyValue","ParamName","UnsetValue","ParamMetadata","in","defaultValue","enum","WarningIcon","warningColor","Warning","formatValue","getDetailsWithWarnings","details","warnings","warning","ObjectParamContainer","ObjectParamKey","ObjectParamValue","pre","ObjectParamDetails","ApiRequestDetails","setParameters","relevantParameters","operationDetails","hasOperationDetails","docsUrl","logoUrl","HttpApiCard","apiName","apiExchange","HttpApiPlaceholderCard","SourceIcon","getExpiryExplanation","date","exactTime","relativeTime","CookieHeaderDescription","requestPath","requestUrl","cookie","sameSite","secure","domain","httpOnly","maxAge","expires","UserAgentHeaderDescription","HeadersGrid","HeaderKeyValue","HeaderName","HeaderDescriptionContainer","HeaderDocsLink","HeaderDetails","sortedHeaders","docs","headerDocs","getHeaderDescription","BreakdownContainer","BreakdownKey","BreakdownValue","ParameterSeparator","UrlBreakdown","decodedPathname","decodeURIComponent","username","password","MatchedRulePill","stepTypes","ruleData","stepDescription","RawRequestDetails","methodDocs","methodDetails","HttpRequestCard","matchedRuleData","onRuleClicked","noopRule","every","HttpResponseCard","apiResponseDescription","statusDocs","ErrorContent","HttpAbortedResponseCard","cardProps","CACHEABLE_METHODS","CACHEABLE_STATUSES","PERMANENTLY_CACHEABLE_STATUSES","CORS_SIMPLE_METHODS","CORS_SIMPLE_HEADERS","formatHeader","THE_DAWN_OF_TIME","formatDuration","seconds","parseCCDirectives","reduce","directive","ALL_CACHES","PRIVATE_ONLY","explainValidCacheTypes","explanation","responseCCDirectives","explainCacheMatching","allowedMethods","allowedHeaders","allowsCredentials","varyHeaders","hasVaryHeaders","varySummary","varyExplanation","realHeaderValue","explainCacheLifetime","maxAgeHeader","dateHeader","expiresHeader","sharedMaxAge","hasExplicitLifetime","lifetime","hasNegativeLifetime","explainSharedCacheLifetime","explainLifetime","staleBonusBehaviourSummary","revalidationSummary","staleBonusBehaviour","explainRevalidation","shouldSuggestImmutable","sigFig","num","figs","parseFloat","toFixed","DurationPill","duration","durationMs","doneTimestamp","HttpPerformanceCard","CompressionPerformance","CachingPerformance","getEncodingName","CompressionDescription","encodings","encodedBodyLength","decodedBodyLength","compressionRatio","CompressionResultsContainer","CompressionResultsPill","CompressionOptions","encodingTestResults","realCompressionRatio","omitBy","_size","testedCompressionRatio","CompressionOptionsContainer","PerformanceExplanation","CompressionOptionsTips","clientAcceptedEncodings","messageType","getEncodings","encodedBody","decodedBody","decodedBodySize","encodedBodySize","bestOtherEncoding","betterEncodingAvailable","cacheability","cacheable","hasRevalidationOptions","revalidationSuggestion","postExplanation","contentLocationUrl","hasFreshnessInfo","contentLocationIsCurrentUri","responseDateHeader","abs","isDefaultCacheableStatus","cacheableReason","explainCacheability","cacheDetails","SnippetDescriptionContainer","SnippetDetailButtons","SnippetEditorContainer","snippetEditorOptions","hover","ExportSnippetEditor","exportOption","snippet","ExportHarPill","setSnippetOption","optGroups","keyFormatter","optionKey","HeaderCard","HeaderButtonStyles","HeaderText","HeaderButton","SecondaryHeaderButton","typeCheck","types","isInitialRequestError","isClientBug","wasNotForwarded","wasResponseIssue","wasTimeout","isWhitelistable","isMockable","HttpErrorHeader","advancedHeaderOverflowSupported","semver","ignoreError","mockRequest","ScrollToButton","PinButton","DeleteButton","MockButton","isExchange","HttpDetailsFooter","onScrollToEvent","HttpRequestBreakpointHeader","onCreateResponse","onResume","HttpResponseBreakpointHeader","outputToRawHeaders","output","stripPseudoHeaders","stripPseudoHeadersAndLowercase","EditableRawHeaders","preserveKeyCase","withH2HeadersDisabled","convertToRawHeaders","newInput","convertFromRawHeaders","onInvalidState","onChangeRawHeaders","UrlInput","validMethods","MethodSelect","inProgressResult","onMethodChanged","methodOption","onUrlChanged","onHeadersChanged","isHttp2","StatusContainer","isDefaultMessage","EditableStatus","invalid","newStatusCode","newStatusMessage","newMessage","InlineEditableStatus","onStatusChange","NaN","onBodyChange","textEncoding","contentTypeHeader","exchangeId","bodyString","onBodyFormatted","contentTypeOptions","onChangeContentType","CardDivider","viewCardProps","rawName","cleanedName","makeFriendlyApiName","headerCard","renderHeaderCard","renderExpandedCard","cards","renderBreakpointCards","renderNormalCards","respondToBreakpointedRequest","resume","errorHeaderProps","tagsToErrorType","expandedCard","renderRequestBody","renderResponseBody","renderWebSocketMessages","updateMetadata","renderApiCard","jumpToRule","webSocketClose","performance","export","requestBodyParams","updateBody","apiBodySchema","bodySchema","responseBodyParams","urlParts","baseName","webSocketMessages","streamMessageEditor","requestEditor","responseEditor","draftRules","currentRuleDraft","currentStepTypes","AndroidIcon","failure","sourceDetailParts","sourceIp","sourceDetails","RTCDataChannelCard","dataChannel","RTCConnectionHeader","hideConnection","jumpToConnection","isConnectionHidden","SentDataColour","ReceivedDataColour","GraphSvg","svg","SendReceiveGraph","graphPaddingPx","bottom","innerHeight","axisMargin","innerWidth","xScale","dataMax","sent","received","sentYScale","receivedYScale","sentData","receivedData","Group","left","GraphArea","yScale","fill","AxisLeft","scale","labelOffset","labelClassName","tickFormat","tickClassName","numTicks","AreaClosed","curve","LinePath","stroke","strokeWidth","RTCMediaCard","mediaTrack","StatsGraphWrapper","stat","ParentSize","parent","graphData","hasData","hasVideo","hasAudio","sessionDescription","sdp","dataChannelEditors","dataChannels","streamCardState","offerEditor","answerEditor","locallyInitiated","offerDescription","answerDescription","offerCardProps","rtcSessionOffer","answerCardProps","rtcSessionAnswer","mediaTracks","toggleCollapse","expandStream","ViewPageKeyboardShortcuts","onStartSearch","EDITOR_KEYS","editors","searchFiltersUnderConsideration","confirmedSearchFilters","currentSearchFilters","eventId","splitDirection","scrollToEvent","newFilteredEvents","oldFilteredEvents","filteredEventState","rightPane","streamMessage","onScrollToCenterEvent","minSize","onForceClear","primary","defaultSize","maxSize","LeftPane","onSearchFiltersConsidered","distance","currentIndex","targetEvent","rowIndex","wasSelected","nextEvent","confirmRequired","someEventsPinned","allEventsPinned","clearInterceptedData","scrollToCenterEvent","scrollToEnd","StyledViewPage","FloatingDragHandle","DragHandle","IconMenu","topOffset","IconMenuButton","CollapsedItemPlaceholder","borderColor","TitleButtonContainer","TitleButton","RuleGroupMenu","onClone","toggleState","onToggleActivation","GroupHeaderContainer","depth","editingTitle","extendGroupDraggableStyles","snapshot","overrideStyles","transition","combineWith","opacity","isFullyActiveGroup","GroupHeader","isEditing","setEditing","unsavedTitle","setUnsavedTitle","toggleCollapsed","startEditing","editTitle","resetTitle","saveTitle","updateGroupTitle","allRulesActivated","toggleActivation","deleteGroup","cloneGroup","draggableId","provided","draggableProps","dragHandleProps","initialMatcher","MethodMatcher","GroupTailPlaceholder","GroupTail","isDragDisabled","InitialMatcherConfiguration","matcherKey","configProps","matcherIndex","AdditionalMatcherConfiguration","matcherClass","ConfigLabel","MatcherConfigContainer","fieldId","methodName","methodValues","isNaN","htmlFor","interaction","interactionName","HostMatcher","urlMatch","exec","fullMatch","ensurePathIsValid","ExactQueryMatcher","RegexInput","containsLiteralQuestionMark","regexSource","examples","regex","RegExp","exp","defaultRange","subtract","gen","example","RegexPathMatcher","pairsArrayToQueryObject","queryPairs","queryParams","queryObject","QueryMatcher","convertInput","HeaderMatcher","BodyContainer","RawBodyMatcher","RawBodyIncludesMatcher","JsonBodyMatcher","JsonBodyFlexibleMatcher","matcherContent","parsedContent","arg","argValue","argType","onJsonChange","getMatcherKey","MatcherRow","MatcherInputsContainer","MatcherButton","InitialMatcherConfigContainer","InitialMatcherRow","availableInitialMatchers","httpMatchers","otherMatchers","MatcherCls","MatcherOptions","NewMatcherConfigContainer","form","LowlightedOption","draftMatchers","invalidMatcherState","dropdownRef","updateDraftMatcher","onAdd","dropdown","availableMatchers","markMatcherInvalid","saveMatcher","selectMatcher","onSubmit","getHandlerKey","HandlerOptions","handlers","summarizeHandlerClass","HandlerSelect","HandlerSelector","allowedHandlers","needProHandlers","availableHandlers","handlerClass","ruleType","handlerKey","instantiateHandler","ConfigExplanation","HandlerConfiguration","SectionLabel","ConfigSelect","WideTextInput","BodyHeader","updateHandler","detectedContentType","previousContentType","newContentType","expectedContentType","previousBody","newBody","lengthHeader","bodyAsString","setStatus","setBody","BodyFileContainer","BodyFileButton","BodyFilePath","selectFile","updateHostHeader","targetHost","forwarding","onTargetChange","onUpdateHeaderChange","savedTargetHost","urlWithoutProtocol","protocolMatch","validProtocols","HandlerClass","TransformSectionLabel","TransformSectionSeparator","TransformConfig","active","TransformDetails","SelectTransform","transformRequest","transformResponse","transformField","objName","MethodTransformConfig","replacementMethod","replaceMethod","StatusTransformConfig","replacementStatus","replaceStatus","convertResultFromRawHeaders","onTransformTypeChange","clearValues","FIELDS","field","setHeadersValue","selectBodyReplacementFile","replaceBody","bodyReplacementBuffer","setBodyReplacement","setJsonBodyUpdate","RawBodyTransfomConfig","replaceBodyFromFile","JsonUpdateTransformConfig","updateJsonBody","StandaloneFormatButton","setError","setBodyString","NATIVE_ETH_TYPES_PATTERN","typeValuePairs","outputTypes","stringValues","encodedData","newPairs","parsedValues","argument","test","valueString","valueGetter","handlerStringValue","normalizedCurrentValue","explanationPart","newContent","handlerFactory","receiptValue","blockValue","errorData","errorName","onChangeMessage","onChangeCode","onChangeData","onChangeName","resultPairs","Name","Hash","Type","Cid","messageAsString","setChannelLabel","setMessage","RuleTitle","EditableTitleContainer","TitleInput","TitleEditButton","EditableRuleTitle","onEditTitle","onSave","onCancel","RowContainer","deactivated","AddRuleRow","MatcherOrHandler","Summary","h1","ArrowIcon","Details","DetailsHeader","RuleMenuContainer","RuleMenu","isEditingTitle","onSetCustomTitle","hasUnsavedChanges","isNewRule","onReset","onToggleCollapse","extendRowDraggableStyles","initialMatcherSelect","saveRule","stopEditingTitle","resetRule","deleteRule","cloneRule","empty","toggleRuleCollapsed","ruleColour","ruleHandlers","shouldShowSummary","titleEditState","startEnteringCustomTitle","originalTitle","cancelEditingTitle","setInitialMatcher","ms","updateMatcher","deleteMatcher","existingMatchers","addMatcher","ruleHandler","handlerIndex","currentRuleType","newRuleType","newHandler","getRuleDefaultHandler","newTitle","demoHandler","shownHandler","isHandlerDemo","MockRuleListContainer","ol","buildDragEndListener","indexMapping","destination","combine","currentlyDraggingRuleId","sourcePath","isTail","targetId","targetPath","targetItem","moveRule","combineRulesAsGroup","wasGroupOpenBeforeDrag","sourceIndex","destinationIndex","displacedItemPath","pathComparison","displacedItemParent","displacedItemIndex","displacedItem","sourceParentPath","targetParentPath","targetParentParentPath","offset","getDragTarget","activeRules","addRule","deleteItem","cloneItem","collapsedRulesMap","beforeDrag","ruleRows","buildRuleRows","allDraftRules","allActiveRules","ruleGroup","ruleGroupPath","overallStartIndex","rowEventHandlers","itemPath","subResult","changed","draftRule","draftPath","activePath","draftParent","activeParent","activeRule","activeCommonSiblings","draftCommonSiblings","getChangedState","onBeforeCapture","onDragEnd","isCombineEnabled","droppableId","droppableProps","MockPageContainer","MockPageScrollContainer","MockPageHeader","MockHeading","SaveButton","OtherButton","initialRuleId","importRules","loadSavedRules","exportRules","rulesetContent","ruleIds","ruleMapIds","extraIds","missingIds","extraId","missingId","ruleElement","areSomeRulesUnsaved","areSomeRulesNonDefault","deleteDraftItem","moveDraftRule","combineDraftRulesAsGroup","resetToDefaults","resetRuleDrafts","saveAll","ruleId","savedRule","saveItem","clonedItem","existingChildIndex","addDraftItem","saveRules","collapseAll","resetRulesToDefault","newRule","InjectedMockPage","HeaderFieldsContainer","SendRequestHeadersCard","updateHeaders","headerAlignment","onBodyUpdated","RequestPaneContainer","hasExpandedChild","sendCardProps","requestInput","updateMethod","updateUrl","sendRequest","requestHeaders","rawBody","changeEvent","ResponseStatusSection","SentResponseHeaderSection","ResponsePaneContainer","renderSuccessfulResponse","renderAbortedResponse","renderInProgressResponse","responseHeaders","SendPageContainer","requestEditorNode","attributes","responseEditorNode","sentExchange","sendStore","TabbedOptionsContainer","TabsContainer","tabValue","tab","Tab","SettingsButtonCss","SettingsButton","SettingsButtonLink","SettingsExplanation","SettingsSubheading","StringListContainer","ConfigValueRow","changeInput","addHost","validationFn","RestartApp","reload","UnsavedIcon","ProxyPortsContainer","warningBackground","ProxyPortStateExplanation","Http2Select","hostnameValidation","minPortValue","maxPortValue","updatePortConfig","isCurrentPortConfigValid","hostnameIndex","passthroughItem","http2CurrentlyEnabled","currentTlsPassthroughConfig","isCurrentPortInRange","onMinPortChange","onMaxPortChange","addTlsPassthroughHostname","removeTlsPassthroughHostname","UpstreamProxySettings","UpstreamProxyDropdown","validateHost","isValidProxyHost","validateProxyHost","proxyType","upstreamProxyType","proxyHostInput","upstreamProxyHost","upstreamNoProxyHosts","effectiveSystemProxyConfig","savedProxyType","savedProxyHost","noProxyHosts","setProxyType","setProxyHostInput","saveProxyHost","addNoProxyHost","removeNoProxyHost","proxyUrl","ClientCertificatesList","CertificateFilename","DecryptionInput","DecryptionSpinner","clientCertHostInput","certFileInputRef","decryptClientCertData","pfx","passphrase","clientCertData","clientCertState","clientCertError","handleClientCertValidationResult","clientCertificateHostMap","files","file","fileReader","FileReader","readAsArrayBuffer","thisConfig","cert","removeClientCertificate","click","accept","onClientCertSelected","dropClientCertData","addClientCertificate","AdditionalCertificateList","CertificateDescription","AddCertificateButton","certFileButtonRef","addCertificate","additionalCaCertificates","rawPEM","subject","org","serial","removeCertificate","whitelistedCertificateHosts","hostIndex","addHostToWhitelist","unwhitelistHost","UploadSpecButton","BaseUrlInput","SavedBaseUrl","Spec","UndoButton","AddButton","ApiRows","updateValidationMessage","uploadSpecButtonRef","specProcessingInProgress","enteredBaseUrl","baseUrlInputRef","uploadSpec","openApiSpec","swagger","patch","openapi","selectedSpec","servers","variables","variableName","variable","onBaseUrl","saveApi","addCustomApi","customOpenApiInfo","deleteApi","resetApiInputs","baseUrlError","hash","existingBaseUrls","protocollessUrl","validateBaseUrl","deleteCustomApi","SettingsPagePlaceholder","SettingsPageScrollContainer","SettingPageContainer","SettingsHeading","AccountDetailsContainer","AccountControls","AccountContactFooter","ThemeColors","ThemeColorBlock","themeColor","EditorContainer","AccountUpdateSpinner","confirmSubscriptionCancellation","planName","cancelEffect","userEmail","logOut","settingsCardProps","sub","account","addSuffix","partialMethod","lastReceiptUrl","updateBillingDetailsUrl","proxy","themes","InjectedSettingsPage","ModalOverlay","modalGradient","ModalButton","PlanPickerModal","dialog","PlanPickerDetails","PlanPickerHeading","PlanCycleToggle","fontFamily","PlanCycle","PlanPickerButtons","PlanSecondaryButton","PricingTable","PricingTier","highlighted","TierHeader","TierPriceBlock","TierPrice","largeHeadingSize","TierPriceCaveats","small","TierLicense","TierFeatures","FeatureHeading","Feature","SubFeature","SubFeatures","PricingCTA","PlanSmallPrint","SpinnerModal","planCycle","getPlanMonthlyPrice","tierCode","isPricingAvailable","plans","getSKU","prices","monthly","buyPlan","onPlanPicked","closePicker","toggleCycle","CheckoutSpinner","renderItem","menuState","onVisibilityChange","onHidden","show","ThemedMenu","AppContainer","Route","pageComponent","otherProps","AppKeyboardShortcuts","canVisitSettings","canVisitSend","listen","trackPage","setSelectedPlan","cancelCheckout","clearHtmlContextMenu","removeAttribute","menuItems","noThrow","AppWithStoreInjected","InjectedStorePoweredThemeProvider","ErrorOverlay","feedbackSent","errorInfo","withScope","scope","setExtra","captureException","sendFeedback","showReportDialog","Event","authToken","enforceActions","registration","mapScriptUrlOrOptions","targetScriptUrl","maybeOptions","serviceWorker","register","update","runtimeDependencies","hasShownUpdateMessage","desktopVersion","checkForOutdatedComponents","stores","appStartupPromise","init","api_host","autocapture","capture_pageview","advanced_disable_decide","disable_session_recording","persistence","race","isTimeout","currentVersion","interactiveMouseoverStyles","UnstyledButton","UnstyledButtonLink","withComponent","BaseButtonStyles","Button","defaultProps","ButtonLink","SecondaryButton","secondaryInputColor","secondaryInputBorder","invalidTextCss","TextInput","textInputFontSize","textInputBackground","textInputColor","Select","select","MethodNames","isRuleGroup","isRuleRoot","comparePaths","pathA","pathB","diff","getItemParentByPath","getItemAtPath","updateItemAtPath","newItem","parentPath","childIndex","parentItems","deleteItemAtPath","itemIndex","findItem","findItemPath","currentPath","flattenRules","mapRules","fn","totalIndex","areItemsEqual","b","areGroupsEqual","areRulesEqual","CUSTOM_RULE_EQUALS","isEqual","MethodMatchers","uiType","WildcardMatcher","DefaultWildcardMatcher","AmIUsingMatcher","StaticResponseHandler","SimpleHandlerDefinition","serializedData","FromFileResponseHandler","FileHandlerDefinition","PassThroughHandler","PassThroughHandlerDefinition","activePassthroughOptions","ForwardToHostHandler","forwardToLocation","TransformingHandler","activeRequestTransforms","activeResponseTransforms","handlerA","handlerB","RequestBreakpointHandler","beforeRequest","triggerRequestBreakpoint","ResponseBreakpointHandler","beforeResponse","triggerResponseBreakpoint","RequestAndResponseBreakpointHandler","TimeoutHandler","TimeoutHandlerDefinition","CloseConnectionHandler","CloseConnectionHandlerDefinition","ResetConnectionHandler","ResetConnectionHandlerDefinition","HttpMatcherLookup","MatcherLookup","HttpInitialMatcherClasses","HttpHandlerLookup","HandlerDefinitionLookup","HEADER_NAME_PATTERN","HEADER_NAME_REGEX","headersToRawHeaders","acc","rawHeadersToHeaders","headersObj","existingValue","getHeaderValue","headerPair","setHeaderValue","lowercaseHeaderKey","withHeaderValue","headerAdditions","lastHeader","val","asHeaderArray","sep","headersToFlatHeaders","fontSizes","subHeadingSize","NARROW_LAYOUT_BREAKPOINT","lightTheme","pillContrast","globalCss","darkTheme","highContrastTheme","Themes","monacoColorOverrides","monacoThemes","defineMonacoThemes","defineTheme","base","inherit","colors","styled","createGlobalStyle","keyframes","ThemeProvider","GlobalStyles","CollapseIcon","Card","LittleCard","MediumCard","BigCard","CollapsibleCard","CollapsibleCardContainer","renderChildren","showCollapseIcon","child","cardDirectionCss","CollapsibleCardHeading","RUNNING_IN_WORKER","firstMatch","tests","longestPrefix","baseString","strings","prefix","shortestLength","char","fakeBuffer","encoder","TextEncoder","strictDecoder","laxDecoder","binaryLaxDecoder","isProbablyUtf8","dataToCheck","stringToBuffer","encode","bufferToString","isSerializedBuffer","obj","asBuffer","isBuffer","byteOffset","Blob","tryParseJson","recursiveMapValues","innerObj","isReactElement","$$typeof","windowSize","Ctrl","isCmdCtrlPressed","isEditable","tagName","isContentEditable","useHotkeys","deps","saveFile","objectUrl","createObjectURL","removeChild","revokeObjectURL","uploadFile","acceptedMimeTypes","promptResult","prompt","fileInput","readAsText","useSize","spaceAvailable","setSpaceAvailable","clientWidth","copyToClipboard","textToCopy","writeText","textArea","prepend","execCommand","isErrorLike","stack","asError","UnreachableCheck","getValue","unreachableCheck","StreamMessage","inputMessage","startOfMessage","encodeAbi","NATIVE_ETH_TYPES","bits","paramValidator","coerceTypes","strict","strictSchema","formats","Proxy","getBodySchema","bodyDefinition","schemasByType","mediaTypeKeys","schemaKey","components","getDummyPath","serverMatch","stripTags","OpenApiExchange","OpenApiService","_spec","_opSpec","matchOpenApiOperation","OpenApiOperation","OpenApiRequest","OpenApiResponse","externalDocs","matchingPath","expectedValue","queryValues","getAll","getPath","__html","deprecated","commonFields","specParam","allowEmptyValue","serializationStyle","explode","valueWrapper","getParameters","bodySpec","responses","root","formatAjvError","pathTransform","instancePath","keyword","allowedValues","migrateRuleData","defaultRules","otherRules","migrateRuleItem","migrateRule","byteStreamToLines","newlineMatcher","decoder","reader","currentLine","ReadableStream","getReader","controller","read","enqueue","pop","cancel","parseJsonLinesStream","emptyStream","initialDecodedBody","initialEncodedBody","getContentEncodingHeader","updateEncodedBody","encodeBodyPromise","contentEncodings","_decodedBody","_encodingPromise","_encodedBody","getBody","getRequestBreakpoint","RequestBreakpoint","getDummyResponseBreakpoint","ResponseBreakpoint","getResponseBreakpoint","deferred","resultMetadata","editableBody","previousEncodedLength","newEncodedLength","oldContentLength","newContentLength","contentLength","updateDecodedBody","sentryInitialized","isSentryInitialized","initSentry","dsn","release","ignoreErrors","beforeSend","hint","exception","originalException","fingerprint","addErrorTag","getClient","getOptions","randomId","setUser","logErrorsAsUser","setTag","logError","getDefaultColor","pillStyles","baseColor","bgColor","lightOption","darkOption","getTextColor","getBackgroundColor","Pill","PillButton","getNonTransparentBackground","PillSelector","asKey","asName","groupName","getRulePartKey","PartVersionRequirements","serverSupports","versionRequirement","MatchersByType","isCompatibleMatcher","MatcherClassKeyLookup","HandlersByType","HandlerLookup","HandlerSteps","HandlerClassKeyLookup","isCompatibleHandler","getRuleTypeFromInitialMatcher","equivalentHandler","matcherCheck","MatcherLimitedHandlers","InitialMatcherClasses","getInitialMatchers","matcherCls","HiddenMatchers","getAvailableAdditionalMatchers","isHiddenMatcherKey","HiddenHandlers","getAvailableHandlers","FinalHandlerSteps","isFinalHandler","PaidHandlerClasses","isPaidHandler","cls","isPaidHandlerClass","matchRuleType","matchRule","isHttpCompatibleType","isHttpBasedRule","isWebSocketRule","isRTCRule","isStepPoweredRule","getMessageBaseAcceptTypes","acceptType","getMessageBaseContentType","isMutatativeExchange","DATA_CONTENT_TYPES","EventCategories","getEventCategory","requestAcceptTypes","isImageExchange","isCSSExchange","isHTMLExchange","isFontExchange","isDataExchange","describeEventCategory","categoryColour","getSummaryColour","highlights","black","grey","red","lightGreen","brightGreen","orange","yellow","lightBlue","darkBlue","purple","pink","exchangeOrCategory","getStatusColor","getWebSocketCloseColor","getMethodColor","RestApiClient","ok","errorBody","apiRequest","apiJsonRequest","interceptorMetadata","requestDefinition","requestOptions","requestDefinitionData","requestOptionsData","clientCertificate","responseDataStream","apiNdJsonRequest","dataStreamReader","requestInputSchema","requestContentType","base64Data","RULE_PARAM_REF_KEY","ENCODED_DATA_CONTENT_TYPES","HttpBodyCard","decodedContentType","downloadFilename","encodedDataContentType","observablePromise","originalThen","arguments","originalCatch","isObservablePromise","lazyObservablePromise","triggerPromise","lazyPromise","originalMethod","box","newState","debounced","timeoutMs","atom","reportObserved","reportChanged","debounceComputed","cbOrTimeout","optionsOrTimeout","computedOptions","descriptor","IpfsInteractions","IpfsInteractionMatcher","IpfsArgDescription","shouldSuggestArgMatcher","IpfsArgMatcher","buildIpfsFixedValueDefaultHeaders","toUTCString","buildIpfsStreamDefaultHeaders","simpleHandlerSchema","IpfsCatTextHandler","IpfsCatFileHandler","IpfsAddResultHandler","IpnsResolveResultHandler","Path","IpnsPublishResultHandler","Value","IpfsPinsResultHandler","Pins","IpfsPinLsResultHandler","IpfsMatcherLookup","ProtocolMatcher","HostnameMatcher","PortMatcher","CookieMatcher","IpfsInitialMatcherClasses","IpfsHandlerLookup","IconButton","IconButtonLink","EthereumMethods","EthereumMethodMatcher","jsonrpc","EthereumParamsMatcher","EthereumCallResultHandler","EthereumNumberResultHandler","EthereumHashResultHandler","EthereumReceiptResultHandler","transactionHash","blockNumber","blockHash","cumulativeGasUsed","gasUsed","effectiveGasPrice","contractAddress","logs","logsBloom","EthereumBlockResultHandler","EthereumErrorHandler","EthereumMatcherLookup","EthereumInitialMatcherClasses","EthereumHandlerLookup","removeItem","_walk","persistObject","createModel","hydrate","dataTransform","customArgs","CardErrorBanner","EditorCardContent","ContainerSizedEditorCardContent","getBodyDownloadFilename","contentDisposition","filenameMatch","suggestedFilename","urlBaseName","ReadonlyBodyCardHeader","EditableBodyCardHeader","EncodingErrorMessage","BodyDecodingErrorBanner","STATUSES","WEBSOCKET_CLOSE_CODES","1000","1001","1002","1003","1004","1005","1006","1007","1008","1009","1010","1011","1012","1013","1014","1015","HEADERS","METHODS","getDocs","docsInfo","mdnSlug","getHeaderDocs","getStatusDocs","getWebSocketCloseCodeDocs","getMethodDocs","getStatusMessage","statusData","getBaseContentType","typeWithoutParams","combinedSubTypes","possibleTypes","st","mimeTypeToContentTypeMap","EditableContentTypes","getContentType","baseContentType","getEditableContentType","viewableContentType","getContentEditorName","getDefaultMimeType","isValidBase64Byte","byte","getCompatibleTypes","Set","firstChar","add","serializeAsTag","getTag","serializeRegex","flags","serializeBuffer","serializeWithUndefineds","syncDeserialize","propSchema","serializeMap","keySchema","valueSchema","mapAsArray","_oldValue","hasSerializrSchema","getReadableSize","siUnits","thresh","units","unitIndex","floor","unitName","pow","EncodedSizesCacheKey","testEncodings","encodedSizesCache","existingObservable","sizesObservable","testResults","EchoWebSocketHandlerDefinition","RejectWebSocketHandlerDefinition","ListenWebSocketHandlerDefinition","WebSocketWildcardMatcher","DefaultWebSocketWildcardMatcher","WebSocketMethodMatcher","WebSocketPassThroughHandler","PassThroughWebSocketHandlerDefinition","WebSocketForwardToHostHandler","WebSocketMatcherLookup","WebSocketInitialMatcherClasses","WebSocketHandlerLookup","WsHandlerDefinitionLookup","Worker_fn","Worker","Serializable","Serialization","RTCWildcardMatcher","HasDataChannelMatcherDefinition","HasVideoTrackMatcherDefinition","HasAudioTrackMatcherDefinition","HasMediaTrackMatcherDefinition","RTCMatcherLookup","MatcherDefinitionLookup","RTCInitialMatcherClasses","DynamicProxyStepDefinition","EchoStepDefinition","CloseStepDefinition","WaitForMediaStepDefinition","WaitForDurationStepDefinition","WaitForChannelStepDefinition","WaitForMessageStepDefinition","CreateChannelStepDefinition","SendStepDefinition","RTCStepLookup","StepDefinitionLookup","delay","numberMs","attempt","getDeferred","resolveCb","rejectCb","worker","messageId","emitter","callApi","transfer","postMessage","once","decodeBody","decodedBuffer","encodeBody","testEncodingsAsync","encodingSizes","buildApiMetadataAsync","baseUrlOverrides","validatePKCS","parseCert","formatBufferAsync","formatted","parseRpcApiExchange","methodSpec","JsonRpcApiExchange","_api","_exchange","_rpcMethod","JsonRpcApiService","JsonRpcApiOperation","JsonRpcApiRequest","JsonRpcApiResponse","rpcMethod","methodDocsBaseUrl","capitalizeFirst","charAt","oneOf","subschema","resultSpec","properties","clientCertificateSchema","reloadRules","ruleRoot","dockerProxyRuleParamName","RulesStore","jumpToExchange","triggerBreakpoint","getEditedEvent","rawStoreData","draftWhitelistedCertificateHosts","draftClientCertificateHostMap","mightBePaidUser","ensureRuleDoesNotExist","forwardingConfig","sourceHost","forwardingRule","ignoreHostHttpsErrors","trustAdditionalCAs","proxyConfig","lookupOptions","simulateConnectionErrors","parsedProxyUrl","systemConfig","noProxy","userProxyConfig","dockerProxyConfig","draftItemPath","activeRulePath","currentDraftParent","targetDraftParent","missingParents","missingParentsActivePath","nextActiveParent","targetDraftParentParent","missingGroup","newGroup","targetSiblingIndex","targetPredecessor","draftSiblings","activeSiblings","targetCommonIndex","draftItemToFollow","draftItem","targetActiveParent","activeItemPath","updatedItem","activeItem","currentActiveParent","updatedCurrentParentPath","draftDeletedRules","sortedItems","previousIndex","childPosition","currentParent","targetParent","sourceItem","groupId","draftGroup","activeGroup","draftRulePath","draftDefaultGroupPath","savedData","SendStore","eventStore","passthroughOptions","effectivePort","getEffectivePort","hostWithPort","getProxyConfig","responseStream","recordSentRequest","trackResponseEvents","responseHead","responseBodyParts","paramRef","errorCount","graphql","activationResult","authTokenPromise","self","serverReady","announceServerReady","waitUntilServerReady","apiClient","restClient","graphQLClient","getServerVersion","getConfig","getNetworkInterfaces","getInterceptors","getDetailedInterceptorMetadata","triggerServerUpdate","SentResponseBodyCard","truncate","str","joinAnd","initialSep","finalSep","VOWEL_ISH","aOrAn","uppercaseFirst","getNewRule","getRuleDefaultMatchers","updateRuleAfterInitialMatcherChange","ipfsInteraction","argMatcherIndex","findIndex","newArgMatcher","ruleStore","buildRequestMatchers","bodyMatcher","buildRuleFromRequest","buildRuleFromExchange","mockRuleHeaders","buildDefaultGroupWrapper","buildDefaultGroupRules","buildDefaultRulesRoot","buildForwardingRuleIntegration","iconName","faArrowLeft","faSpinner","faTrashAlt","faSearch","faPlug","faNetworkWired","faDesktop","faTerminal","faQuestion","faTimes","faChevronUp","faChevronDown","faBan","faComment","faToggleOn","faToggleOff","faCopy","faExternalLinkAlt","faPlus","faMinus","faExclamationTriangle","faLightbulb","faCog","faStar","faMagic","faSun","faMoon","faAdjust","faUpload","faDownload","faPlay","faPause","faGem","faTheaterMasks","faGripVertical","faUndo","faSave","faFolderOpen","faUnlock","faEdit","faWindowMaximize","faMobileAlt","faExpand","faCompressArrowsAlt","faThumbtack","faEye","faCaretDown","faAlignLeft","faClone","faCheck","faLevelDownAlt","faPaperPlane","faChrome","faFirefox","faDocker","faAndroid","faApple","faSafari","faEdge","faInternetExplorer","faOpera","faCodeBranch","faNpm","faNodeJs","faPhp","faPython","faAtom","faGlobe","faJava","SourceIcons","IE","Git","Php","Ruby","Faraday","Excon","Typhoeus","Rubybindings","Npm","Node","Got","Axios","Nodebindings","Pip","Python","Urlfetch","Pycurl","Pythonbindings","Reactornetty","Jetty","Jakarta","Akka","Intellij","Ktor","Ahc","Okhttp","Fbandroidsdk","Iphone","Ios","Ipad","Darwin","Icon","SuggestionIcon","suggestionIconHtml","iconHtml","styles","margin","warningIconHtml","iconLookup","md","linkify","linkTarget","fromMarkdown","unsafeMarkdown","hasAttribute","UI_VERSION","lastServerVersion","versionSatisfies","includePrerelease","DESKTOP_HEADER_LIMIT_CONFIGURABLE","PORT_RANGE_SERVER_RANGE","MOCK_SERVER_RANGE","HOST_MATCHER_SERVER_RANGE","CLIENT_CERT_SERVER_RANGE","FROM_FILE_HANDLER_SERVER_RANGE","DETAILED_CONFIG_RANGE","INTERCEPTOR_METADATA","INITIAL_HTTP2_RANGE","BODY_MATCHING_RANGE","WEBSOCKET_RULE_RANGE","DETAILED_METADATA","PASSTHROUGH_TRANSFORMS_RANGE","PROXY_CONFIG_RANGE","CLOSE_IN_BREAKPOINT","DNS_AND_RULE_PARAM_CONFIG_RANGE","CUSTOM_CA_TRUST_RANGE","MULTIPLE_EXISTING_TERMINAL_RANGE","RAW_BODY_SUPPORTED","WEBSOCKET_MESSAGING_RULES_SUPPORTED","WEBRTC_GLOBALLY_ENABLED","JSONRPC_RESPONSE_RULE_SUPPORTED","RTC_RULES_SUPPORTED","TLS_PASSTHROUGH_SUPPORTED","CONNECTION_RESET_SUPPORTED","SERVER_REST_API_SUPPORTED","SERVER_SEND_API_SUPPORTED","HTKEventBase","VisibleButtonsContainer","HiddenButtonsWrapper","HiddenButtonsContainer","ButtonContainer","MenuButton","unfocus","blur","CollapsingButtons","childElements","itemWidth","itemSpacesAvailable","visibleChildren","hiddenChildren","ExpandShrinkButton"],"mappings":"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","file":"app.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// script path function\n \tfunction jsonpScriptSrc(chunkId) {\n \t\treturn __webpack_require__.p + \"\" + ({\"1\":\"react-monaco-editor\",\"3\":\"zstd\"}[chunkId]||chunkId) + \".bundle.js\"\n \t}\n\n \t// object to store loaded and loading wasm modules\n \tvar installedWasmModules = {};\n\n \tfunction promiseResolve() { return Promise.resolve(); }\n\n \tvar wasmImportObjects = {\n \t\t1666: function() {\n \t\t\treturn {\n \t\t\t\t\"./brotli_wasm_bg.js\": {\n \t\t\t\t\t\"__wbindgen_is_undefined\": function(p0i32) {\n \t\t\t\t\t\treturn installedModules[1557].exports[\"e\"](p0i32);\n \t\t\t\t\t},\n \t\t\t\t\t\"__wbindgen_is_object\": function(p0i32) {\n \t\t\t\t\t\treturn installedModules[1557].exports[\"d\"](p0i32);\n \t\t\t\t\t},\n \t\t\t\t\t\"__wbindgen_string_new\": function(p0i32,p1i32) {\n \t\t\t\t\t\treturn installedModules[1557].exports[\"i\"](p0i32,p1i32);\n \t\t\t\t\t},\n \t\t\t\t\t\"__wbindgen_json_serialize\": function(p0i32,p1i32) {\n \t\t\t\t\t\treturn installedModules[1557].exports[\"f\"](p0i32,p1i32);\n \t\t\t\t\t},\n \t\t\t\t\t\"__wbg_new_59cb74e423758ede\": function() {\n \t\t\t\t\t\treturn installedModules[1557].exports[\"b\"]();\n \t\t\t\t\t},\n \t\t\t\t\t\"__wbg_stack_558ba5917b466edd\": function(p0i32,p1i32) {\n \t\t\t\t\t\treturn installedModules[1557].exports[\"c\"](p0i32,p1i32);\n \t\t\t\t\t},\n \t\t\t\t\t\"__wbg_error_4bb6c2a97407129a\": function(p0i32,p1i32) {\n \t\t\t\t\t\treturn installedModules[1557].exports[\"a\"](p0i32,p1i32);\n \t\t\t\t\t},\n \t\t\t\t\t\"__wbindgen_object_drop_ref\": function(p0i32) {\n \t\t\t\t\t\treturn installedModules[1557].exports[\"g\"](p0i32);\n \t\t\t\t\t},\n \t\t\t\t\t\"__wbindgen_rethrow\": function(p0i32) {\n \t\t\t\t\t\treturn installedModules[1557].exports[\"h\"](p0i32);\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t};\n \t\t},\n \t};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n \t// This file contains only the entry chunk.\n \t// The chunk loading function for additional chunks\n \t__webpack_require__.e = function requireEnsure(chunkId) {\n \t\tvar promises = [];\n\n\n \t\t// JSONP chunk loading for javascript\n\n \t\tvar installedChunkData = installedChunks[chunkId];\n \t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n \t\t\t// a Promise means \"currently loading\".\n \t\t\tif(installedChunkData) {\n \t\t\t\tpromises.push(installedChunkData[2]);\n \t\t\t} else {\n \t\t\t\t// setup Promise in chunk cache\n \t\t\t\tvar promise = new Promise(function(resolve, reject) {\n \t\t\t\t\tinstalledChunkData = installedChunks[chunkId] = [resolve, reject];\n \t\t\t\t});\n \t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n \t\t\t\t// start chunk loading\n \t\t\t\tvar script = document.createElement('script');\n \t\t\t\tvar onScriptComplete;\n\n \t\t\t\tscript.charset = 'utf-8';\n \t\t\t\tscript.timeout = 120;\n \t\t\t\tif (__webpack_require__.nc) {\n \t\t\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n \t\t\t\t}\n \t\t\t\tscript.src = jsonpScriptSrc(chunkId);\n\n \t\t\t\t// create error before stack unwound to get useful stacktrace later\n \t\t\t\tvar error = new Error();\n \t\t\t\tonScriptComplete = function (event) {\n \t\t\t\t\t// avoid mem leaks in IE.\n \t\t\t\t\tscript.onerror = script.onload = null;\n \t\t\t\t\tclearTimeout(timeout);\n \t\t\t\t\tvar chunk = installedChunks[chunkId];\n \t\t\t\t\tif(chunk !== 0) {\n \t\t\t\t\t\tif(chunk) {\n \t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n \t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n \t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n \t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n \t\t\t\t\t\t\terror.type = errorType;\n \t\t\t\t\t\t\terror.request = realSrc;\n \t\t\t\t\t\t\tchunk[1](error);\n \t\t\t\t\t\t}\n \t\t\t\t\t\tinstalledChunks[chunkId] = undefined;\n \t\t\t\t\t}\n \t\t\t\t};\n \t\t\t\tvar timeout = setTimeout(function(){\n \t\t\t\t\tonScriptComplete({ type: 'timeout', target: script });\n \t\t\t\t}, 120000);\n \t\t\t\tscript.onerror = script.onload = onScriptComplete;\n \t\t\t\tdocument.head.appendChild(script);\n \t\t\t}\n \t\t}\n\n \t\t// Fetch + compile chunk loading for webassembly\n\n \t\tvar wasmModules = {\"4\":[1666]}[chunkId] || [];\n\n \t\twasmModules.forEach(function(wasmModuleId) {\n \t\t\tvar installedWasmModuleData = installedWasmModules[wasmModuleId];\n\n \t\t\t// a Promise means \"currently loading\" or \"already loaded\".\n \t\t\tif(installedWasmModuleData)\n \t\t\t\tpromises.push(installedWasmModuleData);\n \t\t\telse {\n \t\t\t\tvar importObject = wasmImportObjects[wasmModuleId]();\n \t\t\t\tvar req = fetch(__webpack_require__.p + \"\" + {\"1666\":\"8de92d11411b6a7216ad\"}[wasmModuleId] + \".module.wasm\");\n \t\t\t\tvar promise;\n \t\t\t\tif(importObject instanceof Promise && typeof WebAssembly.compileStreaming === 'function') {\n \t\t\t\t\tpromise = Promise.all([WebAssembly.compileStreaming(req), importObject]).then(function(items) {\n \t\t\t\t\t\treturn WebAssembly.instantiate(items[0], items[1]);\n \t\t\t\t\t});\n \t\t\t\t} else if(typeof WebAssembly.instantiateStreaming === 'function') {\n \t\t\t\t\tpromise = WebAssembly.instantiateStreaming(req, importObject);\n \t\t\t\t} else {\n \t\t\t\t\tvar bytesPromise = req.then(function(x) { return x.arrayBuffer(); });\n \t\t\t\t\tpromise = bytesPromise.then(function(bytes) {\n \t\t\t\t\t\treturn WebAssembly.instantiate(bytes, importObject);\n \t\t\t\t\t});\n \t\t\t\t}\n \t\t\t\tpromises.push(installedWasmModules[wasmModuleId] = promise.then(function(res) {\n \t\t\t\t\treturn __webpack_require__.w[wasmModuleId] = (res.instance || res).exports;\n \t\t\t\t}));\n \t\t\t}\n \t\t});\n \t\treturn Promise.all(promises);\n \t};\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// on error function for async loading\n \t__webpack_require__.oe = function(err) { console.error(err); throw err; };\n\n \t// object with all WebAssembly.instance exports\n \t__webpack_require__.w = {};\n\n \tvar jsonpArray = this[\"webpackJsonp\"] = this[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([682,2]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import { styled } from \"../../styles\";\nimport { CollapsibleCard } from \"../common/card\";\n\nexport const SendCardSection = styled(CollapsibleCard)`\n    border-radius: 0;\n    margin-bottom: 0;\n\n    flex-basis: auto;\n    flex-shrink: 1;\n    flex-grow: 0; /* Overridden below, so only the bodies expand */\n    min-height: 0;\n`;\n\nexport const SendBodyCardSection = styled(SendCardSection)`\n    /* This is required to force the editor to shrink to fit, instead of going\n       beyond the limits of the column when other item is expanded and pushes it down */\n    overflow-y: hidden;\n\n    flex-grow: ${p =>\n        // Collapsed cards should not expand into unused space\n        p.collapsed ? '0' : '1'\n    };\n\n    ${p => !p.collapsed && `\n        /* When we're open, we want space more than any siblings */\n        flex-grow: 9999999;\n\n        /* If we're open, never let us get squeezed to nothing: */\n        min-height: 25vh;\n\n        /* Fixed size required to avoid editor resize thrashing */\n        flex-basis: 50%;\n    `\n    }\n`;","import { NetworkInterfaceInfo } from 'os';\nimport { ProxySetting } from 'mockttp';\n\nexport interface ServerInterceptor {\n    id: string;\n    version: string;\n    isActivable: boolean;\n    isActive: boolean;\n    metadata?: any;\n}\n\nexport interface NetworkInterfaces {\n    [index: string]: NetworkInterfaceInfo[];\n}\n\nexport interface ServerConfig {\n    certificatePath: string;\n    certificateContent?: string;\n    certificateFingerprint?: string;\n    networkInterfaces: NetworkInterfaces;\n    systemProxy: ProxySetting | undefined;\n    dnsServers: string[];\n    ruleParameterKeys: string[];\n}\n\nexport class ApiError extends Error {\n\n    constructor(\n        message: string,\n        readonly operationName: string,\n        readonly errorCode?: string | number\n    ) {\n        super(`API error during ${operationName}: ${message}`);\n    }\n\n}","import * as React from 'react';\nimport * as _ from 'lodash';\nimport { reaction, computed } from 'mobx';\nimport { observer } from 'mobx-react';\nimport { SchemaObject } from 'openapi3-ts';\nimport * as portals from 'react-reverse-portal';\n\nimport { styled } from '../../styles';\nimport { ObservablePromise, isObservablePromise } from '../../util/observable';\nimport { asError, unreachableCheck } from '../../util/error';\nimport { stringToBuffer } from '../../util';\n\nimport { ViewableContentType } from '../../model/events/content-types';\nimport { Formatters, isEditorFormatter } from '../../model/events/body-formatting';\n\nimport { ContainerSizedEditor, SelfSizedEditor } from './base-editor';\nimport { LoadingCardContent } from '../common/loading-card';\n\ninterface ContentViewerProps {\n    children: Buffer | string;\n    schema?: SchemaObject;\n    expanded: boolean;\n    rawContentType?: string;\n    contentType: ViewableContentType;\n    editorNode: portals.HtmlPortalNode<typeof SelfSizedEditor | typeof ContainerSizedEditor>;\n    cache: Map<Symbol, unknown>;\n\n    // See BaseEditor.props.contentid\n    contentId: string | null;\n\n    // Called after content was successfully rendered into the editor. This may be immediate and uninteresting in\n    // simple cases, or it may take longer if the content is large with a complex format (1MB of formatted JSON).\n    onContentRendered?: () => void;\n}\n\nconst ScrollableContentContainer = styled.div<{\n    expanded: boolean\n}>`\n    overflow-y: auto;\n    max-height: ${p => p.expanded\n        ? '100%'\n        : '560px' // Same as editor container\n    }\n`;\n\nconst CenteredContentViewerContainer = styled.div<{\n    expanded: boolean\n}>`\n    display: flex;\n    justify-content: center;\n\n    ${p => p.expanded\n        ? `\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            align-items: stretch;\n        `\n        : `\n            height: 100%;\n            align-items: center;\n        `\n    }\n`;\n\n@observer\nexport class ContentViewer extends React.Component<ContentViewerProps> {\n\n    constructor(props: ContentViewerProps) {\n        super(props);\n\n        // Every time the rendered content changes, as long as it's not a 'loading' promise,\n        // we fire a callback to notify that the content has been rendered.\n        reaction(() => {\n            try {\n                return this.renderedContent;\n            } catch (e) {}\n        }, (newValue) => {\n            if (newValue && !isObservablePromise(newValue)) {\n                requestAnimationFrame(() => {\n                    this.props.onContentRendered?.();\n                });\n            }\n        }, { fireImmediately: true });\n    }\n\n    @computed\n    private get formatter() {\n        return Formatters[this.props.contentType] || Formatters.text!;\n    }\n\n    @computed\n    private get contentBuffer() {\n        return _.isString(this.props.children)\n            ? stringToBuffer(this.props.children)\n            : this.props.children;\n    }\n\n    // Returns a string, if the rendered content is immediately available or has previously been generated\n    // and cached. Returns an observable promise if rendering is still in progress.\n    @computed\n    private get renderedContent() {\n        if (!isEditorFormatter(this.formatter)) return;\n\n        const { cache } = this.props;\n        const cacheKey = this.formatter.cacheKey;\n        const cachedValue = cache.get(cacheKey) as ObservablePromise<string> | string | undefined;\n\n        const renderingContent = cachedValue ||\n            this.formatter.render(this.contentBuffer) as ObservablePromise<string> | string;\n        if (!cachedValue) cache.set(cacheKey, renderingContent);\n\n        if (typeof renderingContent === 'string') {\n            return renderingContent;\n        } else {\n            if (renderingContent.state === 'fulfilled') {\n                return renderingContent.value as string;\n            } else if (renderingContent.state === 'rejected') {\n                throw renderingContent.value;\n            } else {\n                return renderingContent;\n            }\n        }\n    }\n\n    private readonly editorOptions = {\n        readOnly: true\n    };\n\n    render() {\n        if (isEditorFormatter(this.formatter)) {\n            try {\n                const content = this.renderedContent;\n                if (isObservablePromise<string>(content)) {\n                    return <LoadingCardContent height='500px' />;\n                } else {\n                    return <portals.OutPortal<typeof SelfSizedEditor>\n                        contentId={this.props.contentId}\n                        node={this.props.editorNode}\n                        options={this.editorOptions}\n                        language={this.formatter.language}\n                        value={content!}\n                        schema={this.props.schema}\n                        expanded={this.props.expanded}\n                    />;\n                }\n            } catch (e) {\n                return <div>\n                    Failed to render {this.props.contentType} content:<br/>\n                    { asError(e).toString() }\n                </div>;\n            }\n        } else {\n            const formatterConfig = this.formatter;\n\n\n            // Formatter components should all be either scrollable (top aligned, extending\n            // downwards, scrolling if there's no space) or centered (in the middle, scaling\n            // down to match if the container is ever smaller than the content size):\n            const FormatterContainer = formatterConfig.layout === 'scrollable'\n                    ? ScrollableContentContainer\n                : formatterConfig.layout === 'centered'\n                    ? CenteredContentViewerContainer\n                : unreachableCheck(formatterConfig.layout);\n\n            return <FormatterContainer expanded={this.props.expanded}>\n                <formatterConfig.Component\n                    content={this.contentBuffer}\n                    rawContentType={this.props.rawContentType}\n                />\n            </FormatterContainer>;\n        }\n    }\n}\n","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { action, observable, reaction } from 'mobx';\nimport { disposeOnUnmount, observer } from 'mobx-react';\n\nimport { styled } from '../../styles';\n\nimport { clickOnEnter } from '../component-utils';\nimport { Button, TextInput } from './inputs';\nimport { Icon } from '../../icons';\n\nexport type Pair = { key: string, value: string, disabled?: true };\nexport type PairsArray = Array<Pair>;\n\ninterface EditablePairsProps<R = PairsArray> {\n    pairs: PairsArray;\n\n    onChange: (pairs: R) => void;\n\n    // Optionally, transform values before they're passed to onChange. If not set,\n    // R must be PairsArray. This is useful because it's also used to ignore irrelevant\n    // updates, preserving information lost in conversion with 2-way binding, for example\n    // ordering of the pairs. Without this, duplicate keys in EditableHeaders and similar\n    // result in the pairs reordering themselves while you're typing.\n    convertResult?: (pairs: PairsArray) => R;\n\n    // While convertResult defines transformations that don't update the UI, this\n    // callback defines transforms that do - e.g. lowercasing input as it's typed.\n    transformInput?: (pairs: PairsArray) => PairsArray;\n\n    keyTitle?: string;\n    keyPattern?: string;\n\n    keyPlaceholder: string;\n    valuePlaceholder: string;\n\n    // Disabled by default, but can be useful in some cases\n    allowEmptyValues?: boolean;\n}\n\nconst ReadOnlyPairsContainer = styled.div`\n    display: grid;\n    grid-gap: 5px;\n    grid-template-columns: 1fr 2fr;\n`;\n\nconst EditablePairsContainer = styled(ReadOnlyPairsContainer)`\n    grid-template-columns: 1fr 2fr min-content;\n\n    > :last-child {\n        grid-column: 2 / span 2;\n    }\n`;\n\nconst PairDeleteButton = styled(Button)`\n    font-size: ${p => p.theme.textSize};\n    padding: 3px 10px 5px;\n`;\n\n@observer\nexport class ReadOnlyPairs extends React.Component<{\n    className?: string,\n    pairs: PairsArray\n}> {\n\n    render() {\n        const { pairs, className } = this.props;\n\n        return <ReadOnlyPairsContainer className={className}>\n            { _.flatMap(pairs, ({ key, value }, i) => [\n                <TextInput\n                    value={key}\n                    readOnly={true}\n                    spellCheck={false}\n                    key={`${i}-key`}\n                />,\n                <TextInput\n                    value={value}\n                    readOnly={true}\n                    spellCheck={false}\n                    key={`${i}-val`}\n                />\n            ]) }\n        </ReadOnlyPairsContainer>\n    }\n}\n\n@observer\nexport class EditablePairs<R> extends React.Component<EditablePairsProps<R>> {\n\n    private containerRef = React.createRef<HTMLDivElement>();\n\n    @observable\n    private values: PairsArray = _.cloneDeep(this.props.pairs);\n\n    // Track the last value length. This is used to detect manually added new rows, and\n    // manage the UX around that.\n    private lastValuesLength = this.values.length;\n\n    componentDidMount() {\n        disposeOnUnmount(this, reaction(\n            () => this.props.pairs,\n            (pairs) => {\n                if (!_.isEqual(this.convert(pairs), this.convert(this.values))) {\n                    // Only updates values if some data changes other than their order.\n                    // We treat order as a UI concern only for these pairs, and\n                    // this avoids reordering due to conversion elsewhere, e.g. when entering\n                    // duplicate header keys in EditableHeaders.\n                    this.values = _.cloneDeep(pairs);\n                    this.lastValuesLength = this.values.length;\n                }\n            }\n        ));\n    }\n\n    private convert = (pairs: PairsArray): R => {\n        if (this.props.convertResult) {\n            return this.props.convertResult(pairs);\n        } else {\n            return pairs as unknown as R;\n        }\n    };\n\n    private onChangeValues = (pairs: PairsArray) => {\n        const { props: { transformInput, onChange }, convert } = this;\n\n        if (transformInput) {\n            this.values = transformInput(pairs);\n        } else {\n            this.values = pairs;\n        }\n\n        // If we've just manually added a new row, make sure the parent scrolls\n        // to show it (note we ignore this for external updates).\n        const addedNewRow = this.values.length === this.lastValuesLength + 1;\n        this.lastValuesLength = this.values.length;\n        if (addedNewRow) {\n            requestAnimationFrame(() => {\n                const container = this.containerRef.current;\n                const lastInput = container?.querySelector<HTMLElement>('input:last-child');\n                lastInput?.scrollIntoView({\n                    block: 'nearest',\n                    behavior: 'smooth'\n                });\n            });\n        }\n\n        onChange(convert(this.values));\n    };\n\n    render() {\n        const {\n            keyTitle,\n            keyPattern,\n            keyPlaceholder,\n            valuePlaceholder,\n            allowEmptyValues\n        } = this.props;\n\n        const { values, onChangeValues, containerRef } = this;\n\n        return <EditablePairsContainer\n            ref={containerRef}\n        >\n            { _.flatMap(values, ({ key, value, disabled }, i) => [\n                <TextInput\n                    value={key}\n                    required\n                    pattern={keyPattern}\n                    title={keyTitle}\n                    disabled={disabled}\n                    spellCheck={false}\n                    key={`${i}-key`}\n                    onChange={action((event: React.ChangeEvent<HTMLInputElement>) => {\n                        event.target.reportValidity();\n                        values[i].key = event.target.value;\n                        onChangeValues(values);\n                    })}\n                />,\n                <TextInput\n                    value={value}\n                    required={!allowEmptyValues}\n                    disabled={disabled}\n                    spellCheck={false}\n                    key={`${i}-val`}\n                    onChange={action((event: React.ChangeEvent<HTMLInputElement>) => {\n                        event.target.reportValidity();\n                        values[i].value = event.target.value;\n                        onChangeValues(values);\n                    })}\n                />,\n                <PairDeleteButton\n                    key={`${i}-del`}\n                    disabled={disabled}\n                    onClick={action(() => {\n                        values.splice(i, 1);\n                        onChangeValues(values);\n                    })}\n                >\n                    <Icon icon={['far', 'trash-alt']} />\n                </PairDeleteButton>\n            ]).concat([\n                <TextInput\n                    value=''\n                    pattern={keyPattern}\n                    placeholder={keyPlaceholder}\n                    spellCheck={false}\n                    key={`${values.length}-key`}\n                    onChange={action((event: React.ChangeEvent<HTMLInputElement>) => {\n                        let key = event.target.value;\n                        if (key) values.push({ key: key, value: '' });\n                        onChangeValues(values);\n                    })}\n                />,\n                <TextInput\n                    value=''\n                    placeholder={valuePlaceholder}\n                    spellCheck={false}\n                    key={`${values.length}-val`}\n                    onChange={action((event: React.ChangeEvent<HTMLInputElement>) => {\n                        let value = event.target.value;\n                        if (value) values.push({ key: '', value: event.target.value });\n                        onChangeValues(values);\n                    })}\n                />\n            ]) }\n        </EditablePairsContainer>\n    }\n}","type DesktopInjectedKey =\n    | 'httpToolkitDesktopVersion'\n    | 'httpToolkitForwardingDefault';\n\nexport async function getDesktopInjectedValue(key: DesktopInjectedKey): Promise<string> {\n    // In the SW, it's tricky to check the desktop version, as we don't get it injected.\n    // For now, just treat it as a different environment\n    if (typeof window === 'undefined') return 'service-worker';\n\n    if (key in window) {\n        // If it's already been set, just return it\n        return window[key as keyof Window];\n    } else {\n        return new Promise<string>((resolve) => {\n            // If not, it might still be coming (there's race here), so listen out\n            window.addEventListener('message', (message) => {\n                if (message.data[key]) resolve(message.data[key]);\n            });\n        });\n    }\n    // Note that if we're running in a browser, not the desktop shell, this _never_ resolves.\n}\n\ndeclare global {\n    interface Window {\n        desktopApi?: DesktopApi;\n    }\n}\n\ninterface DesktopApi {\n    selectApplication?: () => Promise<string | undefined>;\n    openContextMenu?: (options: NativeContextMenuDefinition) => Promise<string | undefined>;\n}\n\ninterface NativeContextMenuDefinition {\n    position: { x: number; y: number };\n    items: readonly NativeContextMenuItem[];\n}\n\nexport type NativeContextMenuItem =\n    | NativeContextMenuOption\n    | NativeContextMenuSubmenu\n    | { type: 'separator' };\n\ninterface NativeContextMenuOption {\n    type: 'option';\n    id: string;\n    label: string;\n    enabled?: boolean;\n}\n\ninterface NativeContextMenuSubmenu {\n    type: 'submenu';\n    label: string;\n    enabled?: boolean;\n    items: readonly NativeContextMenuItem[];\n}\n\n// Quick fix to avoid this file crashing the update SW which doesn't have 'window' available, without\n// also breaking old Electron that doesn't have globalThis:\nconst global = typeof globalThis !== 'undefined'\n        ? globalThis as unknown as Window\n    : typeof window !== 'undefined'\n        ? window\n    : {} as Window;\n\nexport const DesktopApi: DesktopApi = global.desktopApi ?? {};","import * as _ from 'lodash';\nimport { UAParser } from 'ua-parser-js';\nimport { get } from 'typesafe-get';\n\nimport { popColor } from '../../styles';\nimport { SourceIcons, IconProps, SourceIconName } from '../../icons';\n\nexport interface TrafficSource {\n    ua: string;\n    summary: string;\n    description?: string;\n    icon: IconProps;\n}\n\nfunction formatVersion(version: string | undefined): string {\n    if (!version) return '';\n\n    // Space-prefixed, first two parts only, trim 0s so that '10.0' -> '10'\n    return ' ' + version.split('.').slice(0, 2).join('.').replace(/\\.0$/, '');\n}\n\nconst getSummary = (useragent: IUAParser.IResult) => {\n    const hasOS = _(useragent.os).values().some();\n    const hasBrowser = _(useragent.browser).values().some();\n\n    const clientName = _.upperFirst(useragent.ua.split(' ')[0]);\n\n    if (hasOS || hasBrowser) {\n        const osDescription = hasOS ?\n            ` (${_.upperFirst(useragent.os.name)}${formatVersion(useragent.os.version)})`\n        : '';\n        const browserDescription = hasBrowser ?\n            (useragent.browser.name || '') + formatVersion(useragent.browser.version)\n        : clientName;\n\n        return browserDescription + osDescription;\n    } else {\n        return clientName;\n    }\n};\n\nfunction getArticle(nextWord: string): string {\n    const firstLetter = nextWord[0].toLowerCase();\n    // This isn't exactly right (really its vowel _sounds_, not vowels),\n    // but it's an ok approximation.\n    return (\n        firstLetter === 'a' ||\n        firstLetter === 'e' ||\n        firstLetter === 'i' ||\n        firstLetter === 'o' ||\n        firstLetter === 'u'\n    ) ? 'an ' : 'a ';\n}\n\nconst getDescription = (useragent: IUAParser.IResult): string | undefined => {\n    if (\n        !useragent.browser.name &&\n        !useragent.os.name &&\n        !useragent.device.type\n    ) return;\n\n    const browserDescription = useragent.browser.name ?\n        useragent.browser.name + formatVersion(useragent.browser.version)\n        + (useragent.engine.name ?\n            `, based on the ${useragent.engine.name}${\n                useragent.engine.name !== 'Blink' // Blink duplicates the Chrome version, noisy\n                    ? formatVersion(useragent.engine.version)\n                    : ''\n             } engine` : '')\n    : useragent.engine.name ?\n        `a browser built on the ${useragent.engine.name}${\n            formatVersion(useragent.engine.version)\n        } engine`\n    : '';\n\n    const hardwareDescription =\n            (useragent.device.vendor ? `${useragent.device.vendor} ` : '') +\n            (useragent.device.model ? `${useragent.device.model} ` : '') +\n            (useragent.device.type ?\n                (useragent.device.type === 'mobile' ?\n                    'mobile phone' : useragent.device.type\n                + ' ')\n            : '');\n\n    const osDescription = useragent.os.name ?\n        `running ${useragent.os.name}${formatVersion(useragent.os.version)}` : '';\n\n    const cpuDescription = useragent.cpu.architecture ?\n        `${getArticle(\n            useragent.cpu.architecture\n        )}${useragent.cpu.architecture} CPU` : '';\n\n    const deviceDescription = (hardwareDescription ? `${getArticle(\n            hardwareDescription\n        )}${hardwareDescription}` : '') +\n        (hardwareDescription && osDescription ? ', ' : '') +\n        osDescription +\n        (cpuDescription ?\n            ((hardwareDescription || osDescription) ? ', with ' : ' using ') +\n            cpuDescription : '');\n\n    return `This request came from ${\n        browserDescription ?\n            browserDescription +\n            (deviceDescription ? '. The device is ' + deviceDescription : '')\n        : hardwareDescription ? // = starts with an article\n            deviceDescription : 'a device ' + deviceDescription\n    }.`;\n}\n\nconst isValidIconName = (name: string | undefined): name is SourceIconName => {\n    return !!(name && _.has(SourceIcons, name));\n}\n\nconst getIcon = (useragent: IUAParser.IResult) => {\n    const browserName = get(useragent, 'browser', 'name');\n    if (isValidIconName(browserName)) return SourceIcons[browserName];\n\n    const uaStrings = useragent.ua.match(/[A-Za-z]+/g) || [];\n\n    const recognizedUaPart = _.find(\n        uaStrings.map((s) => _.upperFirst(s.toLowerCase())),\n        (s) => isValidIconName(s)\n    ) as SourceIconName;\n\n    if (recognizedUaPart) {\n        return SourceIcons[recognizedUaPart];\n    } else {\n        return SourceIcons.Unknown;\n    }\n};\n\nfunction checkForElectron(userAgent: IUAParser.IResult) {\n    const electronVersion = userAgent.ua.match(/Electron\\/(\\S+)/);\n\n    if (electronVersion) {\n        // If we have a browser & an engine, treat the browser as the engine\n        userAgent.engine = userAgent.browser || userAgent.engine;\n        // Treat Electron as the 'browser', replacing any existing browser\n        userAgent.browser = {\n            name: 'Electron',\n            version: electronVersion[1],\n            major: electronVersion[1].split('.')[0]\n        };\n    }\n}\n\nexport const UNKNOWN_SOURCE = {\n    ua: '',\n    summary: 'Unknown client',\n    icon: SourceIcons.Unknown\n};\n\nexport const MANUALLY_SENT_SOURCE = {\n    ua: '',\n    summary: 'HTTP Toolkit',\n    description: 'Sent manually from HTTP Toolkit',\n    icon: {\n        icon: ['far', 'paper-plane'],\n        color: popColor\n    }\n};\n\nexport const parseSource = (userAgentHeader: string | undefined): TrafficSource => {\n    if (!userAgentHeader) return UNKNOWN_SOURCE;\n\n    const useragent = new UAParser(userAgentHeader).getResult();\n\n    checkForElectron(useragent);\n\n    return {\n        ua: useragent.ua,\n        summary: getSummary(useragent),\n        description: getDescription(useragent),\n        icon: getIcon(useragent),\n    };\n}","import * as React from 'react';\n\nimport { styled, css } from '../../styles';\nimport { Icon } from '../../icons';\n\nimport {\n    CollapsibleCard,\n    CollapsibleCardProps\n} from './card'\n\nexport const LoadingCardContent = styled((props: { height?: string, className?: string }) =>\n    <div className={props.className}>\n        <Icon spin icon={['fac', 'spinner-arc']} size='8x' />\n    </div>\n)`\n    ${p => p.height && css`\n        height: ${p.height};\n    `}\n\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n`;\n\nexport const LoadingCard = (props:\n    CollapsibleCardProps & {\n        height?: string,\n        children?: React.ReactNode\n    }\n) => <CollapsibleCard {...props}>\n    { props.children }\n    <LoadingCardContent height={\n        props.height\n            ? props.height\n        : props.expanded\n            ? 'auto'\n        // Not expanded, no explicit height, set a default size (matches body editor max):\n            : '550px'\n    } />\n</CollapsibleCard>;","import * as _ from 'lodash';\nimport { toJS } from 'mobx';\nimport { completionCheckers } from 'mockttp';\nimport * as serializr from 'serializr';\n\nimport { hasSerializrSchema, serializeAsTag } from '../serialization';\n\nimport { RulesStore } from './rules-store';\nimport { HtkMockRule, MatcherLookup, HandlerLookup, getRulePartKey } from './rules';\nimport {\n    HtkMockItem,\n    HtkMockRuleRoot,\n    isRuleGroup,\n    HtkMockRuleGroup\n} from './rules-structure';\nimport { migrateRuleData } from './rule-migrations';\n\nexport type DeserializationArgs = {\n    rulesStore: RulesStore\n};\n\nconst deserializeByType = <T extends { type: string, uiType?: string }>(\n    data: T,\n    lookup: _.Dictionary<any>,\n    args: DeserializationArgs\n) => {\n    const typeKey = getRulePartKey(data);\n    const clazz = lookup[typeKey];\n\n    if (!clazz) throw new Error(`Can't load unrecognized rule type: ${typeKey}`);\n\n    if (hasSerializrSchema(clazz)) {\n        return serializr.deserialize(clazz, data, () => {}, args);\n    } else {\n        return _.create(clazz.prototype, data);\n    }\n}\n\nconst MockRuleSerializer = serializr.custom(\n    (rule: HtkMockRule): HtkMockRule => {\n        const data = _.cloneDeep(toJS(rule));\n\n        // Allow matchers & handlers to override default serialization using serializr\n        data.matchers = data.matchers.map((matcher) => {\n            if (hasSerializrSchema(matcher)) {\n                return serializr.serialize(matcher);\n            } else {\n                return matcher;\n            }\n        });\n\n        if ('steps' in data) {\n            data.steps = data.steps.map((step) => {\n                if (hasSerializrSchema(step)) {\n                    return serializr.serialize(step);\n                } else {\n                    return step;\n                }\n            });\n        } else {\n            if (hasSerializrSchema(data.handler)) {\n                data.handler = serializr.serialize(data.handler);\n            }\n\n            if ('completionChecker' in data && hasSerializrSchema(data.completionChecker)) {\n                data.completionChecker = serializr.serialize(data.completionChecker);\n            }\n        }\n\n        return data;\n    },\n    (data: HtkMockRule, context: { args: DeserializationArgs }) => {\n        return {\n            id: data.id,\n            type: data.type,\n            title: data.title,\n            activated: data.activated,\n            matchers: data.matchers.map((m) =>\n                deserializeByType(m, MatcherLookup, context.args)\n            ),\n            ...('steps' in data\n                ? {\n                    steps: data.steps.map((s) => deserializeByType(s, HandlerLookup, context.args))\n                }\n                : {\n                    handler: deserializeByType(data.handler, HandlerLookup, context.args),\n                }\n            ),\n            completionChecker: 'completionChecker' in data &&\n                deserializeByType(\n                    data.completionChecker,\n                    completionCheckers.CompletionCheckerLookup,\n                    context.args\n                )\n        };\n    }\n);\n\nconst MockItemSerializer: serializr.PropSchema = serializr.custom(\n    (item: HtkMockItem) => {\n        if (isRuleGroup(item)) {\n            return serializr.serialize(MockRuleGroupSchema, item);\n        } else {\n            return MockRuleSerializer.serializer(item);\n        }\n    },\n    (data: HtkMockItem, context: any, oldValue: any, done: (err: any, result: any) => any) => {\n        if (isRuleGroup(data)) {\n            const group = serializr.deserialize(MockRuleGroupSchema, data, done, context.args);\n            group.collapsed = true; // Groups always start collapsed when unpersisted/imported.\n            return group;\n        } else {\n            return MockRuleSerializer.deserializer(data, done, context, oldValue);\n        }\n    }\n);\n\nconst MockRuleGroupSchema = serializr.createSimpleSchema<HtkMockRuleGroup>({\n    id: serializr.primitive(),\n    title: serializr.primitive(),\n    items: serializr.list(MockItemSerializer)\n});\n\ninterface MockRuleset extends HtkMockRuleRoot {\n    version: undefined;\n}\n\nexport const MockRulesetSchema = serializr.createSimpleSchema<MockRuleset>({\n    id: serializr.primitive(),\n    title: serializr.primitive(),\n    version: serializeAsTag(() => undefined), // All compatible, so we don't version yet, but we _could_.\n    isRoot: serializr.optional(serializr.primitive()),\n    items: serializr.list(MockItemSerializer)\n});\n\nexport const serializeRules = (rules: HtkMockRuleRoot): MockRuleset => {\n    return serializr.serialize(MockRulesetSchema, rules);\n}\n\nexport const deserializeRules = (data: any, args: DeserializationArgs): HtkMockRuleRoot => {\n    return (\n        serializr.deserialize(MockRulesetSchema, migrateRuleData(data), undefined, args)\n    ) as HtkMockRuleRoot;\n}\n\nexport const SERIALIZED_RULES_MIME_TYPE = 'application/htkrules+json;charset=utf-8';","import * as _ from 'lodash';\nimport * as React from 'react';\n\nimport { styled } from \"../../styles\";\nimport { Html } from '../../types';\nimport { suggestionIconHtml, warningIconHtml } from '../../icons';\n\nimport { fromMarkdown } from '../../model/ui/markdown';\n\nexport const ContentLabel = styled.h2`\n    text-transform: uppercase;\n    opacity: ${p => p.theme.lowlightTextOpacity};\n\n    display: inline-block;\n    margin-right: 5px;\n`;\n\nexport const ContentValue = styled.div`\n    display: inline-block;\n`;\n\nexport const ContentLabelBlock = styled(ContentLabel)`\n    padding: 3px 0 0;\n    margin: 0 0 5px 0;\n    min-height: 26px;\n    display: block;\n    box-sizing: border-box;\n`;\n\nexport const ContentMonoValue = styled.div`\n    padding: 3px 0 11px;\n    width: 100%;\n\n    &:last-child {\n        padding-bottom: 0;\n    }\n\n    font-family: ${p => p.theme.monoFontFamily};\n    word-break: break-all;\n    line-height: 1.1;\n`;\n\nexport const ContentMonoValueInline = styled(ContentMonoValue)`\n    display: inline;\n`;\n\nexport const CopyableMonoValue = styled.span`\n    font-family: ${p => p.theme.monoFontFamily};\n    font-size: 90%;\n    user-select: all;\n    font-weight: bold;\n\n    word-break: break-all; /* Fallback for anybody without break-word */\n    word-break: break-word;\n`;\n\nexport const BlankContentPlaceholder = styled.div`\n    opacity: ${p => p.theme.lowlightTextOpacity};\n    font-style: italic;\n    display: inline-block;\n`;\n\n// Takes some HTML (in an __html object) and renders it with nice\n// default formatting. THIS MUST ONLY BE CALLED WITH SANITIZED HTML.\n// The __html format is intended to enforce this - those objects\n// should only be created during sanitization.\nexport const ExternalContent = (p:  React.HTMLAttributes<HTMLDivElement> & {\n    content: Html\n}) => <Content {..._.omit(p, 'content')} dangerouslySetInnerHTML={p.content} />\n\n// Format blocks of readable text/docs/etc.\nexport const Content = styled.div`\n    line-height: 1.3;\n\n    p, li, ul, ol, table, h1, h2, h3, h4, h5, h6, pre {\n        margin-bottom: 10px;\n    }\n\n    p::first-letter,\n    li::first-letter,\n    h1::first-letter,\n    h2::first-letter,\n    h3::first-letter,\n    h4::first-letter,\n    h5::first-letter,\n    h6::first-letter {\n        text-transform: capitalize;\n    }\n\n    ol, ul {\n        padding-left: 20px;\n    }\n\n    ol {\n        list-style: decimal;\n    }\n\n    ul {\n        list-style: circle;\n    }\n\n    table {\n        border-collapse: unset;\n        border-spacing: 5px;\n        margin-left: -5px;\n    }\n\n    th {\n        min-width: 80px;\n    }\n\n    code {\n        word-break: break-all; /* Fallback for anybody without break-word */\n        word-break: break-word;\n        font-family: ${p => p.theme.monoFontFamily};\n    }\n\n    h1, h2, h3, h4, h5, h6 {\n        font-weight: bold;\n        margin-bottom: 10px;\n    }\n\n    pre {\n        white-space: pre-wrap;\n        display: block;\n        border-left: 3px solid ${p => p.theme.containerWatermark};\n        padding-left: 8px;\n    }\n\n    img {\n        max-width: 100%;\n    }\n\n    a[href] {\n        color: ${p => p.theme.linkColor};\n\n        &:visited {\n            color: ${p => p.theme.visitedLinkColor};\n        }\n    }\n\n    :last-child :last-child {\n        margin-bottom: 0;\n    }\n`;\n\nexport const Markdown = (p: { content: string | undefined }) =>\n    p.content ?\n        <ExternalContent content={fromMarkdown(\n            p.content\n                .replace(/:suggestion:/g, suggestionIconHtml)\n                .replace(/:warning:/g, warningIconHtml)\n        )} />\n    : null;","import * as React from 'react';\n\nimport {\n    Formatters,\n    isEditorFormatter,\n    EditorFormatter\n} from '../../model/events/body-formatting';\nimport { getContentEditorName } from '../../model/events/content-types';\n\nimport { IconButton } from './icon-button';\n\nexport const FormatButton = (props: {\n    className?: string,\n    format: keyof typeof Formatters,\n    content: Buffer,\n    onFormatted: (content: string) => void\n}) => {\n    const { format, content, onFormatted } = props;\n\n    const formatter = Formatters[format];\n    const canFormat = !!formatter &&\n        isEditorFormatter(formatter) &&\n        [\n            'json',\n            'html',\n            'xml',\n            'javascript',\n            'css'\n        ].includes(format);\n\n    return <IconButton\n        className={props.className}\n        title={canFormat\n            ? `Format as ${getContentEditorName(props.format)}`\n            : \"\"\n        }\n        disabled={!canFormat}\n        icon={['fas', 'align-left']}\n        onClick={async () => {\n            // This is often async, and in that case it'll have a race condition: if you\n            // format content and then keep editing, when its formatted you lose your edits.\n            // That gap should be very short though, and arguably this is expected,\n            // so we ignore it.\n            onFormatted(\n                await (formatter as EditorFormatter).render(content)\n            );\n        }}\n    />;\n}\n","import * as React from 'react';\n\nimport { ReadOnlyPairs } from './editable-pairs';\n\nexport const ReadOnlyParams = (props: { content: string, className?: string }) => {\n    const params = new URLSearchParams(props.content);\n    const paramPairs = [...params].map(([key, value]) => ({ key, value }));\n    return <ReadOnlyPairs\n        className={props.className}\n        pairs={paramPairs}\n    />;\n}","import * as React from 'react';\n\nimport { styled } from '../../styles';\n\n// The image viewer, as used in content viewer editors when the image format\n// is selected from the dropdown:\nexport const ImageViewer = styled((p: {\n    className?: string\n    content: Buffer,\n    rawContentType: string\n}) => <img\n    className={p.className}\n    src={`data:${p.rawContentType || ''};base64,${p.content.toString('base64')}`}\n/>)`\n    display: block;\n    max-width: 100%;\n    margin: 0 auto;\n    object-fit: scale-down;\n`;","import { styled } from '../../styles';\n\nimport { ViewableContentType } from '../events/content-types';\nimport { ObservablePromise, observablePromise } from '../../util/observable';\nimport { bufferToString } from '../../util';\n\nimport type { WorkerFormatterKey } from '../../services/ui-worker-formatters';\nimport { formatBufferAsync } from '../../services/ui-worker-api';\nimport { ReadOnlyParams } from '../../components/common/editable-params';\nimport { ImageViewer } from '../../components/editor/image-viewer';\n\nexport interface EditorFormatter {\n    language: string;\n    cacheKey: Symbol;\n    render(content: Buffer): string | ObservablePromise<string>;\n}\n\ntype FormatComponentProps = {\n    content: Buffer;\n    rawContentType: string | undefined;\n};\n\ntype FormatComponent = React.ComponentType<FormatComponentProps>;\n\ntype FormatComponentConfig = {\n    layout: 'scrollable' | 'centered';\n    Component: FormatComponent;\n};\n\ntype Formatter = EditorFormatter | FormatComponentConfig;\n\nexport function isEditorFormatter(input: any): input is EditorFormatter {\n    return !!input.language;\n}\n\nconst buildAsyncRenderer = (formatKey: WorkerFormatterKey) =>\n    (input: Buffer) => observablePromise(\n        formatBufferAsync(input, formatKey)\n    );\n\nexport const Formatters: { [key in ViewableContentType]: Formatter } = {\n    raw: {\n        language: 'text',\n        cacheKey: Symbol('raw'),\n        render: (input: Buffer) => {\n            if (input.byteLength < 2000) {\n                try {\n                    // For short-ish inputs, we return synchronously - conveniently this avoids\n                    // showing the loading spinner that churns the layout in short content cases.\n                    return input.toString('hex')\n                        .replace(/(\\w\\w)/g, '$1 ')\n                        .trimRight();\n                        // ^ Same logic as in UI-worker-formatter\n                } catch (e) {\n                    return observablePromise(Promise.reject(e));\n                }\n            } else {\n                return observablePromise(\n                    formatBufferAsync(input, 'raw')\n                );\n            }\n        }\n    },\n    text: {\n        language: 'text',\n        cacheKey: Symbol('text'),\n        render: (input: Buffer) => {\n            return bufferToString(input);\n        }\n    },\n    base64: {\n        language: 'text',\n        cacheKey: Symbol('base64'),\n        render: buildAsyncRenderer('base64')\n    },\n    markdown: {\n        language: 'markdown',\n        cacheKey: Symbol('markdown'),\n        render: buildAsyncRenderer('markdown')\n    },\n    yaml: {\n        language: 'yaml',\n        cacheKey: Symbol('yaml'),\n        render: buildAsyncRenderer('yaml')\n    },\n    html: {\n        language: 'html',\n        cacheKey: Symbol('html'),\n        render: buildAsyncRenderer('html')\n    },\n    xml: {\n        language: 'xml',\n        cacheKey: Symbol('xml'),\n        render: buildAsyncRenderer('xml')\n    },\n    json: {\n        language: 'json',\n        cacheKey: Symbol('json'),\n        render: (input: Buffer) => {\n            if (input.byteLength < 10000) {\n                const inputAsString = bufferToString(input);\n\n                try {\n                    // For short-ish inputs, we return synchronously - conveniently this avoids\n                    // showing the loading spinner that churns the layout in short content cases.\n                    return JSON.stringify(\n                        JSON.parse(inputAsString),\n                    null, 2);\n                    // ^ Same logic as in UI-worker-formatter\n                } catch (e) {\n                    // Fallback to showing the raw un-formatted JSON:\n                    return inputAsString;\n                }\n            } else {\n                return observablePromise(\n                    formatBufferAsync(input, 'json')\n                );\n            }\n        }\n    },\n    javascript: {\n        language: 'javascript',\n        cacheKey: Symbol('javascript'),\n        render: buildAsyncRenderer('javascript')\n    },\n    css: {\n        language: 'css',\n        cacheKey: Symbol('css'),\n        render: buildAsyncRenderer('css')\n    },\n    'url-encoded': {\n        layout: 'scrollable',\n        Component: styled(ReadOnlyParams).attrs((p: FormatComponentProps) => ({\n            content: bufferToString(p.content)\n        }))`\n            padding: 5px;\n        ` as FormatComponent\n    },\n    image: {\n        layout: 'centered',\n        Component: ImageViewer\n    }\n};\n","import * as _ from 'lodash';\nimport * as dateFns from 'date-fns';\nimport * as HarFormat from 'har-format';\nimport * as HarValidator from 'har-validator';\nimport * as querystring from 'querystring';\n\nimport {\n    Headers,\n    HtkRequest,\n    HarRequest,\n    HarResponse,\n    HttpExchange,\n    CollectedEvent,\n    TimingEvents,\n    FailedTlsConnection,\n    InputWebSocketMessage,\n    InputTlsFailure\n} from '../../types';\n\nimport { stringToBuffer } from '../../util';\nimport { lastHeader } from '../../util/headers';\nimport { ObservablePromise } from '../../util/observable';\nimport { unreachableCheck } from '../../util/error';\n\nimport { UI_VERSION } from '../../services/service-versions';\nimport { getStatusMessage } from './http-docs';\nimport { StreamMessage } from '../events/stream-message';\nimport { QueuedEvent } from '../events/events-store';\n\n// We only include request/response bodies that are under 500KB\nconst HAR_BODY_SIZE_LIMIT = 500000;\nconst UTF8Decoder = new TextDecoder('utf8', { fatal: true });\n\nexport interface Har extends HarFormat.Har {\n    log: HarLog;\n}\n\nexport interface HarGenerationOptions {\n    bodySizeLimit: number;\n}\n\ninterface HarLog extends HarFormat.Log {\n    // Custom field to expose failed TLS connections\n    _tlsErrors: HarTlsErrorEntry[];\n\n    // Our extended version of HAR entries:\n    entries: HarEntry[];\n}\n\nexport type RequestContentData = {\n    text: string;\n    size: number;\n    encoding?: 'base64';\n    comment?: string;\n};\n\nexport interface ExtendedHarRequest extends HarFormat.Request {\n    _requestBodyStatus?:\n        | 'discarded:too-large'\n        | 'discarded:not-representable'\n        | 'discarded:not-decodable';\n    _content?: RequestContentData;\n}\n\nexport interface HarEntry extends HarFormat.Entry {\n    _resourceType?: 'websocket';\n    _webSocketMessages?: HarWebSocketMessage[];\n    _webSocketClose?: {\n        code?: number;\n        reason?: string;\n        timestamp?: number;\n    } | 'aborted'\n    _pinned?: true;\n}\n\nexport interface HarWebSocketMessage {\n    type: 'send' | 'receive';\n    opcode: 1 | 2;\n    data: string;\n    time: number; // Epoch timestamp, as a float in seconds\n}\n\nexport type HarTlsErrorEntry = {\n    startedDateTime: string;\n    time: number; // Floating-point high-resolution duration, in ms\n    hostname?: string; // Undefined if connection fails before hostname received\n    cause: FailedTlsConnection['failureCause'];\n\n    clientIPAddress: string;\n    clientPort: number;\n}\n\nexport async function generateHar(\n    events: CollectedEvent[],\n    options: HarGenerationOptions = { bodySizeLimit: HAR_BODY_SIZE_LIMIT }\n): Promise<Har> {\n    const [exchanges, otherEvents] = _.partition(events, e => e.isHttp()) as [\n        HttpExchange[], CollectedEvent[]\n    ];\n\n    const errors = otherEvents.filter(e => e.isTlsFailure()) as FailedTlsConnection[];\n\n    const sourcePages = getSourcesAsHarPages(exchanges);\n    const entries = await Promise.all(exchanges.map(e => generateHarHttpEntry(e, options)));\n    const errorEntries = errors.map(generateHarTlsError);\n\n    return {\n        log: {\n            version: \"1.2\",\n            creator: {\n                name: \"HTTP Toolkit\",\n                version: UI_VERSION\n            },\n            pages: sourcePages,\n            entries,\n            _tlsErrors: errorEntries\n        }\n    };\n}\n\nfunction asHarHeaders(headers: Headers) {\n    return _.map(headers, (headerValue, headerKey) => ({\n        name: headerKey,\n        value: _.isArray(headerValue)\n            ? headerValue.join(',')\n            : headerValue!\n    }))\n}\n\nfunction asHtkHeaders(headers: HarFormat.Header[]) {\n    return _(headers)\n        .keyBy((header) => header.name)\n        .mapKeys((_, headerName) => headerName.toLowerCase())\n        .mapValues((header) => header.value)\n        .value() as Headers;\n}\n\nexport function generateHarRequest(\n    request: HtkRequest,\n    waitForDecoding: false,\n    options: HarGenerationOptions\n): ExtendedHarRequest;\nexport function generateHarRequest(\n    request: HtkRequest,\n    waitForDecoding: true,\n    options: HarGenerationOptions\n): ExtendedHarRequest | ObservablePromise<ExtendedHarRequest>;\nexport function generateHarRequest(\n    request: HtkRequest,\n    waitForDecoding: boolean,\n    options: HarGenerationOptions\n): ExtendedHarRequest | ObservablePromise<ExtendedHarRequest> {\n    if (waitForDecoding && (\n        !request.body.decodedPromise.state ||\n        request.body.decodedPromise.state === 'pending'\n    )) {\n        return request.body.decodedPromise.then(() =>\n            generateHarRequest(request, false, options)\n        );\n    }\n\n    const requestEntry: ExtendedHarRequest = {\n        method: request.method,\n        url: request.parsedUrl.toString(),\n        httpVersion: `HTTP/${request.httpVersion || '1.1'}`,\n        cookies: [],\n        headers: asHarHeaders(request.headers),\n        queryString: Array.from(request.parsedUrl.searchParams.entries()).map(\n            ([paramKey, paramValue]) => ({\n                name: paramKey,\n                value: paramValue\n            })\n        ),\n        headersSize: -1,\n        bodySize: request.body.encoded.byteLength\n    };\n\n    if (request.body.decoded) {\n        if (request.body.decoded.byteLength > options.bodySizeLimit) {\n            requestEntry._requestBodyStatus = 'discarded:too-large';\n            requestEntry.comment = `Body discarded during HAR generation: longer than limit of ${\n                options.bodySizeLimit\n            } bytes`;\n        } else {\n            try {\n                requestEntry.postData = generateHarPostBody(\n                    UTF8Decoder.decode(request.body.decoded),\n                    lastHeader(request.headers['content-type']) || 'application/octet-stream'\n                );\n            } catch (e) {\n                if (e instanceof TypeError) {\n                    requestEntry._requestBodyStatus = 'discarded:not-representable';\n                    requestEntry._content = {\n                        text: request.body.decoded.toString('base64'),\n                        size: request.body.decoded.byteLength,\n                        encoding: 'base64',\n                    }\n                } else {\n                    throw e;\n                }\n            }\n        }\n    } else {\n        requestEntry._requestBodyStatus = 'discarded:not-decodable';\n    }\n\n    return requestEntry;\n}\n\ntype TextBody = {\n    mimeType: string,\n    text: string\n};\n\ntype ParamBody = {\n    mimeType: string,\n    params: HarFormat.Param[]\n}\n\nfunction generateHarPostBody(body: string | false, mimeType: string): TextBody | ParamBody | undefined {\n    if (!body) return;\n\n    if (mimeType === 'application/x-www-form-urlencoded') {\n        let parsedBody: querystring.ParsedUrlQuery | undefined;\n\n        try {\n            parsedBody = querystring.parse(body);\n        } catch (e) {\n            console.log('Failed to parse url encoded body', body);\n        }\n\n        if (parsedBody) {\n            // URL encoded data - expose this explicitly\n            return {\n                mimeType,\n                params: generateHarParamsFromParsedQuery(parsedBody),\n                // The spec says we shouldn't export params & text at the same time, but Chrome & FF do,\n                // it's required for full imports there in some cases, and it's useful to ensure we're\n                // perfectly reproducing the original body format.\n                text: body\n            };\n        } else {\n            // URL encoded but not parseable so just use the raw data\n            return {\n                mimeType,\n                text: body\n            };\n        }\n    } else {\n        // Not URL encoded, so just use the raw data\n        return {\n            mimeType,\n            text: body\n        };\n    }\n}\n\nfunction generateHarParamsFromParsedQuery(query: querystring.ParsedUrlQuery): HarFormat.Param[] {\n    const queryEntries = _.flatMap(Object.entries(query), ([key, value]): Array<[string, string]> => {\n        if (_.isString(value)) return [[key, value]];\n        else return value!.map((innerValue) => [\n            key, innerValue\n        ]);\n    });\n\n    return queryEntries.map(([key, value]) => ({\n        name: key,\n        value\n    }));\n}\n\nasync function generateHarResponse(\n    exchange: HttpExchange,\n    options: HarGenerationOptions\n): Promise<HarFormat.Response> {\n    const { request, response } = exchange;\n\n    if (!response || response === 'aborted') {\n        return {\n            status: 0,\n            statusText: \"\",\n            httpVersion: \"\",\n            headers: [],\n            cookies: [],\n            content: { size: 0, mimeType: \"application/x-unknown\" },\n            redirectURL: \"\",\n            headersSize: -1,\n            bodySize: -1\n        };\n    }\n\n    const decoded = await response.body.decodedPromise;\n\n    let responseContent: { text: string, encoding?: string } | { comment: string};\n    try {\n        if (!decoded || decoded.byteLength > options.bodySizeLimit) {\n            // If no body or the body is too large, don't include it\n            responseContent = {\n                comment: `Body discarded during HAR generation: longer than limit of ${\n                    options.bodySizeLimit\n                } bytes`\n            };\n        } else {\n            // If body decodes as text, keep it as text\n            responseContent = { text: UTF8Decoder.decode(decoded) };\n        }\n    } catch (e) {\n        // If body doesn't decode as text, base64 encode it\n        responseContent = {\n            text: decoded!.toString('base64'),\n            encoding: 'base64'\n        };\n    }\n\n    return {\n        status: response.statusCode,\n        statusText: response.statusMessage,\n        httpVersion: `HTTP/${request.httpVersion || '1.1'}`,\n        cookies: [],\n        headers: asHarHeaders(response.headers),\n        content: Object.assign(\n            {\n                mimeType: lastHeader(response.headers['content-type']) ||\n                    'application/octet-stream',\n                size: response.body.decoded?.byteLength || 0\n            },\n            responseContent\n        ),\n        redirectURL: \"\",\n        headersSize: -1,\n        bodySize: response.body.encoded.byteLength || 0\n    };\n}\n\nfunction getSourcesAsHarPages(exchanges: HttpExchange[]): HarFormat.Page[] {\n    const exchangesBySource = _.groupBy(exchanges, (e) =>\n        e.request.source.summary\n    );\n\n    return _.map(exchangesBySource, (exchanges, source) => {\n        const sourceStartTime = Math.min(...exchanges.map(e =>\n            e.timingEvents.startTime ?? Date.now()\n        ), Date.now());\n\n        return {\n            id: source,\n            title: source,\n            startedDateTime: dateFns.format(sourceStartTime),\n            pageTimings: {}\n        }\n    });\n}\n\nasync function generateHarHttpEntry(\n    exchange: HttpExchange,\n    options: HarGenerationOptions\n): Promise<HarEntry> {\n    const { timingEvents } = exchange;\n\n    const startTime = timingEvents.startTime ?? Date.now();\n\n    const sendDuration = timingEvents.bodyReceivedTimestamp\n        ? timingEvents.bodyReceivedTimestamp! - timingEvents.startTimestamp!\n        : 0;\n    const waitDuration = timingEvents.bodyReceivedTimestamp && timingEvents.headersSentTimestamp\n        ? timingEvents.headersSentTimestamp - timingEvents.bodyReceivedTimestamp\n        : 0;\n    const receiveDuration = timingEvents.responseSentTimestamp\n        ? timingEvents.responseSentTimestamp! - timingEvents.headersSentTimestamp!\n        : 0;\n\n    const endTimestamp = timingEvents.wsClosedTimestamp ??\n        timingEvents.responseSentTimestamp ??\n        timingEvents.abortedTimestamp;\n\n    const totalDuration = endTimestamp\n        ? endTimestamp - timingEvents.startTimestamp!\n        : -1;\n\n    return {\n        pageref: exchange.request.source.summary,\n        startedDateTime: dateFns.format(startTime),\n        time: totalDuration,\n        request: await generateHarRequest(exchange.request, true, options),\n        response: await generateHarResponse(exchange, options),\n        cache: {},\n        timings: {\n            blocked: -1,\n            dns: -1,\n            connect: -1,\n            ssl: -1,\n            // These can be negative when events overlap. E.g. if we mock a response we may\n            // send the response before the request has been completed. In that case, we\n            // just 0 the values for now, because these 3 are required >= 0 by the HAR spec\n            // TODO: In future, more clearly express that.\n            send: Math.max(sendDuration, 0),\n            wait: Math.max(waitDuration, 0),\n            receive: Math.max(receiveDuration, 0)\n        },\n        _pinned: exchange.pinned || undefined,\n\n        ...(exchange.isWebSocket() ? {\n            _resourceType: 'websocket',\n            _webSocketMessages: exchange.messages.map((message) =>\n                generateHarWebSocketMessage(message, timingEvents)\n            ),\n            _webSocketClose: exchange.closeState && exchange.closeState !== 'aborted'\n                ? {\n                    code: exchange.closeState.closeCode,\n                    reason: exchange.closeState.closeReason,\n                    timestamp: timingEvents.wsClosedTimestamp\n                        ? timingEvents.wsClosedTimestamp / 1000 // Match _webSocketMessage format\n                        : undefined\n                }\n                : exchange.closeState\n        } : {})\n    };\n}\n\nfunction generateHarWebSocketMessage(\n    message: StreamMessage,\n    timingEvents: Partial<TimingEvents>\n): HarWebSocketMessage {\n    return {\n        // Note that msg.direction is from the perspective of Mockttp, not the client.\n        type: message.direction === 'sent'\n                ? 'receive'\n            : message.direction === 'received'\n                ? 'send'\n            : unreachableCheck(message.direction),\n\n        opcode: message.isBinary ? 2 : 1,\n        data: message.isBinary\n            ? message.content.toString('base64')\n            : message.content.toString('utf8'),\n\n        // N.b. timestamp is precise but relative, startTime is epoch-based but imprecise,\n        // eventual result here has to be in seconds as a float.\n        time: (timingEvents.startTime! + (message.timestamp - timingEvents.startTimestamp!)) / 1000\n    };\n}\n\nfunction generateHarTlsError(event: FailedTlsConnection): HarTlsErrorEntry {\n    const timingEvents = event.timingEvents ?? {};\n\n    const startTime = 'startTime' in timingEvents\n        ? timingEvents.startTime\n        : new Date();\n\n    const failureDuration = 'failureTimestamp' in timingEvents\n        ? timingEvents.failureTimestamp - timingEvents.connectTimestamp\n        : 0;\n\n    return {\n        startedDateTime: dateFns.format(startTime),\n        time: failureDuration,\n        cause: event.failureCause,\n        hostname: event.upstreamHostname,\n        clientIPAddress: event.remoteIpAddress,\n        clientPort: event.remotePort\n    };\n}\n\nexport interface ParsedHar {\n    events: QueuedEvent[];\n    pinnedIds: string[];\n};\n\nconst sumTimings = (\n    timings: HarFormat.Timings,\n    ...keys: Array<keyof HarFormat.Timings>\n): number =>\n    _.sumBy(keys, (k) => {\n        const v = Number(timings[k]);\n        if (!v || v < 0) return 0;\n        else return v;\n    });\n\nexport async function parseHar(harContents: unknown): Promise<ParsedHar> {\n    const har = await HarValidator.har(cleanRawHarData(harContents)) as Har;\n\n    const baseId = _.random(1_000_000) + '-';\n\n    const events: QueuedEvent[] = [];\n    const pinnedIds: string[] = []\n\n    har.log.entries.forEach((entry, i) => {\n        const id = baseId + i;\n        const isWebSocket = entry._resourceType === 'websocket';\n\n        const timingEvents: TimingEvents = {\n            startTime: dateFns.parse(entry.startedDateTime).getTime(),\n            startTimestamp: 0,\n            bodyReceivedTimestamp: sumTimings(entry.timings,\n                'blocked',\n                'dns',\n                'connect',\n                'send'\n            ),\n            headersSentTimestamp: sumTimings(entry.timings,\n                'blocked',\n                'dns',\n                'connect',\n                'send',\n                'wait'\n            )\n        };\n\n        Object.assign(timingEvents,\n            entry.response.status !== 0\n                ? { responseSentTimestamp: entry.time }\n                : { abortedTimestamp: entry.time },\n\n            isWebSocket\n                ? {\n                    wsAcceptedTimestamp: timingEvents.headersSentTimestamp,\n                    wsClosedTimestamp: entry.time\n                }\n                : {}\n        );\n\n\n        const request = parseHarRequest(id, entry.request, timingEvents);\n\n        events.push({\n            type: isWebSocket ? 'websocket-request' : 'request',\n            event: request\n        });\n\n        if (entry.response.status !== 0) {\n            events.push({\n                type: isWebSocket && entry.response.status === 101\n                    ? 'websocket-accepted'\n                    : 'response',\n                event: parseHarResponse(id, entry.response, timingEvents)\n            });\n        } else {\n            events.push({ type: 'abort', event: request });\n        }\n\n        if (isWebSocket) {\n            events.push(...entry._webSocketMessages?.map(message => ({\n                type: `websocket-message-${message.type === 'send' ? 'received' : 'sent'}` as const,\n                event: {\n                    streamId: request.id,\n                    direction: message.type === 'send' ? 'received' : 'sent',\n                    isBinary: message.opcode === 2,\n                    content: Buffer.from(message.data, message.opcode === 2 ? 'base64' : 'utf8'),\n                    eventTimestamp: (message.time * 1000) - timingEvents.startTime,\n                    timingEvents: timingEvents,\n                    tags: []\n                } satisfies InputWebSocketMessage\n            })) ?? []);\n\n            const closeEvent = entry._webSocketClose;\n\n            if (closeEvent && closeEvent !== 'aborted') {\n                events.push({\n                    type: 'websocket-close',\n                    event: {\n                        streamId: request.id,\n                        closeCode: closeEvent.code,\n                        closeReason: closeEvent.reason ?? \"\",\n                        timingEvents: timingEvents,\n                        tags: []\n                    }\n                });\n            } else {\n                // N.b. WebSockets can abort _after_ the response event!\n                events.push({ type: 'abort', event: request });\n            }\n        }\n\n        if (entry._pinned) pinnedIds.push(id);\n    });\n\n    if (har.log._tlsErrors) {\n        events.push(...har.log._tlsErrors.map((entry) => ({\n            type: 'tls-client-error' as const,\n            event: {\n                failureCause: entry.cause,\n                hostname: entry.hostname,\n                remoteIpAddress: entry.clientIPAddress,\n                remotePort: entry.clientPort,\n                tags: [],\n                timingEvents: {\n                    startTime: dateFns.parse(entry.startedDateTime).getTime(),\n                    connectTimestamp: 0,\n                    failureTimestamp: entry.time\n                }\n            }\n        })));\n    }\n\n    return { events, pinnedIds };\n}\n\n// Mutatively cleans & returns the HAR, to tidy up irrelevant but potentially\n// problematic details & ensure we can parse it, if at all possible.\nfunction cleanRawHarData(harContents: any) {\n    const entries = harContents?.log?.entries ?? [];\n\n    entries.forEach((entry: any) => {\n        // Some HAR exports include invalid serverIPAddresses, which fail validation.\n        // Somebody is wrong here, but we don't really care, we never use this data;\n        // just drop it entirely instead.\n        delete entry.serverIPAddress;\n\n        // FF fails to write headersSize or writes null for req/res that has no headers.\n        // We don't use it anyway - set it to -1 if it's missing\n        if (entry.request) {\n            entry.request.headersSize ??= -1;\n            if (entry.request.postData) {\n                // Charles sets this to null, but the spec requires a string\n                entry.request.postData.mimeType ??= 'application/octet-stream';\n            }\n\n            // Cookie data is often messed up (Charles adds extra \"\"/null pairs, sets bad expires datastring format)\n            // and it's optional and we don't use it, so it's better to drop it entirely.\n            entry.request.cookies = [];\n        }\n\n        // Firefox fails to write timing data for some requests, e.g. requests blocked\n        // by adblocker extensions: https://bugzilla.mozilla.org/show_bug.cgi?id=1716335\n        if (entry.timings) {\n            entry.timings.send ??= -1;\n            entry.timings.wait ??= -1;\n            entry.timings.receive ??= -1;\n        }\n\n        if (entry.response) {\n            entry.response.redirectURL ??= \"\"; // Charles sets this to null, but the spec requires a string\n            entry.response.headersSize ??= -1;\n\n            if (entry.response.statusText == null) {\n                // Charles omits the status message in some cases\n                entry.response.statusText = getStatusMessage(entry.response.status);\n            }\n\n            if (entry.response.bodySize === null) {\n                // Firefox sometimes sets bodySize to null, even when there is clearly a body being received.\n                // Fall back to content-length if available, or use -1 if not.\n                // We do want to use this where it's available so this is a bit annoying, but c'est la vie:\n                // it's not super important data (just used to compare compression perf) and there's not much\n                // we can do when the imported file contains invalid data like this.\n                const contentLengthHeader = _.find(entry.response.headers || [],\n                    ({ name }) => name.toLowerCase() === 'content-length'\n                );\n                if (contentLengthHeader) {\n                    entry.response.bodySize = parseInt(contentLengthHeader.value, 10);\n                } else {\n                    entry.response.bodySize = -1;\n                }\n            }\n\n            if (entry.response.content) {\n                // Similarly, when there's no actual response some fields can be missing. Note that\n                // 'content' is response only, but we don't use these fields anyway:\n                entry.response.content.size ??= -1;\n                entry.response.content.mimeType ??= 'application/octet-stream';\n            }\n\n            // Cookie data is often messed up (Charles adds extra \"\"/null pairs, expires datastring format is often wrong)\n            // and it's optional and we don't use it, so it's better to drop it entirely.\n            entry.response.cookies = [];\n        }\n\n        // We never use the 'cache' field, and it can be annoyingly invalid, so drop it.\n        entry.cache = {};\n    });\n\n    const pages = harContents?.log?.pages ?? [];\n    pages.forEach((page: HarFormat.Page) => {\n        // FF doesn't give pages their (required) titles:\n        if (page.title === undefined) page.title = page.id;\n\n        // All timings fields are optional, but some sources provide 'null' values (instead of -1)\n        // to mark missing data, which isn't valid. Fortunately, we never use this data, so we can\n        // just drop it entirely:\n        page.pageTimings = {};\n    });\n\n    return harContents;\n}\n\nfunction parseHarRequest(\n    id: string,\n    request: ExtendedHarRequest,\n    timingEvents: TimingEvents\n): HarRequest {\n    const parsedUrl = new URL(request.url);\n\n    return {\n        id,\n        timingEvents,\n        tags: [],\n        matchedRuleId: false,\n        protocol: request.url.split(':')[0],\n        method: request.method,\n        url: request.url,\n        path: parsedUrl.pathname,\n        hostname: parsedUrl.hostname,\n        // We need to promise it has a 'host' header (i.e. the headers are\n        // legal for an HTTP request):\n        headers: asHtkHeaders(request.headers) as Headers & { host: string },\n        rawHeaders: request.headers.map(h => [h.name, h.value]),\n        body: {\n            decoded: request._content\n                ? parseHarRequestContents(request._content)\n                : parseHarPostData(request.postData),\n            encodedLength: request.bodySize\n        }\n    }\n}\n\nfunction parseHarRequestContents(data: RequestContentData): Buffer {\n    if (data.encoding && Buffer.isEncoding(data.encoding)) {\n        return Buffer.from(data.text, data.encoding);\n    }\n\n    throw TypeError(\"Invalid encoding\");\n}\n\nfunction parseHarPostData(data: HarFormat.PostData | undefined): Buffer {\n    if (data?.text) {\n        // Prefer raw exported 'text' data, when available\n        return stringToBuffer(data.text, 'utf8');\n    } else if (data?.params) {\n        // If only 'params' is available, stringify and use that.\n        return stringToBuffer(\n            // Go from array of key-value objects to object of key -> value array:\n            querystring.stringify(_(data.params)\n                .groupBy(({ name }) => name)\n                .mapValues((params) => params.map(p => p.value || ''))\n                .valueOf()\n            )\n        );\n    } else {\n        return stringToBuffer('');\n    }\n}\n\nfunction parseHarResponse(\n    id: string,\n    response: HarFormat.Response,\n    timingEvents: TimingEvents\n): HarResponse {\n    return {\n        id,\n        timingEvents,\n        tags: [],\n        statusCode: response.status,\n        statusMessage: response.statusText,\n        headers: asHtkHeaders(response.headers),\n        rawHeaders: response.headers.map(h => [h.name, h.value]),\n        body: {\n            decoded: Buffer.from(\n                response.content.text || '',\n                response.content.encoding as BufferEncoding || 'utf8'\n            ),\n            encodedLength: (!response.bodySize || response.bodySize === -1)\n                ? 0 // If bodySize is missing or inaccessible, just zero it\n                : response.bodySize\n        }\n    }\n}\n","import * as _ from 'lodash';\nimport { observable, computed, action, runInAction, when } from 'mobx';\n\nimport {\n    HtkRequest,\n    HtkResponse,\n    Headers,\n    MessageBody,\n    InputRequest,\n    InputResponse,\n    InputFailedRequest,\n    TimingEvents,\n    InputMessage,\n    MockttpBreakpointedRequest,\n    MockttpBreakpointedResponse,\n    InputCompletedRequest,\n    MockttpBreakpointResponseResult,\n} from \"../../types\";\nimport {\n    fakeBuffer,\n    FakeBuffer,\n    stringToBuffer,\n} from '../../util';\nimport { UnreachableCheck } from '../../util/error';\nimport { lazyObservablePromise, ObservablePromise, observablePromise } from \"../../util/observable\";\nimport {\n    asHeaderArray,\n    lastHeader\n} from '../../util/headers';\n\nimport { logError } from '../../errors';\n\nimport { MANUALLY_SENT_SOURCE, parseSource } from './sources';\nimport { getContentType } from '../events/content-types';\nimport { HTKEventBase } from '../events/event-base';\n\nimport { HandlerClassKey, HtkMockRule, getRulePartKey } from '../rules/rules';\n\nimport { ApiStore } from '../api/api-store';\nimport { ApiExchange } from '../api/api-interfaces';\nimport { OpenApiExchange } from '../api/openapi';\nimport { parseRpcApiExchange } from '../api/jsonrpc';\nimport { ApiMetadata } from '../api/api-interfaces';\n\nimport { decodeBody } from '../../services/ui-worker-api';\nimport {\n    RequestBreakpoint,\n    ResponseBreakpoint,\n    getRequestBreakpoint,\n    getResponseBreakpoint,\n    getDummyResponseBreakpoint\n} from './exchange-breakpoint';\n\nfunction tryParseUrl(request: InputRequest): (URL & { parseable: true }) | undefined  {\n    try {\n        return Object.assign(\n            new URL(request.url, `${request.protocol}://${request.hostname || 'unknown.invalid'}`),\n            { parseable: true } as const\n        );\n    } catch (e) {\n        console.log('Unparseable URL:', request.url);\n        // There are many unparseable URLs, especially when unintentionally intercepting traffic\n        // from non-HTTP sources, so we don't report this - we just log locally & return undefined.\n    }\n}\n\nfunction getFallbackUrl(request: InputRequest): URL & { parseable: false } {\n    try {\n        return Object.assign(\n            new URL(\"/[unparseable]\", `${request.protocol}://${request.hostname || 'unknown.invalid'}`),\n            { parseable: false } as const\n        );\n    } catch (e) {\n        return Object.assign(\n            new URL(\"http://unparseable.invalid/\"),\n            { parseable: false } as const\n        );\n    }\n}\n\nfunction addRequestMetadata(request: InputRequest): HtkRequest {\n    try {\n        return Object.assign(request, {\n            parsedUrl: tryParseUrl(request) || getFallbackUrl(request),\n            source: request.tags.includes('httptoolkit:manually-sent-request')\n                ? MANUALLY_SENT_SOURCE\n                : parseSource(request.headers['user-agent']),\n            body: new HttpBody(request, request.headers),\n            contentType: getContentType(lastHeader(request.headers['content-type'])) || 'text',\n            cache: observable.map(new Map<symbol, unknown>(), { deep: false })\n        }) as HtkRequest;\n    } catch (e) {\n        console.log(`Failed to parse request for ${request.url} (${request.protocol}://${request.hostname})`);\n        throw e;\n    }\n}\n\nfunction addResponseMetadata(response: InputResponse): HtkResponse {\n    return Object.assign(response, {\n        body: new HttpBody(response, response.headers),\n        contentType: getContentType(\n            // There should only ever be one. If we get multiple though, just use the last.\n            lastHeader(response.headers['content-type'])\n        ) || 'text',\n        cache: observable.map(new Map<symbol, unknown>(), { deep: false })\n    }) as HtkResponse;\n}\n\nexport class HttpBody implements MessageBody {\n\n    constructor(\n        message: InputMessage,\n        headers: Headers\n    ) {\n        if (!('body' in message) || !message.body) {\n            this._encoded = stringToBuffer(\"\");\n        } else if ('buffer' in message.body) {\n            this._encoded = message.body.buffer;\n        } else {\n            this._encoded = fakeBuffer(message.body.encodedLength);\n            this._decoded = message.body.decoded;\n        }\n\n        this._contentEncoding = asHeaderArray(headers['content-encoding']);\n    }\n\n    private _contentEncoding: string[];\n    private _encoded: FakeBuffer | Buffer;\n    get encoded() {\n        return this._encoded;\n    }\n\n    private _decoded: Buffer | undefined;\n\n    @observable\n    decodingError: Error | undefined;\n\n    decodedPromise: ObservablePromise<Buffer | undefined> = lazyObservablePromise(async () => {\n        // Exactly one of _encoded & _decoded is a buffer, never neither/both.\n        if (this._decoded) return this._decoded;\n        const encodedBuffer = this.encoded as Buffer;\n\n        // Temporarily change to a fake buffer, while the web worker takes the data to decode\n        const encodedLength = encodedBuffer.byteLength;\n        this._encoded = fakeBuffer(encodedLength);\n\n        try {\n            const { decoded, encoded } = await decodeBody(encodedBuffer, this._contentEncoding);\n            this._encoded = encoded;\n            return decoded;\n        } catch (e: any) {\n            logError(e);\n\n            // In most cases, we get the encoded data back regardless, so recapture it here:\n            if (e.inputBuffer) {\n                this._encoded = e.inputBuffer;\n            }\n            runInAction(() => {\n                this.decodingError = e;\n            });\n\n            return undefined;\n        }\n    });\n\n    get decoded() {\n        // We exclude 'Error' from the value - errors should always become undefined\n        return this.decodedPromise.value as Buffer | undefined;\n    }\n\n    // Must only be called when the exchange & body will no longer be used. Ensures that large data is\n    // definitively unlinked, since some browser issues can result in exchanges not GCing immediately.\n    // Important: for safety, this leaves the body in a *VALID* but reset state - not a totally blank one.\n    cleanup() {\n        const emptyBuffer = Buffer.from([]);\n\n        // Set to a valid state for an un-decoded but totally empty body.\n        this._decoded = undefined;\n        this._encoded = emptyBuffer;\n        this.decodingError = undefined;\n        this.decodedPromise = observablePromise(Promise.resolve(emptyBuffer));\n    }\n}\n\nexport type CompletedRequest = Omit<HttpExchange, 'request'> & {\n    matchedRule: { id: string, handlerRype: HandlerClassKey } | false\n};\nexport type CompletedExchange = Omit<HttpExchange, 'response'> & {\n    response: HtkResponse | 'aborted'\n};\nexport type SuccessfulExchange = Omit<HttpExchange, 'response'> & {\n    response: HtkResponse\n};\n\nexport class HttpExchange extends HTKEventBase {\n\n    constructor(apiStore: ApiStore, request: InputRequest) {\n        super();\n\n        this.request = addRequestMetadata(request);\n\n        this.timingEvents = request.timingEvents;\n        this.tags = this.request.tags;\n\n        this.id = this.request.id;\n        this.searchIndex = [\n            this.request.url,\n            this.request.parsedUrl.protocol + '//' +\n                this.request.parsedUrl.hostname +\n                this.request.parsedUrl.pathname +\n                this.request.parsedUrl.search\n        ]\n        .concat(..._.map(this.request.headers, (value, key) => `${key}: ${value}`))\n        .concat(this.request.method)\n        .join('\\n')\n        .toLowerCase();\n\n        // Start loading the relevant Open API specs for this request, if any.\n        this._apiMetadataPromise = apiStore.getApi(this.request);\n    }\n\n    public readonly request: HtkRequest;\n    public readonly id: string;\n\n    @observable\n    // Undefined initially, defined for completed requests, false for 'not available'\n    public matchedRule: { id: string, handlerStepTypes: HandlerClassKey[] } | false | undefined;\n\n    @observable\n    public tags: string[];\n\n    @computed\n    get httpVersion() {\n        return this.request.httpVersion === '2.0' ? 2 : 1;\n    }\n\n    isHttp(): this is HttpExchange {\n        return true;\n    }\n\n    isCompletedRequest(): this is CompletedRequest {\n        return this.matchedRule !== undefined;\n    }\n\n    isCompletedExchange(): this is CompletedExchange {\n        return !!this.response;\n    }\n\n    isSuccessfulExchange(): this is SuccessfulExchange {\n        return this.isCompletedExchange() && this.response !== 'aborted';\n    }\n\n    hasRequestBody(): this is CompletedRequest {\n        return this.isCompletedRequest() && this.request.body.encoded.byteLength > 0;\n    }\n\n    hasResponseBody(): this is SuccessfulExchange {\n        return this.isSuccessfulExchange() &&\n            (this.response as HtkResponse).body.encoded.byteLength > 0;\n    }\n\n    @observable\n    public readonly timingEvents: Partial<TimingEvents>; // May be {} if using an old server (<0.1.7)\n\n    @observable.ref\n    public response: HtkResponse | 'aborted' | undefined;\n\n    @observable\n    public abortMessage: string | undefined;\n\n    updateFromCompletedRequest(request: InputCompletedRequest, matchedRule: HtkMockRule | false) {\n        if (request.body instanceof HttpBody) {\n            // If this request was used in new HttpExchange, it's mutated in some ways, and this\n            // will cause problems. Shouldn't happen, but we check against it here just in case:\n            throw new Error(\"Can't update from already-processed request\");\n        }\n\n        this.request.body = new HttpBody(request, request.headers);\n\n        this.matchedRule = !matchedRule\n                ? false\n            : 'handler' in matchedRule\n                ? {\n                    id: matchedRule.id,\n                    handlerStepTypes: [getRulePartKey(matchedRule.handler)] as HandlerClassKey[]\n                }\n            // MatchedRule has multiple steps\n                : {\n                    id: matchedRule.id,\n                    handlerStepTypes: matchedRule.steps.map(getRulePartKey) as HandlerClassKey[]\n                };\n\n        Object.assign(this.timingEvents, request.timingEvents);\n        this.tags = _.union(this.tags, request.tags);\n    }\n\n    markAborted(request: InputFailedRequest) {\n        this.response = 'aborted';\n        this.searchIndex += '\\naborted';\n\n        Object.assign(this.timingEvents, request.timingEvents);\n        this.tags = _.union(this.tags, request.tags);\n\n        if ('error' in request && request.error?.message) {\n            this.abortMessage = request.error.message;\n        }\n\n        if (this.requestBreakpoint) {\n            this.requestBreakpoint.reject(\n                new Error('Request aborted whilst breakpointed at request')\n            );\n            this._requestBreakpoint = undefined;\n        }\n        if (this.responseBreakpoint) {\n            this.responseBreakpoint.reject(\n                new Error('Request aborted whilst breakpointed at response')\n            );\n            this._responseBreakpoint = undefined;\n        }\n    }\n\n    setResponse(response: InputResponse) {\n        this.response = addResponseMetadata(response);\n\n        Object.assign(this.timingEvents, response.timingEvents);\n        this.tags = _.union(this.tags, response.tags);\n\n        this.searchIndex = [\n            this.searchIndex,\n            response.statusCode.toString(),\n            response.statusMessage.toString(),\n            ..._.map(response.headers, (value, key) => `${key}: ${value}`)\n        ].join('\\n').toLowerCase();\n\n        // Wrap the API promise to also add this response data (but lazily)\n        const requestApiPromise = this._apiPromise;\n        this._apiPromise = lazyObservablePromise(() =>\n            requestApiPromise.then((api) => {\n                if (api) api.updateWithResponse(this.response!);\n                return api;\n            })\n        );\n    }\n\n    // Must only be called when the exchange will no longer be used. Ensures that large data is\n    // definitively unlinked, since some browser issues can result in exchanges not GCing immediately.\n    // Important: for safety, this leaves the exchange in a *VALID* but reset state - not a totally blank one.\n    cleanup() {\n        this.cache.clear();\n\n        this.request.cache.clear();\n        this.request.body.cleanup();\n\n        if (this.isSuccessfulExchange()) {\n            this.response.cache.clear();\n            this.response.body.cleanup();\n        }\n    }\n\n    // API metadata:\n\n    // A convenient reference to the service-wide spec for this API - starts loading immediately\n    private _apiMetadataPromise: Promise<ApiMetadata | undefined>;\n\n    // Parsed API info for this specific request, loaded & parsed lazily, only if it's used\n    @observable.ref\n    private _apiPromise = lazyObservablePromise(async () => {\n        const apiMetadata = await this._apiMetadataPromise;\n\n        if (apiMetadata) {\n            // We load the spec, but we don't try to parse API requests until we've received\n            // the whole thing (because e.g. JSON-RPC requests aren't parseable without the body)\n            await when(() => this.isCompletedRequest());\n\n            try {\n                if (apiMetadata.type === 'openapi') {\n                    return new OpenApiExchange(apiMetadata, this);\n                } else if (apiMetadata.type === 'openrpc') {\n                    return await parseRpcApiExchange(apiMetadata, this);\n                } else {\n                    console.log('Unknown API metadata type for host', this.request.parsedUrl.hostname);\n                    console.log(apiMetadata);\n                    throw new UnreachableCheck(apiMetadata, m => m.type);\n                }\n            } catch (e) {\n                logError(e);\n                throw e;\n            }\n        } else {\n            return undefined;\n        }\n    });\n\n    // Fixed value for the parsed API data - returns the data or undefined, observably.\n    get api() {\n        if (this._apiPromise.state === 'fulfilled') {\n            return this._apiPromise.value as ApiExchange | undefined;\n        }\n    }\n\n    // Breakpoint data:\n\n    @observable.ref\n    private _requestBreakpoint?: RequestBreakpoint;\n\n    get requestBreakpoint() {\n        return this._requestBreakpoint;\n    }\n\n    @observable.ref\n    private _responseBreakpoint?: ResponseBreakpoint;\n\n    get responseBreakpoint() {\n        return this._responseBreakpoint;\n    }\n\n    @computed\n    get isBreakpointed() {\n        return this.requestBreakpoint || this.responseBreakpoint;\n    }\n\n    async triggerRequestBreakpoint(request: MockttpBreakpointedRequest) {\n        const breakpoint = await getRequestBreakpoint(request);\n        runInAction(() => { this._requestBreakpoint = breakpoint; });\n\n        const result = await breakpoint.waitForCompletedResult();\n\n        if (this._requestBreakpoint === breakpoint) {\n            runInAction(() => { this._requestBreakpoint = undefined; });\n        }\n\n        return result;\n    }\n\n    async triggerResponseBreakpoint(response: MockttpBreakpointedResponse) {\n        const breakpoint = await getResponseBreakpoint(response);\n        runInAction(() => { this._responseBreakpoint = breakpoint; });\n\n        const result = await breakpoint.waitForCompletedResult();\n\n        if (this._responseBreakpoint === breakpoint) {\n            runInAction(() => { this._responseBreakpoint = undefined; });\n        }\n\n        return result;\n    }\n\n    @action.bound\n    respondToBreakpointedRequest() {\n        // Replace the request breakpoint with an empty response breakpoint\n        this._responseBreakpoint = getDummyResponseBreakpoint(this.httpVersion);\n\n        const requestBreakpoint = this.requestBreakpoint!;\n        this._requestBreakpoint = undefined;\n\n        // When the response resumes, return it as the request result's response\n        this._responseBreakpoint.waitForCompletedResult().then(\n            action((responseResult: MockttpBreakpointResponseResult) => {\n                requestBreakpoint.respondDirectly(responseResult);\n                this._responseBreakpoint = undefined;\n            })\n        );\n    }\n\n}","import { posthog } from 'posthog-js';\nimport { format as formatDate } from 'date-fns';\n\nimport { serverVersion, desktopVersion, UI_VERSION } from './services/service-versions';\n\nconst POSTHOG_KEY = process.env.POSTHOG_KEY;\nconst enabled = !!POSTHOG_KEY && navigator.doNotTrack !== \"1\";\n\n// Note that all metrics here are fully anonymous.\n// No user information is tracked, no events are\n// sent including anything personally identifiable,\n// and all Posthog data (soon: all data) is sent\n// via an anonymizing proxy so no IP is exposed.\n\n// Metrics are used only to monitor real world\n// performance, work out which features of the app\n// are used, and detect issues (e.g. % failure for\n// different types of interception).\n\nexport function initMetrics() {\n    if (enabled) {\n        posthog.init(POSTHOG_KEY, {\n            api_host: 'https://events.httptoolkit.tech',\n            autocapture: false, // No automatic event capture please\n\n            capture_pageview: false, // We manually capture pageview (to sanitize & dedupe URLs)\n\n            advanced_disable_decide: true, // We don't need dynamic features, skip checking\n            disable_session_recording: false, // Disabled server-side, but disable explicitly here too\n\n            persistence: 'memory' // No cookies/local storage tracking - just anon session metrics\n        });\n    }\n}\n\n// Log the first run date for users, which gives us just enough data to count new vs existing installs, and overall\n// retention (do people keep using the tool) and user stats, but at day resolution so it's not actually identifiable:\nconst today = formatDate(new Date(), 'YYYY-MM-DD');\nconst isFirstRun = localStorage.getItem('first-run-date') === null &&\n    localStorage.getItem('theme-background-color') === null; // Extra check, for people who pre-date first-run-date\n\nconst storedFirstRunDate = localStorage.getItem('first-run-date');\nconst firstRunDate = storedFirstRunDate ?? today;\nif (!storedFirstRunDate) {\n    localStorage.setItem('first-run-date', firstRunDate);\n}\n\n// Track last run too, which gives us some idea of how many users use HTTP Toolkit per day.\nconst isFirstRunToday = localStorage.getItem('last-run-date') !== today;\nif (isFirstRunToday) localStorage.setItem('last-run-date', today);\n\n// (Of course, Posthog does have retention tools to track this kind of thing in depth, but we avoid using them here\n// as they require tracking individual users & storing persistent ids etc - rough & anon is good enough).\n\n// This is passed via $set_once on all Posthog events, and the session collects metadata once it's\n// available. These values never change as all metrics are anonymous - there's no connection between\n// sessions, so the desktop/server version is always fixed.\nconst sessionData = () => ({\n    'first-run': isFirstRun,\n    'first-run-today': isFirstRunToday,\n    'ui-version': UI_VERSION,\n    'server-version': serverVersion.state === 'fulfilled' ? serverVersion.value : undefined,\n    'desktop-version': desktopVersion.state === 'fulfilled' ? desktopVersion.value : undefined,\n});\n\nconst normalizeUrl = (url: string) =>\n    url\n    .replace(/\\/view\\/[a-z0-9\\-]+/, '/view') // Strip row ids\n    .replace(/\\/mock\\/[a-z0-9\\-]+/, '/mock') // Strip mock rule ids\n    .replace(/\\?.*/, ''); // Strip any query & hash params\n\nlet seenPages: string[] = [];\n\nexport function trackPage(location: Window['location']) {\n    if (!enabled) return;\n\n    const currentUrl = normalizeUrl(location.href);\n\n    if (seenPages.includes(currentUrl)) return;\n    seenPages.push(currentUrl);\n\n    posthog.capture('$pageview', {\n        $current_url: currentUrl,\n        $set_once: { ...sessionData() }\n    });\n}\n\nexport function trackEvent(event: {\n    category: string,\n    action: string,\n    value?: string\n}) {\n    if (!enabled) return;\n\n    const currentUrl = normalizeUrl(location.href);\n\n    posthog.capture(`${event.category}:${event.action}`, {\n        value: event.value,\n        $current_url: currentUrl,\n        $set_once: { ...sessionData() }\n    });\n}","import * as _ from 'lodash';\nimport * as querystring from 'querystring';\nimport { createHistory, WindowLocation, NavigateOptions } from \"@reach/router\";\n\n// Whatever params we're given at the initial load, we want to save & preserve\n// them, so they persist across all future navigations.\nconst INITIAL_PARAMS = querystring.parse(\n    window.location.search.replace(/^\\?/, '')\n);\n\n// Builds a history source backed by the real browser history API, but throttling\n// updates to that API, and covering that up by also tracking the current location\n// in memory on top.\nconst buildThrottledHistorySource = () => {\n    let latestState = window.history.state;\n    let latestLocation = window.location;\n\n    window.addEventListener('popstate', () => {\n        latestState = window.history.state;\n        latestLocation = window.location;\n    });\n\n    // Throttle the state update calls - this is important because Chrome will complain &\n    // rate limit calls if we go too fast, and we can at times (when scrolling events).\n    const throttledPushState = _.throttle(\n        (...args: any) => window.history.pushState.apply(window.history, args),\n        250,\n        { leading: true, trailing: true }\n    );\n    const throttledReplaceState = _.throttle(\n        (...args: any) => window.history.replaceState.apply(window.history, args),\n        250,\n        { leading: true, trailing: true }\n    );\n\n    return {\n        get location() {\n            return latestLocation as WindowLocation;\n        },\n        addEventListener: window.addEventListener.bind(window),\n        removeEventListener: window.removeEventListener.bind(window),\n        history: {\n            get state() {\n                return latestState;\n            },\n            pushState(state: any, title: string, uri: string) {\n                throttledPushState(state, title, uri);\n                let [pathname, search = \"\"] = uri.split(\"?\");\n                latestLocation = Object.assign({}, window.location, { pathname, search });\n            },\n            replaceState(state: any, title: string, uri: string) {\n                throttledReplaceState(state, title, uri);\n                let [pathname, search = \"\"] = uri.split(\"?\");\n                latestLocation = Object.assign({}, window.location, { pathname, search });\n            }\n        }\n    };\n};\n\n// Throttlesafe: even with Chrome's throttling us, it'll still work nicely.\nexport const appHistory = createHistory(buildThrottledHistorySource());\n\n// Wrap navigate(), to always preserve our query params:\nconst navigate = appHistory.navigate.bind(appHistory);\nappHistory.navigate = function (to: string, options: NavigateOptions<{}> = {}) {\n    const [pathString, searchString] = to.split(\"?\");\n    const params = querystring.parse(searchString);\n\n    return navigate(pathString + \"?\" + querystring.stringify({\n        ...params,\n        ...INITIAL_PARAMS\n    }), options);\n};","import * as _ from 'lodash';\nimport { observable, action } from 'mobx';\n\nimport {\n    InputInitiatedRequest,\n    InputRequest,\n    InputResponse,\n    InputWebSocketMessage,\n    InputWebSocketClose,\n    InputFailedRequest\n} from '../../types';\n\nimport { ApiStore } from '../api/api-store';\nimport { StreamMessage } from '../events/stream-message';\nimport { HttpExchange } from '../http/exchange';\n\n// A websocket stream is an HTTP exchange (the initial setup, or even rejection), but\n// may include a series of many ongoing messages and a final websocket close event,\n// if the initial websocket connection is successful.\nexport class WebSocketStream extends HttpExchange {\n    constructor(apiStore: ApiStore, request: InputRequest) {\n        super(apiStore, request);\n        this.searchIndex += '\\nwebsocket';\n    }\n\n    isWebSocket(): this is WebSocketStream {\n        return true;\n    }\n\n    @observable\n    private accepted = false;\n\n    @observable\n    private subprotocol: string | undefined;\n\n    @action\n    setAccepted(response: InputResponse) {\n        const subprotocolHeader = response.headers['sec-websocket-protocol'];\n        if (_.isString(subprotocolHeader)) this.subprotocol = subprotocolHeader;\n\n        this.accepted = true;\n        Object.assign(this.timingEvents, response.timingEvents);\n    }\n\n    wasAccepted() {\n        return this.accepted;\n    }\n\n    get selectedSubprotocol() {\n        return this.subprotocol;\n    }\n\n    @observable\n    readonly messages: Array<StreamMessage> = [];\n\n    @action\n    addMessage(message: InputWebSocketMessage) {\n        this.messages.push(new StreamMessage(message, this.messages.length));\n    }\n\n    @observable\n    private closeData: InputWebSocketClose | 'aborted' | undefined;\n\n    @action\n    markClosed(closeData: InputWebSocketClose) {\n        this.closeData = closeData;\n        Object.assign(this.timingEvents, closeData.timingEvents);\n    }\n\n    get closeState() {\n        return this.closeData;\n    }\n\n    markAborted(request: InputFailedRequest) {\n        if (!this.wasAccepted()) {\n            // An abort before accept acts exactly as in normal HTTP\n            return super.markAborted(request);\n        } else {\n            // Unlike normal HTTP, websockets can get an abort *after* a successful HTTP\n            // response. We handle that as a separate case:\n            this.closeData = 'aborted';\n            this.searchIndex += '\\naborted';\n            // Note that we *don't* update this.response - that was still a complete response.\n\n            Object.assign(this.timingEvents, request.timingEvents);\n            this.tags = _.union(this.tags, request.tags);\n        }\n    }\n\n    cleanup() {\n        super.cleanup();\n\n        // Clear all websocket message data too\n        this.messages.forEach(msg => msg.cleanup());\n        this.messages.length = 0;\n    }\n}","import * as _ from 'lodash';\n\nexport interface SyntaxPart<PartValue = string | number, Context extends any = never> {\n    /**\n     * Checks whether the syntax part matches, or _could_ match if\n     * some text were appended to the string.\n     *\n     * This will return undefined if the value could not match, e.g.\n     * a number is required and there's a non-number entered already.\n     * If will return a full match if the part is completely present,\n     * and will consume everything it can, and it will return a partial\n     * match if the end of the string was reached without breaking any\n     * rules, but without successfully completing the matcher.\n     */\n    match(value: string, index: number): undefined | SyntaxPartMatch;\n\n    /**\n     * Given that there was a full or partial match, this returns a list of\n     * possible values that would make this syntax part match fully.\n     *\n     * Don't call it without a match, as the behaviour is undefined.\n     */\n    getSuggestions(value: string, index: number, context?: Context): SyntaxSuggestion[];\n\n    /**\n     * For a part that fully matches, this will return the fully matched\n     * content in a content-appropriate type, e.g. strings for strings,\n     * numbers for numbers.\n     *\n     * If the part does not fully match, this throws an error.\n     */\n    parse(value: string, index: number): PartValue;\n};\n\n// The value a syntax part will return when parsed\nexport type SyntaxPartValue<SP> = SP extends SyntaxPart<infer V> ? V : never;\n// The values that an array of syntax parts will return\nexport type SyntaxPartValues<SPs extends readonly SyntaxPart<any, any>[]> = {\n    [i in keyof SPs]: SyntaxPartValue<SPs[i]>\n};\n\n// The context a syntax part would like to generate suggestions\nexport type SyntaxPartContext<SP> = SP extends SyntaxPart<any, infer C> ? C : never;\n\n/**\n * A suggestion for some content to insert to complete a single part\n * of syntax.\n *\n * Syntax suggestions may be concatenated, by simply concatenating their showAs\n * and value strings directly.\n */\nexport interface SyntaxSuggestion {\n    /**\n     * The text that should show as the autocompleted example\n     */\n    showAs: string;\n\n    /**\n     * The position at which this suggestion should be placed in the\n     * input text.\n     *\n     * For single part suggestions, this is usually trivial: it's the\n     * index that was passed to getSuggestions, where they start matching.\n     * For multi-part suggestions though it can be more complicated in\n     * some cases.\n     */\n    index: number;\n\n    /**\n     * The text that should actually insert if you select the example.\n     *\n     * If this is not a template suggestion, then inserting the suggestion\n     * must result in a string that fully matches this syntax part.\n     */\n    value: string;\n\n    /**\n     * The type of match that this suggestion would create.\n     *\n     * 'full' means that applying this suggestion to the given input will\n     * create a value that would fully match the input.\n     *\n     * 'template' and 'partial' both mean that this wouldn't fully match\n     * the input, in slightly different ways.\n     *\n     * 'template' means that this wouldn't fully match the input, but the showAs\n     * value will be a placeholder. User input would be required, but suggestion\n     * values could be appended to showAs to provide context.\n     *\n     * 'partial' means that this wouldn't fully match the input, and the\n     * showAs property would also be incomplete, so no further suggestions\n     * should be appended - we'd need to stop and prompt the user first.\n     *\n     * Either way, all suggestions are recommendations that the user could\n     * sensibly apply, it's just that template/partial suggestions require\n     * further input on this specific part before the syntax part is matched.\n     */\n    matchType: 'full' | 'template' | 'partial';\n}\n\n/**\n * The result of matching a single syntax part within a string\n */\nexport type SyntaxPartMatch = {\n    /**\n     * If full, this part was completely matched and would be valid as-is\n     * If partial, this part could become valid, iff more content was appended\n     *\n     * Note that the exact end of the string should be a partial match for all\n     * syntax parts, since you should always be able to append content to match\n     * that part.\n     */\n    type: 'partial' | 'full';\n\n    /**\n     * How many characters were matched successfully.\n     */\n    consumed: number;\n};\n\n/**\n * The result of matching an array of syntax parts against a string.\n */\n export type SyntaxMatch = {\n    /**\n     * If full, this syntax completely matches the text shown.\n     * If partial, this syntax could match, iff more content was appended.\n     *\n     * Note that the exact end of the string should be a partial match for any\n     * syntax, since you should always be able to append content to match there.\n     */\n    type: 'partial' | 'full';\n\n    /**\n     * The number of characters fully matched by completed parts of the syntax.\n     */\n    fullyConsumed: number;\n\n    /**\n     * The number of characters fully or partially matched by parts of the syntax.\n     */\n    partiallyConsumed: number;\n\n    /**\n     * For full matches, this = the total number of parts available.\n     * For partial matches, this-1 is the index of the partially matched part.\n     */\n    partsMatched: number;\n\n    /**\n     * The index of the last syntax part that consumed >0 characters. In effect,\n     * this is the work-in-progress part: it's the first part that should be\n     * allowed to make suggestions.\n     */\n    lastConsumingPartSyntaxIndex: number;\n\n    /**\n     * The string index to the latest work-in-progress part of the input.\n     *\n     * For full matches, the string index at the start of the last part.\n     * For partial matches, the string index at the start of the full or partially\n     * matching part (i.e. the last *matched* part, not the last part overall),\n     * iff it matched more than 0 chars.\n     */\n    lastConsumingPartStringIndex: number;\n};\n\n\n\n// ^ That's all the core types, defining the syntax structure\n// -----------------------------------------------------------------------------------------\n// v This is all the generic syntax parsing & matching logic that uses it\n\n\n\n/**\n * Match a series of syntax parts at a position in a string. This tests each part, stepping\n * through the consumed string as it's matched, and returning full/partial according to\n * the final match, with details of how much of the string & syntax was matched en route.\n */\n export function matchSyntax(\n    syntax: readonly SyntaxPart<unknown, unknown>[],\n    value: string,\n    initialIndex: number\n): SyntaxMatch | undefined {\n    let stringIndex = initialIndex;\n    let fullyConsumed = 0;\n    let syntaxIndex: number;\n    let wasFullMatch = true;\n\n    let lastConsumingPartSyntaxIndex = 0;\n    let lastConsumingPartStringIndex = initialIndex;\n\n    for (\n        syntaxIndex = 0;\n        syntaxIndex < syntax.length && stringIndex <= value.length && wasFullMatch;\n        syntaxIndex++\n    ) {\n        const partMatch = syntax[syntaxIndex].match(value, stringIndex);\n        if (!partMatch) return;\n\n        wasFullMatch = partMatch.type === 'full';\n\n        if (partMatch.consumed > 0) {\n            lastConsumingPartSyntaxIndex = syntaxIndex;\n            lastConsumingPartStringIndex = stringIndex;\n        }\n\n        stringIndex += partMatch.consumed;\n        fullyConsumed += wasFullMatch ? partMatch.consumed : 0;\n    }\n\n    return {\n        type: syntaxIndex === syntax.length && wasFullMatch\n            ? 'full'\n            : 'partial',\n        fullyConsumed,\n        partiallyConsumed: stringIndex - initialIndex,\n        partsMatched: syntaxIndex,\n        lastConsumingPartSyntaxIndex,\n        lastConsumingPartStringIndex\n    };\n}\n\n/**\n * Takes a full string, and given a list of syntax parts, returns an\n * appropriate list of suggestions to show the user.\n *\n * Syntax part inputs are linked to a key, so that you can conveniently\n * work out which input created with suggestion later on.\n *\n * Optionally also takes context, which may be used by some syntax\n * parts to provide more specific context-driven suggestions.\n */\n export function getSuggestions<C, K = unknown>(\n    syntaxOptions: Array<{ key: K, syntax: readonly SyntaxPart<any, C>[] }>,\n    value: string,\n    initialIndex: number,\n    options: {\n        context: C,\n        canExtend?: boolean\n    }\n): Array<{ key: K, suggestion: SyntaxSuggestion }> {\n    const syntaxMatches = syntaxOptions.map(({ key: key, syntax }) => ({\n        key,\n        syntax,\n        match: matchSyntax(syntax, value, initialIndex)\n    })).filter(({ match }) => {\n        // We only show suggestions for syntax that does/might match, and which matches\n        // the whole of the input - so \"status=40\" suggests 404, but \"status=hello\" shows\n        // nothing (it doesn't suggest 404 at the start of hello).\n        // Maybe later we could show suggestions in such cases given a space separator?\n        return !!match && (initialIndex + match.partiallyConsumed) === value.length\n    });\n\n    const [fullMatches, partialMatches] = _.partition(syntaxMatches, ({ match }) =>\n        match!.type === 'full'\n    );\n\n    if (fullMatches.length) {\n        // If we have full matches (what you've typed fully matches a syntax option) then\n        // we should rematch just the final part, to get a final completion suggestion.\n        // E.g. Given status=404, we want a suggestion for just '404' after the =.\n        return _.flatMap(fullMatches, ({ key, syntax, match }) => {\n            const finalSyntaxIndex = syntax.length - 1;\n            const didLastPartConsumeChars = finalSyntaxIndex === match!.lastConsumingPartSyntaxIndex;\n\n            const stringIndex = didLastPartConsumeChars\n                // If last consuming part is the last part, then we rerun that in the same place\n                // to get a final suggestion for the whole set of syntax.\n                ? match!.lastConsumingPartStringIndex\n                // If last consuming part is not the last part, there must be final full-matching\n                // but zero-consuming part(s), like an optional suffix. We want to rerun the last\n                // part but in that case we just rerun it at the very end of the string.\n                : value.length;\n\n            return syntax[finalSyntaxIndex]\n                .getSuggestions(value, stringIndex, options.context)\n                .map((suggestion) => ({\n                    key,\n                    suggestion\n                }));\n        });\n    }\n\n    // Otherwise, we're looking at partial matches. Let's find the best ones:\n    const maxMatchedParts = _.max(\n        partialMatches.map(({ match }) => match!.partsMatched)\n    );\n\n    const bestPartialMatches = partialMatches.filter(m =>\n        m.match!.partsMatched === maxMatchedParts\n    );\n\n    // We have some syntax that partially matches. For each set of syntax, get the next suggestions\n    // that should be offered to extend (and _maybe_ complete) a match.\n    const suggestionsWithMatches = _.flatMap(bestPartialMatches, ({\n        key, syntax, match\n    }) => {\n        // We want to get suggestions from the last part that consumed any input. That means\n        // for a last-part half-match, we want that partial last part, but for a last part\n        // 0-char-match, we want the preceeding full part, because there might still be\n        // useful suggestions there to extend that part.\n        const syntaxPartIndex = match!.lastConsumingPartSyntaxIndex;\n        const stringIndex = match!.lastConsumingPartStringIndex;\n\n        // For partially matched syntax, partsMatched is always the index+1\n        // of partially matched part (the part we're waiting to complete)\n        const nextPartToMatch = syntax[syntaxPartIndex];\n        const isLastPart = syntaxPartIndex === syntax.length - 1;\n\n        return nextPartToMatch.getSuggestions(value, stringIndex, options.context)\n            .map((suggestion) => ({\n                key,\n                syntax,\n                syntaxPartIndex,\n                suggestion: {\n                    ...suggestion,\n                    matchType: (\n                        suggestion.matchType === 'full'\n                        ? (isLastPart ? 'full' : 'partial')\n                        : suggestion.matchType\n                    ) as 'full' | 'template' | 'partial'\n                }\n            }));\n    });\n\n    // If we have multiple suggestions at this stage, we're done. Return those\n    // as the options to show the user.\n    if (suggestionsWithMatches.length !== 1 || options.canExtend === false) {\n        return suggestionsWithMatches.map(({ key, suggestion }) => ({\n            key,\n            suggestion\n        }));\n    }\n\n    // If we have exactly one option, we should try to keep extending it, to\n    // provide more interesting options by making more jumps in one go.\n\n    const { key, syntax, suggestion: originalSuggestion } = suggestionsWithMatches[0];\n    let syntaxPartIndex = suggestionsWithMatches[0].syntaxPartIndex + 1;\n\n    // Iteratively expand the suggestion to include future parts, if possible, until we\n    // have either >1 option or a template option:\n    let suggestions = [originalSuggestion];\n\n    // If we've reached a template suggestion, this is the template that we'll eventually\n    // return. We keep looping a little further just to nicely complete the showAs.\n    let sawTemplate: SyntaxSuggestion | undefined;\n\n    while (suggestions.length === 1 && syntaxPartIndex < syntax.length) {\n        const singleSuggestion = suggestions[0];\n        sawTemplate ||= singleSuggestion.matchType === 'template'\n            ? singleSuggestion\n            : undefined;\n\n        const updatedText = applySuggestionToText(value, singleSuggestion);\n\n        const nextSuggestions = syntax[syntaxPartIndex]\n            .getSuggestions(updatedText, updatedText.length, options.context);\n\n        // After we hit a template we keep collecting suggestions until they're ambiguous\n        if (sawTemplate && nextSuggestions.length > 1) break;\n\n        suggestions = nextSuggestions.map((nextSuggestion) => ({\n            value: singleSuggestion.value + nextSuggestion.value,\n            showAs: singleSuggestion.showAs + nextSuggestion.showAs,\n            index: singleSuggestion.index,\n            matchType: nextSuggestion.matchType\n        }));\n\n        // We never extend partial suggestions - partial means user input will be required\n        if (suggestions.some(s => s.matchType === 'partial')) break;\n\n        syntaxPartIndex += 1;\n    }\n\n    const matchedAllParts = syntaxPartIndex === syntax.length;\n\n    if (!sawTemplate) {\n        return suggestions.map((suggestion) => ({\n            key,\n            suggestion: {\n                ...suggestion,\n                matchType: suggestion.matchType === 'full' && !matchedAllParts\n                    // Not a full *filter* match if all parts weren't matched\n                    ? 'partial'\n                    : suggestion.matchType\n            }\n        }));\n    } else {\n        return [{\n            key: key,\n            suggestion: {\n                ...sawTemplate,\n                showAs: suggestions[0].showAs\n            }\n        }];\n    }\n}\n\nexport function applySuggestionToText(value: string, suggestion: SyntaxSuggestion) {\n    return value.slice(0, suggestion.index) + suggestion.value;\n}","import * as _ from 'lodash';\n\nimport {\n    getSuggestions,\n    matchSyntax,\n    SyntaxPart,\n    SyntaxPartContext,\n    SyntaxPartMatch,\n    SyntaxPartValue,\n    SyntaxSuggestion\n} from './syntax-matching';\n\ntype CharRange = readonly [number, number];\n\nexport function charRange(charA: string, charB?: string): CharRange {\n    if (charB) {\n        return [charA.charCodeAt(0), charB.charCodeAt(0)];\n    } else {\n        return [charA.charCodeAt(0), charA.charCodeAt(0)];\n    }\n}\n\nexport const ALPHABETICAL = [charRange(\"a\", \"z\"), charRange(\"A\", \"Z\")];\nexport const NUMERIC = charRange(\"0\", \"9\");\nexport const ALPHANUMERIC = [...ALPHABETICAL, NUMERIC];\n\nexport function matchesRange(charCode: number, range: CharRange) {\n    return charCode >= range[0] && charCode <= range[1];\n}\n\n// Note that our definition of 'number' is very simplistic: no decimal points,\n// no thousand separators, no negative numbers, just 0+ integers.\nconst getNumberAt = (value: string, index: number) =>\n    getStringAt(value, index, [NUMBER_CHARS]);\n\n/**\n * Match a string at a given position, allowing only characters from\n * the given range\n */\nfunction getStringAt(value: string, index: number, allowedCharRanges: CharRange[]) {\n    let i: number;\n\n    // Keep reading chars until we either hit the end of the\n    // string (maybe immediately) or hit an invalid character\n    for (i = index; i < value.length; i++) {\n        const nextChar = value.charCodeAt(i);\n        if (!_.some(allowedCharRanges, r => matchesRange(nextChar, r))) break;\n    }\n\n    if (i !== index) {\n        // We found at least one character, that's a match:\n        return value.substring(index, i);\n    } else if (i === value.length) {\n        // We were at the end of the string, that's an empty partial match:\n        return \"\";\n    } else {\n        // We found no characters, and no end of string: fail\n        return undefined;\n    }\n}\n\nconst NUMBER_CHARS = [48, 57] as const; // 0-9 ascii codes\n\nfunction getParsedValue(part: SyntaxPart, value: string, index: number): string {\n    const match = part.match(value, index);\n    if (!match || match.type !== 'full') {\n        console.log(\"Unparseable expected-parseable input\", value);\n        throw new Error(\"Can't parse expected-parseable value\");\n    }\n    return value.slice(index, index + match.consumed);\n}\n\nfunction filterContextualSuggestions<S>(\n    value: string,\n    index: number,\n    context: S | undefined,\n    existingInput: string | undefined,\n    suggestionGenerator: ((value: string, index: number, context: S) => string[]) | undefined,\n    filter: (suggestion: string) => boolean\n): SyntaxSuggestion[] {\n    if (!context || !suggestionGenerator) return [];\n\n    const lowercaseInput = (existingInput || '').toLowerCase();\n    return suggestionGenerator(value, index, context)\n        .filter((suggestion) =>\n            (\n                !lowercaseInput ||\n                suggestion.toLowerCase().startsWith(lowercaseInput)\n            ) && filter\n        )\n        .slice(0, 10) // Max 10 results\n        .map(s => ({\n            showAs: s,\n            index,\n            value: s,\n            matchType: 'full'\n        }));\n}\n\nexport class FixedStringSyntax<OptionsType extends string = string> implements SyntaxPart<OptionsType> {\n\n    constructor(\n        private matcher: OptionsType\n    ) {}\n\n    match(value: string, index: number): undefined | SyntaxPartMatch {\n        const expected = this.matcher.toLowerCase();\n        let i: number;\n\n        // Compare char by char over the common size\n        for (i = index; (i - index) < this.matcher.length && i < value.length; i++) {\n            if (expected[i - index] !== value[i].toLowerCase()) return undefined;\n        }\n\n        const consumedChars = i - index;\n\n        // We ran out of a string without a mismatch. Which?\n        return {\n            type: (consumedChars === this.matcher.length)\n                ? 'full'\n                : 'partial',\n            consumed: consumedChars\n        };\n    }\n\n    getSuggestions(value: string, index: number): SyntaxSuggestion[] {\n        return [{\n            showAs: this.matcher,\n            index,\n            value: this.matcher,\n            matchType: 'full'\n        }];\n    }\n\n    parse(value: string, index: number): OptionsType {\n        // Ensure the parsing matches correctly\n        getParsedValue(this, value, index);\n        // Return the expected string (ignoring input case) not the matched text:\n        return this.matcher;\n    }\n\n}\n\nexport class StringSyntax<C = never> implements SyntaxPart<string, C> {\n\n    static AnyAsciiExceptSpaces = [charRange('!', '~')];\n\n    private allowedCharRanges: CharRange[];\n    private allowEmpty: (value: string, index: number) => boolean;\n\n    constructor(\n        private templateText: string,\n        private options: {\n            allowEmpty?: (value: string, index: number) => boolean,\n            allowedChars?: CharRange[],\n            suggestionGenerator?: (value: string, index: number, context: C) => string[]\n        } = {}\n    ) {\n        this.allowedCharRanges = options.allowedChars ||\n            StringSyntax.AnyAsciiExceptSpaces;\n        this.allowEmpty = options.allowEmpty || (() => false);\n    }\n\n    match(value: string, index: number): undefined | SyntaxPartMatch {\n        const matchingString = getStringAt(value, index, this.allowedCharRanges);\n        if (matchingString === undefined) return;\n\n        const consumedChars = matchingString.length;\n\n        // Any string is a full match, any empty space is a potential string\n        return {\n            type: (consumedChars > 0 || this.allowEmpty(value, index))\n                ? 'full'\n                : 'partial',\n            consumed: consumedChars\n        };\n    }\n\n    getSuggestions(value: string, index: number, context?: C): SyntaxSuggestion[] {\n        const matchingString = getStringAt(value, index, this.allowedCharRanges);\n\n        const suggestions = filterContextualSuggestions(value, index, context,\n            matchingString,\n            this.options.suggestionGenerator,\n            (suggestion) =>\n                // Suggestion chars must match one of the given char ranges\n                ![...suggestion].map(c => c.charCodeAt(0)).some(c =>\n                    !this.allowedCharRanges.some(r => matchesRange(c, r))\n                )\n        );\n\n        if (!matchingString) {\n            return [\n                {\n                    showAs: `{${this.templateText}}`,\n                    index,\n                    value: \"\",\n                    matchType: 'template'\n                },\n                ...(this.allowEmpty(value, index) && matchingString === \"\"\n                    ? [{\n                        showAs: '',\n                        index,\n                        value: '',\n                        matchType: 'full'\n                    } as const]\n                    : []\n                ),\n                ...suggestions\n            ];\n        } else {\n            return [\n                {\n                    showAs: matchingString,\n                    index,\n                    value: matchingString,\n                    matchType: 'full'\n                },\n                ...suggestions.filter(s => s.value !== matchingString)\n            ];\n        }\n    }\n\n    parse(value: string, index: number): string {\n        return getParsedValue(this, value, index);\n    }\n\n}\n\nexport class SyntaxWrapperSyntax<P> implements SyntaxPart<P> {\n\n    private optional: boolean;\n\n    constructor(\n        private wrapper: [start: string, end: string],\n        private wrappedSyntax: SyntaxPart<P>,\n        options: {\n            /**\n             * If set, the wrapper is optional, and should only be required & suggested\n             * if a input/suggestion contains a space.\n             */\n            optional?: boolean\n        } = {}\n    ) {\n        this.optional = !!options.optional;\n    }\n\n    match(value: string, startIndex: number): SyntaxPartMatch | undefined {\n        let isWrapped: boolean;\n        let index = startIndex;\n\n        // Check for the wrapper start character first:\n        if (value[index] === undefined) {\n            return { type: 'partial', consumed: 0 };\n        } else if (value[index] === this.wrapper[0]) {\n            index += 1;\n            isWrapped = true;\n        } else if (this.optional) {\n            isWrapped = false;\n        } else {\n            return; // No wrapped, not optional - no match\n        }\n\n        // Check the syntax within:\n        const endChar = isWrapped ? this.wrapper[1] : ' ';\n        const nextEndCharIndex = value.slice(index).indexOf(endChar);\n        const valueToMatch = nextEndCharIndex !== -1\n            // Don't allow the wrapped syntax to read beyond the wrapper end\n            ? value.slice(0, index + nextEndCharIndex)\n            : value;\n\n        const submatch = this.wrappedSyntax.match(\n            valueToMatch,\n            index\n        );\n        if (!submatch) return;\n\n        index += submatch.consumed;\n\n        if (submatch.type !== 'full') {\n            return {\n                type: 'partial',\n                consumed: index - startIndex\n            };\n        }\n\n        // Check for the wrapper close character:\n        if (isWrapped) {\n            if (value[index] === undefined) {\n                return { type: 'partial', consumed: index - startIndex };\n            } else if (value[index] !== this.wrapper[1]) {\n                // Missing closing wrapper after open wrapper - no match\n                return;\n            } else {\n                index += 1;\n            }\n        }\n\n        return {\n            type: 'full',\n            consumed: index - startIndex\n        };\n    }\n\n    getSuggestions(value: string, index: number, context?: never): SyntaxSuggestion[] {\n        const hasStartWrapper = value[index] === this.wrapper[0];\n\n        const endChar = !this.optional || hasStartWrapper\n            ? this.wrapper[1]\n            : ' ';\n\n        // Don't allow the wrapped syntax to include the wrapper end in suggestions:\n        const nextEndCharIndex = value.slice(index).indexOf(endChar);\n        const valueToMatch = nextEndCharIndex !== -1\n            ? value.slice(0, index + nextEndCharIndex)\n            : value;\n\n        const wrappedSyntaxStartPosition = hasStartWrapper\n            ? index + 1\n            : index;\n\n        const suggestionsToWrap = this.wrappedSyntax.getSuggestions(\n            valueToMatch,\n            wrappedSyntaxStartPosition,\n            context\n        );\n\n        return suggestionsToWrap.map(suggestion => {\n            // Suggestions need a wrapper when it's required or when it's optional but\n            // the value would be invalid unwrapped (because it has space)\n            const needsWrapper = !this.optional ||\n                suggestion.value.includes(' ');\n\n            const shouldAddStartWrapper = needsWrapper && !hasStartWrapper;\n\n            const shouldAddEndWrapper = (needsWrapper || hasStartWrapper) &&\n                // We only actually append the end wrapper when the child is totally done\n                suggestion.matchType === 'full';\n            const valueSuffix = shouldAddEndWrapper ? this.wrapper[1] : '';\n\n            const shouldShowEndWrapper = (needsWrapper || hasStartWrapper) &&\n                // We do show the end wrapper for templates though, since it looks nicer\n                (suggestion.matchType === 'full' || suggestion.matchType === 'template');\n            const shownSuffix = shouldShowEndWrapper ? this.wrapper[1] : '';\n\n            if (!shouldAddStartWrapper) {\n                // If the start wrapper is already sorted, we just return the suggestion,\n                // maybe with an end wrapper if appropriate\n                return {\n                    ...suggestion,\n                    showAs: suggestion.showAs + shownSuffix,\n                    value: suggestion.value + valueSuffix\n                };\n            } else {\n                // If we want a start wrapper, things get more complicated, because we need\n                // to backtrack the suggestion, as it might be a suggestion later in the\n                // value ('abc', suggest appending ' def' at index 3)\n                const extendedValue = this.wrapper[0] + value.slice(\n                    wrappedSyntaxStartPosition,\n                    suggestion.index\n                ) + suggestion.value + valueSuffix;\n\n                const extendedShowAs = this.wrapper[0] + value.slice(\n                    wrappedSyntaxStartPosition,\n                    suggestion.index\n                ) + suggestion.showAs + shownSuffix;\n\n                return {\n                    ...suggestion,\n                    showAs: extendedShowAs,\n                    value: extendedValue,\n                    index: wrappedSyntaxStartPosition\n                };\n            }\n        });\n    }\n\n    parse(value: string, index: number): P {\n        const hasStartWrapper = value[index] === this.wrapper[0];\n        const hasEndWrapper = value.slice(index).indexOf(this.wrapper[1]) !== -1;\n        const isWrapped = !this.optional || (hasStartWrapper && hasEndWrapper);\n\n        const endChar = isWrapped\n            ? this.wrapper[1]\n            : ' ';\n\n        // Don't allow the wrapped syntax to read beyond the wrapper end:\n        const nextEndCharIndex = value.slice(index).indexOf(endChar);\n        const valueToMatch = nextEndCharIndex !== -1\n            ? value.slice(0, index + nextEndCharIndex)\n            : value;\n\n        return this.wrappedSyntax.parse(\n            valueToMatch,\n            isWrapped ? index + 1 : index\n        );\n    }\n\n}\n\n/**\n * Vararg syntax, including a minimum repetitions. This allows you to create\n * syntax like \"any number of numbers, separated by a comma\". Separators may be\n * followed by any number of spaces, which will be ignored.\n */\nexport class SyntaxRepeaterSyntax<\n    Part extends SyntaxPart<any, any>,\n    V extends SyntaxPartValue<Part>,\n    C extends SyntaxPartContext<Part>\n> implements SyntaxPart<V[], C> {\n\n    private minimumRepetitions: number;\n    private placeholderName: string;\n\n    private delimiterSyntax: FixedStringSyntax;\n\n    constructor(\n        private delimiterString: string,\n        private wrappedSyntax: Part,\n        options: {\n            minimumRepetitions?: number,\n            placeholderName?: string\n        } = {}\n    ) {\n        this.minimumRepetitions = options.minimumRepetitions ?? 2;\n        this.placeholderName = options.placeholderName ?? 'value';\n\n        this.delimiterSyntax = new FixedStringSyntax(this.delimiterString);\n    }\n\n    // Handles the raw wrapper + delimiter matching, without worrying about\n    // minimum repetitions at all.\n    private matchSyntaxOnly(\n        value: string,\n        startIndex: number\n    ): (SyntaxPartMatch & { matchCount: number }) {\n        const { wrappedSyntax, delimiterString, delimiterSyntax } = this;\n\n        let index = startIndex;\n        let matchCount = 0;\n        let lastPartMatchEndIndex = 0;\n\n        while (true) {\n            // Check the syntax within:\n            const nextDelimiterIndex = value.slice(index).indexOf(delimiterString);\n            const valueToMatch = value.slice(0,\n                // Don't allow the wrapped syntax to read beyond the next delimiter\n                nextDelimiterIndex !== -1\n                    ? index + nextDelimiterIndex\n                    : undefined\n            );\n\n            const submatch = wrappedSyntax.match(\n                valueToMatch,\n                index\n            );\n\n            // If we run into non-matching values, we're done. Return everything up\n            // to the last matching part:\n            if (!submatch) {\n                return {\n                    matchCount,\n                    type: 'full',\n                    consumed: lastPartMatchEndIndex - startIndex\n                };\n            }\n\n            index += submatch.consumed;\n            lastPartMatchEndIndex = index;\n\n            if (submatch.type === 'partial') {\n                // An incomplete match means we're done, we stop here and return\n                // what we have so far as a partially complete value\n                return {\n                    matchCount,\n                    type: 'partial',\n                    consumed: index - startIndex\n                };\n            }\n\n            matchCount += 1;\n\n            const delimiterMatch = delimiterSyntax.match(value, index);\n            if (!delimiterMatch || delimiterMatch.consumed === 0) {\n                // If we have a non-delimiter (or we're at the end of the string) stop.\n                return { matchCount, type: 'full', consumed: index - startIndex };\n            } else if (delimiterMatch.type === 'partial') {\n                // If we have part of a delimiter, we partially match it\n                return {\n                    matchCount,\n                    type: 'partial',\n                    consumed: delimiterMatch.consumed + (index - startIndex)\n                };\n            }\n\n            // Otherwise we must have a whole delimiter. We consume any following spaces too,\n            // and then we go around again.\n            index += delimiterMatch.consumed;\n            while (value[index] === ' ') index += 1;\n        }\n    }\n\n    match(value: string, startIndex: number): SyntaxPartMatch | undefined {\n        const { minimumRepetitions } = this;\n\n        const {\n            matchCount,\n            type: matchType,\n            consumed\n        } = this.matchSyntaxOnly(value, startIndex);\n\n        if (consumed === 0) {\n            if (minimumRepetitions <= 0) {\n                return { type: 'full', consumed };\n            } else {\n                return { type: 'partial', consumed };\n            }\n        } else if (matchType === 'full') {\n            if (matchCount >= minimumRepetitions) {\n                return { type: 'full', consumed };\n            } else if (startIndex + consumed === value.length) {\n                // If you have a full match with too few parts, but up to the\n                // end of the string, then it's a partial match (we can append to complete)\n                return { type: 'partial', consumed: consumed };\n            } else {\n                // If you have a full match that's too short, with subequent content\n                // present, then it's just a complete mismatch.\n                return;\n            }\n        } else {\n            return { type: matchType, consumed };\n        }\n    }\n\n    getSuggestions(value: string, initialIndex: number, context?: C): SyntaxSuggestion[] {\n        // getSuggestions requires a match. That means we can find the right suggestion\n        // by looping through part matches until we find the first partial match or a\n        // mismatch, and then ask the last matching part for suggestions.\n        const {\n            wrappedSyntax,\n            delimiterSyntax,\n            delimiterString,\n            minimumRepetitions\n        } = this;\n\n        let index = initialIndex;\n        let matchCount = 0;\n\n        while (true) {\n            const nextDelimiterIndex = value.slice(index).indexOf(delimiterString);\n            const valueToMatch = value.slice(0,\n                // Don't allow the wrapped syntax to read beyond the next delimiter\n                nextDelimiterIndex !== -1\n                    ? index + nextDelimiterIndex\n                    : undefined\n            );\n\n            const wrappedMatch = wrappedSyntax.match(valueToMatch, index);\n            if (!wrappedMatch) {\n                // Must be a full match on the parsed content up to the last delimiter\n                // (if any) because otherwise this is no match at all, and getSuggestions\n                // always requires a match first.\n                return [{\n                    matchType: 'full',\n                    index: matchCount > 0\n                        ? index - delimiterString.length\n                        : index,\n                    showAs: '',\n                    value: ''\n                }];\n            } else if (wrappedMatch.type === 'partial') {\n                // We have a partial match on our contents, so suggest continuining it\n                const suggestions = wrappedSyntax.getSuggestions(value, index, context);\n                if (matchCount + 1 < minimumRepetitions) {\n                    return suggestions.map(suggestion => ({\n                        ...suggestion,\n                        // Downgrade the match to partial if we still wouldn't have\n                        // enough repetitions yet\n                        matchType: suggestion.matchType === 'full'\n                            ? 'partial'\n                            : suggestion.matchType\n                    }));\n                } else {\n                    return suggestions;\n                }\n            }\n\n            // We have a full match, so we just keep going\n            index += wrappedMatch.consumed;\n            matchCount += 1;\n\n            const delimiterMatch = delimiterSyntax.match(value, index);\n            if (!delimiterMatch) {\n                // Non-delimiter after a valid value - we have to stop here.\n                return [{\n                    matchType: 'full',\n                    index: index,\n                    showAs: '',\n                    value: ''\n                }];\n            } else if (delimiterMatch.type === 'partial' || value[index + delimiterMatch.consumed] === undefined) {\n                // If we have a partial delimiter, no delimiter, or a delimiter but no following space at\n                // the end of the value: suggest completing a nice delimiter+space+template for the next value.\n                const suggestions: SyntaxSuggestion[] = [{\n                    showAs: `${delimiterString} {another ${this.placeholderName}}`,\n                    index,\n                    value: delimiterString + ' ',\n                    matchType: 'template'\n                }];\n\n                // If we could stop here, and there's no delimiter entered at all\n                // yet, suggest that too:\n                if (delimiterMatch.consumed === 0 && matchCount >= minimumRepetitions) {\n                    suggestions.unshift({\n                        showAs: \"\",\n                        index,\n                        value: \"\",\n                        matchType: 'full'\n                    });\n                }\n\n                return suggestions;\n            } else { // Full delimiter match before the end of the string:\n                // Consume the delimiter and any following spaces, then continue:\n                index += delimiterMatch.consumed;\n                while (value[index] === ' ') index += 1;\n            }\n        }\n    }\n\n    parse(value: string, index: number): V[] {\n        const match = this.match(value, index)!;\n\n        if (match.type === 'full' && match.consumed === 0) return [];\n\n        const matchedValue = value.slice(index, index + match.consumed);\n        const matchedValueParts = matchedValue.split(this.delimiterString);\n        return matchedValueParts.map((part) => this.wrappedSyntax.parse(part.trim(), 0));\n    }\n\n}\n\nexport class NumberSyntax implements SyntaxPart<number> {\n\n    private stringSyntax: StringSyntax;\n\n    constructor(name: string = \"number\") {\n        this.stringSyntax = new StringSyntax(name, { allowedChars: [NUMBER_CHARS] });\n    }\n\n    match(value: string, index: number): SyntaxPartMatch | undefined {\n        return this.stringSyntax.match(value, index);\n    }\n\n    getSuggestions(value: string, index: number): SyntaxSuggestion[] {\n        return this.stringSyntax.getSuggestions(value, index);\n    }\n\n    parse(value: string, index: number): number {\n        const valueAsString = this.stringSyntax.parse(value, index);\n        return parseInt(valueAsString, 10);\n    }\n\n}\n\nexport class FixedLengthNumberSyntax<S> implements SyntaxPart<number, S> {\n\n    constructor(\n        private requiredLength: number,\n        private options: {\n            suggestionGenerator?: (value: string, index: number, context: S) => string[]\n        } = {}\n    ) {}\n\n    match(value: string, index: number): undefined | SyntaxPartMatch {\n        const matchingNumber = getNumberAt(value, index);\n        if (matchingNumber === undefined) return;\n\n        const consumedChars = matchingNumber.length;\n\n        if (consumedChars === this.requiredLength) {\n            return { type: 'full', consumed: consumedChars };\n        } else if (consumedChars < this.requiredLength) {\n            return { type: 'partial', consumed: consumedChars };\n        } else {\n            return undefined; // Too many numbers - not a match\n        }\n    }\n\n    getSuggestions(value: string, index: number, context?: S): SyntaxSuggestion[] {\n        const matchingNumber = getNumberAt(value, index);\n\n        const suggestions = filterContextualSuggestions(value, index, context,\n            matchingNumber,\n            this.options.suggestionGenerator,\n            (suggestion) =>\n                // Suggestions must have the right length\n                suggestion.length === this.requiredLength &&\n                // and be numbers\n                ![...suggestion].map(c => c.charCodeAt(0)).some(c =>\n                    !matchesRange(c, NUMBER_CHARS)\n                )\n        );\n\n        if (!matchingNumber) {\n            return [{\n                showAs: `{${this.requiredLength}-digit number}`,\n                index,\n                value: \"\",\n                matchType: 'template'\n            }, ...suggestions];\n        } else if (suggestions.length) {\n            // If we have any suggestions, they're valid suffixes of the entered\n            // value, and so they're better suggestions than just extending\n            // the number with 00s, so use them directly\n            return suggestions;\n        } else {\n            // Otherwise, extend to the required length with 00s.\n            const extendedNumber = matchingNumber +\n                _.repeat(\"0\", this.requiredLength - matchingNumber.length);\n\n            return [{\n                showAs: extendedNumber,\n                index,\n                value: extendedNumber,\n                matchType: 'full'\n            }];\n        }\n    }\n\n    parse(value: string, index: number): number {\n        const valueAsString = getParsedValue(this, value, index);\n        return parseInt(valueAsString, 10);\n    }\n\n}\n\n/**\n * Matches one syntax from a list of possible options.\n */\nexport class OptionsSyntax<\n    Options extends readonly SyntaxPart<any, any>[],\n    V extends (Options extends Array<SyntaxPart<infer V, any>> ? V : never),\n    C extends (Options extends Array<SyntaxPart<any, infer C>> ? C : never),\n> implements SyntaxPart<V, C> {\n\n    private options: Options;\n\n    constructor(options: Options) {\n        this.options = options;\n    }\n\n    match(value: string, index: number): SyntaxPartMatch | undefined {\n        const matches = this.options.map((option) =>\n            option.match(value, index)\n        ).filter(m => !!m) as SyntaxPartMatch[];\n\n        const [fullMatches, partialMatches] = _.partition(matches, { type: 'full' });\n\n        // Use full matches by preference, if there is one available:\n        const bestMatches = fullMatches.length ? fullMatches : partialMatches;\n\n        // Return the longest match within that list:\n        return _.maxBy(bestMatches, m => m.consumed);\n    }\n\n    getSuggestions(\n        value: string,\n        index: number,\n        context?: C\n    ): SyntaxSuggestion[] {\n        const matchingOptions = this.options\n            .map((option) => ({ option, match: option.match(value, index) }))\n            .filter(({ match }) => !!match);\n\n        // If there's an exact match, suggest only that.\n        // If there's two (https -> http + https) suggest the longest\n        if (matchingOptions.some(({ match }) => match!.type === 'full')) {\n            const fullyMatchingOptions = matchingOptions\n                .filter(({ match }) => match!.type === 'full');\n\n            const longestFullMatch = _.maxBy(fullyMatchingOptions, ({ match }) =>\n                match!.consumed\n            )!;\n\n            return longestFullMatch.option.getSuggestions(value, index, context);\n        } else {\n            // Otherwise, combine all the options together\n            return _.flatMap(matchingOptions, ({ option }) => {\n                if (matchingOptions.length > 1 && option instanceof CombinedSyntax) {\n                    // If we already have many options, don't allow combined syntax to generate its\n                    // own options, or everything gets rapidly out of hand\n                    return option.getSuggestions(value, index, Object.assign({},\n                        context,\n                        { canExtend: false }\n                    ));\n                } else {\n                    return option.getSuggestions(value, index, context)\n                }\n            });\n        }\n    }\n\n    parse(value: string, index: number): V {\n        const fullMatches = this.options.map((option) => ({\n            option,\n            match: option.match(value, index)\n        })).filter(({ match }) => match?.type === 'full');\n\n        const bestMatch = _.maxBy(fullMatches, ({ match }) => match!.consumed);\n\n        return bestMatch!.option.parse(value, index);\n    }\n}\n\n/**\n * A convenient helper, when the options are all just fixed strings.\n */\nexport class StringOptionsSyntax<\n    V extends string\n> extends OptionsSyntax<Array<FixedStringSyntax<V>>, V, never> {\n\n    constructor(\n        values: readonly V[]\n    ) {\n        super(values.map(v => new FixedStringSyntax(v)));\n    }\n\n}\n\n/**\n * Matches a chunk of syntax, but also matches fully if that syntax does not\n * appear. In effect, this always matches. Either it fully matches nothing\n * if there's mismatch, it partially matches if it's a partial match at the\n * end of the string (but only there), or it fully matches if some\n * fully matching content for all parts within is present.\n */\nexport class OptionalSyntax<\n    Ps extends unknown[] = unknown[],\n    C = never,\n    SPs extends { [i in keyof Ps]: SyntaxPart<Ps[i], C> }\n        = { [i in keyof Ps]: SyntaxPart<Ps[i], C> }\n> implements SyntaxPart<Ps | [], C> {\n\n    private subParts: SPs;\n\n    constructor(...subParts: SPs) {\n        this.subParts = subParts; // Apparently ... isn't allowed in field params.\n    }\n\n    match(value: string, index: number): SyntaxPartMatch | undefined {\n        let currentIndex = index;\n\n        // Optional syntax matches and disappears if there's no content available\n        if (currentIndex >= value.length) {\n            return { type: 'full', consumed: 0 };\n        }\n\n        const subMatch = matchSyntax(this.subParts, value, index);\n\n        // Optional syntax matches and disappears if the sub-syntax doesn't match at all\n        if (!subMatch) {\n            return { type: 'full', consumed: 0 };\n        }\n\n        // Optional syntax matches full like normal syntax if the contained syntax matches\n        if (subMatch.type === 'full') {\n            return { type: 'full', consumed: subMatch.fullyConsumed };\n        }\n\n        // If the contained syntax partially matches, it's only a partial match if we're\n        // at the end of the string. If we're not, then we match 0 & disappear, and the\n        // filter's matching continues to the next part (if any)\n        if (index + subMatch.partiallyConsumed === value.length) {\n            return { type: 'partial', consumed: subMatch.partiallyConsumed };\n        } else {\n            return { type: 'full', consumed: 0 };\n        }\n    }\n\n    getSuggestions(value: string, index: number, context?: C): SyntaxSuggestion[] {\n        const subPartMatch = this.match(value, index);\n        const subPartSuggestions = getSuggestions(\n            [{ key: null, syntax: this.subParts }],\n            value,\n            index,\n            { context }\n        ).map(({ suggestion }) => suggestion);\n\n        const isEndOfValue = value.length === index;\n\n        if (isEndOfValue) {\n            // If we're at the end of the string, we offer all suggestions and no suggestion\n            return [\n                { showAs: \"\", index, value: \"\", matchType: 'full' },\n                ...subPartSuggestions\n            ];\n        } else if (subPartMatch?.type === 'full' && subPartMatch?.consumed === 0) {\n            // If the matcher doesn't match at all, we suggest skipping this optional\n            // part entirely. This effectively allows backtracking for suggestions\n            // so the suggestion is shown only if the next non-optional part _does_\n            // match this content correctly.\n            return [{\n                showAs: \"\",\n                index,\n                value: \"\",\n                matchType: 'full'\n            }];\n        } else {\n            return subPartSuggestions;\n        }\n    }\n\n    parse(value: string, index: number): Ps | [] {\n        const match = this.match(value, index);\n        if (!match || match.consumed === 0) return [];\n\n        // Parse implies a full match, and now know it's not empty, so we must\n        // have a full match for every part. Loop through, return them as an array.\n        return _.reduce(this.subParts, (parsed: Ps[], part: SyntaxPart<any>) => {\n            const parsedValue = part.parse(value, index);\n            index += parsedValue.toString().length;\n            parsed.push(parsedValue as any);\n            return parsed;\n        }, []) as Ps;\n    }\n}\n\n/**\n * Matches a series of pieces of syntax as a single syntax wrapper. This is useful to\n * compose with other nested syntax, allowing them to treat a chunk of syntax as a\n * single unit.\n */\nexport class CombinedSyntax<\n    Ps extends unknown[] = unknown[],\n    C = never,\n    SPs extends { [i in keyof Ps]: SyntaxPart<Ps[i], C> }\n        = { [i in keyof Ps]: SyntaxPart<Ps[i], C> }\n> implements SyntaxPart<Ps, C & { canExtend?: boolean }> {\n\n    private subParts: SPs;\n\n    constructor(...subParts: SPs) {\n        this.subParts = subParts; // Apparently ... isn't allowed in field params.\n    }\n\n    match(value: string, index: number): SyntaxPartMatch | undefined {\n        const subMatch = matchSyntax(this.subParts, value, index);\n        return subMatch\n            ? { type: subMatch?.type, consumed: subMatch?.partiallyConsumed }\n            : undefined;\n    }\n\n    getSuggestions(\n        value: string,\n        index: number,\n        context?: C & { canExtend?: boolean }\n    ): SyntaxSuggestion[] {\n        return getSuggestions(\n            [{ key: null, syntax: this.subParts }],\n            value,\n            index,\n            { context, canExtend: context?.canExtend }\n        ).map(({ suggestion }) => suggestion);\n    }\n\n    parse(value: string, index: number): Ps {\n        // Parse implies a full match, so we must have a full match for every part.\n        // Loop through, return the parsed parts as an array.\n        return _.reduce(this.subParts, (parsed: Ps[], part: SyntaxPart<any>) => {\n            const parsedValue = part.parse(value, index);\n            index += parsedValue.toString().length;\n            parsed.push(parsedValue as any);\n            return parsed;\n        }, []) as Ps;\n    }\n}","import * as _ from 'lodash';\n\nimport { CollectedEvent } from '../../types';\nimport { joinAnd } from '../../util/text';\nimport { stringToBuffer } from '../../util';\n\nimport { getStatusDocs } from '../http/http-docs';\nimport { getReadableSize } from '../events/bodies';\nimport { EventCategories } from '../events/categorization';\nimport { WebSocketStream } from '../websockets/websocket-stream';\n\nimport {\n    matchSyntax,\n    SyntaxPart,\n    SyntaxPartValues\n} from './syntax-matching';\nimport {\n    ALPHABETICAL,\n    ALPHANUMERIC,\n    charRange,\n    CombinedSyntax,\n    FixedLengthNumberSyntax,\n    FixedStringSyntax,\n    NumberSyntax,\n    OptionalSyntax,\n    OptionsSyntax,\n    StringOptionsSyntax,\n    StringSyntax,\n    SyntaxRepeaterSyntax,\n    SyntaxWrapperSyntax\n} from './syntax-parts';\n\nexport abstract class Filter {\n\n    abstract matches(event: CollectedEvent): boolean;\n    abstract toString(): string;\n\n    constructor(\n        private readonly filterString: string\n    ) {}\n\n    serialize() {\n        return this.filterString;\n    }\n\n    get filterDescription() {\n        const thisClass = (this.constructor as FilterClass<unknown>);\n        return thisClass.filterDescription(this.filterString, false);\n    }\n}\n\n// A full set of filters, in reverse-UI order\nexport type FilterSet = readonly [StringFilter, ...Filter[]];\n// A subset of filters\nexport type Filters = readonly Filter[];\nexport const emptyFilterSet = () => [new StringFilter('')] as const;\n\nexport type FilterClass<T extends unknown = never> = {\n    /**\n     * The constructor for the filter, which can take a string that fully matches\n     * all syntax parts of this filter.\n     *\n     * May return multiple filters only for custom filter aliases, where a single\n     * keyword expands to create a whole set of filters when created.\n     */\n    new (input: string): Filter | Filters;\n\n    /**\n     * A list of syntax parts that describe how to enter the filter as a string.\n     *\n     * Filter syntax parts may accept hint context data, of type T.\n     */\n    filterSyntax: readonly SyntaxPart<any, T>[];\n\n    /**\n     * A function which takes a string that fully or partially matches the\n     * syntax parts for this input, and returns a human readable descriptio\n     * of what the filter will do.\n     *\n     * If isTemplate is true, the description should assume that a template\n     * value (as yet unknown) will be appended to the input.\n     *\n     * This function can safely assume it will never be called with strings\n     * that do not match the syntax parts.\n     *\n     * Generally, this should get more precise as more input is entered.\n     */\n    filterDescription: (input: string, isTemplate: boolean) => string;\n\n    /**\n     * A very short string, just naming the type of filter, without any of\n     * the input parameters etc.\n     */\n    filterName: string;\n};\n\n/**\n * Special case: this is the standard string matching filter.\n * Always exactly one used, with the raw text input from the\n * filter field, never added as a filter tag.\n */\nexport class StringFilter extends Filter {\n    constructor(\n        public readonly filter: string = ''\n    ) {\n        super(filter);\n    }\n\n    matches(event: CollectedEvent): boolean {\n        if (this.filter === '') return true;\n        const filter = this.filter.toLocaleLowerCase();\n        return event.searchIndex.includes(filter);\n    }\n\n    toString() {\n        return `\"${this.filter}\"`;\n    }\n}\n\nconst operations = {\n    \"=\": (value: any, expected: any) => value === expected,\n    \"!=\": (value: any, expected: any) => value !== expected\n} as const;\n\nconst numberOperations = {\n    ...operations,\n    \">\": (value: number, expected: number) => value > expected,\n    \">=\": (value: number, expected: number) => value >= expected,\n    \"<\": (value: number, expected: number) => value < expected,\n    \"<=\": (value: number, expected: number) => value <= expected\n};\n\n// Note that all operations here are implicitly case-sensitive, but it's expected\n// that each matcher will lower/uppercase values for matching as part of parsing.\nconst stringOperations = {\n    ...operations,\n    \"*=\": (value: string, expected: string) => value.includes(expected),\n    \"^=\": (value: string, expected: string) => value.startsWith(expected),\n    \"$=\": (value: string, expected: string) => value.endsWith(expected)\n};\n\nconst bufferOperations = {\n    \"=\": (value: Buffer, expected: Buffer) => value.equals(expected),\n    \"!=\": (value: Buffer, expected: Buffer) => !value.equals(expected),\n    \"*=\": (value: Buffer, expected: Buffer) => value.includes(expected),\n    \"^=\": (value: Buffer, expected: Buffer) => value.slice(0, expected.length).equals(expected),\n    \"$=\": (value: Buffer, expected: Buffer) => value.slice(-expected.length).equals(expected)\n};\n\ntype EqualityOperation = keyof typeof operations;\ntype NumberOperation = keyof typeof numberOperations;\ntype StringOperation = keyof typeof stringOperations;\n\nconst operationDescriptions: { [key in NumberOperation | StringOperation]: string } = {\n    \"=\": \"equal to\",\n    \"!=\": \"not equal to\",\n    \">\": \"greater than\",\n    \">=\": \"greater than or equal to\",\n    \"<\": \"less than\",\n    \"<=\": \"less than or equal to\",\n    \"*=\": \"containing\",\n    \"^=\": \"starting with\",\n    \"$=\": \"ending with\"\n} as const;\n\nconst sizeOperationDescriptions: { [key in NumberOperation]: string } = {\n    ...operationDescriptions,\n    \">\": \"larger than\",\n    \">=\": \"larger than or equal to\",\n    \"<\": \"smaller than\",\n    \"<=\": \"smaller than or equal to\"\n} as const;\n\ntype FilterPartValues<F extends FilterClass> = SyntaxPartValues<F['filterSyntax']>;\n\n/**\n * Given that there's a full match for the given filter against the given input,\n * parse the input with the syntax array of the filter and return an array of\n * the parsed values.\n *\n * Throws an error if the value does not fully match the filter.\n */\nfunction parseFilter<F extends FilterClass>(\n    filterClass: F,\n    value: string\n): FilterPartValues<F> {\n    let index = 0;\n    const parts = [];\n\n    for (let part of filterClass.filterSyntax) {\n        parts.push(part.parse(value, index));\n        index += part.match(value, index)!.consumed;\n    }\n\n    return parts as unknown as FilterPartValues<F>;\n}\n\n/**\n * Try to parse the filter, returning an array of all syntax part values that can be\n * parsed successfully, but stopping as soon as a part does not match.\n */\nfunction tryParseFilter<F extends FilterClass>(\n    filterClass: F,\n    value: string\n): Partial<FilterPartValues<F>> {\n    return tryParseFilterParts<\n        F['filterSyntax']\n    >(value, ...filterClass.filterSyntax);\n}\n\n/**\n * Try to parse a specific list of filter parts, returning an array of all syntax\n * parts values that can be parsed successfully, but stopping as soon as a part\n * does not match.\n */\nfunction tryParseFilterParts<\n    SPs extends readonly SyntaxPart<any, any>[]\n>(\n    value: string,\n    ...syntaxParts: SPs\n): Partial<SyntaxPartValues<SPs>> {\n    let index = 0;\n    const parsedParts = [];\n\n    for (let part of syntaxParts) {\n        const match = part.match(value, index);\n        if (!match || match.type !== 'full') break;\n\n        parsedParts.push(part.parse(value, index));\n        index += match.consumed;\n    }\n\n    return parsedParts as unknown as Partial<SyntaxPartValues<SPs>>;\n}\n\nclass StatusFilter extends Filter {\n\n    static filterSyntax = [\n        new FixedStringSyntax(\"status\"),\n        new StringOptionsSyntax<NumberOperation>([\n            \"=\",\n            \"!=\",\n            \">=\",\n            \">\",\n            \"<=\",\n            \"<\"\n        ]),\n        new FixedLengthNumberSyntax(3, {\n            suggestionGenerator: (_v, _i, events: CollectedEvent[]) =>\n                _(events)\n                .map(e =>\n                    'response' in e &&\n                    e.isSuccessfulExchange() &&\n                    e.response.statusCode.toString()\n                )\n                .uniq()\n                .filter(Boolean)\n                .sort()\n                .valueOf() as string[]\n        })\n    ] as const;\n\n    static filterName = \"status\";\n\n    static filterDescription(value: string) {\n        const [, op, status] = tryParseFilter(StatusFilter, value);\n\n        if (!op || (op == '=' && !status)) {\n            return \"responses with a given status code\";\n        } else if (!status) {\n            return `responses with a status ${operationDescriptions[op]} a given value`\n        } else {\n            const statusMessage = getStatusDocs(status)?.message;\n\n            // For exact matches, include the status description for easy reference\n            const describeStatus = (op === '=' || op === '!=') && statusMessage\n                ? ` (${statusMessage})`\n                : '';\n\n            if (op === '=') {\n                // Simplify descriptions for the most common case\n                return `responses with status ${status}${describeStatus}`;\n            } else {\n                return `responses with a status ${\n                    operationDescriptions[op]\n                } ${status}${describeStatus}`\n            }\n        }\n    }\n\n    private status: number;\n    private op: NumberOperation;\n    private predicate: (status: number, expectedStatus: number) => boolean;\n\n    constructor(filter: string) {\n        super(filter);\n        [, this.op, this.status] = parseFilter(StatusFilter, filter);\n        this.predicate = numberOperations[this.op];\n    }\n\n    matches(event: CollectedEvent): boolean {\n        return event.isHttp() &&\n            event.isSuccessfulExchange() &&\n            this.predicate(event.response.statusCode, this.status);\n    }\n\n    toString() {\n        return `Status ${this.op} ${this.status}`;\n    }\n}\n\nclass CompletedFilter extends Filter {\n\n    static filterSyntax = [new FixedStringSyntax(\"completed\")] as const;\n\n    static filterName = \"completed\";\n\n    static filterDescription(value: string) {\n        return \"requests that have received a response\";\n    }\n\n    matches(event: CollectedEvent): boolean {\n        return event.isHttp() &&\n            event.isSuccessfulExchange();\n    }\n\n    toString() {\n        return `Completed`;\n    }\n}\n\nclass PendingFilter extends Filter {\n\n    static filterSyntax = [new FixedStringSyntax(\"pending\")];\n\n    static filterName = \"pending\";\n\n    static filterDescription(value: string) {\n        return \"requests that are still waiting for a response\";\n    }\n\n    matches(event: CollectedEvent): boolean {\n        return event.isHttp() &&\n            !event.isCompletedExchange();\n    }\n\n    toString() {\n        return `Pending`;\n    }\n}\n\nclass AbortedFilter extends Filter {\n\n    static filterSyntax = [new FixedStringSyntax(\"aborted\")] as const;\n\n    static filterName = \"aborted\";\n\n    static filterDescription(value: string) {\n        return \"requests whose connection failed before receiving a response\";\n    }\n\n    matches(event: CollectedEvent): boolean {\n        return event.isHttp() &&\n            event.response === 'aborted'\n    }\n\n    toString() {\n        return `Aborted`;\n    }\n}\n\nclass ErrorFilter extends Filter {\n\n    static filterSyntax = [new FixedStringSyntax(\"errored\")] as const;\n\n    static filterName = \"error\";\n\n    static filterDescription(value: string) {\n        return \"requests that weren't transmitted successfully\";\n    }\n\n    matches(event: CollectedEvent): boolean {\n        return !(event.isHttp()) || // TLS Error\n            event.tags.some(tag =>\n                tag.startsWith('client-error') ||\n                tag.startsWith('passthrough-error')\n            );\n    }\n\n    toString() {\n        return `Error`;\n    }\n}\n\nclass PinnedFilter extends Filter {\n\n    static filterSyntax = [new FixedStringSyntax(\"pinned\")] as const;\n\n    static filterName = \"pinned\";\n\n    static filterDescription(value: string) {\n        return \"exchanges that are pinned\";\n    }\n\n    matches(event: CollectedEvent): boolean {\n        return event.pinned;\n    }\n\n    toString() {\n        return `Pinned`;\n    }\n}\n\nclass CategoryFilter extends Filter {\n\n    static filterSyntax = [\n        new FixedStringSyntax(\"category\"),\n        new FixedStringSyntax(\"=\"), // Separate, so initial suggestions are names only\n        new StringOptionsSyntax(EventCategories)\n    ] as const;\n\n    static filterName = \"category\";\n\n    static filterDescription(value: string) {\n        const [, , category] = tryParseFilter(CategoryFilter, value);\n\n        if (!category) {\n            return \"exchanges by their general category\";\n        } else {\n            return `all ${category} exchanges`;\n        }\n    }\n\n    private expectedCategory: string;\n\n    constructor(filter: string) {\n        super(filter);\n        const [,, categoryString] = parseFilter(CategoryFilter, filter);\n        this.expectedCategory = categoryString;\n    }\n\n    matches(event: CollectedEvent): boolean {\n        return event.isHttp() &&\n            event.category === this.expectedCategory\n    }\n\n    toString() {\n        return _.startCase(this.expectedCategory);\n    }\n}\n\nclass MethodFilter extends Filter {\n\n    static filterSyntax = [\n        new FixedStringSyntax(\"method\"),\n        new StringOptionsSyntax<EqualityOperation>([\n            \"=\",\n            \"!=\"\n        ]),\n        new StringSyntax(\"method\", {\n            allowedChars: ALPHABETICAL,\n            suggestionGenerator: (_v, _i, events: CollectedEvent[]) =>\n                _(events)\n                .map(e => e.isHttp() && e.request.method)\n                .uniq()\n                .filter(Boolean)\n                .valueOf() as string[]\n        })\n    ] as const;\n\n    static filterName = \"method\";\n\n    static filterDescription(value: string) {\n        const [, op, method] = tryParseFilter(MethodFilter, value);\n\n        if (!op) {\n            return \"requests with a given method\";\n        } else if (op === '=') {\n            if (method) {\n                return `${method.toUpperCase()} requests`;\n            } else {\n                return `requests with a given method`;\n            }\n        } else {\n            if (method) {\n                return `non-${method.toUpperCase()} requests`;\n            } else {\n                return 'requests not sent with a given method';\n            }\n        }\n    }\n\n    private expectedMethod: string;\n    private op: EqualityOperation;\n    private predicate: (method: string, expectedMethod: string) => boolean;\n\n    constructor(filter: string) {\n        super(filter);\n        const [, op, method] = parseFilter(MethodFilter, filter);\n        this.op = op;\n        this.predicate = operations[this.op];\n        this.expectedMethod = method.toUpperCase();\n    }\n\n    matches(event: CollectedEvent): boolean {\n        return event.isHttp() &&\n            this.predicate(event.request.method.toUpperCase(), this.expectedMethod);\n    }\n\n    toString() {\n        return `Method ${this.op} ${this.expectedMethod}`;\n    }\n\n}\n\nclass HttpVersionFilter extends Filter {\n\n    static filterSyntax = [\n        new FixedStringSyntax(\"httpVersion\"),\n        new FixedStringSyntax(\"=\"), // Separate, so initial suggestions are names only\n        new StringOptionsSyntax([\"1\", \"2\"])\n    ] as const;\n\n    static filterName = \"httpVersion\";\n\n    static filterDescription(value: string) {\n        const [, , version] = tryParseFilter(HttpVersionFilter, value);\n\n        if (!version) {\n            return \"exchanges using a given version of HTTP\";\n        } else {\n            return `exchanges using HTTP/${version}`;\n        }\n    }\n\n    private expectedVersion: number;\n\n    constructor(filter: string) {\n        super(filter);\n        const [,, versionString] = parseFilter(HttpVersionFilter, filter);\n        this.expectedVersion = parseInt(versionString, 10);\n    }\n\n    matches(event: CollectedEvent): boolean {\n        return event.isHttp() &&\n            event.httpVersion === this.expectedVersion;\n    }\n\n    toString() {\n        return `HTTP ${this.expectedVersion}`;\n    }\n}\n\nclass WebSocketFilter extends Filter {\n\n    static filterSyntax = [\n        new FixedStringSyntax(\"websocket\")\n    ] as const;\n\n    static filterName = \"websocket\";\n\n    static filterDescription() {\n        return \"websocket streams\";\n    }\n\n    constructor(filter: string) {\n        super(filter);\n    }\n\n    matches(event: CollectedEvent): boolean {\n        return event instanceof WebSocketStream;\n    }\n\n    toString() {\n        return 'WebSocket';\n    }\n}\n\nclass ProtocolFilter extends Filter {\n\n    static filterSyntax = [\n        new FixedStringSyntax(\"protocol\"),\n        new FixedStringSyntax(\"=\"),\n        new StringOptionsSyntax([\n            \"http\",\n            \"https\",\n            \"ws\",\n            \"wss\"\n        ])\n    ] as const;\n\n    static filterName = \"protocol\";\n\n    static filterDescription(value: string) {\n        const [, , protocol] = tryParseFilter(ProtocolFilter, value);\n\n        if (!protocol) {\n            return \"exchanges using HTTP, HTTPS, WS or WSS\";\n        } else {\n            return `exchanges using ${protocol.toUpperCase()}`;\n        }\n    }\n\n    private expectedProtocol: string;\n\n    constructor(filter: string) {\n        super(filter);\n        const [,, protocol] = parseFilter(ProtocolFilter, filter);\n        this.expectedProtocol = protocol.toLowerCase();\n    }\n\n    matches(event: CollectedEvent): boolean {\n        if (!(event.isHttp())) return false;\n\n        // Parsed protocol is like 'http:', so we strip the colon\n        const protocol = event.request.parsedUrl.protocol.toLowerCase().slice(0, -1);\n        return protocol === this.expectedProtocol;\n    }\n\n    toString() {\n        return `${this.expectedProtocol.toUpperCase()}`;\n    }\n}\n\nclass HostnameFilter extends Filter {\n\n    static filterSyntax = [\n        new FixedStringSyntax(\"hostname\"),\n        new StringOptionsSyntax<StringOperation>([\n            \"=\",\n            \"!=\",\n            \"*=\",\n            \"^=\",\n            \"$=\"\n        ]),\n        new StringSyntax(\"hostname\", {\n            allowedChars: [\n                ...ALPHANUMERIC,\n                charRange(\"-\"),\n                charRange(\".\")\n            ],\n            suggestionGenerator: (_v, _i, events: CollectedEvent[]) =>\n                _(events)\n                .map(e => e.isHttp() && e.request.parsedUrl.hostname.toLowerCase())\n                .uniq()\n                .filter(Boolean)\n                .valueOf() as string[]\n        })\n    ] as const;\n\n    static filterName = \"hostname\";\n\n    static filterDescription(value: string) {\n        const [, op, hostname] = tryParseFilter(HostnameFilter, value);\n\n        if (!op || (!hostname && op === '=')) {\n            return \"requests sent to a given hostname\";\n        } else if (op === '=') {\n            return `requests to ${hostname}`;\n        } else {\n            return `requests to a hostname ${operationDescriptions[op]} ${hostname || 'a given value'}`;\n        }\n    }\n\n    private expectedHostname: string;\n    private op: StringOperation;\n    private predicate: (host: string, expectedHost: string) => boolean;\n\n    constructor(filter: string) {\n        super(filter);\n        const [, op, hostname] = parseFilter(HostnameFilter, filter);\n        this.op = op;\n        this.predicate = stringOperations[op];\n        this.expectedHostname = hostname.toLowerCase();\n    }\n\n    matches(event: CollectedEvent): boolean {\n        return event.isHttp() &&\n            this.predicate(\n                event.request.parsedUrl.hostname.toLowerCase(),\n                this.expectedHostname\n            );\n    }\n\n    toString() {\n        return `Hostname ${this.op} ${this.expectedHostname}`;\n    }\n}\n\nconst PROTOCOL_DEFAULT_PORTS = {\n    'http:': 80,\n    'https:': 443\n} as const;\n\nclass PortFilter extends Filter {\n\n    static filterSyntax = [\n        new FixedStringSyntax(\"port\"),\n        new StringOptionsSyntax<NumberOperation>([\n            \"=\",\n            \"!=\",\n            \">=\",\n            \">\",\n            \"<=\",\n            \"<\"\n        ]),\n        new NumberSyntax(\"port\")\n    ] as const;\n\n    static filterName = \"port\";\n\n    static filterDescription(value: string) {\n        const [, op, port] = tryParseFilter(PortFilter, value);\n\n        if (!op || (!port && op === '=')) {\n            return \"requests sent to a given port\";\n        } else if (op === '=') {\n            return `requests to port ${port}`;\n        } else {\n            return `requests to a port ${operationDescriptions[op]} ${port || 'a given port'}`;\n        }\n    }\n\n    private expectedPort: number;\n    private op: NumberOperation;\n    private predicate: (port: number, expectedPort: number) => boolean;\n\n    constructor(filter: string) {\n        super(filter);\n        [, this.op, this.expectedPort] = parseFilter(PortFilter, filter);\n        this.predicate = numberOperations[this.op];\n    }\n\n    matches(event: CollectedEvent): boolean {\n        if (!(event.isHttp())) return false;\n\n        const { protocol, port: explicitPort } = event.request.parsedUrl;\n        const port = parseInt((\n            explicitPort ||\n            PROTOCOL_DEFAULT_PORTS[protocol as 'http:' | 'https:'] ||\n            0\n        ).toString(), 10);\n\n        return event.isHttp() &&\n            this.predicate(port, this.expectedPort);\n    }\n\n    toString() {\n        return `Port ${this.op} ${this.expectedPort}`;\n    }\n}\n\nclass PathFilter extends Filter {\n\n    static filterSyntax = [\n        new FixedStringSyntax(\"path\"),\n        new StringOptionsSyntax<StringOperation>([\n            \"=\",\n            \"!=\",\n            \"*=\",\n            \"^=\",\n            \"$=\"\n        ]),\n        new StringSyntax(\"path\", {\n            suggestionGenerator: (_v, _i, events: CollectedEvent[]) =>\n                _(events)\n                .map(e => e.isHttp() && e.request.parsedUrl.pathname)\n                .uniq()\n                .filter(Boolean)\n                .valueOf() as string[]\n        })\n    ] as const;\n\n    static filterName = \"path\";\n\n    static filterDescription(value: string) {\n        const [, op, path] = tryParseFilter(PathFilter, value);\n\n        if (!op || (!path && op === '=')) {\n            return \"requests sent to a given path\";\n        } else if (op === '=') {\n            return `requests to ${path}`;\n        } else {\n            return `requests to a path ${operationDescriptions[op]} ${path || 'a given path'}`;\n        }\n    }\n\n    private expectedPath: string;\n    private op: StringOperation;\n    private predicate: (path: string, expectedPath: string) => boolean;\n\n    constructor(filter: string) {\n        super(filter);\n        [, this.op, this.expectedPath] = parseFilter(PathFilter, filter);\n        this.predicate = stringOperations[this.op];\n    }\n\n    matches(event: CollectedEvent): boolean {\n        return event.isHttp() &&\n            this.predicate(event.request.parsedUrl.pathname, this.expectedPath);\n    }\n\n    toString() {\n        return `Path ${this.op} ${this.expectedPath}`;\n    }\n}\n\nclass QueryFilter extends Filter {\n\n    static filterSyntax = [\n        new FixedStringSyntax(\"query\"),\n        new StringOptionsSyntax<StringOperation>([\n            \"=\",\n            \"!=\",\n            \"*=\",\n            \"^=\",\n            \"$=\"\n        ]),\n        new StringSyntax(\"query\", {\n            // We allow an empty query only with = and !=, which means we need to get the op:\n            allowEmpty: (value, index): boolean => {\n                // Slightly messy logic to roll backwards and find the index of the start\n                // of the string operation just before this.\n                const opIndex = value.slice(0, index).lastIndexOf(\"query\") + \"query\".length;\n                const op = QueryFilter.filterSyntax[1].parse(value, opIndex);\n\n                // You can pass an empty query only to = or !=\n                return op === \"=\" || op === \"!=\";\n            },\n            suggestionGenerator: (_v, _i, events: CollectedEvent[]) =>\n                _(events)\n                .map(e => e.isHttp() && e.request.parsedUrl.search)\n                .uniq()\n                .filter(Boolean)\n                .valueOf() as string[]\n        })\n    ] as const;\n\n    static filterName = \"query\";\n\n    static filterDescription(value: string, isTemplate: boolean) {\n        const [, op, query] = tryParseFilter(QueryFilter, value);\n\n        if (!op) {\n            return \"requests with a given query string\";\n        } else if (query === undefined || isTemplate) {\n            if (op === '=') {\n                return `requests with a given query string`;\n            } else {\n                return `requests with a query string ${\n                    operationDescriptions[op]\n                } a given query string`;\n            }\n        } else if (query === '') {\n            // Op must be '=' or '!=' - we don't allow empty string otherwise\n            if (op === '=') {\n                return 'requests with an empty query string';\n            } else {\n                return 'requests with a non-empty query string';\n            }\n        } else {\n            return `requests with a query string ${\n                operationDescriptions[op]\n            } ${\n                query\n            }`;\n        }\n    }\n\n    private expectedQuery: string;\n    private op: StringOperation;\n    private predicate: (query: string, expectedQuery: string) => boolean;\n\n    constructor(filter: string) {\n        super(filter);\n        [, this.op, this.expectedQuery] = parseFilter(QueryFilter, filter);\n        this.predicate = stringOperations[this.op];\n    }\n\n    matches(event: CollectedEvent): boolean {\n        return event.isHttp() &&\n            this.predicate(event.request.parsedUrl.search, this.expectedQuery);\n    }\n\n    toString() {\n        return `Query ${this.op} ${this.expectedQuery}`;\n    }\n}\n\nconst getAllHeaders = (e: CollectedEvent): [string, string | string[]][] => {\n    if (!(e.isHttp())) return [];\n    return [\n        ...Object.entries(e.request.headers),\n        ...(e.isSuccessfulExchange()\n            ? Object.entries(e.response.headers)\n            : []\n        )\n    ] as [string, string | string[]][];\n}\n\nclass HeadersFilter extends Filter {\n\n    static filterSyntax = [\n        new FixedStringSyntax(\"headers\"),\n        new StringOptionsSyntax([\n            \"=\",\n            \"*=\",\n            \"^=\",\n            \"$=\"\n        ]),\n        // N.b. this is v similar to but not the same as HeaderFilter below!\n        new SyntaxWrapperSyntax(\n            ['[', ']'],\n            new StringSyntax(\"header value\", {\n                allowedChars: [[0, 255]], // Any ASCII! Wrapper guards against spaces for us.\n                suggestionGenerator: (value, index, events: CollectedEvent[]) => {\n                    return _(events)\n                        .map(e =>\n                            _(getAllHeaders(e))\n                            .map(([_hn, headerValue]) => Array.isArray(headerValue)\n                                ? headerValue\n                                : [headerValue]\n                            )\n                            .flatten()\n                            .valueOf()\n                        )\n                        .flatten()\n                        .uniq()\n                        .valueOf();\n                }\n            }),\n            // [] should be required/suggested only if value contains a space\n            { optional: true }\n        )\n    ] as const;\n\n    static filterName = \"headers\";\n\n    static filterDescription(value: string): string {\n        const [, op, headerValue] = tryParseFilter(HeadersFilter, value);\n\n        if (!op) {\n            return \"exchanges by all header values\";\n        } else {\n            return `exchanges with any header value ${\n                operationDescriptions[op]\n            } ${headerValue ? `'${headerValue}'` : 'a given string'}`;\n        }\n    }\n\n    private expectedHeaderValue: string;\n    private op: StringOperation;\n    private predicate: ((headerValue: string, expectedValue: string) => boolean);\n\n    constructor(filter: string) {\n        super(filter);\n        const [, op, headerValue] = parseFilter(HeadersFilter, filter);\n\n        this.op = op;\n        this.predicate = stringOperations[op];\n        this.expectedHeaderValue = headerValue.toLowerCase();\n    }\n\n    matches(event: CollectedEvent): boolean {\n        if (!(event.isHttp())) return false;\n\n        const headers = getAllHeaders(event);\n\n        const { predicate, expectedHeaderValue } = this;\n\n        return _(headers)\n            .flatMap(([_k, value]) => value ?? []) // Flatten our array/undefined values\n            .some((value) => predicate(value.toLowerCase(), expectedHeaderValue));\n    }\n\n    toString() {\n        return `Any header ${this.op} ${this.expectedHeaderValue!}`;\n    }\n}\n\nclass HeaderFilter extends Filter {\n\n    // Separated out so we can do subparsing here ourselves\n    private static valueMatchSyntax = [\n        new StringOptionsSyntax([\n            \"=\",\n            \"!=\",\n            \"*=\",\n            \"^=\",\n            \"$=\"\n        ]),\n        new SyntaxWrapperSyntax(\n            ['[', ']'],\n            new StringSyntax(\"header value\", {\n                allowedChars: [[0, 255]], // Any ASCII! Wrapper guards against spaces for us.\n                suggestionGenerator: (value, index, events: CollectedEvent[]) => {\n                    // Find the start of the wrapped header name text that preceeds this\n                    const headerNameIndex = value.slice(0, index - 1).lastIndexOf('[');\n\n                    const headerNamePart = HeaderFilter.filterSyntax[1];\n                    const expectedHeaderName = headerNamePart\n                        .parse(value, headerNameIndex)\n                        .toLowerCase();\n\n                    return _(events)\n                        .map(e =>\n                            _(getAllHeaders(e))\n                            .filter(([headerName]): boolean =>\n                                headerName.toLowerCase() === expectedHeaderName\n                            )\n                            .map(([_hn, headerValue]) => Array.isArray(headerValue)\n                                ? headerValue\n                                : [headerValue]\n                            )\n                            .flatten()\n                            .valueOf()\n                        )\n                        .flatten()\n                        .uniq()\n                        .valueOf();\n                }\n            }),\n            // [] should be required/suggested only if value contains a space\n            { optional: true }\n        )\n    ] as const;\n\n    static filterSyntax = [\n        new FixedStringSyntax(\"header\"),\n        new SyntaxWrapperSyntax(\n            ['[', ']'],\n            new StringSyntax(\"header name\", {\n                suggestionGenerator: (_v, _i, events: CollectedEvent[]) =>\n                    _(events)\n                    .map(e =>\n                        getAllHeaders(e).map(([headerName]) =>\n                            headerName.toLowerCase()\n                        )\n                    )\n                    .flatten()\n                    .uniq()\n                    .valueOf() as string[]\n            }),\n        ),\n        new OptionalSyntax<[StringOperation, string]>(...HeaderFilter.valueMatchSyntax)\n    ] as const;\n\n    static filterName = \"header\";\n\n    static filterDescription(value: string): string {\n        const [, headerName] = tryParseFilter(HeaderFilter, value);\n\n        // We have to manually parse optional parts unfortunately, since otherwise\n        // any half-optional matches are treated as non-matches and left undefined.\n        const [op, headerValue] = tryParseFilterParts(\n            value.slice(\"header[]\".length + (headerName || '').length),\n            ...HeaderFilter.valueMatchSyntax\n        );\n\n        if (!headerName) {\n            return \"exchanges by a specific header\";\n        } else if (!op) {\n            return `exchanges with a '${headerName}' header`;\n        } else {\n            return `exchanges with a '${headerName}' header ${\n                operationDescriptions[op]\n            } ${headerValue ? `'${headerValue}'` : 'a given value'}`;\n        }\n    }\n\n    private expectedHeaderName: string;\n\n    private expectedHeaderValue: string | undefined;\n\n    private op: StringOperation | undefined;\n    private predicate: ((headerValue: string, expectedValue: string) => boolean) | undefined;\n\n    constructor(filter: string) {\n        super(filter);\n        const [, headerName, [op, headerValue]] = parseFilter(HeaderFilter, filter);\n\n        this.expectedHeaderName = headerName.toLowerCase();\n\n        if (op && headerValue) {\n            this.op = op;\n            this.predicate = stringOperations[op];\n            this.expectedHeaderValue = headerValue.toLowerCase();\n        }\n    }\n\n    matches(event: CollectedEvent): boolean {\n        if (!(event.isHttp())) return false;\n\n        const headers = getAllHeaders(event);\n\n        const { predicate, expectedHeaderValue } = this;\n        if (!predicate || !expectedHeaderValue) {\n            return headers.some(([key]) => key.toLowerCase() === this.expectedHeaderName);\n        }\n\n        return _(headers)\n            .filter(([key]) => key.toLowerCase() === this.expectedHeaderName)\n            .flatMap(([_k, value]) => value ?? []) // Flatten our array/undefined values\n            .some((value) => predicate(value.toLowerCase(), expectedHeaderValue));\n    }\n\n    toString() {\n        if (!this.op) return `Has ${this.expectedHeaderName} header`;\n        return `${this.expectedHeaderName} ${this.op} ${this.expectedHeaderValue!}`;\n    }\n}\n\nclass BodySizeFilter extends Filter {\n\n    static filterSyntax = [\n        new FixedStringSyntax(\"bodySize\"),\n        new StringOptionsSyntax<NumberOperation>([\n            \"=\",\n            \"!=\",\n            \">=\",\n            \">\",\n            \"<=\",\n            \"<\"\n        ]),\n        new NumberSyntax(\"size\")\n    ] as const;\n\n    static filterName = \"bodySize\";\n\n    static filterDescription(value: string) {\n        const [, op, size] = tryParseFilter(BodySizeFilter, value);\n\n        if (!op) {\n            return \"exchanges by body size\";\n        } else {\n            return `exchanges with a body ${\n                sizeOperationDescriptions[op]\n            } ${\n                size !== undefined\n                ? getReadableSize(size)\n                : 'a given size'\n            }`;\n        }\n    }\n\n    private expectedSize: number;\n    private op: NumberOperation;\n    private predicate: (size: number, expectedSize: number) => boolean;\n\n    constructor(filter: string) {\n        super(filter);\n        [, this.op, this.expectedSize] = parseFilter(BodySizeFilter, filter);\n        this.predicate = numberOperations[this.op];\n    }\n\n    matches(event: CollectedEvent): boolean {\n        if (!(event.isHttp())) return false;\n\n        const requestBody = event.request.body;\n        const responseBody = event.isSuccessfulExchange()\n            ? event.response.body\n            : undefined;\n        const totalSize = requestBody.encoded.byteLength +\n            (responseBody?.encoded.byteLength || 0);\n\n        return event.isHttp() &&\n            this.predicate(totalSize, this.expectedSize);\n    }\n\n    toString() {\n        return `Size ${this.op} ${this.expectedSize}`;\n    }\n}\n\nclass BodyFilter extends Filter {\n\n    static filterSyntax = [\n        new FixedStringSyntax(\"body\"),\n        new StringOptionsSyntax<StringOperation>([\n            \"=\",\n            \"!=\",\n            \"*=\",\n            \"^=\",\n            \"$=\"\n        ]),\n        new SyntaxWrapperSyntax(\n            ['[', ']'],\n            new StringSyntax(\"body content\", {\n                allowedChars: [[0, Infinity]] // Match all characters, all unicode included\n            }),\n            // [] should be required/suggested only if value contains a space\n            { optional: true }\n        )\n    ] as const;\n\n    static filterName = \"body\";\n\n    static filterDescription(value: string) {\n        const [, op, bodyContent] = tryParseFilter(BodyFilter, value);\n\n        if (!op) {\n            return \"exchanges by body content\";\n        } else {\n            return `exchanges with a body ${operationDescriptions[op]} ${bodyContent || 'a given value'}`;\n        }\n    }\n\n    private expectedBody: Buffer;\n\n    private op: StringOperation;\n    private predicate: (body: Buffer, expectedBody: Buffer) => boolean;\n\n    constructor(filter: string) {\n        super(filter);\n        const [, op, expectedBody] = parseFilter(BodyFilter, filter);\n        this.op = op;\n\n        this.expectedBody = stringToBuffer(expectedBody);\n        this.predicate = bufferOperations[this.op];\n    }\n\n    matches(event: CollectedEvent): boolean {\n        if (!event.isHttp()) return false;\n        if (!event.hasRequestBody() && !event.hasResponseBody()) return false; // No body, no match\n\n        // Accessing .decoded on both of these touches a lazy promise, starting decoding for all bodies:\n        const requestBody = event.request.body.decoded;\n        const responseBody = event.isSuccessfulExchange()\n            ? event.response.body.decoded\n            : undefined;\n\n        const matchesRequestBody = !!requestBody && requestBody.byteLength > 0 &&\n            this.predicate(requestBody, this.expectedBody);\n\n        const matchesResponseBody = !!responseBody && responseBody.byteLength > 0 &&\n            this.predicate(responseBody, this.expectedBody);\n\n        return matchesRequestBody || matchesResponseBody;\n    }\n\n    toString() {\n        return `Body ${this.op} ${this.expectedBody}`;\n    }\n}\n\nclass ContainsFilter extends Filter {\n\n    static filterSyntax = [\n        new FixedStringSyntax(\"contains\"),\n        new SyntaxWrapperSyntax(\n            ['(', ')'],\n            new StringSyntax(\"content\", {\n                allowedChars: [[0, Infinity]] // Match all characters, all unicode included\n            })\n        )\n    ] as const;\n\n    static filterName = \"contains\";\n\n    static filterDescription(value: string) {\n        const [, content] = tryParseFilter(ContainsFilter, value);\n\n        return `exchanges that contain ${\n            content\n            ? `'${content.toLowerCase()}'`\n            : 'a given value'\n        } anywhere`;\n    }\n\n    private expectedContent: string;\n\n    constructor(filter: string) {\n        super(filter);\n        const [, expectedContent] = parseFilter(ContainsFilter, filter);\n\n        this.expectedContent = expectedContent.toLowerCase();\n    }\n\n    matches(event: CollectedEvent): boolean {\n        let content: Array<string | Buffer | number | undefined>;\n\n        if (event.isHttp()) {\n            content = [\n                event.request.method,\n                event.request.url,\n                ...Object.entries(\n                    event.request.rawHeaders\n                ).map(([key, value]) => `${key}: ${value}`),\n                // Accessing .decoded touches a lazy promise, starting decoding:\n                event.request.body.decoded,\n\n                ...(event.isSuccessfulExchange()\n                    ? [\n                        event.response.statusCode,\n                        event.response.statusMessage,\n                        ...Object.entries(\n                            event.response.rawHeaders\n                        ).map(([key, value]) => `${key}: ${value}`),\n                        // Accessing .decoded touches a lazy promise, starting decoding:\n                        event.response.body.decoded\n                    ] : []\n                ),\n\n                ...(event.isWebSocket()\n                    ? event.messages.map(msg => msg.content)\n                    : []\n                )\n            ];\n        } else if (event.isRTCConnection()) {\n            content = [\n                event.clientURL,\n                event.remoteURL\n            ];\n        } else if (event.isRTCDataChannel()) {\n            content = [\n                ...event.messages.map(msg => msg.content),\n                event.label,\n                event.protocol\n            ]\n        } else if (event.isTlsTunnel()) {\n            content = [\n                event.upstreamHostname,\n                event.upstreamPort\n            ];\n        } else if (event.isTlsFailure()) {\n            content = [\n                event.upstreamHostname\n            ];\n        } else {\n            content = [];\n        }\n\n        return content.some(content => {\n            if (!content) return false;\n            if ((content as string | Buffer).length === 0) return false;\n            return content\n                .toString()\n                .toLowerCase() // Case insensitive (expectedContent lowercased in constructor)\n                .includes(this.expectedContent);\n        });\n    }\n\n    toString() {\n        return `Contains(${this.expectedContent})`;\n    }\n}\n\nconst BaseSearchFilterClasses: FilterClass[] = [\n    MethodFilter,\n    HostnameFilter,\n    PathFilter,\n    QueryFilter,\n    StatusFilter,\n    HeadersFilter,\n    HeaderFilter,\n    BodyFilter,\n    BodySizeFilter,\n    ContainsFilter,\n    CompletedFilter,\n    PendingFilter,\n    AbortedFilter,\n    ErrorFilter,\n    PinnedFilter,\n    CategoryFilter,\n    PortFilter,\n    ProtocolFilter,\n    HttpVersionFilter,\n    WebSocketFilter\n];\n\n// Meta-filters, which can wrap the base filters above:\n\nclass NotFilter extends Filter {\n\n    private static innerFilterSyntax = new OptionsSyntax(\n        BaseSearchFilterClasses.map(f =>\n            new CombinedSyntax(...f.filterSyntax)\n        )\n    );\n\n    static filterSyntax = [\n        new FixedStringSyntax('not'),\n        new SyntaxWrapperSyntax(\n            ['(', ')'],\n            NotFilter.innerFilterSyntax\n        )\n    ] as const;\n\n    static filterName = \"not\";\n\n    static filterDescription(value: string, isTemplate: boolean) {\n        const innerValue = value.slice(4, -1);\n\n        if (innerValue.length === 0) {\n            return \"exchanges that do not match a given condition\"\n        } else {\n            const matches = BaseSearchFilterClasses.map((filter) => ({\n                filter,\n                match: matchSyntax(filter.filterSyntax, innerValue, 0)\n            })).filter(({ match }) => (match?.partiallyConsumed || 0) > 0);\n\n            const bestMatch = _.maxBy(matches, m => m.match!.partiallyConsumed);\n            const innerDescription = bestMatch\n                ? bestMatch.filter.filterDescription(innerValue, isTemplate)\n                : '...';\n\n            return `excluding ${innerDescription}`;\n        }\n    }\n\n    private innerFilter: Filter;\n\n    constructor(private filterValue: string) {\n        super(filterValue);\n\n        const innerValue = filterValue.slice(4, -1);\n\n        const matchingFilterClass = _.find(BaseSearchFilterClasses, (filter) =>\n            matchSyntax(filter.filterSyntax, innerValue, 0)?.type === 'full'\n        )!;\n        this.innerFilter = new matchingFilterClass(innerValue) as Filter; // Never Filters - we don't support filter aliases here\n    }\n\n    matches(event: CollectedEvent): boolean {\n        return !this.innerFilter.matches(event);\n    }\n\n    toString() {\n        return `not(${this.innerFilter.toString()})`;\n    }\n}\n\nclass OrFilter extends Filter {\n\n    private static innerFilterSyntax = new SyntaxRepeaterSyntax(\n        ',',\n        new OptionsSyntax(\n            BaseSearchFilterClasses.map(f =>\n                new CombinedSyntax(...f.filterSyntax)\n            )\n        ),\n        { placeholderName: 'condition' }\n    );\n\n    static filterSyntax = [\n        new FixedStringSyntax('or'),\n        new SyntaxWrapperSyntax(\n            ['(', ')'],\n            OrFilter.innerFilterSyntax\n        )\n    ] as const;\n\n    static filterName = \"or\";\n\n    static filterDescription(value: string, isTemplate: boolean) {\n        if (value[value.length - 1] === ')') value = value.slice(0, -1);\n\n        const innerValues = value.slice(3).split(',').map(v => v.trim());\n\n        if (innerValues.length === 1 && innerValues[0].length === 0) {\n            return \"exchanges that match any one of multiple conditions\"\n        } else {\n            const innerDescriptions = innerValues.map((valuePart, index) => {\n                const isLastPart = index === innerValues.length - 1;\n                const partIsTemplate = isTemplate && isLastPart;\n\n                const matches = BaseSearchFilterClasses.map((filter) => ({\n                    filter,\n                    match: matchSyntax(filter.filterSyntax, valuePart, 0)\n                })).filter(({ match }) => (match?.partiallyConsumed || 0) > 0);\n\n                const bestMatch = _.maxBy(matches, m => m.match!.partiallyConsumed);\n                if (bestMatch) {\n                    return bestMatch.filter.filterDescription(valuePart, partIsTemplate);\n                } else {\n                    return '...';\n                }\n            });\n\n            if (innerDescriptions.length < 2) {\n                innerDescriptions.push('...');\n            }\n\n            return joinAnd(innerDescriptions, ', ', ', or ');\n        }\n    }\n\n    private innerFilters: Filter[];\n\n    constructor(private filterValue: string) {\n        super(filterValue);\n\n        this.innerFilters = filterValue.slice(3, -1).split(',').map(v => v.trim()).map((valuePart) => {\n            const matchingFilterClass = _.find(BaseSearchFilterClasses, (filter) =>\n                matchSyntax(filter.filterSyntax, valuePart, 0)?.type === 'full'\n            )!;\n            return new matchingFilterClass(valuePart) as Filter; // Never Filters - we don't support filter aliases here\n        });\n    }\n\n    matches(event: CollectedEvent): boolean {\n        return this.innerFilters.some(f => f.matches(event));\n    }\n\n    toString() {\n        return joinAnd(this.innerFilters.map(f => f.toString()), ', ', ' or ');\n    }\n}\n\nexport const SelectableSearchFilterClasses: FilterClass[] = [\n    ...BaseSearchFilterClasses,\n    NotFilter,\n    OrFilter\n];","import { NativeContextMenuItem } from \"../../services/desktop-api\";\nimport { UnreachableCheck } from \"../../util/error\";\n\nexport interface ContextMenuState<T> {\n    data: T;\n    event: React.MouseEvent;\n    items: readonly ContextMenuItem<T>[];\n}\n\nexport type ContextMenuItem<T> =\n    | ContextMenuOption<T>\n    | ContextMenuSubmenu<T>\n    | { type: 'separator' };\n\nexport interface ContextMenuOption<T> {\n    type: 'option';\n    label: string;\n    enabled?: boolean;\n    callback: (data: T) => void;\n}\n\ninterface ContextMenuSubmenu<T> {\n    type: 'submenu';\n    label: string;\n    enabled?: boolean;\n    items: readonly ContextMenuItem<T>[];\n}\n\nexport function buildNativeContextMenuItems(\n    items: readonly ContextMenuItem<any>[],\n    path: Array<string | number> = []\n): NativeContextMenuItem[] {\n    return items.map((item, i) => {\n        if (item.type === 'separator') return item;\n        else if (item.type === 'submenu') return {\n            ...item,\n            items: buildNativeContextMenuItems(item.items, path.concat(`${i}.items`))\n        };\n        else if (item.type === 'option') return {\n            ...item,\n            callback: undefined, // Causes errors, as it can't be cloned\n            id: path.concat(i).join('.') // Id is the path to the item (as an _.get key like \"0.items.5\")\n        };\n        else throw new UnreachableCheck(item, i => i.type);\n    });\n}","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { observable, action, autorun, computed, observe } from 'mobx';\n\nimport { Theme, ThemeName, Themes } from '../../styles';\nimport { lazyObservablePromise } from '../../util/observable';\nimport { persist, hydrate } from '../../util/mobx-persist/persist';\nimport { unreachableCheck, UnreachableCheck } from '../../util/error';\n\nimport { AccountStore } from '../account/account-store';\nimport { emptyFilterSet, FilterSet } from '../filters/search-filters';\nimport { DesktopApi } from '../../services/desktop-api';\nimport {\n    ContextMenuState,\n    ContextMenuItem,\n    ContextMenuOption,\n    buildNativeContextMenuItems\n} from './context-menu';\n\nconst VIEW_CARD_KEYS = [\n    'api',\n\n    'request',\n    'requestBody',\n    'response',\n    'responseBody',\n\n    'webSocketMessages',\n    'webSocketClose',\n\n    'rtcConnection',\n    'rtcSessionOffer',\n    'rtcSessionAnswer',\n\n    'performance',\n    'export'\n] as const;\ntype ViewCardKey = typeof VIEW_CARD_KEYS[number];\n\nconst EXPANDABLE_VIEW_CARD_KEYS = [\n    'requestBody',\n    'responseBody',\n    'webSocketMessages'\n] as const;\nexport type ExpandableViewCardKey = typeof EXPANDABLE_VIEW_CARD_KEYS[number];\n\nconst isExpandableViewCard = (key: any): key is ExpandableViewCardKey =>\n    EXPANDABLE_VIEW_CARD_KEYS.includes(key);\n\nconst SEND_CARD_KEYS = [\n    'requestHeaders',\n    'requestBody',\n    'responseHeaders',\n    'responseBody'\n] as const;\ntype SendCardKey = typeof SEND_CARD_KEYS[number];\n\nconst isSendRequestCard = (key: SendCardKey): key is 'requestHeaders' | 'requestBody' =>\n    key.startsWith('request');\n\nconst isSentResponseCard = (key: SendCardKey): key is 'responseHeaders' | 'responseBody' =>\n    key.startsWith('response');\n\nconst EXPANDABLE_SEND_REQUEST_CARD_KEYS = [\n    'requestHeaders',\n    'requestBody',\n] as const;\ntype ExpandableSendRequestCardKey = typeof EXPANDABLE_SEND_REQUEST_CARD_KEYS[number];\n\nconst EXPANDABLE_SENT_RESPONSE_CARD_KEYS = [\n    'responseHeaders',\n    'responseBody'\n] as const;\ntype ExpandableSentResponseCardKey = typeof EXPANDABLE_SENT_RESPONSE_CARD_KEYS[number];\n\ntype ExpandableSendCardKey = ExpandableSendRequestCardKey | ExpandableSentResponseCardKey;\n\nconst isExpandableSendCard = (key: any): key is ExpandableSendCardKey =>\n    EXPANDABLE_SEND_REQUEST_CARD_KEYS.includes(key) ||\n    EXPANDABLE_SENT_RESPONSE_CARD_KEYS.includes(key);\n\nconst SETTINGS_CARD_KEYS =[\n    'account',\n    'proxy',\n    'connection',\n    'api',\n    'themes'\n] as const;\ntype SettingsCardKey = typeof SETTINGS_CARD_KEYS[number];\n\nexport class UiStore {\n\n    constructor(\n        private accountStore: AccountStore\n    ) { }\n\n    readonly initialized = lazyObservablePromise(async () => {\n        await this.accountStore.initialized;\n\n        autorun(() => {\n            // Any time the theme changes, update the HTML background to match\n            document.querySelector('html')!.style.backgroundColor = this.theme.containerBackground;\n\n            // Persist the background colour standalone, so we can easily access it\n            // from the index.html loading script, whether it's custom or computed\n            localStorage.setItem('theme-background-color', this.theme.containerBackground);\n        });\n\n        // Every time the user account data is updated from the server, consider resetting\n        // paid settings to the free defaults. This ensures that they're reset on\n        // logout & subscription expiration (even if that happened while the app was\n        // closed), but don't get reset when the app starts with stale account data.\n        observe(this.accountStore, 'accountDataLastUpdated', () => {\n            if (!this.accountStore.isPaidUser) {\n                this.setTheme('light');\n            }\n        });\n\n        await hydrate({\n            key: 'ui-store',\n            store: this\n        });\n\n        const darkThemeMq = window.matchMedia(\"(prefers-color-scheme: dark)\");\n        this._setPrefersDarkTheme(darkThemeMq.matches);\n        darkThemeMq.addEventListener('change', e => {\n            this._setPrefersDarkTheme(e.matches);\n        });\n\n        console.log('UI store initialized');\n    });\n\n    @action.bound\n    setTheme(themeNameOrObject: Theme | ThemeName | 'automatic') {\n        if (typeof themeNameOrObject === 'string') {\n            this._themeName = themeNameOrObject;\n            this.customTheme = undefined;\n        } else {\n            this._themeName = 'custom';\n            this.customTheme = themeNameOrObject;\n        }\n    }\n\n    @persist @observable\n    private _themeName: ThemeName | 'automatic' | 'custom' = 'light';\n\n    get themeName() {\n        return this._themeName;\n    }\n\n    /**\n     * Stores if user prefers a dark color theme (for example when set in system settings).\n     * Used if automatic theme is enabled.\n     */\n    @observable\n    private _prefersDarkTheme: boolean = false;\n\n    @action.bound\n    private _setPrefersDarkTheme(value: boolean) {\n        this._prefersDarkTheme = value;\n    }\n\n    @persist('object') @observable\n    private customTheme: Theme | undefined = undefined;\n\n    @computed\n    get theme(): Theme {\n        switch(this.themeName) {\n            case 'automatic':\n                return {...Themes[this._prefersDarkTheme ? 'dark' : 'light']}\n            case 'custom':\n                return this.customTheme!;\n            default:\n                return Themes[this.themeName];\n        }\n    }\n\n    // Set briefly at the moment any card expansion is toggled, to trigger animation for the expansion as it's\n    // applied, not always (to avoid animating expanded cards when they're rendered e.g. when selecting a request).\n    @observable\n    private animatedExpansionCard: string | undefined;\n\n    // Store the view details cards state here, so that they persist\n    // when moving away from the page or deselecting all traffic.\n    @observable\n    private readonly viewCardStates = {\n        'api': { collapsed: true },\n\n        'request': { collapsed: false },\n        'requestBody': { collapsed: false },\n        'response': { collapsed: false },\n        'responseBody': { collapsed: false },\n\n        'webSocketMessages': { collapsed: false },\n        'webSocketClose': { collapsed: false },\n\n        'rtcConnection': { collapsed: false },\n        'rtcSessionOffer': { collapsed: false },\n        'rtcSessionAnswer': { collapsed: false },\n\n        'performance': { collapsed: true },\n        'export': { collapsed: true }\n    };\n\n    @observable\n    expandedViewCard: ExpandableViewCardKey | undefined;\n\n    @computed\n    get viewCardProps() {\n        return _.mapValues(this.viewCardStates, (state, key) => ({\n            key,\n            expanded: key === this.animatedExpansionCard\n                ?  'starting' as const\n                : key === this.expandedViewCard,\n            collapsed: state.collapsed && key !== this.expandedViewCard,\n            onCollapseToggled: this.toggleViewCardCollapsed.bind(this, key as ViewCardKey),\n            onExpandToggled: isExpandableViewCard(key)\n                ? this.toggleViewCardExpanded.bind(this, key)\n                : _.noop\n        }));\n    }\n\n    @action\n    toggleViewCardCollapsed(key: ViewCardKey) {\n        const cardState = this.viewCardStates[key];\n        cardState.collapsed = !cardState.collapsed;\n        this.expandedViewCard = undefined;\n    }\n\n    @action\n    private toggleViewCardExpanded(key: ExpandableViewCardKey) {\n        if (this.expandedViewCard === key) {\n            this.expandedViewCard = undefined;\n        } else if (isExpandableViewCard(key)) {\n            this.viewCardStates[key].collapsed = false;\n            this.expandedViewCard = key;\n\n            // Briefly set animatedExpansionCard, to trigger animation for this expansion:\n            this.animatedExpansionCard = key;\n            requestAnimationFrame(action(() => {\n                this.animatedExpansionCard = undefined;\n            }));\n        }\n    }\n\n    // Store the send details cards state here\n    @observable\n    private readonly sendCardStates = {\n        'requestHeaders': { collapsed: false },\n        'requestBody': { collapsed: false },\n        'responseHeaders': { collapsed: false },\n        'responseBody': { collapsed: false }\n    };\n\n    @observable\n    expandedSendRequestCard: ExpandableSendRequestCardKey | undefined;\n\n    @observable\n    expandedSentResponseCard: ExpandableSentResponseCardKey | undefined;\n\n    @computed\n    get sendCardProps() {\n        return _.mapValues(this.sendCardStates, (state, key) => {\n            const expandedState = key === this.animatedExpansionCard\n                ?  'starting' as const\n                : key === this.expandedSendRequestCard || key === this.expandedSentResponseCard;\n\n            return {\n                key,\n                expanded: expandedState,\n                collapsed: state.collapsed && !expandedState,\n                onCollapseToggled: this.toggleSendCardCollapsed.bind(this, key as SendCardKey),\n                onExpandToggled: isExpandableSendCard(key)\n                    ? this.toggleSendCardExpanded.bind(this, key)\n                    : _.noop\n            };\n        });\n    }\n\n    @action\n    toggleSendCardCollapsed(key: SendCardKey) {\n        const cardState = this.sendCardStates[key];\n        cardState.collapsed = !cardState.collapsed;\n\n        if (isSendRequestCard(key)) {\n            this.expandedSendRequestCard = undefined;\n        } else if (isSentResponseCard(key)) {\n            this.expandedSentResponseCard = undefined;\n        } else {\n            throw new UnreachableCheck(key);\n        }\n    }\n\n    @action\n    private toggleSendCardExpanded(key: ExpandableSendCardKey) {\n        const expandedCardField = isSendRequestCard(key)\n                ? 'expandedSendRequestCard'\n            : isSentResponseCard(key)\n                ? 'expandedSentResponseCard'\n            : unreachableCheck(key);\n\n        if (this[expandedCardField] === key) {\n            this[expandedCardField] = undefined;\n        } else if (isExpandableSendCard(key)) {\n            this.sendCardStates[key].collapsed = false;\n            this[expandedCardField] = key as any; // We ensured key matches the field already above\n\n            // Briefly set animatedExpansionCard, to trigger animation for this expansion:\n            this.animatedExpansionCard = key;\n            requestAnimationFrame(action(() => {\n                this.animatedExpansionCard = undefined;\n            }));\n        }\n    }\n\n    @observable\n    private settingsCardStates = {\n        'account': { collapsed: false },\n        'proxy': { collapsed: false },\n        'connection': { collapsed: false },\n        'api': { collapsed: false },\n        'themes': { collapsed: false }\n    };\n\n    @computed\n    get settingsCardProps() {\n        return _.mapValues(this.settingsCardStates, (state, key) => ({\n            key,\n            collapsed: state.collapsed,\n            onCollapseToggled: this.toggleSettingsCardCollapsed.bind(this, key as SettingsCardKey)\n        }));\n    }\n\n    @action\n    toggleSettingsCardCollapsed(key: SettingsCardKey) {\n        const cardState = this.settingsCardStates[key];\n        cardState.collapsed = !cardState.collapsed;\n        this.expandedViewCard = undefined;\n    }\n\n    @action.bound\n    rememberElectronPath(path: string) {\n        if (!this.previousElectronAppPaths.includes(path)) {\n            this.previousElectronAppPaths.unshift(path);\n        }\n\n        // Keep only the most recent 3 electron paths used\n        this.previousElectronAppPaths = this.previousElectronAppPaths.slice(0, 3);\n    }\n\n    @action.bound\n    forgetElectronPath(path: string) {\n        this.previousElectronAppPaths = this.previousElectronAppPaths.filter(p => p != path);\n    }\n\n    @persist('list') @observable\n    previousElectronAppPaths: string[] = [];\n\n    @observable\n    activeFilterSet: FilterSet = emptyFilterSet();\n\n    @persist('object') @observable\n    _customFilters: { [name: string]: string } = {};\n\n    @computed\n    get customFilters() {\n        if (this.accountStore.isPaidUser) {\n            return this._customFilters;\n        } else {\n            return {};\n        }\n    }\n\n    @persist @observable\n    preferredShell: string | undefined = 'Bash';\n\n    @persist @observable\n    exportSnippetFormat: string | undefined;\n\n    /**\n     * This tracks the context menu state *only if it's not handled natively*. This state\n     * is rendered by React as a fallback when DesktopApi.openContextMenu is not available.\n     */\n    @observable.ref // This shouldn't be mutated\n    contextMenuState: ContextMenuState<any> | undefined;\n\n    handleContextMenuEvent<T>(\n        event: React.MouseEvent,\n        items: readonly ContextMenuItem<T>[],\n        data: T\n    ): void;\n    handleContextMenuEvent(\n        event: React.MouseEvent,\n        items: readonly ContextMenuItem<void>[]\n    ): void;\n    @action.bound\n    handleContextMenuEvent<T>(\n        event: React.MouseEvent,\n        items: readonly ContextMenuItem<T>[],\n        data?: T\n    ): void {\n        if (!items.length) return;\n\n        event.preventDefault();\n\n        if (DesktopApi.openContextMenu) {\n            const position = { x: event.pageX, y: event.pageY };\n            this.contextMenuState = undefined; // Should be set already, but let's be explicit\n\n            DesktopApi.openContextMenu({\n                position,\n                items: buildNativeContextMenuItems(items)\n            }).then((result) => {\n                if (result) {\n                    const selectedItem = _.get(items, result) as ContextMenuOption<T>;\n                    selectedItem.callback(data!);\n                }\n            }).catch((error) => {\n                console.log(error);\n                throw new Error('Error opening context menu');\n            });\n        } else {\n            event.persist();\n            this.contextMenuState = {\n                data,\n                event,\n                items\n            };\n        }\n    }\n\n    @action.bound\n    clearHtmlContextMenu() {\n        this.contextMenuState = undefined;\n    }\n\n}\n","import * as _ from 'lodash';\nimport { observable, action, flow, computed, when } from 'mobx';\n\nimport { logError, logErrorsAsUser } from '../../errors';\nimport { trackEvent } from '../../metrics';\nimport { delay } from '../../util/promise';\nimport { ObservablePromise, lazyObservablePromise, observablePromise } from '../../util/observable';\n\nimport {\n    initializeAuthUi,\n    loginEvents,\n    showLoginDialog,\n    logOut,\n\n    User,\n    getLatestUserData,\n    getLastUserData,\n    RefreshRejectedError,\n\n    SKU,\n    SubscriptionPlans,\n    prepareCheckout,\n    openNewCheckoutWindow,\n    cancelSubscription,\n    loadPlanPricesUntilSuccess\n} from '@httptoolkit/accounts';\n\nexport class AccountStore {\n\n    constructor(\n        private goToSettings: () => void\n    ) {}\n\n    readonly initialized = lazyObservablePromise(async () => {\n        // All async auth-related errors at any stage (bad tokens, invalid subscription data,\n        // misc failures) will come through here, so we can log & debug later.\n        loginEvents.on('app_error', logError);\n\n        initializeAuthUi({\n            // Proper indefinitely persistent session via refreshable token please\n            refreshToken: true,\n\n            // Don't persist logins for auto-login later. That makes sense for apps you log into\n            // every day, but it's weird otherwise (e.g. after logout -> one-click login? Very odd).\n            rememberLastLogin: false\n        });\n\n        this.subscriptionPlans = observablePromise(\n            loadPlanPricesUntilSuccess()\n        );\n\n        // Update account data automatically on login, logout & every 10 mins\n        loginEvents.on('authenticated', async (authResult) => {\n            // If a user logs in after picking a plan, they're going to go to the\n            // checkout imminently. The API has to query Paddle to build that checkout,\n            // so we ping here early to kick that process off ASAP:\n            const initialEmailResult = authResult?.idTokenPayload?.email;\n            if (initialEmailResult && this.selectedPlan) {\n                prepareCheckout(initialEmailResult, this.selectedPlan, 'app');\n            }\n\n            await this.updateUser();\n            loginEvents.emit('user_data_loaded');\n        });\n\n        loginEvents.on('authorization_error', (error) => {\n            if (error instanceof RefreshRejectedError) {\n                // If our refresh token ever becomes invalid (caused once by an Auth0 regression,\n                // or in general refresh tokens can be revoked), prompt for a fresh login.\n                logOut();\n                this.logIn();\n            }\n        });\n\n        this.updateUser();\n        setInterval(this.updateUser, 1000 * 60 * 10);\n        loginEvents.on('logout', this.updateUser);\n\n        console.log('Account store initialized');\n    });\n\n    @observable\n    private user: User = getLastUserData();\n\n    @observable\n    accountDataLastUpdated = 0;\n\n    // Set when we know a checkout/cancel is processing elsewhere:\n    @observable\n    isAccountUpdateInProcess = false;\n\n    @computed get userEmail() {\n        return this.user.email;\n    }\n\n    @computed get userSubscription() {\n        return this.isPaidUser || this.isPastDueUser\n            ? this.user.subscription\n            : undefined;\n    }\n\n    private updateUser = flow(function * (this: AccountStore) {\n        this.user = yield getLatestUserData();\n        this.accountDataLastUpdated = Date.now();\n\n        // Include the user email in error reports whilst they're logged in.\n        // Useful generally, but especially for checkout/subscription issues.\n        logErrorsAsUser(this.user.email);\n\n        if (this.user.banned) {\n            alert('Your account has been blocked for abuse. Please contact help@httptoolkit.com.');\n            window.close();\n        }\n    }.bind(this));\n\n    subscriptionPlans!: ObservablePromise<SubscriptionPlans>;\n\n    @observable\n    modal: 'login' | 'pick-a-plan' | 'post-checkout' | undefined;\n\n    @observable\n    private selectedPlan: SKU | undefined;\n\n    @computed get isLoggedIn() {\n        return !!this.user.email;\n    }\n\n    @computed get featureFlags() {\n        return _.clone(this.user.featureFlags);\n    }\n\n    @computed private get isStatusUnexpired() {\n        const subscriptionExpiry = this.user.subscription?.expiry;\n        const subscriptionStatus = this.user.subscription?.status;\n\n        const expiryMargin = subscriptionStatus === 'active'\n            // If we're offline during subscription renewal, and the sub was active last\n            // we checked, then we might just have outdated data, so leave extra slack.\n            // This gives a week of offline usage. Should be enough, given that most HTTP\n            // development needs network connectivity anyway.\n            ? 1000 * 60 * 60 * 24 * 7\n            : 0;\n\n        return !!subscriptionExpiry &&\n            subscriptionExpiry.valueOf() + expiryMargin > Date.now();\n    }\n\n    @computed get isPaidUser() {\n        // ------------------------------------------------------------------\n        // You could set this to true to become a paid user for free.\n        // I'd rather you didn't. HTTP Toolkit takes time & love to build,\n        // and I can't do that if it doesn't pay my bills!\n        //\n        // Fund open source - if you want Pro, help pay for its development.\n        // Can't afford it? Get in touch: tim@httptoolkit.com.\n        // ------------------------------------------------------------------\n\n        // If you're before the last expiry date, your subscription is valid,\n        // unless it's past_due, in which case you're in a strange ambiguous\n        // zone, and the expiry date is the next retry. In that case, your\n        // status is unexpired, but _not_ considered as valid for Pro features.\n        // Note that explicitly cancelled ('deleted') subscriptions are still\n        // valid until the end of the last paid period though!\n        return this.user.subscription?.status !== 'past_due' &&\n            this.isStatusUnexpired;\n    }\n\n    @computed get isPastDueUser() {\n        // Is the user a subscribed user whose payments are failing? Keep them\n        // in an intermediate state so they can fix it (for now, until payment\n        // retries fail, and their subscription cancels & expires completely).\n        return this.user.subscription?.status === 'past_due' &&\n            this.isStatusUnexpired;\n    }\n\n    @computed get userHasSubscription() {\n        return this.isPaidUser || this.isPastDueUser;\n    }\n\n    @computed get mightBePaidUser() {\n        // Like isPaidUser, but returns true for users who have subscription data\n        // locally that's expired, until we successfully make a first check.\n        return this.user.subscription?.status &&\n            this.user.subscription?.status !== 'past_due' &&\n            (this.isStatusUnexpired || this.accountDataLastUpdated === 0);\n    }\n\n    getPro = flow(function * (this: AccountStore, source: string) {\n        try {\n            trackEvent({ category: 'Account', action: 'Get Pro', value: source });\n\n            const selectedPlan: SKU | undefined = yield this.pickPlan();\n            if (!selectedPlan) return;\n\n            if (!this.isLoggedIn) yield this.logIn();\n\n            // If we cancelled login, or we've already got a plan, we're done.\n            if (!this.isLoggedIn || this.userHasSubscription) {\n                if (this.isPastDueUser) this.goToSettings();\n                return;\n            }\n\n            // It's checkout time, and the rest is in the hands of Paddle/PayPro\n            yield this.purchasePlan(this.user.email!, selectedPlan);\n        } catch (error: any) {\n            logError(error);\n            alert(`${\n                error.message || error.code || 'Error'\n            }\\n\\nPlease check your email for details.\\nIf you need help, get in touch at billing@httptoolkit.com.`);\n            this.modal = undefined;\n        } finally {\n            this.selectedPlan = undefined;\n        }\n    }.bind(this));\n\n    logIn = flow(function * (this: AccountStore) {\n        let initialModal = this.modal;\n        this.modal = 'login';\n\n        trackEvent({ category: 'Account', action: 'Login' });\n        const loggedIn: boolean = yield showLoginDialog();\n\n        if (loggedIn) {\n            trackEvent({ category: 'Account', action: 'Login success' });\n            if (this.userHasSubscription) {\n                trackEvent({ category: 'Account', action: 'Paid user login' });\n                this.modal = undefined;\n\n                if (this.isPastDueUser) this.goToSettings();\n            } else {\n                this.modal = initialModal;\n            }\n        } else {\n            trackEvent({ category: 'Account', action: 'Login failed' });\n            this.modal = undefined;\n        }\n\n        return loggedIn;\n    }.bind(this));\n\n    @action.bound\n    logOut() {\n        logOut();\n    }\n\n    private pickPlan = flow(function * (this: AccountStore) {\n        this.selectedPlan = undefined;\n        this.modal = 'pick-a-plan';\n\n        yield when(() => this.modal === undefined || !!this.selectedPlan);\n\n        this.modal = undefined;\n\n        if (this.selectedPlan) {\n            trackEvent({ category: 'Account', action: 'Plan selected', value: this.selectedPlan });\n        } else if (!this.isPaidUser) {\n            // If you don't pick a plan via any route other than already having\n            // bought them, then you're pretty clearly rejecting them.\n            trackEvent({ category: 'Account', action: 'Plans rejected' });\n        }\n\n        return this.selectedPlan;\n    });\n\n    @action.bound\n    setSelectedPlan(plan: SKU | undefined) {\n        if (plan) {\n            this.selectedPlan = plan;\n        } else {\n            this.selectedPlan = this.modal = undefined;\n        }\n    }\n\n    private purchasePlan = flow(function * (this: AccountStore, email: string, sku: SKU) {\n        openNewCheckoutWindow(email, sku, 'app');\n\n        this.modal = 'post-checkout';\n        this.isAccountUpdateInProcess = true;\n        yield this.waitForUserUpdate(() => this.isPaidUser || !this.modal);\n        this.isAccountUpdateInProcess = false;\n        this.modal = undefined;\n\n        trackEvent({\n            category: 'Account',\n            action: this.isPaidUser ? 'Checkout complete' : 'Checkout cancelled',\n            value: sku\n        });\n    });\n\n    private waitForUserUpdate = flow(function * (\n        this: AccountStore,\n        completedCheck: () => boolean\n    ) {\n        let focused = true;\n\n        const setFocused = () => {\n            focused = true;\n            this.updateUser();\n        };\n\n        const setUnfocused = () => {\n            focused = false;\n        };\n\n        window.addEventListener('focus', setFocused);\n        window.addEventListener('blur', setUnfocused);\n\n        // Keep checking the user's subscription data at intervals, whilst other processes\n        // (browser checkout, update from payment provider) complete elsewhere...\n        yield this.updateUser();\n        let ticksSinceCheck = 0;\n        while (!completedCheck()) {\n            yield delay(1000);\n            ticksSinceCheck += 1;\n\n            if (focused || ticksSinceCheck > 10) {\n                // Every 10s while blurred or 500ms while focused, check the user data:\n                ticksSinceCheck = 0;\n                yield this.updateUser();\n            }\n        }\n\n        if (completedCheck() && !focused) window.focus(); // Jump back to the front after update\n\n        window.removeEventListener('focus', setFocused);\n        window.removeEventListener('blur', setUnfocused);\n    });\n\n    @action.bound\n    cancelCheckout() {\n        this.modal = this.selectedPlan = undefined;\n    }\n\n    get canManageSubscription() {\n        return !!this.userSubscription?.canManageSubscription;\n    }\n\n    cancelSubscription = flow(function * (this: AccountStore) {\n        try {\n            this.isAccountUpdateInProcess = true;\n            yield cancelSubscription();\n            yield this.waitForUserUpdate(() =>\n                !this.user.subscription ||\n                this.user.subscription.status === 'deleted'\n            );\n            console.log('Subscription cancellation confirmed');\n        } catch (e: any) {\n            console.log(e);\n            logError(`Subscription cancellation failed: ${e.message || e}`);\n            throw e;\n        } finally {\n            this.isAccountUpdateInProcess = false;\n        }\n    });\n\n}","import * as ipaddr from 'ipaddr.js';\nimport { logError } from '../errors';\n\nexport function isValidPort(port: number): boolean {\n    return port > 0 && port <= 65535;\n}\n\nexport function isValidHost(host: string | undefined): boolean {\n    return !!host?.match(/^[A-Za-z0-9\\-.]+(:\\d+)?$/);\n}\n\nexport function isValidHostname(hostname: string | undefined): boolean {\n    return !!hostname?.match(/^[A-Za-z0-9\\-.]+$/);\n}\n\nfunction isIPv6(ip: ipaddr.IPv4 | ipaddr.IPv6): ip is ipaddr.IPv6 {\n    return ip.kind() === 'ipv6';\n}\n\nconst subnetDescriptionOverrides: _.Dictionary<string> = {\n    'unspecified': 'unknown',\n    'loopback': 'this machine',\n    'private': 'a local network device',\n    'uniqueLocal': 'a local network device',\n    'unicast': '',\n};\n\n// Takes an IPv6 or IPv4 address, and makes it presentable\nexport function getReadableIP(ip: string) {\n    let parsedIp: ipaddr.IPv4 | ipaddr.IPv6\n    try {\n        parsedIp = ipaddr.parse(ip);\n    } catch (e) {\n        logError('Failed to parse IP', { ip: ip });\n        return ip;\n    }\n\n    if (isIPv6(parsedIp) && parsedIp.isIPv4MappedAddress()) {\n        parsedIp = parsedIp.toIPv4Address();\n    }\n\n    const subnetType = parsedIp.range();\n    const subnetDescription = (\n        subnetType in subnetDescriptionOverrides\n            ? subnetDescriptionOverrides[subnetType]\n            : subnetType\n    ).replace(/([A-Z])/g, ' $1') // camelCase to separate Words\n    .toLowerCase() // Lowercase everything\n    .replace(/^rfc/, 'see RFC ') // Highlight RFCs;\n\n    return parsedIp.toNormalizedString() + (\n        subnetDescription\n            ? ` (${subnetDescription})`\n            : ''\n    );\n}","import * as _ from 'lodash';\nimport {\n    observable,\n    action,\n    flow,\n    computed,\n    observe,\n    runInAction,\n} from 'mobx';\n\nimport {\n    PluggableAdmin,\n    MockttpPluggableAdmin,\n    ProxySetting,\n    RequestRuleData,\n    WebSocketRuleData,\n    MockttpHttpsOptions\n} from 'mockttp';\nimport * as MockRTC from 'mockrtc';\n\nimport {\n    InputHTTPEvent,\n    InputRTCEvent,\n    PortRange,\n} from '../types';\nimport {\n    getConfig,\n    announceServerReady,\n    getNetworkInterfaces,\n    NetworkInterfaces,\n} from '../services/server-api';\nimport { AccountStore } from './account/account-store';\n\nimport { delay } from '../util/promise';\nimport { logError } from '../errors';\nimport { lazyObservablePromise } from '../util/observable';\nimport { persist, hydrate } from '../util/mobx-persist/persist';\nimport { isValidPort } from './network';\nimport { serverVersion } from '../services/service-versions';\n\ntype HtkAdminClient =\n    // WebRTC is only supported for new servers:\n    | PluggableAdmin.AdminClient<{ http: MockttpPluggableAdmin.MockttpAdminPlugin, webrtc: MockRTC.MockRTCAdminPlugin }>\n    | PluggableAdmin.AdminClient<{ http: MockttpPluggableAdmin.MockttpAdminPlugin }>;\n\n// Start the server, with slowly decreasing retry frequency (up to a limit).\n// Note that this never fails - any timeout to this process needs to happen elsewhere.\nfunction startServer(\n    adminClient: HtkAdminClient,\n    config: Parameters<HtkAdminClient['start']>[0],\n    maxDelay = 500,\n    delayMs = 200\n): Promise<void> {\n    return adminClient.start(config as any).catch((e) => {\n        console.log('Server initialization failed', e);\n\n        if (e.response) {\n            // Server is listening, but failed to start as requested.\n            // This generally means that some of our config is bad.\n\n            if (e.message?.includes('unrecognized plugin: webrtc')) {\n                // We have webrtc enabled, and the server is new enough to recognize plugins and try to\n                // start them, but too old to actually support the WebRTC plugin. Skip that entirely then:\n                config = {\n                    ...config,\n                    webrtc: undefined\n                };\n            } else {\n                // Some other error - probably means that the HTTP port is in use.\n                // Drop the port config and try again:\n                config = {\n                    ...config,\n                    http: {\n                        ...config.http,\n                        port: undefined\n                    }\n                }\n            }\n\n            // Retry with our updated config after the tiniest possible delay:\n            return delay(100).then(() =>\n                startServer(adminClient, config, maxDelay, delayMs)\n            );\n        }\n\n        // For anything else (unknown errors, or more likely server not listening yet),\n        // wait briefly and then retry the same config:\n        return delay(Math.min(delayMs, maxDelay)).then(() =>\n            startServer(adminClient, config, maxDelay, delayMs * 1.2)\n        );\n    }) as Promise<void>;\n}\n\nexport function isValidPortConfiguration(portConfig: PortRange | undefined) {\n    return portConfig === undefined || (\n        portConfig.endPort >= portConfig.startPort &&\n        isValidPort(portConfig.startPort) &&\n        isValidPort(portConfig.endPort)\n    );\n}\n\nexport class ProxyStore {\n\n    constructor(\n        private readonly accountStore: AccountStore\n    ) { }\n\n    @observable.ref\n    private adminClient!: HtkAdminClient // Definitely set *after* initialization\n\n    private mockttpRequestBuilder!: MockttpPluggableAdmin.MockttpAdminRequestBuilder;\n    private mockRTCRequestBuilder = new MockRTC.MockRTCAdminRequestBuilder();\n\n    @observable\n    // !-asserted, because it's definitely set *after initialized*\n    certPath!: string;\n\n    @observable\n    certContent: string | undefined;\n\n    @observable\n    certFingerprint: string | undefined;\n\n    @observable\n    externalNetworkAddresses: string[] = [];\n\n    @observable\n    systemProxyConfig: ProxySetting | undefined;\n\n    @observable\n    dnsServers: string[] = [];\n\n    @observable\n    ruleParameterKeys: string[] = [];\n\n    @observable\n    serverVersion!: string; // Definitely set *after* initialization\n\n    readonly initialized = lazyObservablePromise(async () => {\n        await this.accountStore.initialized;\n\n        await this.loadSettings();\n        await this.startIntercepting();\n        this.serverVersion = await serverVersion;\n        console.log(`Proxy store initialized (server version ${this.serverVersion})`);\n    });\n\n    private async loadSettings() {\n        const { accountStore } = this;\n        // Every time the user account data is updated from the server, consider resetting\n        // paid settings to the free defaults. This ensures that they're reset on\n        // logout & subscription expiration (even if that happened while the app was\n        // closed), but don't get reset when the app starts with stale account data.\n        observe(accountStore, 'accountDataLastUpdated', () => {\n            if (!accountStore.isPaidUser) {\n                this.setPortConfig(undefined);\n                this.http2Enabled = 'fallback';\n                this.tlsPassthroughConfig = [];\n            }\n        });\n\n        // Load all persisted settings from storage\n        await hydrate({\n            key: 'server-store',\n            store: this\n        });\n\n        // Backward compat for store data before 2020-01-28 - drop this in a month or two\n        const rawData = localStorage.getItem('interception-store');\n        if (rawData) {\n            try {\n                const data = JSON.parse(rawData);\n\n                // Migrate data from the interception store to here:\n                if (data._portConfig) {\n                    runInAction(() => {\n                        this._portConfig = data._portConfig;\n                    });\n                }\n            } catch (e) {\n                console.log(e);\n            }\n        }\n\n        console.log('Proxy settings loaded');\n    }\n\n    private startIntercepting = flow(function* (this: ProxyStore) {\n        this.adminClient = new PluggableAdmin.AdminClient<{\n            http: any,\n            webrtc: any\n        }>({\n            adminServerUrl: 'http://127.0.0.1:45456'\n        });\n\n        this._http2CurrentlyEnabled = this.http2Enabled;\n        this._currentTlsPassthroughConfig = _.cloneDeep(this.tlsPassthroughConfig);\n\n        this.monitorRemoteClientConnection(this.adminClient);\n\n        yield startServer(this.adminClient, {\n            http: {\n                options: {\n                    cors: false,\n                    suggestChanges: false,\n                    // User configurable settings:\n                    http2: this._http2CurrentlyEnabled,\n                    https: {\n                        tlsPassthrough: this._currentTlsPassthroughConfig\n                    } as MockttpHttpsOptions // Cert/Key options are set by the server\n                },\n                port: this.portConfig\n            },\n            webrtc: {}\n        });\n\n        this.mockttpRequestBuilder = new MockttpPluggableAdmin.MockttpAdminRequestBuilder(\n            this.adminClient.schema\n        );\n\n        announceServerReady();\n        console.log('Server started');\n\n        yield getConfig(this.httpProxyPort).then((config) => {\n            this.certPath = config.certificatePath;\n            this.certContent = config.certificateContent;\n            this.certFingerprint = config.certificateFingerprint;\n            this.setNetworkAddresses(config.networkInterfaces);\n            this.systemProxyConfig = config.systemProxy;\n            this.dnsServers = config.dnsServers;\n            this.ruleParameterKeys = config.ruleParameterKeys;\n            console.log('Config loaded');\n        });\n\n        // Everything seems to agree that here we're 'done'\n        console.log(`Server started on port ${this.httpProxyPort}`);\n\n        window.addEventListener('beforeunload', () => {\n            this.adminClient.stop().catch(() => { });\n        });\n    });\n\n    private monitorRemoteClientConnection(client: PluggableAdmin.AdminClient<{}>) {\n        client.on('admin-client:stream-error', (err) => {\n            console.log('Admin client stream error');\n            logError(err.message ? err : new Error('Client stream error'), { cause: err });\n        });\n        client.on('admin-client:subscription-error', (err) => {\n            console.log('Admin client subscription error');\n            logError(err.message ? err : new Error('Client subscription error'), { cause: err });\n        });\n        client.on('admin-client:stream-reconnect-failed', (err) => {\n            logError(err.message ? err : new Error('Client reconnect error'), { cause: err });\n        });\n    }\n\n    @persist('object') @observable\n    private _portConfig: PortRange | undefined;\n\n    @computed get portConfig() {\n        return this._portConfig;\n    }\n\n    @action\n    setPortConfig(value: PortRange | undefined) {\n        if (!isValidPortConfiguration(value)) {\n            throw new TypeError(`Invalid port config: ${JSON.stringify(value)}`);\n        } else if (!value || (value.startPort === 8000 && value.endPort === 65535)) {\n            // If unset, or set to the default equivalent value, then\n            // we delegate to the server itself.\n            this._portConfig = undefined;\n        } else {\n            this._portConfig = value;\n        }\n    }\n\n    @computed get httpProxyPort() {\n        return this.adminClient.metadata.http.port;\n    }\n\n    @persist @observable\n    http2Enabled: true | false | 'fallback' = 'fallback';\n    private _http2CurrentlyEnabled = this.http2Enabled;\n    get http2CurrentlyEnabled() {\n        return this._http2CurrentlyEnabled;\n    }\n\n    @persist('list') @observable\n    tlsPassthroughConfig: Array<{ hostname: string }> = [];\n    private _currentTlsPassthroughConfig: Array<{ hostname: string }> = [];\n    get currentTlsPassthroughConfig() {\n        return this._currentTlsPassthroughConfig;\n    }\n\n    setRequestRules = (...rules: RequestRuleData[]) => {\n        const { adminStream } = this.adminClient;\n\n        return this.adminClient.sendQuery(\n            this.mockttpRequestBuilder.buildAddRequestRulesQuery(rules, true, adminStream)\n        );\n    }\n\n    setWebSocketRules = (...rules: WebSocketRuleData[]) => {\n        const { adminStream } = this.adminClient;\n\n        return this.adminClient.sendQuery(\n            this.mockttpRequestBuilder.buildAddWebSocketRulesQuery(rules, true, adminStream)\n        );\n    }\n\n    setRTCRules = (...rules: MockRTC.MockRTCRuleDefinition[]) => {\n        const { adminStream } = this.adminClient;\n\n        return this.adminClient.sendQuery(\n            this.mockRTCRequestBuilder.buildSetRulesQuery(rules, adminStream)\n        );\n    }\n\n    // Proxy event subscriptions through to the server instance:\n    onMockttpEvent = (event: InputHTTPEvent, callback: (data: any) => void) => {\n        const subRequest = this.mockttpRequestBuilder.buildSubscriptionRequest(event);\n\n        if (!subRequest) {\n            // We just return an immediately promise if we don't recognize the event, which will quietly\n            // succeed but never call the corresponding callback (the same as the server and most event\n            // sources in the same kind of situation). This is what happens when the *client* doesn't\n            // recognize the event. Subscribe() below handles the unknown-to-server case.\n            console.warn(`Ignoring subscription for event unrecognized by Mockttp client: ${event}`);\n            return Promise.resolve();\n        }\n\n        return this.adminClient.subscribe(subRequest, callback);\n    }\n\n    // Proxy event subscriptions through to the server instance:\n    onMockRTCEvent = (event: InputRTCEvent, callback: (data: any) => void) => {\n        const subRequest = this.mockRTCRequestBuilder.buildSubscriptionRequest(event);\n\n        if (!subRequest) {\n            // We just return an immediately promise if we don't recognize the event, which will quietly\n            // succeed but never call the corresponding callback (the same as the server and most event\n            // sources in the same kind of situation). This is what happens when the *client* doesn't\n            // recognize the event. Subscribe() below handles the unknown-to-server case.\n            console.warn(`Ignoring subscription for event unrecognized by MockRTC client: ${event}`);\n            return Promise.resolve();\n        }\n\n        return this.adminClient.subscribe(subRequest, callback);\n    }\n\n    private setNetworkAddresses(networkInterfaces: NetworkInterfaces) {\n        this.externalNetworkAddresses = _.flatMap(networkInterfaces, (addresses, iface) => {\n            return addresses\n                .filter(a =>\n                    !a.internal && // Loopback interfaces\n                    a.family === \"IPv4\" && // Android VPN app supports IPv4 only\n                    iface !== 'docker0' && // Docker default bridge interface\n                    !iface.startsWith('br-') && // More docker bridge interfaces\n                    !iface.startsWith('veth') // Virtual interfaces for each docker container\n                )\n                .map(a => a.address);\n        })\n    }\n\n    public refreshNetworkAddresses = flow(function* (this: ProxyStore) {\n        this.setNetworkAddresses(yield getNetworkInterfaces());\n    });\n\n}","import * as uuid from 'uuid/v4';\n\nimport { InputTlsFailure } from '../../types';\nimport { HTKEventBase } from '../events/event-base';\n\nexport class FailedTlsConnection extends HTKEventBase {\n\n    constructor(\n        private failureEvent: InputTlsFailure\n    ) {\n        super();\n\n        this.searchIndex = [failureEvent.hostname, failureEvent.remoteIpAddress]\n            .filter((x): x is string => !!x)\n            .join('\\n');\n    }\n\n    readonly id = uuid();\n\n    readonly upstreamHostname = this.failureEvent.hostname;\n    readonly remoteIpAddress = this.failureEvent.remoteIpAddress;\n    readonly remotePort = this.failureEvent.remotePort;\n    readonly failureCause = this.failureEvent.failureCause;\n    readonly tags = this.failureEvent.tags;\n    readonly timingEvents = this.failureEvent.timingEvents;\n\n    isTlsFailure(): this is FailedTlsConnection {\n        return true;\n    }\n\n}","import { observable } from 'mobx';\n\nimport { InputTlsPassthrough } from '../../types';\nimport { HTKEventBase } from '../events/event-base';\n\nexport class TlsTunnel extends HTKEventBase {\n\n    constructor(\n        private openEvent: InputTlsPassthrough\n    ) {\n        super();\n\n        this.searchIndex = [openEvent.hostname, openEvent.remoteIpAddress]\n            .filter((x): x is string => !!x)\n            .join('\\n');\n    }\n\n    readonly id = this.openEvent.id;\n\n    readonly remoteIpAddress = this.openEvent.remoteIpAddress;\n    readonly remotePort = this.openEvent.remotePort;\n\n    readonly upstreamHostname = this.openEvent.hostname;\n    readonly upstreamPort = this.openEvent.upstreamPort;\n\n    readonly tags = this.openEvent.tags;\n    readonly timingEvents = this.openEvent.timingEvents;\n\n    isTlsTunnel(): this is TlsTunnel {\n        return true;\n    }\n\n    @observable\n    private open = true;\n\n    markClosed(closeEvent: InputTlsPassthrough) {\n        this.timingEvents.disconnectTimestamp = closeEvent.timingEvents.disconnectTimestamp;\n        this.open = false;\n    }\n\n    isOpen() {\n        return this.open;\n    }\n\n}","/*\n * SPDX-FileCopyrightText: 2022 Tim Perry <tim@httptoolkit.com>\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { action, observable, computed } from \"mobx\";\nimport { SelectedRTCCandidate } from \"mockrtc\";\nimport {\n    InputRTCPeerConnected,\n    InputRTCExternalPeerAttached,\n    InputRTCPeerDisconnected,\n    RTCStream\n} from \"../../types\";\nimport { HTKEventBase } from \"../events/event-base\";\nimport { parseSource } from \"../http/sources\";\n\nconst candidateToUrl = (candidate: SelectedRTCCandidate) =>\n    `${candidate.protocol}://${candidate.address}:${candidate.port}`;\n\nexport class RTCConnection extends HTKEventBase {\n\n    constructor(\n        private connectionEvent: InputRTCPeerConnected\n    ) {\n        super();\n    }\n\n    readonly id = this.connectionEvent.sessionId;\n\n    isRTCConnection(): this is RTCConnection  {\n        return true;\n    }\n\n    get peerId() {\n        return this.connectionEvent.peerId;\n    }\n\n    get localSessionDescription() {\n        return this.connectionEvent.localSessionDescription;\n    }\n\n    get remoteSessionDescription() {\n        return this.connectionEvent.remoteSessionDescription;\n    }\n\n    @computed\n    get source() {\n        return parseSource(this.connectionEvent.metadata.userAgent);\n    }\n\n    @computed\n    get sourceURL() {\n        if (!this.connectionEvent.metadata.sourceURL) return undefined;\n\n        try {\n            return new URL(this.connectionEvent.metadata.sourceURL);\n        } catch (e) {\n            return undefined;\n        }\n    }\n\n    @computed\n    get clientURL() {\n        return candidateToUrl(this.connectionEvent.selectedRemoteCandidate);\n    }\n\n    @observable\n    private attachedConnection:\n        | {\n            externalConnection: InputRTCExternalPeerAttached['externalConnection'],\n            otherHalf?: RTCConnection\n        }\n        | undefined;\n\n    @action\n    attachExternalPeer(\n        attachEvent: InputRTCExternalPeerAttached,\n        otherHalf: RTCConnection | undefined\n    ) {\n        this.attachedConnection = {\n            externalConnection: attachEvent.externalConnection,\n            otherHalf\n        };\n    }\n\n    isOtherHalfOf(attachEvent: InputRTCExternalPeerAttached) {\n        if (!this.attachedConnection) return false;\n\n        const { externalConnection: ourExternalConnection } = this.attachedConnection;\n        const { externalConnection: theirExternalConnection } = attachEvent;\n\n        const ourExternalAddress = candidateToUrl(ourExternalConnection.selectedLocalCandidate);\n        const ourRemoteAddress = candidateToUrl(ourExternalConnection.selectedRemoteCandidate);\n\n        const theirExternalAddress = candidateToUrl(theirExternalConnection.selectedLocalCandidate);\n        const theirRemoteAddress = candidateToUrl(theirExternalConnection.selectedRemoteCandidate);\n\n        return ourExternalAddress === theirRemoteAddress &&\n            theirExternalAddress === ourRemoteAddress;\n    }\n\n    @action\n    connectOtherHalf(otherHalf: RTCConnection) {\n        this.attachedConnection!.otherHalf = otherHalf;\n    }\n\n    @computed\n    get remoteCandidate() {\n        if (!this.attachedConnection) return this.connectionEvent.selectedLocalCandidate;\n\n        const { externalConnection, otherHalf } = this.attachedConnection;\n\n        if (otherHalf) {\n            return otherHalf.connectionEvent.selectedRemoteCandidate;\n        } else {\n            return externalConnection.selectedRemoteCandidate;\n        }\n    }\n\n    @computed\n    get remoteURL() {\n        return candidateToUrl(this.remoteCandidate);\n    }\n\n    readonly streams = observable.array<RTCStream>([], { deep: false });\n\n    @action\n    addStream(stream: RTCStream) {\n        this.streams.push(stream);\n    }\n\n    @action\n    removeStream(stream: RTCStream) {\n        this.streams.remove(stream);\n    }\n\n    @observable\n    private closeData: InputRTCPeerDisconnected | undefined;\n\n    @action\n    markClosed(closeData: InputRTCPeerDisconnected) {\n        this.closeData = closeData;\n    }\n\n    get closeState() {\n        return this.closeData;\n    }\n\n}","/*\n * SPDX-FileCopyrightText: 2022 Tim Perry <tim@httptoolkit.com>\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { action, observable } from 'mobx';\n\nimport {\n    InputRTCDataChannelOpened,\n    InputRTCMessage,\n    InputRTCDataChannelClosed\n} from '../../types';\nimport { HTKEventBase } from '../events/event-base';\nimport { StreamMessage } from '../events/stream-message';\n\nimport { RTCConnection } from './rtc-connection';\n\nexport class RTCDataChannel extends HTKEventBase {\n\n    constructor(\n        private openEvent: InputRTCDataChannelOpened,\n        private connection: RTCConnection\n    ) {\n        super();\n    }\n\n    readonly id = this.sessionId + ':data:' + this.channelId;\n\n    isRTCDataChannel(): this is RTCDataChannel {\n        return true;\n    }\n\n    get rtcConnection() {\n        return this.connection;\n    }\n\n    get sessionId() {\n        return this.rtcConnection.id;\n    }\n\n    get channelId() {\n        return this.openEvent.channelId;\n    }\n\n    get label() {\n        return this.openEvent.channelLabel;\n    }\n\n    get protocol() {\n        return this.openEvent.channelProtocol;\n    }\n\n    @observable\n    readonly messages: Array<StreamMessage> = [];\n\n    @action\n    addMessage(message: InputRTCMessage) {\n        this.messages.push(new StreamMessage(message, this.messages.length));\n    }\n\n    @observable\n    private closeData: InputRTCDataChannelClosed | undefined;\n\n    @action\n    markClosed(closeData: InputRTCDataChannelClosed) {\n        this.closeData = closeData;\n    }\n\n    get closeState() {\n        return this.closeData;\n    }\n\n    cleanup() {\n        this.messages.forEach(msg => msg.cleanup());\n        this.messages.length = 0;\n    }\n\n    @observable\n    public pinned: boolean = false;\n\n}","/*\n * SPDX-FileCopyrightText: 2022 Tim Perry <tim@httptoolkit.com>\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport _ from 'lodash';\nimport { action, observable, computed } from 'mobx';\n\nimport {\n    InputRTCMediaTrackOpened,\n    InputRTCMediaStats,\n    InputRTCMediaTrackClosed\n} from '../../types';\nimport { HTKEventBase } from '../events/event-base';\n\nimport { RTCConnection } from './rtc-connection';\n\nexport interface RTCMediaStatEvent {\n    timestamp: number;\n\n    sentDelta: number;\n    receivedDelta: number;\n}\n\nexport class RTCMediaTrack extends HTKEventBase {\n\n    constructor(\n        private openEvent: InputRTCMediaTrackOpened,\n        private connection: RTCConnection\n    ) {\n        super();\n    }\n\n    readonly id = this.sessionId + ':media:' + this.mid;\n\n    isRTCMediaTrack(): this is RTCMediaTrack {\n        return true;\n    }\n\n    get rtcConnection() {\n        return this.connection;\n    }\n\n    get sessionId() {\n        return this.rtcConnection.id;\n    }\n\n    get mid() {\n        return this.openEvent.trackMid;\n    }\n\n    get direction() {\n        return this.openEvent.trackDirection;\n    }\n\n    get type() {\n        return this.openEvent.trackType;\n    }\n\n    @observable\n    readonly stats: Array<RTCMediaStatEvent> = [];\n\n    @action\n    addStats(event: InputRTCMediaStats) {\n        const previousEvent: RTCMediaStatEvent | undefined = this.stats[this.stats.length - 1];\n\n        if (previousEvent?.timestamp < event.eventTimestamp - 1500) { // If we've missed some events:\n            const skippedEventCount = Math.round((event.eventTimestamp - previousEvent.timestamp) / 1000) - 1;\n\n            if (skippedEventCount > 0) {\n                // No stats are sent when there's no traffic. If we now have traffic, we need to backfill\n                // skipped events with zeros to give us a complete timeline:\n                this.stats.push(\n                    ..._.range(previousEvent.timestamp + 1000, event.eventTimestamp - 500, 1000)\n                    .map(timestamp => ({ timestamp, sentDelta: 0, receivedDelta: 0 }))\n                );\n            }\n        }\n\n        this.stats.push({\n            timestamp: event.eventTimestamp,\n            sentDelta: event.totalBytesSent - this.totalBytesSent,\n            receivedDelta: event.totalBytesReceived - this.totalBytesReceived\n        });\n\n        this._totalBytesSent = event.totalBytesSent;\n        this._totalBytesReceived = event.totalBytesReceived;\n    }\n\n    @observable\n    private _totalBytesSent: number = 0;\n\n    get totalBytesSent() {\n        return this._totalBytesSent;\n    }\n\n    @observable\n    private _totalBytesReceived: number = 0;\n\n    get totalBytesReceived() {\n        return this._totalBytesReceived;\n    }\n\n    @observable\n    private closeData: InputRTCMediaTrackClosed | undefined;\n\n    @action\n    markClosed(closeData: InputRTCMediaTrackClosed) {\n        this.closeData = closeData;\n    }\n\n    get closeState() {\n        return this.closeData;\n    }\n\n    cleanup() {\n        this.stats.length = 0;\n    }\n\n    @observable\n    public pinned: boolean = false;\n\n}","import * as _ from 'lodash';\nimport {\n    observable,\n    action,\n    computed,\n} from 'mobx';\nimport { HarParseError } from 'har-validator';\n\nimport {\n    InputResponse,\n    InputTlsFailure,\n    InputTlsPassthrough,\n    InputInitiatedRequest,\n    InputCompletedRequest,\n    InputFailedRequest,\n    InputClientError,\n    CollectedEvent,\n    InputWebSocketMessage,\n    InputWebSocketClose,\n    InputRTCEvent,\n    InputRTCEventData,\n    InputRTCPeerConnected,\n    InputRTCDataChannelOpened,\n    InputRTCMessage,\n    InputRTCDataChannelClosed,\n    InputRTCPeerDisconnected,\n    InputRTCMediaTrackOpened,\n    InputRTCMediaStats,\n    InputRTCMediaTrackClosed,\n    InputRTCExternalPeerAttached,\n    TimingEvents\n} from '../../types';\n\nimport { lazyObservablePromise } from '../../util/observable';\nimport { logError } from '../../errors';\n\nimport { ProxyStore } from \"../proxy-store\";\nimport { ApiStore } from '../api/api-store';\nimport { RulesStore } from '../rules/rules-store';\nimport { findItem, isRuleGroup } from '../rules/rules-structure';\n\nimport { parseHar } from '../http/har';\n\nimport { FailedTlsConnection } from '../tls/failed-tls-connection';\nimport { TlsTunnel } from '../tls/tls-tunnel';\nimport { HttpExchange } from '../http/exchange';\nimport { WebSocketStream } from '../websockets/websocket-stream';\nimport { RTCConnection } from '../webrtc/rtc-connection';\nimport { RTCDataChannel } from '../webrtc/rtc-data-channel';\nimport { RTCMediaTrack } from '../webrtc/rtc-media-track';\n\n// Would be nice to magically infer this from the overloaded on() type, but sadly:\n// https://github.com/Microsoft/TypeScript/issues/24275#issuecomment-390701982\ntype EventTypesMap = {\n    // HTTP:\n    'request-initiated': InputInitiatedRequest\n    'request': InputCompletedRequest\n    'response': InputResponse\n    // WebSockets:\n    'websocket-request': InputCompletedRequest,\n    'websocket-accepted': InputResponse,\n    'websocket-message-received': InputWebSocketMessage,\n    'websocket-message-sent': InputWebSocketMessage,\n    'websocket-close': InputWebSocketClose,\n    // Mockttp misc:\n    'abort': InputInitiatedRequest,\n    'tls-client-error': InputTlsFailure,\n    'tls-passthrough-opened': InputTlsPassthrough,\n    'tls-passthrough-closed': InputTlsPassthrough,\n    'client-error': InputClientError,\n} & {\n    // MockRTC:\n    [K in InputRTCEvent]: InputRTCEventData[K];\n}\n\nconst mockttpEventTypes = [\n    'request-initiated',\n    'request',\n    'response',\n    'websocket-request',\n    'websocket-accepted',\n    'websocket-message-received',\n    'websocket-message-sent',\n    'websocket-close',\n    'abort',\n    'tls-client-error',\n    'tls-passthrough-opened',\n    'tls-passthrough-closed',\n    'client-error'\n] as const;\n\nconst mockRTCEventTypes = [\n    'peer-connected',\n    'peer-disconnected',\n    'external-peer-attached',\n    'data-channel-opened',\n    'data-channel-message-sent',\n    'data-channel-message-received',\n    'data-channel-closed',\n    'media-track-opened',\n    'media-track-stats',\n    'media-track-closed'\n] as const;\n\ntype MockttpEventType = typeof mockttpEventTypes[number];\ntype MockRTCEventType = typeof mockRTCEventTypes[number]\n\ntype EventType =\n    | MockttpEventType\n    | MockRTCEventType;\n\nexport type QueuedEvent = ({\n    [T in EventType]: { type: T, event: EventTypesMap[T] }\n}[EventType]);\n\ntype OrphanableQueuedEvent<T extends\n    | 'response'\n    | 'abort'\n    | 'websocket-accepted'\n    | 'websocket-message-received'\n    | 'websocket-message-sent'\n    | 'websocket-close'\n    | 'peer-disconnected'\n    | 'external-peer-attached'\n    | 'data-channel-opened'\n    | 'data-channel-message-sent'\n    | 'data-channel-message-received'\n    | 'data-channel-closed'\n    | 'media-track-opened'\n    | 'media-track-stats'\n    | 'media-track-closed'\n    | 'tls-passthrough-closed'\n> = { type: T, event: EventTypesMap[T] };\n\nexport class EventsStore {\n\n    constructor(\n        private proxyStore: ProxyStore,\n        private apiStore: ApiStore,\n        private rulesStore: RulesStore\n    ) { }\n\n    readonly initialized = lazyObservablePromise(async () => {\n        await Promise.all([\n            this.proxyStore.initialized,\n            this.apiStore.initialized,\n            this.rulesStore.initialized\n        ]);\n\n        mockttpEventTypes.forEach(<T extends MockttpEventType>(eventName: T) => {\n            this.proxyStore.onMockttpEvent(eventName, ((eventData: EventTypesMap[T]) => {\n                if (this.isPaused) return;\n                this.eventQueue.push({ type: eventName, event: eventData } as any);\n                this.queueEventFlush();\n            }));\n        });\n\n        mockRTCEventTypes.forEach(<T extends MockRTCEventType>(eventName: T) => {\n            this.proxyStore.onMockRTCEvent(eventName, ((eventData: EventTypesMap[T]) => {\n                if (this.isPaused) return;\n                this.eventQueue.push({ type: eventName, event: eventData } as any);\n                this.queueEventFlush();\n            }));\n        });\n\n        console.log('Events store initialized');\n    });\n\n    @observable\n    isPaused = false;\n\n    private eventQueue: Array<QueuedEvent> = [];\n    private orphanedEvents: { [id: string]: OrphanableQueuedEvent<any> } = {};\n\n    private isFlushQueued = false;\n    private queueEventFlush() {\n        if (!this.isFlushQueued) {\n            this.isFlushQueued = true;\n            requestAnimationFrame(this.flushQueuedUpdates);\n        }\n    }\n\n    readonly events = observable.array<CollectedEvent>([], { deep: false });\n\n    @computed.struct\n    get exchanges(): Array<HttpExchange> {\n        return this.events.filter((e): e is HttpExchange => e.isHttp());\n    }\n\n    @computed.struct\n    get websockets(): Array<WebSocketStream> {\n        return this.exchanges.filter((e): e is WebSocketStream => e.isWebSocket());\n    }\n\n    @computed.struct\n    get rtcConnections(): Array<RTCConnection> {\n        return this.events.filter((e): e is RTCConnection => e.isRTCConnection());\n    }\n\n    @computed.struct\n    get rtcDataChannels(): Array<RTCDataChannel> {\n        return this.events.filter((e): e is RTCDataChannel => e.isRTCDataChannel());\n    }\n\n    @computed.struct\n    get rtcMediaTracks(): Array<RTCMediaTrack> {\n        return this.events.filter((e): e is RTCMediaTrack => e.isRTCMediaTrack());\n    }\n\n    @computed.struct\n    get activeSources() {\n        return _(this.exchanges)\n            .map(e => e.request.source)\n            .uniqBy(s => s.summary)\n            .value();\n    }\n\n    @action.bound\n    private flushQueuedUpdates() {\n        this.isFlushQueued = false;\n\n        // We batch request updates until here. This runs in a mobx transaction and\n        // on request animation frame, so batches get larger and cheaper if\n        // the frame rate starts to drop.\n\n        this.eventQueue.forEach(this.updateFromQueuedEvent);\n        this.eventQueue = [];\n    }\n\n    private updateFromQueuedEvent = (queuedEvent: QueuedEvent) => {\n        try {\n            switch (queuedEvent.type) {\n                case 'request-initiated':\n                    this.addInitiatedRequest(queuedEvent.event);\n                    return this.checkForOrphan(queuedEvent.event.id);\n                case 'request':\n                    this.addCompletedRequest(queuedEvent.event);\n                    return this.checkForOrphan(queuedEvent.event.id);\n                case 'response':\n                    return this.setResponse(queuedEvent.event);\n                case 'websocket-request':\n                    this.addWebSocketRequest(queuedEvent.event);\n                    return this.checkForOrphan(queuedEvent.event.id);\n                case 'websocket-accepted':\n                    return this.addAcceptedWebSocketResponse(queuedEvent.event);\n                case 'websocket-message-received':\n                case 'websocket-message-sent':\n                    return this.addWebSocketMessage(queuedEvent.event);\n                case 'websocket-close':\n                    return this.markWebSocketClosed(queuedEvent.event);\n                case 'abort':\n                    return this.markRequestAborted(queuedEvent.event);\n                case 'tls-passthrough-opened':\n                    this.addTlsTunnel(queuedEvent.event);\n                    return this.checkForOrphan(queuedEvent.event.id);\n                case 'tls-passthrough-closed':\n                    return this.markTlsTunnelClosed(queuedEvent.event);\n                case 'tls-client-error':\n                    return this.addFailedTlsRequest(queuedEvent.event);\n                case 'client-error':\n                    return this.addClientError(queuedEvent.event);\n\n                case 'peer-connected':\n                    return this.addRTCPeerConnection(queuedEvent.event);\n                case 'external-peer-attached':\n                    return this.attachExternalRTCPeer(queuedEvent.event);\n                case 'peer-disconnected':\n                    return this.markRTCPeerDisconnected(queuedEvent.event);\n                case 'data-channel-opened':\n                    return this.addRTCDataChannel(queuedEvent.event);\n                case 'data-channel-message-sent':\n                case 'data-channel-message-received':\n                    return this.addRTCDataChannelMessage(queuedEvent.event);\n                case 'data-channel-closed':\n                    return this.markRTCDataChannelClosed(queuedEvent.event);\n                case 'media-track-opened':\n                    return this.addRTCMediaTrack(queuedEvent.event);\n                case 'media-track-stats':\n                    return this.addRTCMediaTrackStats(queuedEvent.event);\n                case 'media-track-closed':\n                    return this.markRTCMediaTrackClosed(queuedEvent.event);\n            }\n        } catch (e) {\n            // It's possible we might fail to parse an input event. This shouldn't happen, but if it\n            // does it's better to drop that one event and continue instead of breaking completely.\n            logError(e);\n        }\n    }\n\n    private checkForOrphan(id: string) {\n        // Sometimes we receive events out of order (response/abort before request).\n        // They could be later in the same batch, or in a previous batch. If that happens,\n        // we store them separately, and we check later whether they're valid when subsequent\n        // completed/initiated request events come in. If so, we re-queue them.\n\n        const orphanEvent = this.orphanedEvents[id];\n\n        if (orphanEvent) {\n            delete this.orphanedEvents[id];\n            this.updateFromQueuedEvent(orphanEvent);\n        }\n    }\n\n    @action.bound\n    togglePause() {\n        this.isPaused = !this.isPaused;\n    }\n\n    @action\n    private addInitiatedRequest(request: InputInitiatedRequest) {\n        // Due to race conditions, it's possible this request already exists. If so,\n        // we just skip this - the existing data will be more up to date.\n        const existingEventIndex = _.findIndex(this.events, { id: request.id });\n        if (existingEventIndex === -1) {\n            const exchange = new HttpExchange(this.apiStore, request);\n            this.events.push(exchange);\n        }\n    }\n\n    private getMatchedRule(request: InputCompletedRequest) {\n        if (!request.matchedRuleId) return false;\n\n        const matchedItem = findItem(this.rulesStore.rules, { id: request.matchedRuleId });\n\n        // This shouldn't really happen, but could in race conditions with rule editing:\n        if (!matchedItem) return false;\n\n        // This should never happen, but it's good to check:\n        if (isRuleGroup(matchedItem)) throw new Error('Request event unexpectedly matched rule group');\n\n        return matchedItem;\n    }\n\n    @action\n    private addCompletedRequest(request: InputCompletedRequest) {\n        // The request should already exist: we get an event when the initial path & headers\n        // are received, and this one later when the full body is received.\n        // We add the request from scratch if it's somehow missing, which can happen given\n        // races or if the server doesn't support request-initiated events.\n        const existingEventIndex = _.findIndex(this.events, { id: request.id });\n\n        let event: HttpExchange;\n        if (existingEventIndex >= 0) {\n            event = this.events[existingEventIndex] as HttpExchange;\n        } else {\n            event = new HttpExchange(this.apiStore, { ...request });\n            // ^ This mutates request to use it, so we have to shallow-clone to use it below too:\n            this.events.push(event);\n        }\n\n        event.updateFromCompletedRequest(request, this.getMatchedRule(request));\n    }\n\n    @action\n    private markRequestAborted(request: InputFailedRequest) {\n        const exchange = _.find(this.exchanges, { id: request.id });\n\n        if (!exchange) {\n            // Handle this later, once the request has arrived\n            this.orphanedEvents[request.id] = { type: 'abort', event: request };\n            return;\n        };\n\n        exchange.markAborted(request);\n    }\n\n    @action\n    private setResponse(response: InputResponse) {\n        const exchange = _.find(this.exchanges, { id: response.id });\n\n        if (!exchange) {\n            // Handle this later, once the request has arrived\n            this.orphanedEvents[response.id] = { type: 'response', event: response };\n            return;\n        }\n\n        exchange.setResponse(response);\n    }\n\n    @action\n    private addWebSocketRequest(request: InputCompletedRequest) {\n        const stream = new WebSocketStream(this.apiStore, { ...request });\n        // ^ This mutates request to use it, so we have to shallow-clone to use it below too\n\n        stream.updateFromCompletedRequest(request, this.getMatchedRule(request));\n        this.events.push(stream);\n    }\n\n    @action\n    private addAcceptedWebSocketResponse(response: InputResponse) {\n        const stream = _.find(this.websockets, { id: response.id });\n\n        if (!stream) {\n            // Handle this later, once the request has arrived\n            this.orphanedEvents[response.id] = { type: 'websocket-accepted', event: response };\n            return;\n        }\n\n        stream.setResponse(response);\n        stream.setAccepted(response);\n    }\n\n    @action\n    private addWebSocketMessage(message: InputWebSocketMessage) {\n        const stream = _.find(this.websockets, { id: message.streamId });\n\n        if (!stream) {\n            // Handle this later, once the request has arrived\n            this.orphanedEvents[message.streamId] = {\n                type: `websocket-message-${message.direction}`,\n                event: message\n            };\n            return;\n        }\n\n        stream.addMessage(message);\n    }\n\n    @action\n    private markWebSocketClosed(close: InputWebSocketClose) {\n        const stream = _.find(this.websockets, { id: close.streamId });\n\n        if (!stream) {\n            // Handle this later, once the request has arrived\n            this.orphanedEvents[close.streamId] = {\n                type: 'websocket-close', event: close\n            };\n            return;\n        }\n\n        stream.markClosed(close);\n    }\n\n    @action\n    private addTlsTunnel(openEvent: InputTlsPassthrough) {\n        this.events.push(new TlsTunnel(openEvent));\n    }\n\n    @action\n    private markTlsTunnelClosed(closeEvent: InputTlsPassthrough) {\n        const tunnel = _.find(this.events, { id: closeEvent.id }) as TlsTunnel | undefined;\n\n        if (!tunnel) {\n            // Handle this later, once the tunnel open event has arrived\n            this.orphanedEvents[closeEvent.id] = {\n                type: 'tls-passthrough-closed', event: close\n            };\n            return;\n        }\n\n        tunnel.markClosed(closeEvent);\n    }\n\n    @action\n    private addFailedTlsRequest(request: InputTlsFailure) {\n        if (_.some(this.events, (event) =>\n            event.isTlsFailure() &&\n            event.upstreamHostname === request.hostname &&\n            event.remoteIpAddress === request.remoteIpAddress\n        )) return; // Drop duplicate TLS failures\n\n        this.events.push(new FailedTlsConnection(request));\n    }\n\n    @action\n    private addClientError(error: InputClientError) {\n        if (error.errorCode === 'ECONNRESET' && !error.request.method && !error.request.url) {\n            // We don't bother showing client resets before any data was sent at all.\n            // Not interesting, nothing to show, and generally all a bit noisey.\n            return;\n        }\n\n        if (error.errorCode === 'ERR_SSL_DECRYPTION_FAILED_OR_BAD_RECORD_MAC') {\n            // The TLS connection was interrupted by a bad packet. Generally paired with\n            // an abort event for ongoing requests, so no need for a separate error.\n            return;\n        }\n\n        const exchange = new HttpExchange(this.apiStore, {\n            ...error.request,\n            protocol: error.request.protocol || '',\n            method: error.request.method || '',\n            url: error.request.url || `${error.request.protocol || 'http'}://`,\n            path: error.request.path || '/',\n            headers: error.request.headers\n        });\n\n        if (error.response === 'aborted') {\n            exchange.markAborted(error.request);\n        } else {\n            exchange.setResponse(error.response);\n        }\n\n        this.events.push(exchange);\n    }\n\n    @action\n    private addRTCPeerConnection(event: InputRTCPeerConnected) {\n        this.events.push(new RTCConnection(event));\n    }\n\n    @action\n    private attachExternalRTCPeer(event: InputRTCExternalPeerAttached) {\n        const conn = this.rtcConnections.find(c => c.id === event.sessionId);\n        const otherHalf = this.rtcConnections.find(c => c.isOtherHalfOf(event));\n\n        if (conn) {\n            conn.attachExternalPeer(event, otherHalf);\n            if (otherHalf) otherHalf.connectOtherHalf(conn);\n        } else {\n            this.orphanedEvents[event.sessionId] = { type: 'external-peer-attached', event };\n        }\n    }\n\n    @action\n    private markRTCPeerDisconnected(event: InputRTCPeerDisconnected) {\n        const conn = this.rtcConnections.find(c => c.id === event.sessionId);\n        if (conn) {\n            conn.markClosed(event);\n        } else {\n            this.orphanedEvents[event.sessionId] = { type: 'peer-disconnected', event };\n        }\n    }\n\n    @action\n    private addRTCDataChannel(event: InputRTCDataChannelOpened) {\n        const conn = this.rtcConnections.find(c => c.id === event.sessionId);\n        if (conn) {\n            const dc = new RTCDataChannel(event, conn);\n            this.events.push(dc);\n            conn.addStream(dc);\n        } else {\n            this.orphanedEvents[event.sessionId] = { type: 'data-channel-opened', event };\n        }\n    }\n\n    @action\n    private addRTCDataChannelMessage(event: InputRTCMessage) {\n        const channel = this.rtcDataChannels.find(c => c.sessionId === event.sessionId && c.channelId === event.channelId);\n        if (channel) {\n            channel.addMessage(event);\n        } else {\n            this.orphanedEvents[event.sessionId] = { type: `data-channel-message-${event.direction}`, event };\n        }\n    }\n\n    @action\n    private markRTCDataChannelClosed(event: InputRTCDataChannelClosed) {\n        const channel = this.rtcDataChannels.find(c => c.sessionId === event.sessionId && c.channelId === event.channelId);\n        if (channel) {\n            channel.markClosed(event);\n        } else {\n            this.orphanedEvents[event.sessionId] = { type: 'data-channel-closed', event };\n        }\n    }\n\n    @action\n    private addRTCMediaTrack(event: InputRTCMediaTrackOpened) {\n        const conn = this.rtcConnections.find(c => c.id === event.sessionId);\n        if (conn) {\n            const track = new RTCMediaTrack(event, conn);\n            this.events.push(track);\n            conn.addStream(track);\n        } else {\n            this.orphanedEvents[event.sessionId] = { type: 'media-track-opened', event };\n        }\n    }\n\n    @action\n    private addRTCMediaTrackStats(event: InputRTCMediaStats) {\n        const track = this.rtcMediaTracks.find(t => t.sessionId === event.sessionId && t.mid === event.trackMid);\n        if (track) {\n            track.addStats(event);\n        } else {\n            this.orphanedEvents[event.sessionId] = { type: 'media-track-stats', event };\n        }\n    }\n\n    @action\n    private markRTCMediaTrackClosed(event: InputRTCMediaTrackClosed) {\n        const track = this.rtcMediaTracks.find(t => t.sessionId === event.sessionId && t.mid === event.trackMid);\n        if (track) {\n            track.markClosed(event);\n        } else {\n            this.orphanedEvents[event.sessionId] = { type: 'media-track-closed', event };\n        }\n    }\n\n    @action.bound\n    deleteEvent(event: CollectedEvent) {\n        this.events.remove(event);\n\n        if (event.isRTCDataChannel() || event.isRTCMediaTrack()) {\n            event.rtcConnection.removeStream(event);\n        } else if (event.isRTCConnection()) {\n            const streams = [...event.streams];\n            streams.forEach((stream) => this.deleteEvent(stream));\n        }\n\n        if ('cleanup' in event) event.cleanup();\n    }\n\n    @action.bound\n    clearInterceptedData(clearPinned: boolean) {\n        const [pinnedEvents, unpinnedEvents] = _.partition(\n            this.events,\n            clearPinned ? () => false : (ex) => ex.pinned\n        );\n\n        this.events.clear();\n        unpinnedEvents.forEach((event) => { if ('cleanup' in event) event.cleanup() });\n\n        this.events.push(...pinnedEvents);\n        this.orphanedEvents = {};\n\n        // If GC is exposed (desktop 0.1.22+), trigger it when data is cleared,\n        // as this is the perfect point to pack everything down.\n        if ('gc' in window) (window as any).gc();\n    }\n\n    async loadFromHar(harContents: {}) {\n        const { events, pinnedIds } = await parseHar(harContents).catch((harParseError: HarParseError) => {\n            // Log all suberrors, for easier reporting & debugging.\n            // This does not include HAR data - only schema errors like\n            // 'bodySize is missing' at 'entries[1].request'\n            harParseError.errors.forEach((error) => {\n                console.log(error);\n            });\n            throw harParseError;\n        });\n\n        // We now take each of these input items, and put them on the queue to be added\n        // to the UI like any other seen request data. Arguably we could call addRequest &\n        // setResponse etc directly, but this is nicer if the UI thread is already under strain.\n\n        // First, we run through the request & TLS error events together, in order, since these\n        // define the initial event ordering\n        const [initialEvents, updateEvents] = _.partition(events, ({ type }) =>\n            type === 'request' ||\n            type === 'websocket-request' ||\n            type === 'tls-client-error'\n        );\n        this.eventQueue.push(..._.sortBy(initialEvents, (e) =>\n            (e.event as { timingEvents: TimingEvents }).timingEvents.startTime\n        ));\n\n        // Then we add everything else (responses & aborts). They just update, so order doesn't matter:\n        this.eventQueue.push(...updateEvents);\n\n        this.queueEventFlush();\n\n        if (pinnedIds.length) {\n            // This rAF will be scheduled after the queued flush, so the event should\n            // always be fully imported by this stage:\n            requestAnimationFrame(action(() => pinnedIds.forEach((id) => {\n                this.events.find(e => e.id === id)!.pinned = true;\n            })));\n        }\n    }\n\n    @action\n    recordSentRequest(request: InputCompletedRequest): HttpExchange {\n        const exchange = new HttpExchange(this.apiStore, { ...request });\n        // ^ This mutates request to use it, so we have to shallow-clone to use it below too:\n        exchange.updateFromCompletedRequest(request, false);\n\n        this.events.push(exchange);\n        return exchange;\n    }\n\n}","import * as _ from 'lodash';\nimport * as React from 'react';\n\nexport function filterProps<C extends React.ComponentType<any>>(\n    Component: C,\n    ...keys: string[]\n): C {\n    return ((props: any) => <Component {..._.omit(props, keys) as any} />) as C;\n}\n\n// Trigger the click handler when Enter is pressed on this element\nexport function clickOnEnter<T extends Element>(e: React.KeyboardEvent<T>) {\n    if (e.target === e.currentTarget && e.key === 'Enter') {\n        // Can't use .click(), as sometimes our target is an SVGElement, and they don't have it\n        e.currentTarget.dispatchEvent(new MouseEvent('click', { bubbles: true }));\n    }\n}\n\nexport const noPropagation = <E extends React.BaseSyntheticEvent>(\n    callback: (event: E) => void\n) => (event: E) => {\n    event.stopPropagation();\n    callback(event);\n}\n\nexport const inputValidation = (\n    checkFn: (input: string) => boolean,\n    errorMessage: string\n) => (input: HTMLInputElement) => {\n    const inputValue = input.value;\n    if (!inputValue || checkFn(inputValue)) {\n        input.setCustomValidity('');\n    } else {\n        input.setCustomValidity(errorMessage);\n    }\n    input.reportValidity();\n    return input.validity.valid;\n}","import { styled, Theme } from \"../../styles\";\nimport { Icon } from \"../../icons\";\nimport { filterProps, clickOnEnter } from '../component-utils';\n\ninterface CloseButtonProps {\n    onClose: () => void;\n    inverted?: boolean;\n    top?: string;\n    right?: string;\n\n    theme?: Theme;\n}\n\nexport const CloseButton = styled(\n    filterProps(Icon, 'inverted')\n).attrs((props: CloseButtonProps) => ({\n    icon: ['fas', 'times'],\n    size: '2x',\n\n    tabIndex: 0,\n    onClick: props.onClose,\n    onKeyPress: clickOnEnter\n}))`\n    position: absolute;\n    z-index: 1;\n    cursor: pointer;\n\n    color: ${(p: CloseButtonProps) => p.inverted ?\n        p.theme!.mainBackground : p.theme!.mainColor\n    };\n\n    top: ${p => p.top || '10px'};\n    right: ${p => p.right || '15px'};\n\n    &:hover {\n        opacity: 0.6;\n    }\n`;","import * as React from 'react';\n\nimport { styled } from \"../../styles\";\nimport { Icon } from \"../../icons\";\n\nconst ExternalLinkIcon = styled(Icon).attrs(() => ({\n    icon: ['fas', 'external-link-alt']\n}))`\n    opacity: 0.5;\n    margin-left: 5px;\n\n    &:focus {\n        outline: none;\n        color: ${p => p.theme.popColor};\n    }\n`;\n\nconst DocsA = styled.a`\n    &[href] {\n        color: ${p => p.theme.linkColor};\n\n        &:visited {\n            color: ${p => p.theme.visitedLinkColor};\n        }\n    }\n`;\n\nexport const DocsLink = (p: {\n    href?: string,\n    children?: React.ReactNode\n}) => p.href ?\n    <DocsA {...p} target='_blank' rel='noreferrer noopener'>\n        { /* Whitespace after children, iff we have children */ }\n        { p.children ? <>{ p.children } </> : null }\n        <ExternalLinkIcon />\n    </DocsA>\n: null;","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { action, observable } from 'mobx';\nimport { observer, inject } from 'mobx-react';\n\nimport { NARROW_LAYOUT_BREAKPOINT, styled, popColor } from '../../styles';\nimport { Icon } from '../../icons';\nimport { trackEvent } from '../../metrics';\nimport { logError } from '../../errors';\nimport { windowSize } from '../../util/ui';\n\nimport { Interceptor } from '../../model/interception/interceptors';\nimport { InterceptorStore } from '../../model/interception/interceptor-store';\n\nimport { clickOnEnter } from '../component-utils';\nimport { LittleCard } from '../common/card';\nimport { Pill } from '../common/pill';\nimport { CloseButton } from '../common/close-button';\nimport { DocsLink } from '../common/docs-link';\n\ninterface InterceptOptionProps {\n    className?: string;\n    interceptorStore?: InterceptorStore;\n    index: number;\n    interceptor: Interceptor;\n    showRequests: () => void;\n}\n\ntype InterceptorConfigComponent = React.ComponentType<{\n    interceptor: Interceptor,\n    // Custom config UIs should call this to activate the interceptor. This just sends the request,\n    // with no side effects except check for updated interceptor state afterwards.\n    activateInterceptor: (activationOptions?: any) => Promise<any>,\n    // This should be called when each activation is considered started (i.e. after any required\n    // user input or confirmation).\n    reportStarted: () => void,\n    // This should be called when each activation is considered successfully completed. If\n    // showRequests is not explicitly set to false, it will jump to the View page.\n    reportSuccess: (options?: { showRequests?: boolean }) => void,\n    // This should be called to hide the custom UI again. Mainly useful if interception is cancelled,\n    // or the UI deems itself unnecessary. The UI is never closed automatically, but reportSuccess\n    // without showRequests false will jump to the View page, giving similar results.\n    closeSelf: () => void\n}>\n\nexport interface InterceptorCustomUiConfig {\n    columnWidth: number;\n    rowHeight: number;\n\n    configComponent: InterceptorConfigComponent;\n    customPill?: React.ComponentType<{}>;\n}\n\nconst BackgroundIcons = styled.div`\n    z-index: 0;\n\n    position: absolute;\n    bottom: -10px;\n    right: -10px;\n    z-index: 0;\n    opacity: 0.2;\n\n    > svg {\n        &:not(:first-child) {\n            position: absolute;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n        }\n    }\n`;\n\nconst InterceptOptionCard = styled(LittleCard)<{\n    gridWidth: number,\n    disabled: boolean,\n    expanded: boolean,\n    index: number,\n    uiConfig?: InterceptorCustomUiConfig\n}>`\n    height: 100%;\n    width: 100%;\n    overflow: hidden;\n\n    ${p => {\n        if (!p.expanded || !p.uiConfig) {\n            return `order: ${p.index};`;\n        }\n\n        const width = Math.min(\n            p.uiConfig.columnWidth,\n            p.gridWidth\n        );\n        const height = p.uiConfig.rowHeight;\n\n        // Tweak the order to try and keep cards in the same place as\n        // they expand, pushing other cards down rather than moving\n        // down in the grid themselves.\n        const fixedOrder = Math.max(-1, p.index - width);\n\n        return `\n            order: ${fixedOrder};\n            grid-row: span ${height};\n            grid-column: span ${width};\n        `\n    }}\n\n    user-select: none;\n\n    > :not(${BackgroundIcons}) {\n        z-index: 1;\n    }\n\n    > h1:not(:last-child) {\n        margin-bottom: 10px;\n    }\n\n    > p {\n        color: ${p => p.theme.mainColor};\n        line-height: 1.2;\n\n        &:not(:first-of-type) {\n            margin-top: 10px;\n        }\n    }\n\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    align-items: flex-start;\n`;\n\nconst LoadingOverlay = styled.div`\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n\n    background-color: rgba(0,0,0,0.2);\n    box-shadow: inset 0 2px 10px 0 rgba(0,0,0,0.2);\n\n    display: flex;\n    align-items: center;\n    justify-content: center;\n`;\n\nexport const StatusPill = styled(Pill)`\n    white-space: normal; /* Useful for layout in tiny screens, e.g. the 'proxy port' badge */\n\n    margin-top: auto;\n`;\n\nfunction getStatusPill(interceptor: Interceptor) {\n    if (interceptor.uiConfig?.customPill) {\n        const CustomPill = interceptor.uiConfig?.customPill;\n        return <CustomPill />;\n    } else if (interceptor.isActive) {\n        return <StatusPill color='#4caf7d'>\n            Activated\n        </StatusPill>;\n    } else if (!interceptor.isActivable) {\n        if (interceptor.isSupported) {\n            return <StatusPill>\n                Not available{\n                    interceptor.notAvailableHelpUrl\n                    ? <DocsLink href={interceptor.notAvailableHelpUrl} />\n                    : null\n                }\n            </StatusPill>;\n        } else {\n            return <StatusPill color={popColor}>\n                Coming soon\n            </StatusPill>;\n        }\n    } else {\n        return null;\n    }\n}\n\n@inject('interceptorStore')\n@observer\nexport class InterceptOption extends React.Component<InterceptOptionProps> {\n\n    @observable expanded = false;\n\n    private cardRef = React.createRef<HTMLDivElement>();\n\n    constructor(props: InterceptOptionProps) {\n        super(props);\n    }\n\n    render() {\n        const {\n            expanded,\n            onActivationStarted,\n            activateInterceptor,\n            onActivationSuccessful\n        } = this;\n        const { interceptor, index } = this.props;\n\n        const isDisabled = !interceptor.isActivable;\n        const { uiConfig } = interceptor;\n        const ConfigComponent = uiConfig?.configComponent;\n\n        const icons = _.isArray(interceptor.iconProps)\n            ? interceptor.iconProps\n            : [interceptor.iconProps];\n\n        const gridWidth = windowSize.width >= NARROW_LAYOUT_BREAKPOINT\n            ? 4\n            : 3;\n\n        return <InterceptOptionCard\n            ref={this.cardRef}\n\n            index={index}\n            expanded={expanded}\n            uiConfig={uiConfig}\n            gridWidth={gridWidth}\n\n            disabled={isDisabled}\n            onKeyDown={clickOnEnter}\n            onClick={this.expanded ? undefined : this.onClick}\n            tabIndex={!isDisabled && !this.expanded ? 0 : undefined}\n        >\n            <BackgroundIcons>\n                { icons.map((iconProps, i) =>\n                    <Icon\n                        key={i}\n                        size='8x'\n                        {...iconProps}\n                    />)\n                }\n            </BackgroundIcons>\n\n            <h1>{ interceptor.name }</h1>\n\n            { ConfigComponent && expanded\n                ? <>\n                    <CloseButton onClose={this.onClose} />\n                    <ConfigComponent\n                        interceptor={interceptor}\n                        activateInterceptor={activateInterceptor}\n                        reportStarted={onActivationStarted}\n                        reportSuccess={onActivationSuccessful}\n                        closeSelf={this.onClose}\n                    />\n                </>\n                : <>\n                    { interceptor.description.map((descParagraph, i) =>\n                        <p key={i}>{ descParagraph }</p>\n                    ) }\n\n                    { getStatusPill(interceptor) }\n\n                    { interceptor.inProgress &&\n                        <LoadingOverlay>\n                            <Icon\n                                icon={['fac', 'spinner-arc']}\n                                size='4x'\n                                spin={true}\n                            />\n                        </LoadingOverlay>\n                    }\n                </>\n            }\n        </InterceptOptionCard>;\n    }\n\n    onActivationStarted = () => {\n        trackEvent({\n            category: 'Interceptors',\n            action: 'Activated',\n            value: this.props.interceptor.id\n        });\n    };\n\n    activateInterceptor = (activationOptions: unknown = {}) => {\n        const { interceptor, interceptorStore } = this.props;\n        return interceptorStore!.activateInterceptor(interceptor.id, activationOptions);\n    };\n\n    onActivationSuccessful = (options: {\n        showRequests?: boolean\n    } = {}) => {\n        trackEvent({\n            category: 'Interceptors',\n            action: 'Successfully Activated',\n            value: this.props.interceptor.id\n        });\n\n        // Some interceptors don't switch to show the requests, e.g. if the UI shows a list\n        // of options to intercept, in case the user wants to select multiple options.\n        if (options.showRequests !== false) {\n            this.props.showRequests();\n        }\n    };\n\n    @action.bound\n    onClick() {\n        const {\n            onActivationStarted,\n            activateInterceptor,\n            onActivationSuccessful\n        } = this;\n        const { interceptor } = this.props;\n\n        if (interceptor.inProgress) return;\n\n        if (!interceptor.isActivable) {\n            // Track that somebody *tried* to activate it\n            onActivationStarted();\n            return;\n        }\n\n        if (interceptor.uiConfig) {\n            this.expanded = true;\n            requestAnimationFrame(() => {\n                this.cardRef.current?.scrollIntoView({\n                    block: 'nearest',\n                    behavior: 'smooth'\n                });\n            });\n        } else {\n            onActivationStarted();\n            activateInterceptor(interceptor.activationOptions)\n            .then(() => onActivationSuccessful())\n            .catch((e) => logError(e));\n        }\n    }\n\n    @action.bound\n    onClose() {\n        this.expanded = false;\n    }\n\n}","import * as React from 'react';\nimport { observer, inject, Observer } from 'mobx-react';\n\nimport { styled } from '../../../styles';\nimport { Icon } from '../../../icons';\n\nimport { ProxyStore } from '../../../model/proxy-store';\nimport { saveFile } from '../../../util/ui';\n\nimport { StatusPill } from '../intercept-option';\nimport { PillButton } from '../../common/pill';\nimport { CopyableMonoValue } from '../../common/text-content';\n\nconst InstructionsContainer = styled.div`\n    display: flex;\n    flex-direction: row;\n    user-select: text;\n    margin-top: 5px;\n`;\n\nconst InstructionsStep = styled.div`\n    flex: 1 1 0;\n\n    &:not(:last-child) {\n        margin-right: 40px;\n    }\n\n    > h2 {\n        font-size: ${p => p.theme.headingSize};\n        margin-bottom: 10px;\n    }\n\n    > ol {\n        list-style: decimal;\n\n        > li {\n            margin-left: 20px;\n            margin-bottom: 10px;\n        }\n    }\n\n    > p {\n        line-height: 1.3;\n\n        &:not(:last-child) {\n            margin-bottom: 10px;\n        }\n    }\n\n    strong {\n        font-weight: bold;\n    }\n\n    a[href] {\n        color: ${p => p.theme.linkColor};\n\n        &:visited {\n            color: ${p => p.theme.visitedLinkColor};\n        }\n    }\n`;\n\nconst Nowrap = styled.span`\n    white-space: nowrap;\n`;\n\nconst ManualInterceptPill = inject('proxyStore')(observer(\n    (p: {\n        proxyStore?: ProxyStore,\n        children?: React.ReactNode\n    }) =>\n        <StatusPill color='#4caf7d'>\n            Proxy port: { p.proxyStore!.httpProxyPort }\n        </StatusPill>\n));\n\nconst ExportCertificateButton = styled((p: { certContent: string, className?: string }) =>\n    <PillButton\n        className={p.className}\n        onClick={() => saveFile(\n            'http-toolkit-ca-certificate.crt',\n            'application/x-x509-ca-cert',\n            p.certContent\n        )}\n    >\n        <Icon icon={['fas', 'download']} /> Export CA certificate\n    </PillButton>\n)`\n    margin: 0 0 10px 0;\n`;\n\nconst ManualInterceptConfig = inject('proxyStore')(\n    (p: {\n        proxyStore?: ProxyStore,\n        children?: React.ReactNode,\n        reportStarted: () => void\n    }) => {\n        // Report activation when first opened\n        React.useEffect(() => p.reportStarted(), []);\n\n        const { httpProxyPort, certPath, certContent } = p.proxyStore!;\n\n        return <Observer>{() =>\n            <InstructionsContainer>\n                <InstructionsStep>\n                    <p>To intercept traffic you need to:</p>\n                    <ol>\n                        <li><strong>send your traffic via the HTTP Toolkit proxy</strong></li>\n                        <li><strong>trust the certificate authority</strong> (if using HTTPS) </li>\n                    </ol>\n                    <p>\n                        The steps to do this manually depend\n                        on the client, but all the details\n                        you'll need are shown here.\n                    </p>\n                    <p>\n                        Want your client to be supported automatically? <Nowrap>\n                            <a href='https://github.com/httptoolkit/httptoolkit/issues/new'>\n                                Send some feedback\n                            </a>\n                        </Nowrap>.\n                    </p>\n                </InstructionsStep>\n\n                <InstructionsStep>\n                    <h2>1. Send traffic via HTTP Toolkit</h2>\n                    <p>\n                        To intercept an HTTP client on this machine, configure it to send traffic via{' '}\n                        <CopyableMonoValue>http://localhost:{httpProxyPort}</CopyableMonoValue>.\n                    </p>\n                    <p>\n                        Most tools can be configured to do so by using the above address as an HTTP or\n                        HTTPS proxy.\n                    </p>\n                    <p>\n                        In other cases, it's also possible to forcibly reroute traffic\n                        using networking tools like iptables.\n                    </p>\n                    <p>\n                        Remote clients (e.g. phones) will need to use the IP address of this machine, not\n                        localhost.\n                    </p>\n                </InstructionsStep>\n\n                <InstructionsStep>\n                    <h2>2. Trust the certificate authority</h2>\n                    <p><em>Only required to intercept traffic that uses HTTPS</em></p>\n                    <p>\n                        HTTP Toolkit has generated a certificate authority (CA) on your machine. All\n                        intercepted HTTPS uses certificates from this CA.\n                    </p>\n                    { certContent // Not defined in some older server versions\n                        ? <ExportCertificateButton certContent={certContent} />\n                        : <p>\n                            The certificate is stored on your machine at <CopyableMonoValue>{\n                                certPath\n                            }</CopyableMonoValue>.\n                        </p>\n                    }\n                    <p>\n                        To intercept HTTPS traffic you need to configure your HTTP client to\n                        trust this certificate as a certificate authority, or to temporarily\n                        disable certificate checks entirely.\n                    </p>\n                </InstructionsStep>\n            </InstructionsContainer>\n        }</Observer>;\n    }\n);\n\nexport const ManualInterceptCustomUi = {\n    rowHeight: 1,\n    columnWidth: 4,\n    configComponent: ManualInterceptConfig,\n    customPill: ManualInterceptPill\n};","import * as React from 'react';\n\nimport { Icon } from \"../../icons\";\nimport { styled } from '../../styles';\n\nimport { clickOnEnter } from '../component-utils';\nimport { PillButton } from './pill';\nimport { IconButton } from './icon-button';\nimport { copyToClipboard } from '../../util/ui';\n\nconst CopyIconButton = styled(IconButton)`\n    color: ${p => p.theme.mainColor};\n\n    &:hover, &:focus {\n        color: ${p => p.theme.popColor};\n        outline: none;\n    }\n\n    &:active {\n        color: ${p => p.theme.mainColor};\n    }\n`;\n\nconst useTemporaryFlag = () => {\n    const [flagResetTimer, setFlagResetTimer] = React.useState<number | undefined>();\n    const [flagged, setFlagged] = React.useState<true | undefined>();\n\n    const triggerFlag = () => {\n        setFlagged(true);\n\n        if (flagResetTimer) {\n            clearTimeout(flagResetTimer);\n            setFlagResetTimer(undefined);\n        }\n\n        setFlagResetTimer(setTimeout(() =>\n            setFlagged(undefined),\n            2000\n        ) as unknown as number);\n    }\n\n    return [flagged, triggerFlag] as const;\n}\n\nexport const CopyButtonIcon = (p: {\n    className?: string,\n    content: string,\n    onClick: () => void\n}) => {\n    const [success, showSuccess] = useTemporaryFlag();\n\n    return <CopyIconButton\n        title=\"Copy this to your clipboard\"\n        className={p.className}\n        icon={success ? ['fas', 'check'] : ['far', 'copy']}\n        fixedWidth={true}\n        onClick={() => {\n            copyToClipboard(p.content);\n            showSuccess();\n            p.onClick();\n        }}\n    />;\n}\n\nexport const CopyButtonPill = (p: { content: string, children?: React.ReactNode }) => {\n    const [success, showSuccess] = useTemporaryFlag();\n\n    return <PillButton\n        tabIndex={0}\n        onClick={() => {\n            copyToClipboard(p.content);\n            showSuccess();\n        }}\n    >\n        <Icon\n            icon={success ? ['fas', 'check'] : ['far', 'copy']}\n            fixedWidth={true}\n        />\n        { p.children }\n    </PillButton>;\n}","import * as React from 'react';\nimport { disposeOnUnmount, inject, observer } from 'mobx-react';\nimport { observable, runInAction, computed, when, action } from 'mobx';\n\nimport { styled, css } from '../../../styles';\n\nimport {\n    serverVersion,\n    versionSatisfies,\n    MULTIPLE_EXISTING_TERMINAL_RANGE\n} from '../../../services/service-versions';\n\nimport { AccountStore } from '../../../model/account/account-store';\nimport { UiStore } from '../../../model/ui/ui-store';\nimport { InterceptorStore } from '../../../model/interception/interceptor-store';\nimport { Interceptor } from '../../../model/interception/interceptors';\n\nimport { CopyButtonIcon } from '../../common/copy-button';\nimport { PillSelector } from '../../common/pill';\n\nconst CopyableCommand = styled((p: {\n    className?: string;\n    onCopy: () => void;\n    children: string;\n    disabled: boolean;\n}) =>\n    <div className={p.className}>\n        <code onCopy={p.onCopy}>\n            { p.children }\n        </code>\n        <CopyButtonIcon onClick={p.onCopy} content={p.children} />\n    </div>\n)`\n    display: inline-block;\n    margin-top: 20px;\n\n    ${p => p.disabled && css`\n        opacity: 0.5;\n        pointer-events: none;\n    `}\n\n    border: solid 1px ${p => p.theme.containerBorder};\n    background-color: ${p => p.theme.highlightBackground};\n    color: ${p => p.theme.highlightColor};\n\n    padding: 10px 75px 10px 20px;\n    border-radius: 4px;\n\n    > code {\n        font-family: ${p => p.theme.monoFontFamily};\n        user-select: all;\n    }\n\n    position: relative;\n    > button {\n        padding: 10px 20px 10px 20px;\n        position: absolute;\n        top: 0;\n        right: 0;\n        bottom: 0;\n\n        border-radius: 0 4px 4px 0;\n        border-left: solid 1px ${p => p.theme.containerBorder};\n\n        background-color: ${p => p.theme.mainLowlightBackground};\n\n        &:active {\n            background-image: linear-gradient(transparent, rgba(0,0,0,.05) 40%, rgba(0,0,0,.1));\n        }\n    }\n\n    > svg {\n        margin: 1px 0 2px;\n    }\n`;\n\nconst ConfigContainer = styled.div`\n    user-select: text;\n\n    > select {\n        display: block;\n        margin-top: 20px;\n        margin-left: 0;\n    }\n`;\n\nconst PLACEHOLDER_SHELL = \"...\";\n\ntype ShellDefinition = { command: string, description: string };\n\n@inject('interceptorStore')\n@inject('accountStore')\n@inject('uiStore')\n@observer\nclass ExistingTerminalConfig extends React.Component<{\n    interceptor: Interceptor,\n    activateInterceptor: () => Promise<{\n        port: number,\n        commands?: {\n            [shellName: string]: ShellDefinition\n        }\n    }>,\n    reportStarted: () => void,\n    reportSuccess: (options?: { showRequests?: boolean }) => void,\n    closeSelf: () => void,\n    interceptorStore?: InterceptorStore,\n    accountStore?: AccountStore,\n    uiStore?: UiStore\n}> {\n\n    @observable reportedActivated = false;\n\n    @observable shellCommands: { [shellName: string]: ShellDefinition } = {\n        // Placeholder string, similar to the default, while we wait (v briefly) for server startup:\n        [PLACEHOLDER_SHELL]: {\n            command: 'eval \"$(curl -sS localhost:..../setup)\"',\n            description: ''\n        }\n    };\n\n    @observable\n    selectedShell = PLACEHOLDER_SHELL; // Updated to first key when list of shells arrives\n\n    @computed\n    get interceptCommand() {\n        return this.shellCommands[this.selectedShell].command;\n    }\n\n    @computed\n    get shellDescription() {\n        return this.shellCommands[this.selectedShell].description;\n    }\n\n    @computed\n    get shouldShowDropdown() {\n        const multipleShellsMaybeSupported = serverVersion.state !== 'fulfilled' ||\n            versionSatisfies(serverVersion.value as string, MULTIPLE_EXISTING_TERMINAL_RANGE);\n\n        const multipleShellsMaybeAvailable = this.selectedShell === PLACEHOLDER_SHELL ||\n            Object.keys(this.shellCommands).length > 1;\n\n        // We show the dropdown unless we're sure (old server, or new server but only one shell\n        // returned) that there's only one option available.\n        return multipleShellsMaybeSupported && multipleShellsMaybeAvailable;\n    }\n\n    @action.bound\n    selectShell(shell: string) {\n        this.selectedShell = shell;\n        this.props.uiStore!.preferredShell = shell;\n    }\n\n    @action.bound\n    reportActivated() {\n        if (this.reportedActivated) return;\n\n        this.reportedActivated = true;\n        this.props.reportStarted();\n    }\n\n    async componentDidMount() {\n        const { port, commands } = await this.props.activateInterceptor();\n\n        runInAction(() => {\n            if (!commands) {\n                // Backward compat for servers that only support bash:\n                this.shellCommands = {\n                    'Bash': {\n                        command: `eval \"$(curl -sS localhost:${port}/setup)\"`,\n                        description: 'Bash-compatible'\n                    }\n                };\n            } else {\n                this.shellCommands = commands;\n            }\n\n            // Remember which shell you prefer:\n            const { preferredShell } = this.props.uiStore!;\n            if (preferredShell && preferredShell in this.shellCommands) {\n                this.selectedShell = preferredShell;\n            }\n\n            // Make sure selected shell always refers to a valid command:\n            if (!this.shellCommands[this.selectedShell]) {\n                this.selectedShell = Object.keys(this.shellCommands)[0];\n            }\n        });\n\n        if (!this.props.interceptor.isActive) {\n            // While we wait for activation, increase the interval refresh frequency\n            const intervalId = setInterval(() => {\n                this.props.interceptorStore!.refreshInterceptors()\n            }, 2000);\n            disposeOnUnmount(this, () => clearInterval(intervalId));\n\n            when(() => this.props.interceptor.isActive, () => {\n                this.reportActivated(); // Mark as activated, if it wasn't already\n                this.props.reportSuccess();\n                clearInterval(intervalId);\n            });\n        } else {\n            this.reportedActivated = true;\n        }\n    }\n\n    render() {\n        return <ConfigContainer>\n            <p>\n                Run the command below in any {this.shellDescription} terminal on this machine, to\n                immediately enable interception for all new processes started there.\n            </p>\n            { this.shouldShowDropdown\n                ? <PillSelector<string>\n                    onChange={this.selectShell}\n                    value={this.selectedShell}\n                    options={Object.keys(this.shellCommands)}\n                />\n                : null\n            }\n            <CopyableCommand\n                onCopy={this.reportActivated}\n                disabled={this.selectedShell === PLACEHOLDER_SHELL}\n            >\n                { this.interceptCommand }\n            </CopyableCommand>\n        </ConfigContainer>;\n    }\n\n}\n\nexport const ExistingTerminalCustomUi = {\n    columnWidth: 2,\n    rowHeight: 1,\n    configComponent: ExistingTerminalConfig\n};","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { observer, inject } from 'mobx-react';\n\nimport { styled } from '../../../styles';\nimport { Icon } from '../../../icons';\nimport { logError } from '../../../errors';\n\nimport { Interceptor } from '../../../model/interception/interceptors';\nimport { UiStore } from '../../../model/ui/ui-store';\nimport { DesktopApi } from '../../../services/desktop-api';\n\nimport { uploadFile } from '../../../util/ui';\nimport { Button, SecondaryButton, UnstyledButton } from '../../common/inputs';\n\nconst ConfigContainer = styled.div`\n    user-select: text;\n\n    > p {\n        line-height: 1.2;\n\n        &:not(:last-child) {\n            margin-bottom: 10px;\n        }\n    }\n\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    justify-content: start;\n`;\n\nconst Spacer = styled.div`\n    flex: 1 1 100%;\n`;\n\nconst Hr = styled.hr`\n    width: 100%;\n    margin: 0 0 10px 0;\n    border-top: solid 1px ${p => p.theme.containerBorder};\n`;\n\nconst SelectAndInterceptButton = styled(Button)`\n    font-size: ${p => p.theme.textSize};\n    font-weight: bold;\n    padding: 10px 24px;\n\n    width: 100%;\n    flex-shrink: 0;\n\n    &:not(:last-child) {\n        margin-bottom: 10px;\n    }\n`;\n\nconst RememberedOption = styled.div`\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n\n    &:not(:last-child) {\n        margin-bottom: 10px;\n    }\n\n    flex-shrink: 0;\n`;\n\nconst InterceptButton = styled(SecondaryButton)`\n    font-size: ${p => p.theme.textSize};\n    font-weight: bold;\n    padding: 10px 24px;\n\n    width: 100%;\n    word-break: break-word;\n`;\n\nconst ForgetPathButton = styled(UnstyledButton)`\n    &:hover {\n        opacity: 0.6;\n    }\n`;\n\nconst platform = navigator.platform.startsWith('Mac')\n        ? 'mac'\n    : navigator.platform.startsWith('Win')\n        ? 'win'\n    : navigator.platform.includes('Linux')\n        ? 'linux'\n    : 'unknown';\n\nfunction getWordForBinary() {\n    if (platform === 'mac') return 'application';\n    if (platform === 'win') return 'exe';\n    if (platform === 'linux') return 'binary';\n    else return 'application';\n}\n\nfunction getArticleForBinary(binaryName: string) {\n    if (binaryName[0] === 'a' || binaryName[0] === 'e') return 'an';\n    else return 'a';\n}\n\nfunction getReadablePath(path: string) {\n    if (platform === 'win') {\n        // Windows exes generally have meaningful names, so just use that\n        return _.last(path.split('\\\\'))!;\n    } else {\n        const pathParts = path.split('/').filter(\n            p => p !== 'bin' && p !== 'run' // Drop any useless generic bits\n        );\n\n        const appPart = _.find(pathParts, p => p.endsWith('.app'));\n\n        if (appPart) {\n            // For Mac apps, we drop the (normally invisible) app extension\n            return appPart.slice(0, -4);\n        } else {\n            // Otherwise it's probably a bare binary - we're dropped useless names, so this should work\n            return pathParts[pathParts.length - 1];\n        }\n    }\n}\n\n@inject('uiStore')\n@observer\nclass ElectronConfig extends React.Component<{\n    interceptor: Interceptor,\n    activateInterceptor: (options: { pathToApplication: string }) => Promise<void>,\n    reportStarted: () => void,\n    reportSuccess: (options?: { showRequests?: boolean }) => void,\n    closeSelf: () => void,\n    uiStore?: UiStore\n}> {\n\n    async componentDidMount() {\n        const { previousElectronAppPaths } = this.props.uiStore!;\n        if (previousElectronAppPaths.length === 0) {\n            this.selectApplication();\n            // Don't expand for selection, unless we're a mac (where the instructions might be useful).\n            if (platform !== 'mac') this.props.closeSelf();\n        }\n    }\n\n    selectApplication = async () => {\n        const appPicker = DesktopApi.selectApplication ?? (() => uploadFile('path'));\n\n        const pathToApplication = await(appPicker());\n\n        if (!pathToApplication) {\n            this.props.closeSelf();\n            return;\n        }\n\n        this.runApplication(pathToApplication)\n        .then(() => {\n            // Activated successfully! Add it to the list & jump to /view\n            this.props.uiStore!.rememberElectronPath(pathToApplication);\n        });\n    }\n\n    async runApplication(pathToApplication: string) {\n        const { activateInterceptor, reportStarted, reportSuccess } = this.props;\n\n        reportStarted(); // 'Started' when you pick an app, not when we ask you to pick one.\n        activateInterceptor({ pathToApplication })\n        .then(() => {\n            reportSuccess();\n        }).catch((e) => {\n            this.props.uiStore!.forgetElectronPath(pathToApplication);\n            logError(e);\n        });\n    }\n\n    render() {\n        const uiStore = this.props.uiStore!;\n        const { previousElectronAppPaths, forgetElectronPath } = uiStore;\n\n        const binary = getWordForBinary();\n        const binaryArticle = getArticleForBinary(binary);\n\n        return <ConfigContainer>\n            <p>\n                Start an Electron {binary} with HTTP Toolkit's settings injected,\n                to intercept all its HTTP &amp; HTTPS traffic.\n            </p>\n            {\n                platform === 'mac' && previousElectronAppPaths.length < 2 && <p>\n                    For .app bundles, you can intercept either the bundle\n                    (the .app directory) or the executable itself,\n                    typically stored in Contents/MacOS inside the bundle.\n                </p>\n            }\n            <p>\n                {\n                    previousElectronAppPaths.length\n                        ? `You can also rerun a previously started ${binary}, using the buttons below`\n                        : `Once you've run ${binaryArticle} ${binary}, it'll be saved and shown here so you can rerun it later`\n                }.\n            </p>\n\n            <Spacer />\n\n            <SelectAndInterceptButton onClick={this.selectApplication}>\n                Select { binaryArticle } { binary }\n            </SelectAndInterceptButton>\n\n            { previousElectronAppPaths.length > 0 && <Hr /> }\n\n            { previousElectronAppPaths.map((path) => <RememberedOption key={path}>\n                <InterceptButton title={path} onClick={() => this.runApplication(path)}>\n                    Start { getReadablePath(path) }\n                </InterceptButton>\n                <ForgetPathButton onClick={() => forgetElectronPath(path)}>\n                    <Icon icon={['fas', 'times']} />\n                </ForgetPathButton>\n            </RememberedOption>) }\n        </ConfigContainer>;\n    }\n\n}\n\nexport const ElectronCustomUi = {\n    columnWidth: 1,\n    rowHeight: 2,\n    configComponent: ElectronConfig\n};\n","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { when } from 'mobx';\nimport { observer, inject } from 'mobx-react';\nimport * as QRCode from 'qrcode.react';\nimport {\n    matchers,\n    completionCheckers\n} from 'mockttp';\n\nimport { styled } from '../../../styles';\nimport { stringToBuffer } from '../../../util';\nimport { logError } from '../../../errors';\n\nimport { Interceptor } from '../../../model/interception/interceptors';\nimport { ProxyStore } from '../../../model/proxy-store';\nimport { EventsStore } from '../../../model/events/events-store';\n\nimport {\n    MethodMatchers,\n    StaticResponseHandler\n} from '../../../model/rules/definitions/http-rule-definitions';\nimport { RulesStore } from '../../../model/rules/rules-store';\n\nconst ConfigContainer = styled.div`\n    user-select: text;\n\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    justify-content: start;\n\n    > p {\n        line-height: 1.2;\n\n        &:not(:last-child) {\n            margin-bottom: 5px;\n        }\n\n        &:not(:first-child) {\n            margin-top: 5px;\n        }\n    }\n\n    > canvas {\n        margin: 0 auto;\n        /* Without white padding, the QR code sometimes isn't scannable */\n        padding: 5px;\n        background-color: #fff;\n    }\n\n    a[href] {\n        color: ${p => p.theme.linkColor};\n\n        &:visited {\n            color: ${p => p.theme.visitedLinkColor};\n        }\n    }\n`;\n\nconst Spacer = styled.div`\n    flex: 1 1 100%;\n`;\n\nfunction urlSafeBase64(content: string) {\n    return stringToBuffer(content)\n        .toString('base64')\n        .replace(/\\+/g, '-')\n        .replace(/\\//g, '_');\n}\n\nfunction getConfigRequestIds(eventsStore: EventsStore) {\n    return eventsStore.exchanges.filter((exchange) =>\n        exchange.request.url === 'http://android.httptoolkit.tech/config'\n    ).map(e => e.id);\n}\n\nexport function setUpAndroidCertificateRule(\n    certContent: string,\n    rulesStore: RulesStore,\n    eventsStore: EventsStore,\n    onNextConfigRequest: () => void\n) {\n    rulesStore.ensureRuleExists({\n        id: 'default-android-certificate',\n        type: 'http',\n        activated: true,\n        matchers: [\n            new MethodMatchers.GET(),\n            new matchers.SimplePathMatcher(\n                \"http://android.httptoolkit.tech/config\"\n            )\n        ],\n        completionChecker: new completionCheckers.Always(),\n        handler: new StaticResponseHandler(200, undefined, JSON.stringify({\n            certificate: certContent\n        }), {\n            'content-type': 'application/json'\n        })\n    });\n\n    // When the next Android config request comes in:\n    const previousConfigRequestIds = getConfigRequestIds(eventsStore);\n    when(() =>\n        _.difference(\n            getConfigRequestIds(eventsStore),\n            previousConfigRequestIds\n        ).length > 0\n    ).then(() => {\n        // In effect, we treat this as 'success' for Android. That's not quite\n        // true: we just know the device is running the app and can connect to\n        // us, but cert setup or VPN activation could still fail in-app anyway!\n        onNextConfigRequest();\n    });\n}\n\n@inject('proxyStore')\n@inject('rulesStore')\n@inject('eventsStore')\n@observer\nclass AndroidConfig extends React.Component<{\n    proxyStore?: ProxyStore,\n    rulesStore?: RulesStore,\n    eventsStore?: EventsStore,\n\n    reportStarted: () => void,\n    reportSuccess: (options?: { showRequests?: boolean }) => void,\n    closeSelf: () => void\n\n    // Not used, but required for types:\n    interceptor: Interceptor,\n    activateInterceptor: () => Promise<void>\n}> {\n\n    async componentDidMount() {\n        const rulesStore = this.props.rulesStore!;\n        const eventsStore = this.props.eventsStore!;\n        const proxyStore = this.props.proxyStore!;\n\n        const { reportStarted, reportSuccess } = this.props;\n\n        // Just in case the network addresses have changed:\n        proxyStore.refreshNetworkAddresses().then(() => {\n            // This should never happen, but plausibly could in some edge cases, in which case we need\n            // to clearly tell the user what's going on here:\n            if (proxyStore.externalNetworkAddresses.length === 0) {\n                alert(\n                    \"Cannot activate Android interception as no network addresses could be detected.\" +\n                    \"\\n\\n\" +\n                    \"Please open an issue at github.com/httptoolkit/httptoolkit\"\n                );\n                logError(\"Android QR activation failed - no network addresses\");\n                this.props.closeSelf();\n            }\n        });\n\n        setUpAndroidCertificateRule(\n            proxyStore!.certContent!,\n            rulesStore,\n            eventsStore,\n            // Jump to requests only the first time, so it's not too inconvenient\n            // if you want to connect many devices at the same time:\n            getConfigRequestIds(eventsStore).length === 0\n                ? reportSuccess\n                : () => reportSuccess({ showRequests: false })\n        );\n\n        // We consider activate attempted once you show the QR code\n        reportStarted();\n    }\n\n    render() {\n        const {\n            certFingerprint,\n            httpProxyPort,\n            externalNetworkAddresses\n        } = this.props.proxyStore!;\n\n        const setupParams ={\n            addresses: externalNetworkAddresses,\n            port: httpProxyPort,\n            certFingerprint: certFingerprint!\n        };\n\n        const serializedSetupParams = urlSafeBase64(JSON.stringify(setupParams));\n\n        return <ConfigContainer>\n            <p>\n                Scan the QR code below on your device to install the HTTP Toolkit\n                app, and start intercepting HTTP & HTTPS traffic.\n            </p>\n            <p>\n                Don't have a barcode scanner? Install the <a\n                    href={\n                        `https://play.google.com/store/apps/details?id=tech.httptoolkit.android.v1&referrer=${\n                            serializedSetupParams\n                        }`\n                    }\n                    target='_blank'\n                    rel='noreferrer noopener'\n                >\n                    HTTP Toolkit app\n                </a> manually instead.\n            </p>\n\n            <Spacer />\n            <QRCode\n                size={160}\n                value={\n                    `https://android.httptoolkit.tech/connect/?data=${serializedSetupParams}`\n                }\n            />\n            <Spacer />\n\n            <p>\n                Once activated, this will send all HTTP & HTTPS traffic to HTTP Toolkit,\n                and configure the device to trust its HTTPS certificate by default.\n            </p>\n            <p>\n                <strong>This won't work immediately for all apps.</strong> Some may need changes\n                to trust HTTP Toolkit for HTTPS traffic. <a\n                    href=\"https://httptoolkit.com/docs/guides/android\"\n                    target='_blank'\n                    rel='noreferrer noopener'\n                >\n                    See the docs\n                </a> for more details.\n            </p>\n        </ConfigContainer>;\n    }\n\n}\n\nexport const AndroidDeviceCustomUi = {\n    columnWidth: 2,\n    rowHeight: 2,\n    configComponent: AndroidConfig\n};","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { computed, observable, action } from 'mobx';\nimport { observer, inject } from 'mobx-react';\n\nimport { styled } from '../../../styles';\n\nimport { Interceptor } from '../../../model/interception/interceptors';\nimport { ProxyStore } from '../../../model/proxy-store';\nimport { AccountStore } from '../../../model/account/account-store';\nimport { EventsStore } from '../../../model/events/events-store';\nimport { RulesStore } from '../../../model/rules/rules-store';\n\nimport { setUpAndroidCertificateRule } from './android-device-config';\n\nimport { Button } from '../../common/inputs';\nimport { Icon } from '../../../icons';\n\nconst ConfigContainer = styled.div`\n    user-select: text;\n\n    height: 100%;\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    justify-content: start;\n\n    > p {\n        line-height: 1.2;\n\n        &:not(:last-child) {\n            margin-bottom: 5px;\n        }\n\n        &:not(:first-child) {\n            margin-top: 5px;\n        }\n    }\n\n    a[href] {\n        color: ${p => p.theme.linkColor};\n\n        &:visited {\n            color: ${p => p.theme.visitedLinkColor};\n        }\n    }\n`;\n\nconst DeviceList = styled.ul`\n    display: flex;\n    flex-direction: column;\n    align-items: stretch;\n    justify-content: center;\n    height: 100%;\n`;\n\nconst AdbDevice = styled.li`\n    margin: 0 -15px -15px;\n    padding: 15px;\n`;\n\nconst AdbDeviceButton = styled(Button)`\n    font-size: ${p => p.theme.textSize};\n    font-weight: bold;\n    padding: 10px 24px;\n    width: 100%;\n\n    > svg {\n        margin-right: 10px;\n    }\n`;\n\n@inject('proxyStore')\n@inject('rulesStore')\n@inject('eventsStore')\n@inject('accountStore')\n@observer\nclass AndroidAdbConfig extends React.Component<{\n    proxyStore?: ProxyStore,\n    rulesStore?: RulesStore,\n    eventsStore?: EventsStore,\n    accountStore?: AccountStore,\n\n    interceptor: Interceptor,\n    activateInterceptor: (options: { deviceId: string }) => Promise<void>,\n    reportStarted: () => void,\n    reportSuccess: (options?: { showRequests?: boolean }) => void,\n    closeSelf: () => void\n}> {\n\n    @computed private get deviceIds(): string[] {\n        return this.props.interceptor.metadata?.deviceIds || [];\n    }\n\n    @observable private inProgressIds: string[] = [];\n\n    async componentDidMount() {\n        // If there's only one device, just connect immediately and silently\n        if (this.deviceIds.length === 1) {\n            this.interceptDevice(this.deviceIds[0]);\n            this.props.closeSelf();\n        }\n    }\n\n    render() {\n        return <ConfigContainer>\n            <p>\n                There are multiple ADB devices connected.\n            </p>\n            <p>\n                Pick which device you'd like to intercept:\n            </p>\n\n            <DeviceList>\n                { this.deviceIds.map(id => {\n                    const activating = this.inProgressIds.includes(id);\n\n                    return <AdbDevice key={id}>\n                        <AdbDeviceButton\n                            disabled={activating}\n                            onClick={activating ? _.noop : () => this.interceptDevice(id)}\n                        >\n                            {\n                                activating\n                                    ? <Icon icon={['fas', 'spinner']} spin />\n                                : id.includes(\"emulator-\")\n                                    ? <Icon icon={['far', 'window-maximize']} />\n                                : id.match(/\\d+\\.\\d+\\.\\d+\\.\\d+:\\d+/)\n                                    ? <Icon icon={['fas', 'network-wired']} />\n                                : <Icon icon={['fas', 'mobile-alt']} />\n                            }\n                            { id }\n                        </AdbDeviceButton>\n                    </AdbDevice>\n                }) }\n            </DeviceList>\n        </ConfigContainer>;\n    }\n\n    @action.bound\n    interceptDevice(deviceId: string) {\n        const {\n            inProgressIds,\n            onSuccess,\n            props: {\n                proxyStore,\n                rulesStore,\n                eventsStore,\n                reportStarted,\n                activateInterceptor\n            }\n        } = this;\n\n        // Ensure the config rule is in place before we start any activation. This listens for the\n        // next config request, and uses that to track succesful setup (by calling onSuccess).\n        setUpAndroidCertificateRule(\n            proxyStore!.certContent!,\n            rulesStore!,\n            eventsStore!,\n            onSuccess\n        );\n\n        reportStarted();\n        const activationPromise = activateInterceptor({ deviceId: deviceId });\n\n        inProgressIds.push(deviceId);\n\n        activationPromise.finally(action(() => {\n            _.pull(inProgressIds, deviceId);\n        }));\n    }\n\n    onSuccess = () => {\n        this.props.reportSuccess({\n            showRequests: this.deviceIds.length <= 1\n        });\n    };\n\n}\n\nexport const AndroidAdbCustomUi = {\n    columnWidth: 1,\n    rowHeight: 2,\n    configComponent: AndroidAdbConfig\n};","import * as React from 'react';\nimport { observer } from 'mobx-react';\nimport { observable } from 'mobx';\nimport dedent from 'dedent';\n\nimport { Interceptor } from '../../../model/interception/interceptors';\n\n@observer\nclass ExistingBrowserConfig extends React.Component<{\n    interceptor: Interceptor,\n    activateInterceptor: (\n        options: { closeConfirmed?: true },\n        shouldTrackEvent?: false\n    ) => Promise<void>,\n    reportStarted: () => void,\n    reportSuccess: (options?: { showRequests?: boolean }) => void,\n    closeSelf: () => void\n}> {\n\n    async componentDidMount() {\n        const { activateInterceptor, reportStarted, reportSuccess, closeSelf } = this.props;\n        closeSelf(); // We immediately unmount, but continue activating:\n\n        try {\n            // Try to activate, assuming the browser isn't currently open:\n            await activateInterceptor({}, false);\n\n            // Only it runs without confirmation does this count as an activation\n            reportStarted();\n        } catch (error: any) {\n            if (!error.metadata || error.metadata.closeConfirmRequired !== true) {\n                // This is a real error, not a confirmation requirement.\n\n                reportStarted(); // Track that this started, before it fails\n                throw error;\n            }\n\n            // If the browser is open, confirm that we can kill & restart it first:\n            const confirmed = confirm(dedent`\n                Your browser is currently open, and needs to be\n                restarted to enable interception. Restart it now?\n            `.replace('\\n', ' '));\n\n            // If cancelled, we silently do nothing\n            if (!confirmed) return;\n\n            reportStarted();\n            await activateInterceptor({ closeConfirmed: true });\n        }\n\n        reportSuccess();\n    }\n\n    render() {\n        return null; // This never actually displays - we just mount, confirm, and close\n    }\n\n}\n\nexport const ExistingBrowserCustomUi = {\n    columnWidth: 1,\n    rowHeight: 1,\n    configComponent: ExistingBrowserConfig\n};","import * as _ from 'lodash';\nimport * as React from 'react';\n\nimport { observer } from 'mobx-react';\n\nimport { styled } from '../../../styles';\nimport { Icon } from '../../../icons';\nimport { Button } from '../../common/inputs';\n\nconst SpinnerBlock = styled.div`\n    text-align: center;\n`;\n\nconst Spinner = styled(Icon).attrs(() => ({\n    icon: ['fas', 'spinner'],\n    spin: true,\n    size: '2x'\n}))`\n    display: block;\n    margin: 0 auto 10px;\n`;\n\nconst ListScrollContainer = styled.div`\n    max-height: 279px;\n    overflow-y: auto;\n    margin: 10px -15px;\n`;\n\nconst TargetList = styled.ul`\n    display: flex;\n    flex-direction: column;\n    align-items: stretch;\n    justify-content: center;\n`;\n\nconst Target = styled.li`\n    margin-bottom: -10px;\n    padding: 10px;\n\n    &:first-child {\n        padding-top: 0;\n    }\n\n    &:last-child {\n        padding-bottom: 0;\n        margin-bottom: 0;\n    }\n`;\n\nconst TargetButton = styled(Button)<{\n    state: 'active' | 'available' | 'activating' | 'unavailable'\n}>`\n    font-size: ${p => p.theme.textSize};\n    padding: 10px;\n    width: 100%;\n\n    display: flex;\n    align-items: center;\n\n    ${p => p.state === 'active' &&\n        '&& { background-color: #4caf7d; }'\n    }\n`;\n\nconst TargetIcon = styled(Icon)`\n    margin-right: 10px;\n`;\n\nconst TargetText = styled.span<{ ellipseDirection: 'left' | 'right' }>`\n    flex-grow: 1;\n\n    overflow: hidden;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    text-align: center;\n\n    ${p => p.ellipseDirection === 'left' ?\n        'direction: rtl;'\n    : ''}\n`;\n\ntype TargetItem<Id> = {\n    id: Id,\n    title: string,\n    content: React.ReactNode,\n    status: 'active' | 'available' | 'activating' | 'unavailable',\n};\n\n@observer\nexport class InterceptionTargetList<Id extends string | number> extends React.Component<{\n    targetName: string,\n    targets: TargetItem<Id>[],\n    interceptTarget: (id: Id) => void,\n    ellipseDirection: 'left' | 'right'\n}> {\n\n    render() {\n        const { targetName, targets, interceptTarget, ellipseDirection } = this.props;\n\n        if (targets.length === 0) {\n            return <SpinnerBlock>\n                <Spinner />\n                Looking for running { targetName } to intercept...\n            </SpinnerBlock>\n        }\n\n        return <ListScrollContainer>\n            <TargetList>\n                { _.map(targets, (target: TargetItem<Id>) => <Target key={target.id}>\n                    <TargetButton\n                        title={target.title}\n                        state={target.status}\n                        disabled={target.status !== 'available'}\n                        onClick={target.status === 'available'\n                            ? () => interceptTarget(target.id)\n                            : _.noop\n                        }\n                    >\n                        {\n                            target.status === 'activating'\n                                ? <TargetIcon icon={['fas', 'spinner']} spin />\n                            : target.status === 'active'\n                                ? <TargetIcon icon={['fas', 'check']} />\n                            : null\n                        }\n                        <TargetText ellipseDirection={ellipseDirection}>\n                            { target.content }\n                        </TargetText>\n                    </TargetButton>\n                </Target>) }\n            </TargetList>\n        </ListScrollContainer>;\n    }\n}","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { observable, action, flow } from 'mobx';\nimport { observer, inject, disposeOnUnmount } from 'mobx-react';\n\nimport { styled } from '../../../styles';\n\nimport { Interceptor } from '../../../model/interception/interceptors';\nimport { ProxyStore } from '../../../model/proxy-store';\n\nimport { getDetailedInterceptorMetadata } from '../../../services/server-api';\nimport { InterceptionTargetList } from './intercept-target-list';\n\ntype JvmTarget = { pid: string, name: string, interceptedByProxy: number | undefined };\n\n@inject('proxyStore')\n@observer\nclass JvmConfig extends React.Component<{\n    proxyStore?: ProxyStore,\n\n    interceptor: Interceptor,\n    activateInterceptor: (options: { targetPid: string }) => Promise<void>,\n    reportStarted: () => void,\n    reportSuccess: (options?: { showRequests?: boolean }) => void,\n    closeSelf: () => void\n}> {\n\n    @observable.shallow\n    private jvmTargets: _.Dictionary<JvmTarget> = {};\n\n    updateTargets = flow(function * (this: JvmConfig) {\n        const result: {\n            jvmTargets?: _.Dictionary<JvmTarget>\n        } | undefined = (\n            yield getDetailedInterceptorMetadata(\"attach-jvm\")\n        );\n        this.jvmTargets = result?.jvmTargets ?? {};\n    }.bind(this));\n\n    @observable\n    private inProgressPids: string[] = [];\n\n    componentDidMount() {\n        this.updateTargets();\n        const updateInterval = setInterval(this.updateTargets, 2000);\n        disposeOnUnmount(this, () => clearInterval(updateInterval));\n    }\n\n    render() {\n        const interestingTargets = Object.values(this.jvmTargets).filter((target) =>\n            // Maven-launched processes have a wrapper, which is never interesting:\n            !target.name.startsWith(\"org.apache.maven.wrapper.MavenWrapperMain \")\n        );\n\n        const proxyPort = this.props.proxyStore!.httpProxyPort;\n\n        return <ConfigContainer>\n            <p>\n                Pick which JVM process you'd like to intercept:\n            </p>\n\n            <InterceptionTargetList<string>\n                targetName='JVM processes'\n                interceptTarget={this.interceptTarget}\n                ellipseDirection='left'\n                targets={interestingTargets.map((target) => {\n                    const activating = this.inProgressPids.includes(target.pid);\n                    const alreadyIntercepted = target.interceptedByProxy !== undefined;\n                    const interceptedByUs = target.interceptedByProxy === proxyPort;\n\n                    const targetName = target.name.split(' ')[0];\n\n                    const isClassName = !targetName.includes('/') &&\n                        !targetName.includes('\\\\');\n\n                    let contextName: string;\n                    let mainName: string;\n\n                    if (isClassName) {\n                        const [className, ...packageParts] = targetName.split('.').reverse();\n                        const packageName = packageParts.reverse().join('.');\n\n                        contextName = packageName ? packageName + '.' : '';\n                        mainName = className;\n                    } else {\n                        const [filePath, ...dirParts] = targetName.split(/\\/|\\\\/).reverse();\n                        const dirPath = dirParts.reverse().join('/');\n                        contextName = dirPath ? dirPath + '/' : '';\n                        mainName = filePath;\n                    }\n\n                    return {\n                        id: target.pid,\n                        title: target.name,\n                        status:\n                            activating\n                                ? 'activating'\n                            : interceptedByUs\n                                ? 'active'\n                            : alreadyIntercepted\n                                ? 'unavailable'\n                            : 'available',\n                        content: <>\n                            <PackageName>{ contextName }</PackageName>\n                            <ClassName>{ mainName }</ClassName>\n                        </>,\n                    };\n                })}\n            />\n\n            <Footer>\n                You can also launch JVM processes from an intercepted\n                terminal, where they'll be intercepted automatically.\n            </Footer>\n        </ConfigContainer>;\n    }\n\n    @action.bound\n    interceptTarget(pid: string) {\n        const {\n            inProgressPids,\n            props: {\n                reportStarted,\n                activateInterceptor,\n                proxyStore\n            }\n        } = this;\n\n        reportStarted();\n        const activationPromise = activateInterceptor({ targetPid: pid });\n        activationPromise.then(() => {\n            // Optimistically update the UI's success state\n            const target = this.jvmTargets[pid];\n            if (target) {\n                target.interceptedByProxy = proxyStore!.httpProxyPort;\n            }\n\n            this.props.reportSuccess({\n                // Don't jump to view, because there's often not immediately visible traffic\n                // anyway, and you may well want to intercept multiple targets.\n                showRequests: false\n            });\n        });\n\n        inProgressPids.push(pid);\n\n        activationPromise.finally(action(() => {\n            _.pull(inProgressPids, pid);\n        }));\n    }\n\n}\n\nconst ConfigContainer = styled.div`\n    user-select: text;\n\n    height: 100%;\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n\n    > p {\n        line-height: 1.2;\n\n        &:not(:last-child) {\n            margin-bottom: 5px;\n        }\n\n        &:not(:first-child) {\n            margin-top: 5px;\n        }\n    }\n\n    a[href] {\n        color: ${p => p.theme.linkColor};\n\n        &:visited {\n            color: ${p => p.theme.visitedLinkColor};\n        }\n    }\n`;\n\nconst Footer = styled.p`\n    font-size: 85%;\n    font-style: italic;\n`;\n\nconst PackageName = styled.span`\n    opacity: 0.6;\n`;\n\nconst ClassName = styled.span`\n    font-weight: bold;\n`;\n\nexport const JvmCustomUi = {\n    columnWidth: 1,\n    rowHeight: 2,\n    configComponent: JvmConfig\n};","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { observable, action, flow } from 'mobx';\nimport { observer, inject, disposeOnUnmount } from 'mobx-react';\n\nimport { styled } from '../../../styles';\n\nimport { Interceptor } from '../../../model/interception/interceptors';\nimport { ProxyStore } from '../../../model/proxy-store';\n\nimport { getDetailedInterceptorMetadata } from '../../../services/server-api';\n\nimport { InterceptionTargetList } from './intercept-target-list';\n\nconst ConfigContainer = styled.div`\n    user-select: text;\n\n    height: 100%;\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n\n    > p {\n        line-height: 1.2;\n\n        &:not(:last-child) {\n            margin-bottom: 5px;\n        }\n\n        &:not(:first-child) {\n            margin-top: 5px;\n        }\n    }\n\n    a[href] {\n        color: ${p => p.theme.linkColor};\n\n        &:visited {\n            color: ${p => p.theme.visitedLinkColor};\n        }\n    }\n`;\n\nconst Footer = styled.p`\n    font-size: 85%;\n    font-style: italic;\n`;\n\ntype ContainerTarget = {\n    id: string,\n    names: string[],\n    labels: { [key: string]: string },\n    image: string\n};\n\nconst CONTAINER_PROXY_LABEL = \"tech.httptoolkit.docker.proxy\";\n\n@inject('proxyStore')\n@observer\nclass DockerAttachConfig extends React.Component<{\n    proxyStore?: ProxyStore,\n\n    interceptor: Interceptor,\n    activateInterceptor: (options: { containerId: string }) => Promise<void>,\n    reportStarted: () => void,\n    reportSuccess: (options?: { showRequests?: boolean }) => void,\n    closeSelf: () => void\n}> {\n\n    @observable.shallow\n    private targets: _.Dictionary<ContainerTarget> = {};\n\n    updateTargets = flow(function * (this: DockerAttachConfig) {\n        const result: {\n            targets?: _.Dictionary<ContainerTarget>\n        } | undefined = (\n            yield getDetailedInterceptorMetadata(\"docker-attach\")\n        );\n        this.targets = result?.targets ?? {};\n    }.bind(this));\n\n    @observable\n    private inProgressIds: string[] = [];\n\n    componentDidMount() {\n        this.updateTargets();\n        const updateInterval = setInterval(this.updateTargets, 2000);\n        disposeOnUnmount(this, () => clearInterval(updateInterval));\n    }\n\n    render() {\n        const proxyPort = this.props.proxyStore!.httpProxyPort;\n        const targets = Object.values(this.targets)\n            .filter(target =>\n                !target.image.startsWith('httptoolkit/docker-socks-tunnel')\n            );\n\n        return <ConfigContainer>\n            <p>\n                Pick a container to restart it with all traffic intercepted:\n            </p>\n\n            <InterceptionTargetList<string>\n                targetName='Docker containers'\n                interceptTarget={this.interceptTarget}\n                ellipseDirection='right'\n                targets={targets.map((target) => {\n                    const activating = this.inProgressIds.includes(target.id);\n                    const interceptedByUs = target.labels[CONTAINER_PROXY_LABEL] === proxyPort.toString();\n\n                    // Container names are more or less alphanumeric, but internally have a normally\n                    // hidden slash: https://github.com/moby/moby/issues/6705. We hide that too.\n                    const containerName = target.names[0]?.replace(/^\\//, '') || target.id.slice(0, 8);\n\n                    const containerDescription = target.id.startsWith(containerName)\n                        ? `'${containerName}'`\n                        : `'${containerName}' (${target.id.slice(0, 8)})`\n\n                    return {\n                        id: target.id,\n                        title: `Container ${containerDescription}, from image '${target.image}'`,\n                        status:\n                            activating\n                                ? 'activating'\n                            : interceptedByUs\n                                ? 'active'\n                            : 'available', // <-- We allow intercepting containers already intercepted elsewhere\n                        content: <>\n                            <ContainerName>{ containerName }</ContainerName>\n                            <ImageName>{ target.image }</ImageName>\n                        </>,\n                    };\n                })}\n            />\n\n            <Footer>\n                You can also create Docker containers from an intercepted\n                terminal, where they'll be intercepted automatically.\n            </Footer>\n        </ConfigContainer>;\n    }\n\n    @action.bound\n    interceptTarget(containerId: string) {\n        const {\n            inProgressIds,\n            props: {\n                reportStarted,\n                activateInterceptor,\n                proxyStore\n            }\n        } = this;\n\n        reportStarted();\n        const activationPromise = activateInterceptor({ containerId: containerId });\n        activationPromise.then(() => {\n            // Optimistically update the UI's success state\n            const target = this.targets[containerId];\n            if (target) {\n                target.labels[CONTAINER_PROXY_LABEL] = proxyStore!.httpProxyPort.toString();\n            }\n\n            this.props.reportSuccess({\n                // Don't jump to view, because there's often not immediately visible traffic\n                // anyway, and you may well want to intercept multiple targets.\n                showRequests: false\n            });\n        });\n\n        inProgressIds.push(containerId);\n\n        activationPromise.finally(action(() => {\n            _.pull(inProgressIds, containerId);\n        }));\n    }\n\n}\n\nconst ContainerName = styled.div`\n    font-weight: bold;\n`;\n\nconst ImageName = styled.div`\n    opacity: 0.6;\n`;\n\n\nexport const DockerAttachCustomUi = {\n    columnWidth: 1,\n    rowHeight: 2,\n    configComponent: DockerAttachConfig\n};","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { inject, observer } from 'mobx-react';\nimport { when } from 'mobx';\n\nimport { Interceptor } from '../../../model/interception/interceptors';\nimport { EventsStore } from '../../../model/events/events-store';\nimport { SourceIcons } from '../../../icons';\n\n@inject('eventsStore')\n@observer\nclass ManualIOSConfig extends React.Component<{\n    eventsStore?: EventsStore,\n\n    interceptor: Interceptor,\n\n    activateInterceptor: () => Promise<void>,\n    reportStarted: () => void,\n    reportSuccess: (options?: { showRequests?: boolean }) => void,\n    closeSelf: () => void\n}> {\n\n    async componentDidMount() {\n        const { eventsStore, reportStarted, reportSuccess, closeSelf } = this.props;\n        closeSelf(); // We immediately unmount, but continue activating:\n\n        // Open the manual setup docs page:\n        window.open(\n            \"https://httptoolkit.com/docs/guides/ios/\",\n            \"_blank\",\n            \"noreferrer noopener\"\n        );\n\n        reportStarted();\n\n        // When we receive the next iOS-appearing request, we consider this as successful\n        // and then jump to the View page:\n        const previousIOSRequestIds = getIOSRequestIds(eventsStore!);\n        when(() =>\n            _.difference(\n                getIOSRequestIds(eventsStore!),\n                previousIOSRequestIds\n            ).length > 0\n        ).then(() => {\n            reportSuccess()\n        });\n    }\n\n    render() {\n        return null; // This never actually displays - we just mount, open the page, and close\n    }\n\n}\n\nfunction getIOSRequestIds(eventsStore: EventsStore) {\n    return eventsStore.exchanges.filter((exchange) =>\n        _.isEqual(exchange.request.source.icon, SourceIcons.iOS)\n    ).map(e => e.id);\n}\n\nexport const ManualIOSCustomUi = {\n    columnWidth: 1,\n    rowHeight: 1,\n    configComponent: ManualIOSConfig\n};","import * as _ from \"lodash\";\n\nimport { ServerInterceptor } from \"../../services/server-api\";\nimport {\n    versionSatisfies,\n    DETAILED_CONFIG_RANGE,\n    WEBRTC_GLOBALLY_ENABLED\n} from \"../../services/service-versions\";\nimport { IconProps, SourceIcons } from \"../../icons\";\nimport { AccountStore } from \"../account/account-store\";\n\nimport { InterceptorCustomUiConfig } from \"../../components/intercept/intercept-option\";\nimport { ManualInterceptCustomUi } from \"../../components/intercept/config/manual-intercept-config\";\nimport { ExistingTerminalCustomUi } from \"../../components/intercept/config/existing-terminal-config\";\nimport { ElectronCustomUi } from '../../components/intercept/config/electron-config';\nimport { AndroidDeviceCustomUi } from \"../../components/intercept/config/android-device-config\";\nimport { AndroidAdbCustomUi } from \"../../components/intercept/config/android-adb-config\";\nimport { ExistingBrowserCustomUi } from \"../../components/intercept/config/existing-browser-config\";\nimport { JvmCustomUi } from \"../../components/intercept/config/jvm-config\";\nimport { DockerAttachCustomUi } from \"../../components/intercept/config/docker-attach-config\";\nimport { ManualIOSCustomUi } from \"../../components/intercept/config/manual-ios-config\";\n\ninterface InterceptorConfig {\n    name: string;\n    description: string[];\n    iconProps: IconProps | Array<IconProps>;\n    tags: string[];\n    inProgress?: boolean;\n    clientOnly?: true;\n    checkRequirements?: (options: {\n        interceptorVersion: string,\n        accountStore: AccountStore,\n        serverVersion?: string\n    }) => boolean;\n    uiConfig?: InterceptorCustomUiConfig;\n    getActivationOptions?: (options: {\n        accountStore: AccountStore,\n        serverVersion?: string\n    }) => unknown;\n    notAvailableHelpUrl?: string;\n}\n\nexport type Interceptor =\n    Pick<ServerInterceptor, Exclude<keyof ServerInterceptor, 'version'>> &\n    InterceptorConfig &\n    { version?: string, isSupported: boolean, activationOptions: unknown | undefined };\n\nconst BROWSER_TAGS = ['browsers', 'web', 'pwa'];\nconst JVM_TAGS = ['jvm', 'java', 'scala', 'kotlin', 'clojure', 'groovy'];\nconst MOBILE_TAGS = ['mobile', 'phone', 'app'];\nconst ANDROID_TAGS = ['samsung', 'galaxy', 'nokia', 'lg', 'android', 'google', 'motorola', ...JVM_TAGS];\nconst IOS_TAGS = ['apple', 'ios', 'iphone', 'ipad'];\nconst DOCKER_TAGS = ['bridge', 'services', 'images'];\nconst TERMINAL_TAGS = ['command line', 'cli', 'docker', 'bash', 'cmd', 'shell', 'php', 'ruby', 'node', 'js', ...JVM_TAGS];\n\nconst androidInterceptIconProps = _.assign({\n    style: { transform: 'translateY(32px)' }\n}, SourceIcons.Android);\n\nconst recoloured = (icon: IconProps, color: string) => ({ ...icon, color });\n\nexport const MANUAL_INTERCEPT_ID = 'manual-setup';\n\nconst getChromiumOptions = ({ accountStore, serverVersion }: {\n    accountStore: AccountStore,\n    serverVersion?: string\n}) => ({\n    webExtensionEnabled: accountStore.featureFlags.includes('webrtc') ||\n        versionSatisfies(serverVersion || '', WEBRTC_GLOBALLY_ENABLED)\n});\n\nconst INTERCEPT_OPTIONS: _.Dictionary<InterceptorConfig> = {\n    'docker-attach': {\n        name: 'Attach to Docker Container',\n        description: [\"Intercept all traffic from running Docker containers\"],\n        uiConfig: DockerAttachCustomUi,\n        iconProps: SourceIcons.Docker,\n        tags: DOCKER_TAGS\n    },\n    'fresh-chrome': {\n        name: 'Chrome',\n        description: [\"Intercept a fresh independent Chrome window\"],\n        iconProps: SourceIcons.Chrome,\n        tags: BROWSER_TAGS,\n        getActivationOptions: getChromiumOptions\n    },\n    'existing-chrome': {\n        name: 'Global Chrome',\n        description: [\n            \"Intercept your main Chrome profile globally\",\n            \"This captures all default Chrome traffic, so may interfere with normal usage\"\n        ],\n        uiConfig: ExistingBrowserCustomUi,\n        iconProps: [\n            SourceIcons.Chrome,\n            { icon: ['fas', 'globe'], color: '#fafafa', size: '2x' }\n        ],\n        tags: BROWSER_TAGS,\n        getActivationOptions: getChromiumOptions\n    },\n    'fresh-chrome-beta': {\n        name: 'Chrome (Beta)',\n        description: [\"Intercept a fresh independent Chrome window\"],\n        iconProps: recoloured(SourceIcons.Chrome, '#DB4437'),\n        tags: BROWSER_TAGS,\n        getActivationOptions: getChromiumOptions\n    },\n    'fresh-chrome-dev': {\n        name: 'Chrome (Dev)',\n        description: [\"Intercept a fresh independent Chrome window\"],\n        iconProps: recoloured(SourceIcons.Chrome, '#74929f'),\n        tags: BROWSER_TAGS,\n        getActivationOptions: getChromiumOptions\n    },\n    'fresh-chrome-canary': {\n        name: 'Chrome (Canary)',\n        description: [\"Intercept a fresh independent Chrome window\"],\n        iconProps: recoloured(SourceIcons.Chrome, '#e8ab01'),\n        tags: BROWSER_TAGS,\n        getActivationOptions: getChromiumOptions\n    },\n    'fresh-chromium': {\n        name: 'Chromium',\n        description: [\"Intercept a fresh independent Chromium window\"],\n        iconProps: SourceIcons.Chromium,\n        tags: BROWSER_TAGS,\n        getActivationOptions: getChromiumOptions\n    },\n    'fresh-chromium-dev': {\n        name: 'Chromium (Dev)',\n        description: [\"Intercept a fresh independent Chromium window\"],\n        iconProps: recoloured(SourceIcons.Chromium, '#74929f'),\n        tags: BROWSER_TAGS,\n        getActivationOptions: getChromiumOptions\n    },\n    'fresh-brave': {\n        name: 'Brave',\n        description: [\"Intercept a fresh independent Brave window\"],\n        iconProps: SourceIcons.Brave,\n        tags: BROWSER_TAGS,\n        getActivationOptions: getChromiumOptions\n    },\n    'fresh-firefox': {\n        name: 'Firefox',\n        description: [\"Intercept a fresh independent Firefox window\"],\n        iconProps: SourceIcons.Firefox,\n        tags: BROWSER_TAGS,\n        checkRequirements: ({ interceptorVersion }) => {\n            return versionSatisfies(interceptorVersion, \"^1.1.0\")\n        },\n    },\n    'existing-arc': {\n        name: 'Global Arc Browser',\n        description: [\n            \"Intercept Arc Browser globally on this machine\",\n            \"This captures all Arc traffic, so may interfere with normal usage\"\n        ],\n        iconProps: SourceIcons.Arc,\n        tags: BROWSER_TAGS,\n        getActivationOptions: getChromiumOptions,\n        checkRequirements: ({ accountStore }) =>\n            accountStore.featureFlags.includes('arc-browser')\n    },\n    'fresh-safari': {\n        name: 'Safari',\n        description: [\"Intercept a fresh independent Safari window\"],\n        iconProps: SourceIcons.Safari,\n        tags: BROWSER_TAGS\n    },\n    'fresh-edge': {\n        name: 'Edge',\n        description: [\"Intercept a fresh independent Edge window\"],\n        iconProps: SourceIcons.Edge,\n        tags: BROWSER_TAGS,\n        getActivationOptions: getChromiumOptions\n    },\n    'fresh-edge-beta': {\n        name: 'Edge (Beta)',\n        description: [\"Intercept a fresh independent Edge window\"],\n        iconProps: recoloured(SourceIcons.Edge, '#50e6ff'),\n        tags: BROWSER_TAGS,\n        getActivationOptions: getChromiumOptions\n    },\n    'fresh-edge-dev': {\n        name: 'Edge (Dev)',\n        description: [\"Intercept a fresh independent Edge window\"],\n        iconProps: recoloured(SourceIcons.Edge, '#74929f'),\n        tags: BROWSER_TAGS,\n        getActivationOptions: getChromiumOptions\n    },\n    'fresh-edge-canary': {\n        name: 'Edge (Canary)',\n        description: [\"Intercept a fresh independent Edge window\"],\n        iconProps: recoloured(SourceIcons.Edge, '#ffc225'),\n        tags: BROWSER_TAGS,\n        getActivationOptions: getChromiumOptions\n    },\n    'fresh-opera': {\n        name: 'Opera',\n        description: [\"Intercept a fresh independent Opera window\"],\n        iconProps: SourceIcons.Opera,\n        tags: BROWSER_TAGS,\n        checkRequirements: ({ interceptorVersion }) => {\n            return versionSatisfies(interceptorVersion, \"^1.0.3\")\n        },\n        getActivationOptions: getChromiumOptions\n    },\n    'attach-jvm': {\n        name: 'Attach to JVM',\n        description: [\n            'Attach to any local running JVM process, including Java, Kotlin & Clojure'\n        ],\n        iconProps: SourceIcons.Java,\n        uiConfig: JvmCustomUi,\n        tags: JVM_TAGS\n    },\n    'fresh-terminal': {\n        name: 'Fresh Terminal',\n        description: [\"Open a new terminal that intercepts all processes & Docker containers\"],\n        iconProps: SourceIcons.Terminal,\n        tags: TERMINAL_TAGS\n    },\n    'existing-terminal': {\n        name: 'Existing Terminal',\n        description: [\"Intercept all launched processes & Docker containers from an existing terminal window\"],\n        iconProps: recoloured(SourceIcons.Terminal, '#dd44dd'),\n        uiConfig: ExistingTerminalCustomUi,\n        tags: TERMINAL_TAGS\n    },\n    'android-adb': {\n        name: 'Android Device via ADB',\n        description: [\n            'Intercept an Android device or emulator connected to ADB',\n            'Automatically injects system HTTPS certificates into rooted devices & most emulators'\n        ],\n        notAvailableHelpUrl: 'https://httptoolkit.com/docs/guides/android/#android-device-via-adb-interception-option-is-not-available',\n        iconProps: androidInterceptIconProps,\n        checkRequirements: ({ serverVersion }) => {\n            return versionSatisfies(serverVersion || '', DETAILED_CONFIG_RANGE);\n        },\n        uiConfig: AndroidAdbCustomUi,\n        tags: [...MOBILE_TAGS, ...ANDROID_TAGS, 'emulator', 'root', 'adb']\n    },\n    'android-device': {\n        name: 'Android Device via QR code',\n        description: [\n            'Intercept any Android device on your network',\n            'Manual setup required for HTTPS in some apps'\n        ],\n        iconProps: recoloured(androidInterceptIconProps, '#4285F4'),\n        checkRequirements: ({ serverVersion }) => {\n            return versionSatisfies(serverVersion || '', DETAILED_CONFIG_RANGE);\n        },\n        clientOnly: true,\n        uiConfig: AndroidDeviceCustomUi,\n        tags: [...MOBILE_TAGS, ...ANDROID_TAGS]\n    },\n    'manual-ios-device': {\n        name: 'iOS via Manual Setup',\n        description: [\"Manually intercept all HTTP and HTTPS traffic from any iPhone or iPad\"],\n        iconProps: SourceIcons.iOS,\n        clientOnly: true,\n        uiConfig: ManualIOSCustomUi,\n        tags: [...MOBILE_TAGS, ...IOS_TAGS]\n    },\n    'ios-device': {\n        name: 'Automatic iOS Device Setup',\n        description: [\"Intercept all HTTP traffic from an iOS device on your network\"],\n        iconProps: SourceIcons.iOS,\n        tags: [...MOBILE_TAGS, ...IOS_TAGS]\n    },\n    'network-device': {\n        name: 'A Device on Your Network',\n        description: [\"Intercept all HTTP traffic from another device on your network\"],\n        iconProps: SourceIcons.Network,\n        tags: [...MOBILE_TAGS, ...IOS_TAGS, ...ANDROID_TAGS, 'lan', 'arp', 'wifi']\n    },\n    'virtualbox-machine': {\n        name: 'A Virtualbox VM',\n        description: [\"Intercept all traffic from a Virtualbox VM\"],\n        iconProps: SourceIcons.Desktop,\n        tags: ['virtual machine', 'vagrant']\n    },\n    'system-proxy': {\n        name: 'Everything',\n        description: [\"Intercept all HTTP traffic on this machine\"],\n        iconProps: SourceIcons.Desktop,\n        tags: ['local', 'machine', 'system', 'me']\n    },\n    'electron': {\n        name: 'Electron Application',\n        description: [\"Launch an Electron application with all its traffic intercepted\"],\n        iconProps: SourceIcons.Electron,\n        uiConfig: ElectronCustomUi,\n        tags: ['electron', 'desktop', 'postman']\n    },\n    [MANUAL_INTERCEPT_ID]: {\n        name: 'Anything',\n        description: [\"Manually configure any source using the proxy settings and CA certificate\"],\n        iconProps: SourceIcons.Unknown,\n        clientOnly: true,\n        uiConfig: ManualInterceptCustomUi,\n        tags: []\n    }\n};\n\nexport function getInterceptOptions(\n    serverInterceptorArray: ServerInterceptor[],\n    accountStore: AccountStore,\n    serverVersion?: string\n) {\n    const serverInterceptors = _.keyBy(serverInterceptorArray, 'id');\n\n    return _.mapValues(INTERCEPT_OPTIONS, (option, id) => {\n        if (\n            // If we need a server interceptor & it's not present\n            (!option.clientOnly && !serverInterceptors[id]) ||\n            // Or if we're missing other requirement (specific server version,\n            // feature flags, etc)\n            (option.checkRequirements && !option.checkRequirements({\n                interceptorVersion: (serverInterceptors[id] || {}).version,\n                accountStore,\n                serverVersion\n            }))\n        ) {\n            // The UI knows about this interceptor, but we can't use it for some reason.\n            return _.assign({}, option, {\n                id: id,\n                isSupported: false,\n                isActive: false,\n                isActivable: false,\n                activationOptions: undefined\n            });\n        } else if (option.clientOnly) {\n            // Some interceptors don't need server support at all, so as long as the requirements\n            // are fulfilled, they're always supported & activable (e.g. manual setup guide).\n            return _.assign({}, option, {\n                id: id,\n                isSupported: true,\n                isActive: false,\n                isActivable: true,\n                activationOptions: option.getActivationOptions\n                    ? option.getActivationOptions({\n                        accountStore,\n                        serverVersion\n                    })\n                    : undefined\n            });\n        } else {\n            // For everything else: the UI & server supports this, we let the server tell us\n            // if it's activable/currently active.\n            const serverInterceptor = serverInterceptors[id];\n\n            return _.assign({}, option, serverInterceptor, {\n                id,\n                isSupported: true,\n                activationOptions: option.getActivationOptions\n                    ? option.getActivationOptions({\n                        accountStore,\n                        serverVersion\n                    })\n                    : undefined\n            });\n        }\n    });\n}\n","import { observable, runInAction, flow, action } from \"mobx\";\n\nimport { lazyObservablePromise } from \"../../util/observable\";\n\nimport { ProxyStore } from \"../proxy-store\";\nimport { AccountStore } from \"../account/account-store\";\n\nimport { getInterceptors, activateInterceptor } from \"../../services/server-api\";\nimport { serverVersion as serverVersionPromise } from '../../services/service-versions';\nimport { Interceptor, getInterceptOptions } from \"./interceptors\";\n\nexport class InterceptorStore {\n\n    constructor(\n        private proxyStore: ProxyStore,\n        private accountStore: AccountStore\n    ) {\n        this.interceptors = getInterceptOptions([], accountStore);\n    }\n\n    readonly initialized = lazyObservablePromise(async () => {\n        await Promise.all([\n            this.proxyStore.initialized,\n            this.accountStore.initialized\n        ]);\n\n        await this.refreshInterceptors();\n\n        const refreshInterceptorInterval = setInterval(() =>\n            this.refreshInterceptors()\n        , 10000);\n\n        window.addEventListener('beforeunload', () => {\n            clearInterval(refreshInterceptorInterval);\n        });\n\n        console.log('Interceptor store initialized');\n    });\n\n    @observable interceptors: _.Dictionary<Interceptor>;\n\n    async refreshInterceptors() {\n        const serverInterceptors = await getInterceptors(this.proxyStore.httpProxyPort);\n        const serverVersion = await serverVersionPromise;\n\n        runInAction(() => {\n            const supportedInterceptors = getInterceptOptions(\n                serverInterceptors,\n                this.accountStore,\n                serverVersion\n            );\n\n            // Quick patch for a bug in existing-chrome for server <= 1.1.2 which incorrectly\n            // always reports existing Chrome as activable:\n            if (\n                !supportedInterceptors['fresh-chrome'].isActivable &&\n                supportedInterceptors['existing-chrome'].isActivable\n            ) {\n                supportedInterceptors['existing-chrome'].isActivable = false;\n            }\n\n            this.interceptors = supportedInterceptors;\n        });\n    }\n\n    @action.bound\n    activateInterceptor = (interceptorId: string, options?: any): Promise<unknown | true> => {\n        this.interceptors[interceptorId].inProgress = true;\n\n        return activateInterceptor(\n            interceptorId,\n            this.proxyStore.httpProxyPort,\n            options\n        ).then(\n            (metadata) => metadata || true\n        ).finally(action(() => {\n            this.interceptors[interceptorId].inProgress = false;\n            this.refreshInterceptors();\n        }));\n    };\n}","import * as _ from 'lodash';\nimport { observable, observe, computed } from \"mobx\";\nimport * as localForage from 'localforage';\nimport * as serializr from 'serializr';\nimport { findApi as findPublicOpenApi } from 'openapi-directory';\n\nimport { HtkRequest } from '../../types';\nimport { logError } from '../../errors';\nimport { lazyObservablePromise } from \"../../util/observable\";\nimport { hydrate, persist } from \"../../util/mobx-persist/persist\";\n\nimport { AccountStore } from \"../account/account-store\";\nimport { ApiMetadata, ApiSpec } from \"./api-interfaces\";\nimport { buildApiMetadataAsync } from '../../services/ui-worker-api';\nimport { matchOpenApiOperation } from './openapi';\nimport { serializeRegex, serializeMap } from '../serialization';\n\nasync function fetchApiMetadata(specId: string): Promise<ApiSpec> {\n    const specResponse = await fetch(`/api/${specId}.json`);\n    return specResponse.json();\n}\n\nconst apiMetadataSchema = serializr.createSimpleSchema({\n    spec: serializr.raw(),\n    serverMatcher: serializeRegex,\n    requestMatchers: serializeMap(\n        serializr.object(\n            serializr.createSimpleSchema({\n                pathMatcher: serializeRegex,\n                queryMatcher: serializr.raw()\n            })\n        ),\n        serializr.custom(\n            ({ path }: { path: string }) => path,\n            (path: string, context: serializr.Context) => ({\n                path,\n                pathSpec: context.json.spec.paths[path]\n            })\n        )\n    )\n});\n\n// In addition to the public OpenAPI directory, we have a few extra APIs (stored in\n// this repo in /extra-apis) that we match seprately:\nconst EXTRA_APIS: { [urlPrefix: string]: 'ipfs' | 'ethereum' } = {\n    // See the 'servers' field in /extra-apis/ipfs.json:\n    'localhost:5001/api/v0': 'ipfs',\n    '127.0.0.1:5001/api/v0': 'ipfs',\n    'localhost:5002/api/v0': 'ipfs',\n    '127.0.0.1:5002/api/v0': 'ipfs',\n    'ipfs.infura.io:5001/api/v0': 'ipfs',\n\n    // See the 'servers' field in /extra-apis/ethereum.json:\n    'localhost:8545/': 'ethereum',\n    '127.0.0.1:8545/': 'ethereum',\n    'mainnet.': 'ethereum',\n    'ropsten.': 'ethereum',\n    'rinkeby.': 'ethereum',\n    'kovan.': 'ethereum',\n    'goerli.': 'ethereum',\n    'mainnet-': 'ethereum',\n    'web3.ens.domains/v1/mainnet': 'ethereum'\n};\n\nfunction findPublicApi(url: string) {\n    const openApiId = findPublicOpenApi(url);\n\n    if (openApiId) return openApiId;\n\n    const matchingExtraApiKey = Object.keys(EXTRA_APIS)\n        .find((apiPrefix) => url.startsWith(apiPrefix));\n\n    if (matchingExtraApiKey) return EXTRA_APIS[matchingExtraApiKey];\n    else return undefined;\n}\n\nexport class ApiStore {\n\n    constructor(\n        private accountStore: AccountStore\n    ) { }\n\n    readonly initialized = lazyObservablePromise(async () => {\n        await this.accountStore.initialized;\n\n        // Every time the user account data is updated from the server, consider resetting\n        // paid settings to the free defaults. This ensures that they're reset on\n        // logout & subscription expiration (even if that happened while the app was\n        // closed), but don't get reset when the app starts with stale account data.\n        observe(this.accountStore, 'accountDataLastUpdated', () => {\n            if (!this.accountStore.isPaidUser) this.customOpenApiSpecs = {};\n        });\n\n        await hydrate({\n            // Stored in WebSQL, not local storage, for performance because specs can be *big*\n            storage: localForage,\n            jsonify: false,\n            key: 'api-store',\n            store: this\n        });\n\n        console.log('API store initialized');\n    });\n\n    @persist('map', apiMetadataSchema) @observable.shallow\n    private customOpenApiSpecs: _.Dictionary<ApiMetadata> = {};\n\n    addCustomApi(baseUrl: string, apiMetadata: ApiMetadata) {\n        this.customOpenApiSpecs[baseUrl] = apiMetadata;\n    }\n\n    deleteCustomApi(baseUrl: string) {\n        delete this.customOpenApiSpecs[baseUrl];\n    }\n\n    // Exposes the info from all openAPI specs, for convenient listing\n    // Not the whole spec because we want to clone, that'd be expensive,\n    // and in general nobody should ever iterate over the details of all specs\n    @computed get customOpenApiInfo() {\n        return _.mapValues(this.customOpenApiSpecs, (api) => ({\n            info: _.cloneDeep(api.spec.info)\n        }));\n    }\n\n    @computed private get customOpenApiSpecsByUrl() {\n        return new Map<URL, ApiMetadata>(\n            (Object.entries(this.customOpenApiSpecs).map(([rawUrl, spec]) => {\n                // We want to prepare the base URLs for easy lookup. We need a protocol\n                // to parse them, so we use https, but these will match HTTP too.\n                return [\n                    new URL('https://' + rawUrl.replace(/\\/$/, '')),\n                    spec\n                ];\n            }) as Array<[URL, ApiMetadata]>)\n            .sort(([urlA, _apiA], [urlB, _apiB]) => {\n                // Ports before non-ports, then longer paths before shorter ones.\n                if (urlA.port && !urlB.port) return -1;\n                if (urlB.port && !urlA.port) return 1;\n                return urlB.pathname.length - urlA.pathname.length;\n            })\n        );\n    }\n\n    private getPrivateApi(url: URL) {\n        // Find a base URL with the same domain, maybe port, and initial path substring\n        const apiBaseUrl = _.find([...this.customOpenApiSpecsByUrl.keys()], (baseUrl) => {\n            return baseUrl.hostname === url.hostname &&\n                (\n                    !baseUrl.port ||\n                    baseUrl.port === url.port ||\n                    baseUrl.port === '443' && url.protocol === 'https' ||\n                    baseUrl.port === '80' && url.protocol === 'http'\n                ) &&\n                url.pathname.startsWith(baseUrl.pathname)\n        });\n\n        return apiBaseUrl\n            ? this.customOpenApiSpecsByUrl.get(apiBaseUrl)\n            : undefined;\n    }\n\n    private publicApiCache: _.Dictionary<Promise<ApiMetadata>> = {};\n\n    private getPublicApi(specId: string) {\n        const { publicApiCache } = this;\n        if (!publicApiCache[specId]) {\n            publicApiCache[specId] = fetchApiMetadata(specId)\n                .then(buildApiMetadataAsync)\n                .catch((e) => {\n                    console.log(`Failed to build API ${specId}`);\n                    logError(e, {\n                        apiSpecId: specId\n                    });\n                    throw e;\n                });\n        }\n        return publicApiCache[specId];\n    }\n\n    async getApi(request: HtkRequest): Promise<ApiMetadata | undefined> {\n        const { parsedUrl } = request;\n\n        // Is this a configured private API? I.e. has the user explicitly given\n        // us a spec to use for requests like these.\n        let privateSpec = this.getPrivateApi(parsedUrl);\n        if (privateSpec) {\n            return Promise.resolve(privateSpec);\n        }\n\n        // If not, is this a known public API? (note that private always has precedence)\n        const requestUrl = `${parsedUrl.host}${parsedUrl.pathname}`;\n\n        let publicSpecId = findPublicApi(requestUrl);\n        if (!publicSpecId) return;\n        if (!Array.isArray(publicSpecId)) publicSpecId = [publicSpecId];\n\n        // The graph API is enormous and doesn't actually build due to\n        // https://github.com/microsoftgraph/microsoft-graph-openapi/issues/9.\n        // Skip it rather than waiting ages before failing anyway.\n        publicSpecId = publicSpecId.filter(specId => specId !== 'microsoft.com/graph');\n\n        const publicSpecs = await Promise.all(\n            publicSpecId.map((specId) => this.getPublicApi(specId))\n        );\n\n        if (publicSpecs.length === 1) {\n            return publicSpecs[0];\n        }\n\n        // If this matches multiple APIs, we fetch and build all of them, and then\n        // use the best match (the one with the matching operation, hopefully)\n        return findBestMatchingApi(publicSpecs, request);\n    }\n\n}\n\n// If we match multiple APIs, build all of them, try to match each one\n// against the request, and return only the matching one. This happens if\n// multiple services have the exact same base request URL (rds.amazonaws.com)\nexport function findBestMatchingApi(\n    apis: ApiMetadata[],\n    request: HtkRequest\n): ApiMetadata | undefined {\n    const matchingApis = apis.filter((api) =>\n        api.type == 'openrpc' || // Since we have so few JSON-RPC APIs, we assume they match\n        matchOpenApiOperation(api, request).matched // For OpenAPI, we check for a matching op\n    );\n\n    // If we've successfully found one matching API, return it\n    if (matchingApis.length === 1) return matchingApis[0];\n\n    // If this is a non-matching request to one of these APIs, but we're not\n    // sure which, return the one with the most paths (as a best guess metric of\n    // which is the most popular service)\n    if (matchingApis.length === 0) return _.maxBy(apis, a => a.spec.paths.length)!;\n\n    // Otherwise we've matched multiple APIs which all define operations that\n    // could be this one request. Does exist right now (e.g. AWS RDS vs DocumentDB)\n\n    // Report this so we can try to improve & avoid in future.\n    logError('Overlapping APIs', matchingApis);\n\n    // Return our guess of the most popular service, from the matching services only\n    return _.maxBy(matchingApis, a => Object.keys(a.spec.paths).length)!;\n}","export var ServiceWorkerNoSupportError = (function() {\n\n\tfunction ServiceWorkerNoSupportError() {\n\t\tvar err = Error.call(this, 'ServiceWorker is not supported.');\n\t\tObject.setPrototypeOf(err, ServiceWorkerNoSupportError.prototype);\n\t\treturn err;\n\t}\n\n\tServiceWorkerNoSupportError.prototype = Object.create(Error.prototype);\n\n\treturn ServiceWorkerNoSupportError;\n})();\n\nexport var scriptUrl = \"/\" + \"ui-update-worker.js\";\n\nexport default function registerServiceWorkerIfSupported(mapScriptUrlOrOptions, maybeOptions) {\n\n\tvar targetScriptUrl = scriptUrl;\n\tvar options = maybeOptions;\n\n\tif (typeof mapScriptUrlOrOptions === 'function') {\n\t\ttargetScriptUrl = mapScriptUrlOrOptions(targetScriptUrl);\n\t} else {\n\t\toptions = mapScriptUrlOrOptions;\n\t}\n\n\tif ('serviceWorker' in navigator) {\n\t\treturn navigator.serviceWorker.register(targetScriptUrl, options);\n\t}\n\n\treturn Promise.reject(new ServiceWorkerNoSupportError());\n}\n","import registerUpdateWorker, {\n    ServiceWorkerNoSupportError\n} from 'service-worker-loader!./ui-update-worker';\n\nimport { triggerServerUpdate } from './server-api';\n\nimport packageMetadata from '../../package.json';\nimport { desktopVersion, serverVersion, versionSatisfies } from './service-versions';\n\nexport const attemptServerUpdate = () =>\n    triggerServerUpdate().catch(console.warn);\n\n// Set up a SW in the background, to add offline support & instant startup.\n// This also checks for new UI & server versions at intervals.\nexport async function runBackgroundUpdates() {\n    // Try to trigger a server update. Can't guarantee it'll work, and we also trigger it\n    // after successful startup, but this tries to ensure that even if startup is broken,\n    // we still update the server (and hopefully thereby unbreak app startup).\n    attemptServerUpdate();\n\n    try {\n        const registration = await registerUpdateWorker({ scope: '/' });\n        console.log('Service worker loaded');\n        registration.update().catch(console.log);\n\n        // Check for server & UI updates every 5 minutes:\n        setInterval(() => {\n            attemptServerUpdate();\n            registration.update().catch(console.log);\n        }, 1000 * 60 * 5);\n    } catch (e) {\n        if (e instanceof ServiceWorkerNoSupportError) {\n            console.warn('Service worker not supported - cached & offline startup will not be available');\n            return;\n        }\n        throw e;\n    }\n}\n\nfunction showPleaseUpdateMessage() {\n    alert(\n        \"This HTTP Toolkit installation is now very outdated, and this version is \" +\n        \"no longer supported.\" +\n        \"\\n\\n\" +\n        \"You can continue to use HTTP Toolkit, but you may experience issues & \" +\n        \"instability.\" +\n        \"\\n\\n\" +\n        \"Please update to the latest version from httptoolkit.com when you can, \" +\n        \"to access the many new features, bug fixes & performance improvements \" +\n        \"available there.\"\n    );\n}\n\nexport function checkForOutdatedComponents() {\n    const { runtimeDependencies } = packageMetadata;\n\n    let hasShownUpdateMessage = false;\n\n    serverVersion.then((serverVersion) => {\n        if (versionSatisfies(serverVersion, runtimeDependencies['httptoolkit-server'])) return;\n        if (hasShownUpdateMessage) return;\n\n        // This one should be _very_ rare, since the server always auto-updates - it'll only\n        // affect systems where that is failing for some reason, for years.\n\n        showPleaseUpdateMessage();\n        hasShownUpdateMessage = true;\n    }).catch(() => {});\n\n    desktopVersion.then((desktopVersion) => {\n        if (versionSatisfies(desktopVersion, runtimeDependencies['httptoolkit-desktop'])) return;\n        if (hasShownUpdateMessage) return;\n\n        // This will trigger for a few users, but not many - below 0.2% of weekly users right now\n\n        showPleaseUpdateMessage();\n        hasShownUpdateMessage = true;\n    }).catch(() => {});\n}","import * as React from 'react';\nimport { StyledComponent } from 'styled-components';\nimport { observer } from 'mobx-react';\nimport { Link, Match } from '@reach/router';\nimport * as dedent from 'dedent';\n\nimport { styled, css, Theme } from '../styles';\nimport { Icon, IconProp } from '../icons';\nimport { UI_VERSION, desktopVersion, serverVersion } from '../services/service-versions';\n\nimport { UnstyledButton } from './common/inputs';\nimport * as logo from '../images/logo-icon.svg';\n\nexport interface SidebarItem {\n    name: string;\n    icon: IconProp;\n    position: 'top' | 'bottom';\n    highlight?: true;\n\n    type: 'web' | 'router' | 'callback';\n    title: string;\n    url?: string;\n    onClick?: () => void;\n}\n\ninterface SidebarProps {\n    items: Array<SidebarItem>;\n}\n\nexport const SIDEBAR_WIDTH = '80px';\n\nconst SidebarNav = styled.nav`\n    width: ${SIDEBAR_WIDTH};\n    flex-shrink: 0;\n\n    background-color: ${p => p.theme.mainBackground};\n    color: ${p => p.theme.mainColor};\n    z-index: 5;\n\n    border-right: 1px solid rgba(0,0,0,0.12);\n    box-sizing: border-box;\n    box-shadow: 0 0 30px rgba(0,0,0,0.2);\n\n    font-size: ${p => p.theme.textSize};\n\n    display: flex;\n    flex-direction: column;\n`\n\nconst sidebarItemStyles = css`\n    width: 70px;\n    height: 70px;\n    margin: 0 auto;\n\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    text-align: center;\n\n    box-sizing: border-box;\n`;\n\nconst SidebarLogo = styled.img.attrs(() => ({\n    src: logo,\n    alt: 'HTTP Toolkit logo'\n}))`\n    ${sidebarItemStyles}\n    padding: 8px;\n`\n\nconst SidebarSelectableItem = styled(Link)`\n    ${sidebarItemStyles}\n\n    color: ${p => p.theme.mainColor};\n    text-decoration: none;\n    line-height: normal;\n\n    width: calc(100% + 2px);\n    margin: 0 -1px;\n\n    cursor: pointer;\n    user-select: none;\n    &:hover, &:focus {\n        outline: none;\n        color: ${p => p.theme.popColor};\n    }\n\n    border-width: 0 5px;\n    border-style: solid;\n    border-color: transparent;\n\n    opacity: 0.6;\n\n    ${(p: { selected: boolean }) => p.selected && css`{\n        opacity: 1;\n        border-right-color: ${p => p.theme.popColor};\n    }`}\n\n    > svg {\n        margin-bottom: 5px;\n    }\n`;\n\nconst Separator = styled.div`\n    margin-top: auto;\n`;\n\nconst SidebarLink = styled.a<{ highlight?: true }>`\n    ${sidebarItemStyles}\n\n    ${(p) => p.highlight && css`\n        color:  ${p.theme.popColor};\n        font-weight: bold;\n    `};\n\n    &:hover, &:focus {\n        outline: none;\n        color: ${p => p.highlight ? p.theme.mainColor : p.theme.popColor};\n    }\n\n    text-decoration: none;\n\n    margin-bottom: 5px;\n\n    > svg {\n        margin-bottom: 5px;\n    }\n`;\n\nconst SidebarButton = styled(\n    UnstyledButton as StyledComponent<\"button\", Theme, { highlight?: boolean }>\n)`\n    ${sidebarItemStyles}\n\n    opacity: 0.6;\n\n    ${(p) => p.highlight && css`\n        color:  ${p.theme.popColor};\n        font-weight: bold;\n    `};\n\n    > svg {\n        margin-bottom: 5px;\n    }\n`;\n\nexport const Sidebar = observer((props: SidebarProps) => {\n    const items = props.items.map((item, i) => {\n        const itemContent = <>\n            <Icon size='2x' icon={item.icon} />\n            {item.name}\n        </>;\n\n        if (item.type === 'web') {\n            return {\n                position: item.position,\n                component: <SidebarLink\n                    key={item.name}\n                    title={item.title}\n                    highlight={item.highlight}\n                    href={item.url}\n                    target='_blank'\n                >\n                    { itemContent }\n                </SidebarLink>\n            }\n        } else if (item.type === 'router') {\n            return {\n                position: item.position,\n                component: <Match\n                    key={item.name}\n                    path={`${item.url!}/*`}\n                >{({ match }) =>\n                    <SidebarSelectableItem\n                        to={item.url}\n                        title={item.title}\n                        selected={!!match}\n                    >\n                        { itemContent }\n                    </SidebarSelectableItem>\n                }</Match>\n            };\n        } else {\n            return {\n                position: item.position,\n                component: <SidebarButton\n                    key={item.name}\n                    title={item.title}\n                    highlight={item.highlight}\n                    onClick={item.onClick}\n                >\n                    { itemContent }\n                </SidebarButton>\n            };\n        }\n    });\n\n    return <SidebarNav>\n        <SidebarLogo\n            title={dedent`\n                UI version: ${UI_VERSION.slice(0, 8)}\n                Desktop version: ${\n                    desktopVersion.state === 'fulfilled'\n                        ? desktopVersion.value\n                        : 'Unknown'\n                }\n                Server version: ${\n                    serverVersion.state === 'fulfilled'\n                        ? serverVersion.value\n                        : 'Unknown'\n                }\n            `}\n        />\n\n        {\n            items.filter(i => i.position === 'top').map((item) => item.component)\n        }\n        <Separator />\n        {\n            items.filter(i => i.position === 'bottom').map((item) => item.component)\n        }\n    </SidebarNav>;\n});","import * as React from 'react';\n\nimport { styled } from '../../styles';\nimport { TrafficSource } from '../../model/http/sources';\n\nimport { BigCard } from \"../common/card\";\nimport { Icon } from '../../icons';\n\nconst ConnectedSource = styled.div`\n    &:not(:last-child) {\n        margin-bottom: 30px;\n    }\n\n    font-size: ${p => p.theme.headingSize};\n\n    > svg {\n        margin-right: 30px;\n    }\n`;\n\nexport const ConnectedSources = styled((props: { activeSources: TrafficSource[], className?: string }) =>\n    <BigCard className={props.className}>\n        <h1>Connected Sources</h1>\n        {\n            props.activeSources.length ?\n                props.activeSources.map((source) =>\n                    <ConnectedSource key={source.ua} title={source.ua}>\n                        <Icon {...source.icon} fixedWidth={true} />\n                        { source.summary }\n                    </ConnectedSource>\n                )\n            : null\n        }\n    </BigCard>\n)``; // Styled here so that we can target this with selectors in SC styles elsewhere","import * as _ from 'lodash';\nimport * as React from 'react';\n\nimport { styled } from '../../styles';\nimport { Icon, IconProp, SizeProp } from '../../icons';\nimport { filterProps } from '../component-utils';\n\nconst SearchInput = styled.input.attrs(() => ({\n    type: 'text'\n}))`\n    width: 100%;\n    padding: 15px;\n    box-sizing: border-box;\n\n    border-radius: 4px;\n\n    border: 1px solid ${p => p.theme.containerBorder};\n    box-shadow: inset 0 2px 4px 1px rgba(0, 0, 0, 0.1);\n    background-color: ${p => p.theme.highlightBackground};\n    color: ${p => p.theme.highlightColor};\n\n    font-size: ${p => p.theme.headingSize};\n`;\n\nconst ClearSearchButton = styled(filterProps(Icon, 'visible'))<{\n    visible: boolean,\n    icon: IconProp,\n    size?: SizeProp,\n    onClick: () => void\n}>`\n    position: absolute;\n\n    right: 15px;\n    top: 50%;\n    transform: translateY(-50%);\n    cursor: pointer;\n\n    display: ${p => p.visible ? 'block' : 'none'};\n`;\n\nexport const SearchBox = styled((props: {\n    className?: string,\n    value: string,\n    placeholder?: string,\n    autoFocus?: boolean,\n    onSearch: (input: string) => void,\n    iconSize?: SizeProp\n}) =>\n    <div className={props.className}>\n        <SearchInput\n            autoFocus={props.autoFocus}\n            value={props.value}\n            placeholder={props.placeholder}\n            onChange={(e) => props.onSearch(e.currentTarget.value)}\n        />\n        <ClearSearchButton\n            icon={['fas', 'times']}\n            size={props.iconSize}\n            onClick={() => props.onSearch('')}\n            visible={!!props.value}\n        />\n    </div>\n)`\n    position: relative;\n`;","import * as _ from 'lodash';\nimport * as React from 'react';\n\nimport { observable, action } from 'mobx';\nimport { observer, inject } from 'mobx-react';\n\nimport { WithInjected } from '../../types';\nimport { NARROW_LAYOUT_BREAKPOINT, styled } from '../../styles';\n\nimport { InterceptorStore } from '../../model/interception/interceptor-store';\nimport { EventsStore } from '../../model/events/events-store';\nimport { MANUAL_INTERCEPT_ID } from '../../model/interception/interceptors';\n\nimport { ConnectedSources } from './connected-sources';\nimport { InterceptOption } from './intercept-option';\nimport { SearchBox } from '../common/search-box';\n\ninterface InterceptPageProps {\n    className?: string;\n    interceptorStore: InterceptorStore;\n    eventsStore: EventsStore;\n    navigate: (path: string) => void;\n}\n\nconst InterceptPageContainer = styled.section`\n    display: grid;\n\n    @media (min-width: ${NARROW_LAYOUT_BREAKPOINT}px) {\n        grid-gap: 40px;\n        grid-template-columns: 1fr 1fr 1fr 1fr;\n        grid-template-rows: 320px;\n        padding: 60px 40px;\n    }\n\n    @media not (min-width: ${NARROW_LAYOUT_BREAKPOINT}px) {\n        grid-gap: 20px;\n        grid-template-columns: 1fr 1fr 1fr;\n        padding: 40px;\n    }\n\n    grid-auto-rows: minmax(200px, auto);\n    grid-auto-flow: row dense;\n\n    max-width: 1200px;\n    margin: 0 auto 20px;\n\n    > ${ConnectedSources} {\n        @media not (min-width: ${NARROW_LAYOUT_BREAKPOINT}px) {\n            display: none;\n        }\n\n        order: -1;\n        grid-column: 3 / span 2;\n        overflow-y: auto;\n        margin-bottom: 0;\n    }\n`;\n\nconst InterceptInstructions = styled.div`\n    order: -1;\n\n    @media (min-width: ${NARROW_LAYOUT_BREAKPOINT}px) {\n        grid-column: 1 / span 2;\n    }\n\n    @media not (min-width: ${NARROW_LAYOUT_BREAKPOINT}px) {\n        grid-column: 1 / -1;\n    }\n\n    display: flex;\n    flex-direction: column;\n    justify-content: flex-end;\n\n    > h1 {\n        font-size: ${p => p.theme.loudHeadingSize};\n        font-weight: bold;\n        margin-bottom: 40px;\n    }\n\n    > p {\n        font-size: ${p => p.theme.headingSize};\n\n        margin-bottom: 20px;\n        text-align: left;\n        line-height: 1.2;\n    }\n`;\n\nconst InterceptSearchBox = styled(SearchBox).attrs(() => ({\n    autoFocus: true,\n    placeholder: 'Browsers, mobile, docker...',\n    iconSize: '2x'\n}))`\n    @media (min-width: ${NARROW_LAYOUT_BREAKPOINT}px) {\n        margin: 20px 0 0;\n    }\n`;\n\n@inject('interceptorStore')\n@inject('eventsStore')\n@observer\nclass InterceptPage extends React.Component<InterceptPageProps> {\n\n    @observable filter: string | false = false;\n\n    private readonly gridRef = React.createRef<HTMLDivElement>();\n\n    render(): JSX.Element {\n        const { interceptors } = this.props.interceptorStore;\n        const { activeSources } = this.props.eventsStore;\n\n        const filter = this.filter ? this.filter.toLocaleLowerCase() : false;\n\n        const visibleInterceptOptions = _.pickBy(interceptors, (option) =>\n            !filter ||\n            _.includes(option.name.toLocaleLowerCase(), filter) ||\n            _.includes(option.description.join(' ').toLocaleLowerCase(), filter) ||\n            _.some(option.tags, t => _.includes(t.toLocaleLowerCase(), filter))\n        );\n\n        if (!_.some(visibleInterceptOptions, (o) => o.isActivable)) {\n            visibleInterceptOptions[MANUAL_INTERCEPT_ID] = interceptors[MANUAL_INTERCEPT_ID];\n        }\n\n        return <div className={this.props.className}>\n            <InterceptPageContainer ref={this.gridRef}>\n                <InterceptInstructions>\n                    <h1>\n                        Intercept HTTP\n                    </h1>\n                    <p>\n                        To collect &amp; view HTTP traffic, you need to connect\n                        a source of traffic, like a browser, mobile device, or\n                        docker container.\n                    </p>\n                    <p>\n                        Click an option below to connect a traffic source, or\n                        search for connectors that could work for you:\n                    </p>\n                    <InterceptSearchBox\n                        value={this.filter || ''}\n                        onSearch={this.onSearchInput}\n                    />\n                </InterceptInstructions>\n\n                <ConnectedSources activeSources={activeSources} />\n\n                { _(visibleInterceptOptions)\n                    .sortBy((option) => {\n                        const exactFilterMatch = filter && (\n                            option.tags.includes(filter) ||\n                            option.name.toLocaleLowerCase().split(' ').includes(filter)\n                        );\n\n                        return -1 * (0 +\n                            (exactFilterMatch ? 100 : 0) +\n                            (option.isActive || option.isActivable ? 50 : 0) +\n                            (option.isSupported ? 25 : 0)\n                        );\n                    })\n                    .map((option, index) =>\n                        <InterceptOption\n                            key={option.id}\n                            index={index}\n                            interceptor={option}\n                            showRequests={this.showRequests}\n                        />\n                    ).value()\n                }\n            </InterceptPageContainer>\n        </div>;\n    }\n\n    @action.bound\n    showRequests() {\n        this.props.navigate('/view');\n    }\n\n    @action.bound\n    onSearchInput(input: string) {\n        this.filter = input || false;\n    }\n}\n\nconst StyledInterceptPage = styled(\n    // Exclude store from the external props, as it's injected\n    InterceptPage as unknown as WithInjected<typeof InterceptPage, 'interceptorStore' | 'eventsStore' | 'navigate'>\n)`\n    height: 100%;\n    overflow-y: auto;\n    position: relative;\n`;\n\nexport { StyledInterceptPage as InterceptPage };","import * as React from 'react';\nimport { default as ReactSplitPane } from 'react-split-pane';\n\nimport { styled } from '../styles';\n\n// Styles original taken from\n// https://github.com/tomkp/react-split-pane/blob/master/README.md#example-styling\nexport const SplitPane = styled(ReactSplitPane)<{\n    hiddenPane?: '1' | '2'\n}>`\n    .Resizer {\n        background: #000;\n        opacity: .3;\n        z-index: 1;\n        -moz-box-sizing: border-box;\n        -webkit-box-sizing: border-box;\n        box-sizing: border-box;\n        -moz-background-clip: padding;\n        -webkit-background-clip: padding;\n        background-clip: padding-box;\n    }\n\n    .Resizer:hover {\n        -webkit-transition: all 1s ease;\n        transition: all 1s ease;\n        opacity: 0.9;\n    }\n\n    .Resizer.horizontal {\n        height: 11px;\n        margin: -5px 0;\n        border-top: 5px solid rgba(255, 255, 255, 0);\n        border-bottom: 5px solid rgba(255, 255, 255, 0);\n        cursor: row-resize;\n        width: 100%;\n    }\n\n    .Resizer.horizontal:hover {\n        border-top: 5px solid rgba(0, 0, 0, 0.2);\n        border-bottom: 5px solid rgba(0, 0, 0, 0.2);\n    }\n\n    .Resizer.vertical {\n        width: 11px;\n        margin: 0 -5px;\n        border-left: 5px solid rgba(255, 255, 255, 0);\n        border-right: 5px solid rgba(255, 255, 255, 0);\n        cursor: col-resize;\n    }\n\n    .Resizer.vertical:hover {\n        border-left: 5px solid rgba(0, 0, 0, 0.2);\n        border-right: 5px solid rgba(0, 0, 0, 0.2);\n    }\n\n    .Resizer.disabled {\n        cursor: not-allowed;\n    }\n\n    .Resizer.disabled:hover {\n        border-color: transparent;\n    }\n\n    .Pane {\n        min-width: 0; /* Don't let flexbox force panes to expand */\n    }\n\n    ${({ hiddenPane }) => {\n        if (!hiddenPane) return '';\n        else return `\n            .Resizer {\n                display: none !important;\n            }\n\n            .Pane${hiddenPane} {\n                display: none !important;\n            }\n        `;\n    }}\n`;","import * as React from 'react';\nimport * as _ from 'lodash';\n\nimport { styled } from '../../styles'\nimport { Icon, IconProp } from '../../icons';\n\nexport const EmptyState = styled((props: React.HTMLAttributes<HTMLDivElement> & {\n    className?: string,\n    icon: IconProp,\n    spin?: true | 'slow',\n    children?: React.ReactNode\n}) => (\n    <div {..._.omit(props, ['message', 'icon', 'spin'])}>\n        <Icon\n            icon={props.icon}\n            spin={props.spin === true}\n            className={props.spin === 'slow' ? 'slow-spin' : undefined}\n        />\n        { props.children && <>\n            <br/>\n            { props.children }\n        </> }\n    </div>\n))`\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n\n    color: ${props => props.theme.containerWatermark};\n    font-size: 40px;\n    text-align: center;\n\n    box-sizing: border-box;\n    padding: 20px;\n    height: 100%;\n    width: 100%;\n\n    margin: auto 0;\n\n    > svg {\n        font-size: 150px;\n    }\n`;","import * as _ from 'lodash';\nimport * as React from 'react';\n\nconst focusableElementSelector = [\n    'a:not([disabled])',\n    'button:not([disabled])',\n    'textarea:not([disabled])',\n    'input:not([disabled])',\n    'select:not([disabled])',\n    '[tabindex]:not([disabled]):not([tabindex=\"-1\"])'\n].join(',');\n\nfunction getFocusableChildren(element: HTMLElement) {\n    // Note that we ignore numerical tabindexes entirely, since we never use them\n    return _.filter(\n        (element.querySelectorAll(focusableElementSelector) as NodeListOf<HTMLElement>),\n        (element) => element.offsetParent !== null // Element is visible (ish)\n    )\n}\n\n// Wraps an element (i.e. the Monaco editor), and blocks focusing it directly in the tab order.\n// This is necessary for elements which capture tab/shift-tab for some other use (as Monaco does).\n// Focus can be explicitly given by pressing Enter, or removed with Escape.\nexport const FocusWrapper = (p: { children: React.ReactNode, className?: string }) => {\n    return <div\n        className={p.className}\n        aria-label='Press enter to focus this editor, and use escape to unfocus it later'\n        tabIndex={0}\n        onKeyDown={(e) => {\n            const thisElement = e.currentTarget;\n            if (e.target === thisElement) {\n                // Pressing tab with the container focused jumps past the children\n                if (e.key === 'Tab') {\n                    if (e.shiftKey) {\n                        // Pressing shift-tab tabs backwards from this element, so just like normal\n                        return;\n                    } else {\n                        // Pressing tab tabs forwards past all the children of this element.\n                        const allFocusableElements = getFocusableChildren(document.body);\n                        const elementLastChild = _.last(thisElement.children) as HTMLElement;\n                        const currentTabIndex = allFocusableElements.indexOf(elementLastChild);\n\n                        const nextTabbableElement = allFocusableElements[currentTabIndex + 1];\n                        if (nextTabbableElement) {\n                            nextTabbableElement.focus();\n                            e.preventDefault();\n                            return;\n                        } else {\n                            // If we can't find a next tabbable element, loop back to the first\n                            allFocusableElements[0].focus();\n                            e.preventDefault();\n                            return;\n                        }\n                    }\n                }\n\n                // Pressing enter with the container focused jumps into the children\n                if (e.key === 'Enter') {\n                    const firstFocussableChild = getFocusableChildren(thisElement)[0];\n                    if (firstFocussableChild) {\n                        firstFocussableChild.focus();\n                        e.preventDefault(); // Don't actually press enter on the child element\n                    }\n                    return;\n                }\n            } else if (thisElement.contains(document.activeElement)) {\n                // Pressing escape inside the container jumps to the container\n                if (e.key === 'Escape') {\n                    thisElement.focus();\n                    return;\n                }\n            }\n        }}\n    >\n        { p.children }\n\n        {/* If you shift-tab into the children, we focus the container */}\n        <div tabIndex={0} onFocus={(e) => {\n            if (e.target === e.currentTarget) e.currentTarget.parentElement!.focus();\n        }} />\n    </div>;\n}","import type * as monacoTypes from 'monaco-editor';\n\nimport { copyToClipboard } from '../../util/ui';\n\nimport { UiStore } from '../../model/ui/ui-store';\nimport { ContextMenuItem } from '../../model/ui/context-menu';\n\nexport function buildContextMenuCallback(\n    uiStore: UiStore,\n    isReadOnly: boolean,\n    // Anon base-editor type to avoid exporting this\n    baseEditorRef: React.RefObject<{\n        editor: monacoTypes.editor.IStandaloneCodeEditor | undefined\n    }>\n) {\n    return (mouseEvent: React.MouseEvent) => {\n        const editor = baseEditorRef.current?.editor;\n        if (!editor) return;\n        const selection = editor.getSelection();\n\n        const items: ContextMenuItem<void>[] = [];\n\n        if (!isReadOnly) {\n            items.push({\n                type: 'option',\n                label: \"Cut\",\n                enabled: !!selection && !selection.isEmpty(),\n                callback: async () => {\n                    const selection = editor.getSelection();\n                    if (!selection) return;\n                    const content = editor.getModel()?.getValueInRange(selection);\n                    if (!content) return;\n\n                    await copyToClipboard(content);\n\n                    editor.executeEdits(\"clipboard\", [{\n                        range: selection,\n                        text: \"\",\n                        forceMoveMarkers: true,\n                    }]);\n                },\n            });\n        }\n\n        if (selection && !selection.isEmpty()) {\n            items.push({\n                type: 'option',\n                label: \"Copy\",\n                enabled: !!selection && !selection.isEmpty(),\n                callback: () => {\n                    const selection = editor.getSelection();\n                    if (!selection) return;\n                    const content = editor.getModel()?.getValueInRange(selection);\n                    if (!content) return;\n                    copyToClipboard(content);\n                },\n            });\n        }\n\n        if (selection && !!navigator.clipboard) {\n            items.push({\n                type: 'option',\n                label: \"Paste\",\n                enabled: !isReadOnly,\n                callback: async () => {\n                    const selection = editor.getSelection();\n                    if (!selection) return;\n                    const text = await navigator.clipboard.readText();\n\n                    editor.executeEdits(\"clipboard\", [{\n                        range: selection,\n                        text: text,\n                        forceMoveMarkers: true,\n                    }]);\n                }\n            });\n        }\n\n        uiStore.handleContextMenuEvent(mouseEvent, items);\n    }\n}","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { observer, disposeOnUnmount, inject } from 'mobx-react';\nimport { observable, action, autorun, reaction, runInAction, comparer } from 'mobx';\nimport type { SchemaObject } from 'openapi-directory';\n\nimport type * as monacoTypes from 'monaco-editor';\nimport type { default as _MonacoEditor, MonacoEditorProps } from 'react-monaco-editor';\n\nimport { logError } from '../../errors';\nimport { Omit } from '../../types';\nimport { styled, defineMonacoThemes } from '../../styles';\n\nimport { delay } from '../../util/promise';\nimport { asError } from '../../util/error';\n\nimport { UiStore } from '../../model/ui/ui-store';\n\nimport { FocusWrapper } from './focus-wrapper';\nimport { buildContextMenuCallback } from './editor-context-menu';\n\nlet MonacoEditor: typeof _MonacoEditor | undefined;\n// Defer loading react-monaco-editor ever so slightly. This has two benefits:\n// * don't delay first app start waiting for this massive chunk to load\n// * better caching (app/monaco-editor bundles can update independently)\nlet rmeModulePromise = delay(100).then(() => loadMonacoEditor());\n\nasync function loadMonacoEditor(retries = 5): Promise<void> {\n    try {\n        // These might look like two sequential requests, but since they're a single chunk,\n        // it's actually just one load and then both will fire together.\n        const rmeModule = await import(/* webpackChunkName: \"react-monaco-editor\" */ 'react-monaco-editor');\n        const monacoEditorModule = await import(/* webpackChunkName: \"react-monaco-editor\" */ 'monaco-editor/esm/vs/editor/editor.api');\n\n        defineMonacoThemes(monacoEditorModule);\n\n        // Track the currently visible markers per model:\n        monacoEditorModule.editor.onDidChangeMarkers((modelUris) => {\n            const markers = monacoEditorModule.editor.getModelMarkers({});\n\n            runInAction(() => {\n                modelsMarkers.clear();\n                markers.forEach((marker) => {\n                    const modelUri = marker.resource;\n                    const markersSoFar = modelsMarkers.get(modelUri) ?? [];\n                    markersSoFar.push(marker);\n                    modelsMarkers.set(modelUri, markersSoFar);\n                });\n            });\n        });\n        MonacoEditor = rmeModule.default;\n    } catch (err) {\n        console.log('Monaco load failed', asError(err).message);\n        if (retries <= 0) {\n            console.warn('Repeatedly failed to load monaco editor, giving up');\n            throw err;\n        }\n\n        return loadMonacoEditor(retries - 1);\n    }\n}\n\n// We keep a single global observable linking model URIs to their current error marker data,\n// updated via a global listener set up in loadMonacoEditor above.\nconst modelsMarkers = observable.map<monacoTypes.Uri, monacoTypes.editor.IMarker[]>();\n\nexport interface EditorProps extends MonacoEditorProps {\n    onContentSizeChange?: (contentUpdate: monacoTypes.editor.IContentSizeChangedEvent) => void;\n\n    // When this prop changes, the editor layout will be reset. This can be used to indicate a change of the content\n    // represented by the editor (which should update state, e.g. the editor content selection) even when editors\n    // are reused via portals etc. This is not strictly required in non-reused editors, but it's useful to enforce it\n    // here to make sure we handle this correctly in all cases. Can be set to null to explicitly ignore this.\n    contentId: string | null;\n\n    schema?: SchemaObject;\n}\n\n// Extracted unnamed type from Monaco\ninterface SchemaMapping {\n    readonly uri: string;\n    readonly fileMatch?: string[];\n    readonly schema?: any;\n}\n\nconst MAX_HEIGHT = 560;\n\nconst EditorMaxHeightContainer = styled.div`\n    ${(p: { expanded: boolean }) => p.expanded\n        ? `\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            height: auto !important;\n        `\n        : `\n            max-height: ${MAX_HEIGHT}px;\n        `\n    }\n`;\n\n@inject('uiStore')\n@observer\nexport class SelfSizedEditor extends React.Component<\n    Omit<EditorProps, 'onContentSizeChange'> & {\n        expanded?: boolean,\n        uiStore?: UiStore // Injected automatically\n    }\n> {\n\n    container = React.createRef<HTMLDivElement>();\n    editor = React.createRef<BaseEditor>();\n\n    @action.bound\n    onContentSizeChange(contentUpdate: monacoTypes.editor.IContentSizeChangedEvent) {\n        this.contentHeight = Math.min(contentUpdate.contentHeight, MAX_HEIGHT);\n    }\n\n    onResize = _.throttle(() => {\n        if (this.editor.current) this.editor.current.relayout();\n    }, 50, { leading: true, trailing: true });\n\n    componentDidUpdate() {\n        // Relayout after update, to ensure the editor is always using the full available\n        // size even as the editor content changes\n        if (this.editor.current) this.editor.current.relayout();\n    }\n\n    resizeObserver = new ResizeObserver(this.onResize);\n\n    componentDidMount() {\n        if (this.container.current) {\n            this.resizeObserver.observe(this.container.current);\n        }\n    }\n\n    componentWillUnmount() {\n        this.resizeObserver.disconnect();\n    }\n\n    @observable contentHeight: number = 0;\n\n    render() {\n        return <EditorMaxHeightContainer\n            ref={this.container}\n            expanded={!!this.props.expanded}\n            style={{ 'height': this.contentHeight + 'px' }}\n            onContextMenu={buildContextMenuCallback(\n                this.props.uiStore!,\n                !!this.props.options?.readOnly,\n                this.editor\n            )}\n        >\n            <BaseEditor\n                theme={this.props.uiStore!.theme.monacoTheme}\n                {...this.props}\n                ref={this.editor}\n                onContentSizeChange={this.onContentSizeChange}\n            />\n        </EditorMaxHeightContainer>\n    }\n}\n\n// As opposed to self-sized - when not expanded, the container-sized\nconst ContainerSizedEditorContainer = styled.div`\n    ${(p: { expanded: boolean }) => p.expanded\n        ? `\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            height: auto !important;\n        `\n        : `\n            height: 100%;\n        `\n    }\n`;\n\n@inject('uiStore')\n@observer\nexport class ContainerSizedEditor extends React.Component<\n    Omit<EditorProps, 'onContentSizeChange'> & {\n        expanded?: boolean,\n        uiStore?: UiStore // Injected automatically\n    }\n> {\n\n    container = React.createRef<HTMLDivElement>();\n    editor = React.createRef<BaseEditor>();\n\n    onResize = _.throttle(() => {\n        if (this.editor.current) this.editor.current.relayout();\n    }, 25, { leading: true, trailing: true });\n\n    componentDidUpdate() {\n        // Relayout after update, to ensure the editor is always using the full available\n        // size even as the editor content changes\n        if (this.editor.current) this.editor.current.relayout();\n    }\n\n    resizeObserver = new ResizeObserver(this.onResize);\n\n    componentDidMount() {\n        if (this.container.current) {\n            this.resizeObserver.observe(this.container.current);\n        }\n    }\n\n    componentWillUnmount() {\n        this.resizeObserver.disconnect();\n    }\n\n    render() {\n        return <ContainerSizedEditorContainer\n            ref={this.container}\n            expanded={!!this.props.expanded}\n            onContextMenu={buildContextMenuCallback(\n                this.props.uiStore!,\n                !!this.props.options?.readOnly,\n                this.editor\n            )}\n        >\n            <BaseEditor\n                theme={this.props.uiStore!.theme.monacoTheme}\n                {...this.props}\n                ref={this.editor}\n            />\n        </ContainerSizedEditorContainer>\n    }\n}\n\nconst EditorFocusWrapper = styled(FocusWrapper)`\n    height: 100%;\n    width: 100%;\n`;\n\n@observer\nclass BaseEditor extends React.Component<EditorProps> {\n\n    // Both provided async, once the editor has initialized\n    editor: monacoTypes.editor.IStandaloneCodeEditor | undefined;\n    monaco: (typeof monacoTypes) | undefined;\n\n    @observable\n    monacoEditorLoaded = !!MonacoEditor;\n\n    @observable\n    modelUri: monacoTypes.Uri | undefined = undefined;\n\n    registeredSchemaUri: string | undefined = undefined;\n\n    constructor(props: EditorProps) {\n        super(props);\n\n        if (!this.monacoEditorLoaded) {\n            rmeModulePromise\n                // Did it fail before? Retry it now, just in case\n                .catch(() => {\n                    rmeModulePromise = loadMonacoEditor(0);\n                    return rmeModulePromise;\n                })\n                .then(action(() => this.monacoEditorLoaded = true));\n        }\n\n        reaction(() => this.props.contentId, () => this.resetUIState());\n    }\n\n    public relayout() {\n        if (this.editor) {\n            try {\n                this.editor.layout();\n            } catch (e) {\n                // Monaco can throw some irrelevant errors here, due to race conditions with\n                // layout and model updates etc. It's OK if the layout very occasionally goes\n                // funky whilst things are going on, and there's nothing we can do about it,\n                // and it'll resolve itself on the next layout, so we just ignore it.\n                console.log('Monaco layout error:', e);\n                return;\n            }\n        }\n    }\n\n    private getMarkerController() {\n        return this.editor?.getContribution('editor.contrib.markerController') as unknown as {\n            showAtMarker(marker: monacoTypes.editor.IMarker): void;\n            close(focus: boolean): void;\n        };\n    }\n\n    private withoutFocusingEditor(cb: () => void) {\n        if (!this.editor) return;\n        const originalFocusMethod = this.editor.focus;\n        this.editor.focus = () => {};\n        cb();\n        this.editor.focus = originalFocusMethod;\n    }\n\n    private async resetUIState() {\n        if (this.editor && this.monaco) {\n            this.editor.setSelection(\n                new this.monaco.Selection(0, 0, 0, 0)\n            );\n\n            this.relayout();\n\n            requestAnimationFrame(() => {\n                if (this.editor && this.monaco) {\n                    // Sometimes, if the value updates immediately, the above results in us\n                    // selecting *all* content. We reset again after a frame to avoid that.\n                    this.editor.setSelection(new this.monaco.Selection(0, 0, 0, 0));\n                }\n\n                // Clear open problems - without this, expanded markers (squiggly line -> View Problem)\n                // will persist even though the marker itself no longer exists in the content.\n                this.getMarkerController()?.close(false);\n            });\n        }\n    }\n\n    @action.bound\n    onEditorDidMount(editor: monacoTypes.editor.IStandaloneCodeEditor, monaco: typeof monacoTypes) {\n        this.editor = editor;\n        this.monaco = monaco;\n\n        const model = editor.getModel();\n        this.modelUri = model?.uri;\n\n        this.editor.onDidChangeModel(action((e: monacoTypes.editor.IModelChangedEvent) => {\n            this.modelUri = e.newModelUrl ?? undefined;\n        }));\n\n        if (this.props.onContentSizeChange) {\n            this.editor.onDidContentSizeChange(this.props.onContentSizeChange);\n        }\n\n        // For read-only editors, we want to manually highlight the inline errors, if there are\n        // any. Mostly relevant to OpenAPI body validation issues. We can't do this in reset or\n        // elsewhere, as markers update slightly asynchronously from content changes, so this is\n        // only visible by observing modelMarkers.\n        disposeOnUnmount(this, reaction(() => ({\n            markers: (this.modelUri && modelsMarkers.get(this.modelUri)) ?? []\n        }), ({ markers }) => {\n            if (markers.length && this.props.options?.readOnly) {\n                requestAnimationFrame(() => { // Run after the reset marker.close() update\n                    this.withoutFocusingEditor(() => {\n                        this.getMarkerController().showAtMarker(markers[0]);\n                    });\n                });\n            }\n        }, { equals: comparer.structural }));\n    }\n\n    componentDidMount() {\n        // We don't run _after_ unmount, so we'll leave behind schemas on unmount, which isn't great...\n        disposeOnUnmount(this, autorun(() => {\n            if (!this.editor || !this.monaco) return;\n\n            // Update the set of JSON schemas recognized by Monaco, to potentially include this file's\n            // schema (from props.newSchema) linked to its model URI, or remove our stale schemas.\n\n            const existingOptions = this.monaco.languages.json.jsonDefaults.diagnosticsOptions;\n            let newSchemaMappings: SchemaMapping[] = existingOptions.schemas || [];\n\n            const uriString = this.modelUri?.toString();\n\n            if (uriString) {\n                const newSchema = this.props.schema;\n\n                const existingMapping = _.find(existingOptions.schemas || [],\n                    (sm: SchemaMapping) => sm.uri === uriString\n                ) as SchemaMapping | undefined;\n\n                if (newSchema && (!existingMapping || existingMapping.schema !== newSchema)) {\n                    // If we have a replacement/new schema for this file, replace/add it.\n                    newSchemaMappings = newSchemaMappings\n                        .filter((sm) => sm !== existingMapping)\n                        .concat({ uri: uriString, fileMatch: [uriString], schema: newSchema });\n                } else if (!newSchema) {\n                    // If we have no schema for this file, drop the schema\n                    newSchemaMappings = newSchemaMappings\n                        .filter((sm) => sm !== existingMapping);\n                }\n            }\n\n            if (this.registeredSchemaUri && uriString != this.registeredSchemaUri) {\n                // If we registered a previous schema for a different model, clear it up.\n                newSchemaMappings = newSchemaMappings\n                    .filter((sm) => sm.uri !== this.registeredSchemaUri);\n            }\n\n            const options = Object.assign({}, existingOptions, {\n                validate: true,\n                schemas: newSchemaMappings\n            });\n\n            if (!_.isEqual(existingOptions, options)) {\n                // Avoid unnecessary calls to this, as it reloads the JSON worker\n                this.monaco.languages.json.jsonDefaults.setDiagnosticsOptions(options);\n            }\n\n            this.registeredSchemaUri = uriString;\n        }));\n    }\n\n    componentWillUnmount() {\n        if (this.editor && this.monaco && this.registeredSchemaUri) {\n            // When we unmount, clear our registered schema, if we have one.\n            const existingOptions = this.monaco.languages.json.jsonDefaults.diagnosticsOptions;\n\n            const newSchemaMappings = (existingOptions.schemas || [])\n                .filter((sm) => sm.uri !== this.registeredSchemaUri);\n\n            const newOptions = Object.assign({}, existingOptions, {\n                schemas: newSchemaMappings\n            });\n\n            if (!_.isMatch(existingOptions, newOptions)) {\n                this.monaco.languages.json.jsonDefaults.setDiagnosticsOptions(newOptions);\n            }\n\n            this.registeredSchemaUri = undefined;\n        }\n    }\n\n    render() {\n        if (!this.monacoEditorLoaded || !MonacoEditor) {\n            logError('Monaco editor failed to load');\n            return null;\n        }\n\n        const options: monacoTypes.editor.IEditorConstructionOptions = {\n            showFoldingControls: 'always',\n\n            scrollbar: {\n                alwaysConsumeMouseWheel: false\n            },\n\n            quickSuggestions: false,\n            parameterHints: { enabled: false },\n            codeLens: false,\n            minimap: { enabled: false },\n            contextmenu: false,\n            scrollBeyondLastLine: false,\n            colorDecorators: false,\n            renderValidationDecorations: 'on',\n\n            // TODO: Would like to set a fontFace here, but due to\n            // https://github.com/Microsoft/monaco-editor/issues/392\n            // it breaks wordwrap\n\n            fontSize: 16,\n            wordWrap: 'on',\n\n            ...this.props.options\n        };\n\n        if (!options.readOnly) {\n            return <EditorFocusWrapper>\n                <MonacoEditor\n                    {...this.props}\n                    options={options}\n                    editorDidMount={this.onEditorDidMount}\n                />\n            </EditorFocusWrapper>;\n        } else {\n            // Read-only editors don't capture tab/shift-tab, so don't need\n            // any special focus management.\n            return <MonacoEditor\n                {...this.props}\n                options={options}\n                editorDidMount={this.onEditorDidMount}\n            />;\n        }\n    }\n}","import * as _ from 'lodash';\n\nimport { UnreachableCheck } from '../../util/error';\n\nimport {\n    HtkMockRule,\n    RuleType,\n    HandlerClassKey,\n    MatcherClassKey\n} from \"./rules\";\nimport {\n    MethodMatchers\n} from './definitions/http-rule-definitions';\n\nfunction withFirstCharUppercased(input: string): string {\n    return input[0].toUpperCase() + input.slice(1);\n}\n\nconst isMethod = (key: any): key is keyof typeof MethodMatchers => {\n    return key in MethodMatchers;\n};\n\n// Summarize a single type of matcher (for listing matcher options)\nexport function summarizeMatcherClass(key: MatcherClassKey): string {\n    if (isMethod(key)) return `${key} requests`;\n\n    switch (key) {\n        case 'wildcard':\n        case 'default-wildcard':\n            return \"Any requests\";\n        case 'ws-wildcard':\n        case 'default-ws-wildcard':\n            return 'Any WebSocket';\n        case 'rtc-wildcard':\n            return \"Any WebRTC connection\";\n\n        case 'method':\n            return \"Sent with HTTP method\";\n        case 'host':\n            return \"For a host\";\n        case 'simple-path':\n            return \"For a URL\";\n        case 'regex-path':\n            return \"For URLs matching\";\n        case 'query':\n            return \"With query parameters including\";\n        case 'exact-query-string':\n            return \"With exact query string\";\n        case 'header':\n            return \"Including headers\";\n        case 'cookie':\n            return \"With cookie\";\n        case 'raw-body':\n            return \"With exact body\";\n        case 'raw-body-includes':\n            return \"With body including\";\n        case 'form-data':\n            return \"With form data\";\n        case 'json-body':\n            return \"With JSON body\";\n        case 'json-body-matching':\n            return \"With JSON body including\";\n        case 'protocol':\n            return \"With protocol\";\n        case 'port':\n            return \"For port\";\n        case 'hostname':\n            return \"For hostname\";\n\n        case 'eth-method':\n            return \"An Ethereum interaction\";\n        case 'eth-params':\n            return \"With Ethereum parameters matching\";\n\n        case 'ipfs-interaction':\n            return \"An IPFS interaction\";\n        case 'ipfs-arg':\n            return \"With IPFS argument\";\n\n        case 'has-rtc-data-channel':\n            return \"Including a data channel\";\n        case 'has-rtc-video-track':\n            return \"Including a video track\";\n        case 'has-rtc-audio-track':\n            return \"Including an audio track\";\n        case 'has-rtc-media-track':\n            return \"Including any media track\";\n        case 'rtc-page-hostname':\n            return \"Sent from a web page on a specific hostname\";\n        case 'rtc-page-regex':\n            return \"Sent from a web page matching a URL regex\";\n        case 'rtc-user-agent-regex':\n            return \"Sent by a user agent matching a regex\";\n\n        case 'am-i-using':\n        case 'callback':\n        case 'multipart-form-data':\n        case 'raw-body-regexp':\n            throw new Error(`${key} handler should not be used directly`);\n        default:\n            throw new UnreachableCheck(key);\n    }\n};\n\nexport function nameHandlerClass(key: HandlerClassKey): string {\n    switch (key) {\n        case 'simple':\n            return \"fixed response\";\n        case 'file':\n            return \"file response\";\n        case 'forward-to-host':\n        case 'ws-forward-to-host':\n            return \"forwarding\";\n        case 'passthrough':\n        case 'ws-passthrough':\n            return \"passthrough\";\n        case 'req-res-transformer':\n            return \"transform\";\n        case 'request-breakpoint':\n        case 'response-breakpoint':\n        case 'request-and-response-breakpoint':\n            return \"breakpoint\";\n        case 'timeout':\n            return \"timeout\";\n        case 'close-connection':\n            return \"connection close\";\n        case 'reset-connection':\n            return \"connection reset\";\n\n        case 'ws-reject':\n            return \"reject\";\n        case 'ws-listen':\n            return \"listen\";\n        case 'ws-echo':\n            return \"echo\";\n\n        case 'eth-call-result':\n        case 'eth-number-result':\n        case 'eth-hash-result':\n        case 'eth-receipt-result':\n        case 'eth-block-result':\n            return \"fixed result\";\n        case 'eth-error':\n            return \"error\";\n\n        case 'ipfs-cat-text':\n        case 'ipfs-add-result':\n        case 'ipns-resolve-result':\n        case 'ipns-publish-result':\n        case 'ipfs-pins-result':\n        case 'ipfs-pin-ls-result':\n            return \"fixed result\";\n        case 'ipfs-cat-file':\n            return \"file\";\n\n        case 'wait-for-duration':\n        case 'wait-for-rtc-data-channel':\n        case 'wait-for-rtc-track':\n        case 'wait-for-rtc-media':\n        case 'wait-for-rtc-message':\n        case 'create-rtc-data-channel':\n        case 'send-rtc-data-message':\n        case 'close-rtc-connection':\n        case 'echo-rtc':\n        case 'rtc-dynamic-proxy':\n            return 'WebRTC';\n\n        case 'json-rpc-response':\n        case 'rtc-peer-proxy':\n        case 'callback':\n        case 'stream':\n            throw new Error(`${key} handler should not be used directly`);\n        default:\n            throw new UnreachableCheck(key);\n    }\n}\n\nexport function summarizeHandlerClass(key: HandlerClassKey): string {\n    switch (key) {\n        case 'simple':\n            return \"Return a fixed response\";\n        case 'file':\n            return \"Return a response from a file\";\n        case 'forward-to-host':\n            return \"Forward the request to a different host\";\n        case 'passthrough':\n            return \"Pass the request on to its destination\";\n        case 'req-res-transformer':\n            return \"Transform the real request or response automatically\";\n        case 'request-breakpoint':\n            return \"Pause the request to manually edit it\";\n        case 'response-breakpoint':\n            return \"Pause the response to manually edit it\";\n        case 'request-and-response-breakpoint':\n            return \"Pause the request & response to manually edit them\";\n        case 'timeout':\n            return \"Time out with no response\";\n        case 'close-connection':\n            return \"Close the connection\";\n        case 'reset-connection':\n            return \"Forcibly reset the connection\";\n\n        case 'ws-passthrough':\n            return \"Pass the WebSocket through to its destination\";\n        case 'ws-forward-to-host':\n            return \"Forward the WebSocket to a different host\";\n        case 'ws-reject':\n            return \"Reject the WebSocket setup request\";\n        case 'ws-listen':\n            return \"Accept the WebSocket but send no messages\";\n        case 'ws-echo':\n            return \"Echo all messages\";\n\n        case 'eth-call-result':\n            return \"Return a fixed eth_call result\";\n        case 'eth-number-result':\n        case 'eth-hash-result':\n            return \"Return a fixed value\";\n        case 'eth-receipt-result':\n            return \"Return a fixed transaction receipt\";\n        case 'eth-block-result':\n            return \"Return fixed Ethereum block data\";\n        case 'eth-error':\n            return \"Return an Ethereum error response\";\n\n        case 'ipfs-cat-text':\n            return \"Return fixed IPFS content\";\n        case 'ipfs-cat-file':\n            return \"Return IPFS content from a file\";\n        case 'ipfs-add-result':\n            return \"Return a fixed IPFS add result\";\n        case 'ipns-resolve-result':\n            return \"Return a fixed IPNS resolved address\";\n        case 'ipns-publish-result':\n            return \"Return a fixed succesful IPNS result\";\n        case 'ipfs-pins-result':\n            return \"Return a fixed IPFS pinning result\";\n        case 'ipfs-pin-ls-result':\n            return \"Return a fixed list of IPFS pins\";\n\n        case 'wait-for-duration':\n            return \"Sleep for a given duration\";\n        case 'wait-for-rtc-data-channel':\n            return \"Wait for a data channel to be opened\";\n        case 'wait-for-rtc-track':\n            return \"Wait for a media track to be opened\";\n        case 'wait-for-rtc-media':\n            return \"Wait for any media to be received\";\n        case 'wait-for-rtc-message':\n            return \"Wait for a data message to be received\";\n        case 'create-rtc-data-channel':\n            return \"Create a data channel\";\n        case 'send-rtc-data-message':\n            return \"Send a data message\";\n        case 'close-rtc-connection':\n            return \"Close the WebRTC connection\";\n        case 'echo-rtc':\n            return \"Echo all messages and media\";\n        case 'rtc-dynamic-proxy':\n            return \"Proxy all traffic to the real remote peer\";\n\n        case 'json-rpc-response':\n        case 'rtc-peer-proxy':\n        case 'callback':\n        case 'stream':\n            throw new Error(`${key} handler should not be used directly`);\n        default:\n            throw new UnreachableCheck(key);\n    }\n}\n\n// Summarize the matchers of an instantiated rule\n// Slight varation on the Mockttp explanation to make the\n// comma positioning more consistent for UX of changing rules\nexport function summarizeMatcher(rule: HtkMockRule): string {\n    const { matchers } = rule;\n\n    if (matchers.length === 0) return 'Never';\n    if (matchers.length === 1) return matchers[0]!.explain();\n    if (matchers.length === 2) {\n        // With just two explanations you can just combine them\n        return `${matchers[0]!.explain()} ${matchers[1].explain()}`;\n    }\n\n    // With 3+, we need to oxford comma separate the later\n    // explanations, to make them readable\n    return matchers[0]!.explain() + ' ' +\n        matchers.slice(1, -1)\n        .map((m) => m.explain())\n        .join(', ') +\n        (matchers.length > 3 ? ', and ' : ', ') + // We 'and' only with *many*\n        matchers.slice(-1)[0].explain();\n}\n\n// Summarize the handler of an instantiated rule\nexport function summarizeHandler(rule: HtkMockRule): string {\n    if ('steps' in rule) {\n        const stepExplanations = rule.steps.map(s => s.explain());\n        return withFirstCharUppercased(\n            stepExplanations.length > 1\n            ? (stepExplanations.slice(0, -1).join(', ') + ' then ' + stepExplanations.slice(-1)[0])\n            : stepExplanations[0]\n        );\n    } else {\n        return withFirstCharUppercased(rule.handler.explain());\n    }\n}","import * as React from 'react';\n\nimport { styled } from '../../styles'\nimport { Icon } from '../../icons';\nimport { getStatusColor } from '../../model/events/categorization';\n\nexport const StatusCode = styled((props: {\n    status:\n        | undefined // Still in progress\n        | 'aborted' // Failed before response\n        | 'WS:open' // Accepted active websocket\n        | 'WS:closed' // Accepted but now closed websocket\n        | number, // Any other status\n    message?: string,\n    className?: string\n}) => (\n    <div\n        className={props.className}\n        title={!props.status ? 'Waiting for response...' : (props.message || undefined) }\n    >\n        {\n            props.status === 'aborted' ?\n                <Icon icon={['fas', 'ban']} />\n            : props.status === 'WS:open'\n                ? <>\n                    WS <Icon\n                        icon={['fas', 'spinner']}\n                        spin={true}\n                    />\n                </>\n            : props.status === 'WS:closed'\n                ? 'WS'\n            : (\n                props.status ||\n                <Icon\n                    icon={['fas', 'spinner']}\n                    spin={true}\n                />\n            )\n        }\n    </div>\n))`\n    font-weight: bold;\n\n    display: flex;\n    align-items: center;\n\n    .fa-spinner {\n        padding: 6px;\n    }\n\n    .fa-ban {\n        padding: 5px;\n    }\n\n    color: ${props => getStatusColor(\n        (props.status === 'WS:open' || props.status === 'WS:closed')\n            ? undefined\n            : props.status,\n        props.theme\n    )};\n`;","import * as React from 'react';\nimport { observer, inject } from 'mobx-react';\nimport * as dateFns from 'date-fns';\nimport * as dedent from 'dedent';\nimport * as Ajv from 'ajv';\n\nimport { CollectedEvent } from '../../types';\nimport { saveFile, uploadFile, Ctrl } from '../../util/ui';\n\nimport { AccountStore } from '../../model/account/account-store';\nimport { EventsStore } from '../../model/events/events-store';\nimport { generateHar } from '../../model/http/har';\nimport { logError } from '../../errors';\nimport { formatAjvError } from '../../util/json-schema';\n\nimport { IconButton } from '../common/icon-button';\n\nexport const ClearAllButton = observer((props: {\n    className?: string,\n    disabled: boolean,\n    onClear: () => void\n}) => <IconButton\n    icon={['far', 'trash-alt']}\n    title={`Clear all (${Ctrl}+Shift+Delete)`}\n    disabled={props.disabled}\n    onClick={props.onClear}\n/>);\n\nexport const ExportAsHarButton = inject('accountStore')(observer((props: {\n    className?: string,\n    accountStore?: AccountStore,\n    events: CollectedEvent[]\n}) => {\n    const { isPaidUser } = props.accountStore!;\n\n    return <IconButton\n        icon={['fas', 'save']}\n        title={\n            isPaidUser\n                ? 'Export these exchanges as a HAR file'\n                : (\n                    'With Pro: Export requests & responses as a HAR file, ' +\n                    'to save for later or share with others'\n                )\n        }\n        disabled={!isPaidUser || props.events.length === 0}\n        onClick={async () => {\n            const harContent = JSON.stringify(\n                await generateHar(props.events)\n            );\n            const filename = `HTTPToolkit_${\n                dateFns.format(Date.now(), 'YYYY-MM-DD_HH-mm')\n            }.har`;\n\n            saveFile(filename, 'application/har+json;charset=utf-8', harContent);\n        }}\n    />\n}));\n\nexport const ImportHarButton = inject('eventsStore', 'accountStore')(\n    observer((props: {\n        accountStore?: AccountStore,\n        eventsStore?: EventsStore\n    }) => {\n        const { isPaidUser } = props.accountStore!;\n\n        return <IconButton\n            icon={['fas', 'folder-open']}\n            title={\n                isPaidUser\n                    ? 'Import exchanges from a HAR file'\n                    : (\n                        'With Pro: Import requests & responses from HAR files, ' +\n                        'to examine past recordings or data from other tools'\n                    )\n            }\n            disabled={!isPaidUser}\n            onClick={async () => {\n                const uploadedFile = await uploadFile('text', ['.har', 'application/har', 'application/har+json']);\n                if (uploadedFile) {\n                    let data: {};\n                    try {\n                        data = JSON.parse(uploadedFile);\n                        await props.eventsStore!.loadFromHar(data);\n                    } catch (error: any) {\n                        logError(error);\n\n                        if (error.name === 'HARError' && error.errors) {\n                            alert(dedent`\n                                HAR file is not valid.\n\n                                ${\n                                    error.errors\n                                    .map((e: Ajv.ErrorObject) => formatAjvError(data, e))\n                                    .join('\\n')\n                                }\n                            `);\n                        } else {\n                            alert(dedent`\n                                Could not parse HAR file.\n\n                                ${error.message || error}\n                            `);\n                        }\n                    }\n                }\n            }}\n        />\n    })\n);\n\nexport const PlayPauseButton = inject('eventsStore')(\n    observer((props: {\n        eventsStore?: EventsStore\n    }) => {\n        const { isPaused, togglePause } = props.eventsStore!;\n\n        return <IconButton\n            icon={['fas', isPaused ? 'play' : 'pause']}\n            title={`${isPaused ? 'Resume' : 'Pause'} collecting intercepted exchanges`}\n            onClick={togglePause}\n        />\n    })\n);\n\nexport const ScrollToEndButton = (props: { onScrollToEnd: () => void }) =>\n    <IconButton\n        icon={['fas', 'level-down-alt']}\n        title=\"Scroll to the bottom of the list\"\n        onClick={props.onScrollToEnd}\n    />","import * as _ from 'lodash';\n\nimport {\n    FilterClass,\n    Filters,\n    FilterSet,\n    StringFilter\n} from './search-filters';\nimport {\n    SyntaxSuggestion,\n    matchSyntax,\n    applySuggestionToText,\n    getSuggestions\n} from './syntax-matching';\nimport { FixedStringSyntax } from './syntax-parts';\n\n/**\n * Takes a full string, parses it completely for filters, and returns a\n * list of the parser result. Used when pasting a complete list of\n * filters into the search input.\n */\nexport function matchFilters(filterClasses: FilterClass[], value: string): FilterSet {\n    let remainingString = value.trim();\n    let filters = [];\n\n    // Repeatedly parse filter from the start of the input\n    while (remainingString.length > 0) {\n        const firstFullMatch = filterClasses\n            .map(filterClass => ({\n                filterClass,\n                match: matchSyntax(filterClass.filterSyntax, remainingString, 0)\n            }))\n            .filter((fm) => !!fm.match && fm.match.type === 'full')[0];\n\n        if (!firstFullMatch) break;\n\n        const consumed = firstFullMatch.match!.fullyConsumed;\n        const matchedString = remainingString.slice(0, consumed);\n        remainingString = remainingString.slice(consumed).trimLeft();\n\n        // Unshift here, because filter array runs in reverse to the inputs\n        filters.unshift(new firstFullMatch.filterClass(matchedString));\n    }\n\n    // We've either run out of string, or stopped being able to match anything\n    // Turn the leftovers into a StringFilter, and return the whole lot:\n    return [\n        new StringFilter(remainingString),\n        ..._.flatten(filters)\n    ];\n}\n\nexport interface FilterSuggestion extends SyntaxSuggestion {\n    filterClass: FilterClass;\n};\n\n/**\n * Takes a full string, and given a list of filters, returns an\n * appropriate list of suggestions to show the user, with the filter\n * metadata required to immediately create the filters.\n *\n * Optionally also takes context, which may be used by some syntax\n * parts to provide more specific context-driven suggestions.\n */\nexport function getFilterSuggestions<T>(\n    filters: FilterClass<T>[],\n    value: string,\n    context?: T\n): FilterSuggestion[] {\n    const suggestions = getSuggestions(\n        filters.map((filterClass) => ({\n            key: filterClass,\n            syntax: filterClass.filterSyntax\n        })),\n        value,\n        0,\n        { context }\n    )\n\n    return suggestions.map(({ key: filterClass, suggestion }) => ({\n        filterClass,\n        ...suggestion,\n    }));\n}\n\n/**\n * Given a selected suggestion and the current list of filters, returns\n * a new list of filters with the suggestion applied.\n *\n * This either updates the string content (given the suggestion for part\n * of a rule) or clears the string content and creates a new filter.\n */\nexport function applySuggestionToFilters(\n    filterSet: FilterSet,\n    suggestion: FilterSuggestion\n): FilterSet {\n    const text = filterSet[0].filter;\n\n    const updatedText = applySuggestionToText(text, suggestion);\n\n    if (suggestion.matchType === 'full') {\n        return [\n            new StringFilter(\"\"),\n            ..._.flatten([\n                // Flattened because a filterClass can expand to multiple filter\n                // instances, e.g. for saved custom filters\n                new suggestion.filterClass(updatedText.trim())\n            ]),\n            ...filterSet.slice(1)\n        ];\n    } else {\n        return [\n            new StringFilter(updatedText),\n            ...filterSet.slice(1)\n        ];\n    }\n}\n\nexport interface CustomFilterClass extends FilterClass {\n    isCustomFilter: true;\n    filterName: string;\n}\n\nexport function buildCustomFilter(\n    name: string, // A name for your custom filter\n    filterString: string, // The full filter string it expands to\n    availableFilters: FilterClass[] // Parsed in the context of this set of filter classes\n): CustomFilterClass {\n    const parsedFilters = matchFilters(availableFilters, filterString);\n\n    // Skip empty string filters\n    const filtersToInsert = parsedFilters[0].filter === ''\n        ? parsedFilters.slice(1)\n        : parsedFilters; // Only include the string filter if it's non-empty\n\n    // Build a fake constructor that produces the filters within, rather than\n    // building a filter by itself as normal.\n    const factory = (function () { return filtersToInsert; }) as unknown as (new () => Filters);\n    return Object.assign(factory, {\n        filterSyntax: [new FixedStringSyntax(name)],\n        filterDescription: () => filterString,\n\n        filterName: name,\n        isCustomFilter: true\n    } as const);\n};\n\nexport function isCustomFilter(\n    f: FilterClass & { isCustomFilter?: boolean }\n): f is CustomFilterClass {\n    return !!f.isCustomFilter;\n}","import * as React from 'react';\nimport * as polished from 'polished';\n\nimport { styled } from '../../../styles';\nimport { Icon } from '../../../icons';\n\nimport { Filter } from '../../../model/filters/search-filters';\n\nconst FilterTagDelete = styled(Icon).attrs(() => ({\n    icon: ['fas', 'times']\n}))`\n    position: absolute;\n    right: -20px;\n    top: 50%;\n    transform: translateY(-50%);\n    transition: right 0.1s;\n    cursor: pointer;\n\n    padding: 6px;\n    background-image: radial-gradient(\n        ${p => polished.rgba(p.theme.mainBackground, 0.9)} 50%,\n        transparent 100%\n    );\n\n    &:hover {\n        color: ${p => p.theme.popColor};\n    }\n`;\n\nconst FilterTagName = styled.span`\n    white-space: pre; /* Nowrap + show spaces accurately */\n    overflow: hidden;\n    text-overflow: ellipsis;\n    padding: 4px;\n`\n\nconst FilterTagContainer = styled.div`\n    flex-shrink: 0;\n\n    display: flex;\n    align-items: center;\n\n    position: relative;\n    overflow: hidden;\n\n    min-width: 0;\n    max-width: 100%;\n    box-sizing: border-box;\n\n    margin-right: 5px;\n\n    background-color: ${p => p.theme.mainBackground};\n    border: 1px solid ${p => p.theme.containerWatermark};\n    box-shadow: 0 2px 4px 0 rgba(0,0,0,0.2);\n    border-radius: 3px;\n\n    cursor: pointer;\n\n    &:hover, &:focus-within {\n        box-shadow: 0 2px 4px 0 rgba(0,0,0,0.4);\n    }\n\n    &:hover {\n        > ${FilterTagDelete} {\n            right: 0;\n        }\n    }\n\n    &:focus-within {\n        outline: none;\n        border-color: ${p => p.theme.popColor};\n    }\n\n    &.is-selected {\n        background-color: ${p => p.theme.mainLowlightBackground};\n        box-shadow: inset 0 0 12px -8px #000;\n    }\n\n    & ::selection {\n        background-color: transparent;\n    }\n`;\n\nfunction ignoreTripleClick(event: React.MouseEvent<HTMLDivElement>) {\n    if (event.detail === 3) event.preventDefault();\n}\n\nexport const FilterTag = React.forwardRef((props: {\n    filter: Filter,\n    isSelected: boolean,\n    onDelete: () => void\n    onKeyDown?: (event: React.KeyboardEvent<HTMLDivElement>) => void\n}, ref: React.Ref<HTMLDivElement>) => {\n    return <FilterTagContainer\n        ref={ref}\n        className={'filter-tag' + (props.isSelected ? ' is-selected' : '')}\n        tabIndex={-1}\n        onKeyDown={props.onKeyDown}\n        onMouseDown={ignoreTripleClick}\n        title={`Match ${props.filter.filterDescription}`}\n    >\n        <FilterTagName>{ props.filter.toString() }</FilterTagName>\n        <FilterTagDelete onClick={props.onDelete} />\n    </FilterTagContainer>;\n});","import * as React from 'react';\n\nimport { styled, css } from '../../../styles';\n\nimport { FilterSuggestion } from '../../../model/filters/filter-matching';\nimport { applySuggestionToText } from '../../../model/filters/syntax-matching';\n\nimport { IconButton } from '../../common/icon-button';\nimport { longestPrefix } from '../../../util';\n\nconst ExistingText = styled.span`\n    font-weight: bold;\n`;\n\nconst SuggestedText = styled.span`\n    opacity: 0.7;\n`;\n\nconst SuggestionRowContainer = styled.div<{ isHighlighted: boolean }>`\n    background-color: ${p => p.isHighlighted\n        ? p.theme.highlightBackground\n        : p.theme.mainBackground\n    };\n\n    ${p => p.isHighlighted && css`\n        ${SuggestedText} {\n            opacity: 1;\n        }\n    `}\n\n    width: 100%;\n    cursor: pointer;\n\n    font-size: ${p => p.theme.textSize};\n`;\n\nconst SuggestionRowPart = styled.p`\n    padding: 8px;\n`;\n\nconst SuggestionDetails = styled(SuggestionRowPart)`\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: pre; /* Nowrap + show spaces accurately */\n\n    ${(p: { isHighlighted: boolean }) => p.isHighlighted && css`\n        box-shadow: 0px -8px 10px -10px rgba(0,0,0,0.3);\n    `}\n\n    svg {\n        margin-left: auto;\n    }\n`;\n\nconst SuggestionDeleteButton = styled(IconButton).attrs(() => ({\n    icon: ['far', 'trash-alt']\n}))`\n    float: right;\n    padding: 4px;\n    margin: -4px -4px;\n`;\n\nconst SuggestionDescription = styled(SuggestionRowPart)`\n    background-color: ${p => p.theme.mainLowlightBackground};\n    box-shadow:\n        inset 0px 12px 8px -10px rgba(0,0,0,0.15),\n        inset 0px -8px 8px -10px rgba(0,0,0,0.15);\n\n    white-space: pre; /* Nowrap + show spaces accurately */\n    overflow: hidden;\n    text-overflow: ellipsis;\n`;\n\nexport const FilterSuggestionRow = (props: {\n    suggestion: FilterSuggestion,\n    query: string,\n    isHighlighted: boolean,\n    onDelete?: () => void\n}) => {\n    const { suggestion, query, isHighlighted, onDelete } = props;\n\n    // Work out how many chars of the query are included in the showAs/value text\n    // We want both - when they differ, it's a template value or similar.\n    const commonText = longestPrefix(\n        query.slice(suggestion.index),\n        suggestion.value,\n        suggestion.showAs\n    );\n    const partiallyMatchedChars = commonText.length;\n\n    // If there is overlap, treat the existing+suggested chars as just existing text\n    const existingText = query.slice(0, suggestion.index + partiallyMatchedChars);\n    const suggestedAddition = suggestion.showAs.slice(partiallyMatchedChars);\n\n    const filterDescription = `Match ${suggestion.filterClass.filterDescription(\n        applySuggestionToText(query, suggestion),\n        suggestion.matchType === 'template'\n    ) }`;\n\n    return <SuggestionRowContainer isHighlighted={isHighlighted}>\n        <SuggestionDetails isHighlighted={isHighlighted}>\n            <ExistingText>{ existingText }</ExistingText>\n            <SuggestedText>{ suggestedAddition }</SuggestedText>\n            { onDelete &&\n                <SuggestionDeleteButton\n                    title=\"Delete this custom filter shortcut\"\n                    onClick={(e) => {\n                        onDelete();\n                        e.preventDefault();\n                        e.stopPropagation();\n                    }}\n                />\n            }\n        </SuggestionDetails>\n\n        { isHighlighted &&\n            <SuggestionDescription title={filterDescription}>\n                { filterDescription }\n            </SuggestionDescription>\n        }\n    </SuggestionRowContainer>;\n}","import * as React from 'react';\n\nimport { styled, css } from '../../../styles';\nimport { Icon } from '../../../icons';\n\nexport type SaveFiltersSuggestion = {\n    saveFilters: true,\n    filterCount: number,\n    isPaidUser: boolean\n};\n\nexport const isSaveFiltersSuggestion = (suggestion: any): suggestion is SaveFiltersSuggestion =>\n        'saveFilters' in suggestion && suggestion.saveFilters === true;\n\nconst SaveFiltersContainer = styled.div<{ isHighlighted: boolean }>`\n    background-color: ${p => p.isHighlighted\n        ? p.theme.highlightBackground\n        : p.theme.mainBackground\n    };\n\n    :not(:first-child) {\n        border-top: 1px solid ${p => p.theme.containerBorder};\n    }\n\n    ${(p: { isHighlighted: boolean }) => p.isHighlighted && css`\n        box-shadow: 0px -8px 10px -10px rgba(0,0,0,0.3);\n        font-weight: bold;\n    `}\n\n    width: 100%;\n    cursor: pointer;\n\n    padding: 8px;\n    box-sizing: border-box;\n\n    font-size: ${p => p.theme.textSize};\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n\n    svg {\n        margin-right: 5px;\n    }\n`;\n\nexport const SaveFiltersRow = (props: {\n    filterCount: number,\n    query: string,\n    isHighlighted: boolean,\n    isPaidUser: boolean\n}) => {\n    return <SaveFiltersContainer isHighlighted={props.isHighlighted}>\n        {\n            props.isPaidUser\n            ? <>\n                <Icon icon={['fas', 'save']} />\n                Save {\n                    props.filterCount > 1\n                    ? `these ${props.filterCount} filters`\n                    : 'this filter'\n                } as { `'${props.query}'` || '...' }\n            </>\n            : <>\n                <Icon icon={['far', 'star']} />\n                Get Pro to save {\n                    props.filterCount > 1\n                    ? `these ${props.filterCount} filters`\n                    : 'this filter'\n                } as { `'${props.query}'` || '...' }\n            </>\n        }\n    </SaveFiltersContainer>\n}","import * as _ from 'lodash';\nimport * as React from 'react';\nimport * as Autosuggest from 'react-autosuggest';\n\nimport { styled } from '../../../styles';\nimport { trackEvent } from '../../../metrics';\n\nimport {\n    Filter,\n    FilterClass,\n    FilterSet,\n    StringFilter\n} from '../../../model/filters/search-filters';\nimport {\n    FilterSuggestion,\n    getFilterSuggestions,\n    applySuggestionToFilters,\n    isCustomFilter,\n    CustomFilterClass\n} from '../../../model/filters/filter-matching';\nimport { applySuggestionToText } from '../../../model/filters/syntax-matching';\n\nimport { FilterSuggestionRow } from './filter-suggestion-row';\nimport {\n    SaveFiltersSuggestion,\n    isSaveFiltersSuggestion,\n    SaveFiltersRow\n} from './save-filters-row';\n\nconst FilterInputField = styled.input`\n    box-sizing: border-box;\n    width: 100%;\n    height: 100%;\n\n    padding: 3px 0 4px 1px;\n    border: none;\n    outline: none;\n\n    background-color: ${p => p.theme.highlightBackground};\n    color: ${p => p.theme.highlightColor};\n    font-size: ${p => p.theme.textSize};\n\n    ::placeholder {\n        /*\n        For some reason, I think related to react-split-pane setting 'user-select: text',\n        the placeholder gets selected by selection.selectAllChildren. This stops that:\n        */\n        user-select: none;\n    }\n`;\n\nconst FilterSuggestionsBox = styled.div`\n    position: absolute;\n    bottom: calc(100% + 10px);\n    left: 0;\n    right: 0;\n    z-index: 1;\n\n    background-color: ${p => p.theme.mainBackground};\n    border: 1px solid ${p => p.theme.containerBorder};\n    box-shadow: 0 2px 4px 0 rgba(0,0,0,0.2);\n\n    border-radius: 4px;\n    .react-autosuggest__suggestion:first-child > * {\n        border-radius: 4px 4px 0 0;\n    }\n    .react-autosuggest__suggestion:last-child > *, .react-autosuggest__suggestion:last-child > * > * {\n        border-radius: 0 0 4px 4px;\n    }\n    .react-autosuggest__suggestion:first-child:last-child > * {\n        border-radius: 4px;\n    }\n\n    color: ${p => p.theme.highlightColor};\n    font-size: ${p => p.theme.textSize};\n\n    &:empty {\n        display: none;\n    }\n`;\n\n// Need to wrap these as functions, to make autosuggest happy:\nconst renderInputField = (props: any) => <FilterInputField {...props} />;\nconst renderSuggestionsBox = (props: { containerProps: any, children: any }) =>\n    <FilterSuggestionsBox {...props.containerProps}>\n        { props.children }\n    </FilterSuggestionsBox>;\nconst buildRowRenderer = (\n    onDeleteCustomFilter: (filterClass: CustomFilterClass) => void,\n    query: string // We can't use this from props, because it's unavoidably trimmed()\n) => (suggestion: SuggestionType, params: { isHighlighted: boolean }) => {\n        if (isSaveFiltersSuggestion(suggestion)) {\n            return <SaveFiltersRow {...suggestion} {...params} query={query} />;\n        }\n\n        const { filterClass } = suggestion;\n        const onDelete = isCustomFilter(filterClass)\n            ? () => onDeleteCustomFilter(filterClass)\n            : undefined;\n\n        return <FilterSuggestionRow\n            suggestion={suggestion}\n            {...params}\n            query={query}\n            onDelete={onDelete}\n        />;\n    };\n\ntype SuggestionType = FilterSuggestion | SaveFiltersSuggestion;\n\nconst areSuggestionsVisible = (autosuggestRef: React.RefObject<Autosuggest>) => {\n    const autosuggestRoot = autosuggestRef.current?.input?.parentElement;\n    const listbox = autosuggestRoot?.querySelector(\"[role='listbox']\");\n    return (listbox?.children.length || 0) > 0;\n};\n\nexport const FilterInput = <T extends unknown>(props: {\n    value: string,\n    placeholder: string,\n    searchInputRef?: React.Ref<HTMLInputElement>,\n    onChange: (event: React.ChangeEvent<HTMLInputElement>) => void,\n\n    activeFilters: FilterSet,\n    availableFilters: FilterClass<T>[],\n    suggestionContext?: T,\n\n    isPaidUser: boolean,\n    getPro: (source: string) => void,\n\n    onFiltersChanged: (filters: FilterSet) => void,\n    onFiltersConsidered: (filters: FilterSet | undefined) => void,\n    onFiltersSaved: (filters: Filter[], name: string) => void,\n    onCustomFilterDeleted: (filter: CustomFilterClass) => void\n}) => {\n    const autosuggestRef = React.useRef<Autosuggest>(null);\n\n    // React-autosuggest wants us to track state, and only update it when requested. We're going\n    // to ignore that, mainly because we want more direct control to update and show the\n    // suggestions more aggressively than it expects. Instead of updating on request, we useMemo\n    // to update the suggestions every time the value changes:\n    const suggestions = React.useMemo(() =>\n        getFilterSuggestions(props.availableFilters, props.value, props.suggestionContext)\n    , [props.availableFilters, props.value, props.suggestionContext]);\n\n    // Whenever a suggestion is highlighted, we fire an event with the filters that would be active if\n    // the suggestion is accepted, so that the list of events can preview the result.\n    const considerSuggestion = React.useCallback((data: { suggestion: SuggestionType | null }) => {\n        if (\n            data.suggestion &&\n            !isSaveFiltersSuggestion(data.suggestion) &&\n            areSuggestionsVisible(autosuggestRef)\n        ) {\n            if (data.suggestion.matchType === 'full') {\n                props.onFiltersConsidered(\n                    applySuggestionToFilters(props.activeFilters, data.suggestion)\n                );\n            } else {\n                // If you highlight a partial match, we show the filtered events as if you haven't\n                // entered any text, so you can still conveniently see the data until you either type\n                // something that's not a filter (filtering just by text), or closely match a filter\n                // directly (and we filter by that instead).\n                props.onFiltersConsidered([\n                    new StringFilter(''),\n                    ...props.activeFilters.slice(1)\n                ]);\n            }\n        } else {\n            props.onFiltersConsidered(undefined);\n        }\n    }, [props.onFiltersConsidered, props.activeFilters, autosuggestRef]);\n\n    // Ephemerally track the updated suggestions, so we can detect a selection in clearSuggestions()\n    // and update to show ongoing suggestions instead of hiding suggestions.\n    let updatedFilters: FilterSet | undefined = undefined;\n\n    const selectSuggestion = React.useCallback((\n        event: React.FormEvent<any>,\n        data: { suggestion: SuggestionType }\n    ) => {\n        // Due to some race conditions, it's possible that react-autosuggest can think we have a\n        // suggestion selected even when none is shown. Guard against that.\n        if (!areSuggestionsVisible(autosuggestRef)) return;\n\n        // If you select the save suggestion, we save the given filters using the\n        // text in the input as their new custom name.\n        if (isSaveFiltersSuggestion(data.suggestion)) {\n            if (!props.value) return; // No dice - we just ignore empty names\n\n            if (props.isPaidUser) {\n                props.onFiltersSaved(props.activeFilters.slice(1), props.value);\n            } else {\n                props.getPro('save-filter');\n            }\n            return;\n        }\n\n        updatedFilters = applySuggestionToFilters(props.activeFilters, data.suggestion);\n        if (updatedFilters.length !== props.activeFilters.length) {\n            trackEvent({\n                category: 'Filters',\n                action: 'Create',\n                // Track most used filter types, *not* input or params\n                value: data.suggestion.filterClass.filterName\n            });\n        }\n        props.onFiltersChanged(updatedFilters);\n    }, [updatedFilters, props.value, props.isPaidUser, props.getPro, props.activeFilters, props.onFiltersChanged]);\n\n    const clearSuggestions = React.useCallback(() => {\n        const autosuggest = autosuggestRef.current as any;\n\n        if (updatedFilters && updatedFilters.length === props.activeFilters.length) {\n            // If this is due to a filter update, but a new filter hasn't been created (i.e. we\n            // had a partial match, for a single part) then force the suggestions to stay visible:\n            autosuggest.justSelectedSuggestion = false;\n            autosuggest.revealSuggestions();\n            updatedFilters = undefined;\n        }\n\n        // We ignore actual requests to clear the suggestions, because we show the\n        // suggestions in almost all cases anyway - we just clear selection highlighting\n        autosuggest.resetHighlightedSuggestion();\n        considerSuggestion({ suggestion: null });\n    }, [updatedFilters, selectSuggestion, props.activeFilters.length, autosuggestRef]);\n\n    const shouldRenderSuggestions = React.useCallback((value: string, reason: string) =>\n        value.trim().length > 0 ||\n        !['input-focused', 'input-changed', 'escape-pressed'].includes(reason)\n    , []);\n\n    const getSuggestionTextValue = React.useCallback((suggestion: SuggestionType) => {\n        if (isSaveFiltersSuggestion(suggestion)) return '';\n        else return applySuggestionToText(props.value, suggestion)\n    }, [props.value]);\n\n    const onInputChange = React.useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n        // React-autosuggest tries to update the input content to match the highlighted value.\n        // We don't want that, so we ignore changes where the input itself hasn't changed:\n        if (e.target.value === props.value) return;\n        else props.onChange(e);\n    }, [props.onChange, props.value]);\n\n    const inputProps = React.useMemo(() => ({\n        type: 'text',\n        value: props.value,\n        onChange: onInputChange,\n        placeholder: props.placeholder,\n        ref: props.searchInputRef\n    }), [props.value, onInputChange, props.placeholder, props.searchInputRef]);\n\n    // Whilst you're typing, if you've entered a filter, and you're typing but you haven't\n    // typed something that exactly matches one type of filter, show a 'save' option.\n    const shouldShowSave = props.activeFilters.length > 1 &&\n        props.value.length >= 1 &&\n        !props.value.includes(' ') &&\n        _.uniq(suggestions.map(s => s.filterClass)).length !== 1;\n\n    // If we have no suggestions, but we're showing a save option, don't highlight the\n    // option because it shouldn't be your default 'enter' action\n    const shouldHighlightFirst = !(shouldShowSave && suggestions.length === 0);\n\n    const suggestionsWithSave = React.useMemo(() => {\n        return shouldShowSave\n            ? (suggestions as Array<SuggestionType>).concat({\n                saveFilters: true,\n                isPaidUser: props.isPaidUser,\n                filterCount: props.activeFilters.length - 1 // -1 to exclude text filter\n            })\n            : suggestions\n    }, [shouldShowSave, props.isPaidUser, suggestions, props.activeFilters]);\n\n    const rowRenderer = React.useMemo(() =>\n        buildRowRenderer(props.onCustomFilterDeleted, props.value)\n    , [props.onCustomFilterDeleted, props.value]);\n\n    return <Autosuggest\n        ref={autosuggestRef}\n        multiSection={false}\n        suggestions={suggestionsWithSave}\n        highlightFirstSuggestion={shouldHighlightFirst}\n        shouldRenderSuggestions={shouldRenderSuggestions}\n        onSuggestionsFetchRequested={_.noop} // No-op: we useMemo to keep suggestion up to date manually\n        onSuggestionsClearRequested={clearSuggestions}\n        onSuggestionHighlighted={considerSuggestion}\n        onSuggestionSelected={selectSuggestion}\n        getSuggestionValue={getSuggestionTextValue}\n        renderSuggestion={rowRenderer}\n        renderInputComponent={renderInputField}\n        renderSuggestionsContainer={renderSuggestionsBox}\n        inputProps={inputProps}\n    />;\n};","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { disposeOnUnmount, inject, observer } from 'mobx-react';\nimport { action, computed, observable } from 'mobx';\nimport { trackUndo } from 'mobx-shallow-undo';\nimport * as polished from 'polished';\n\nimport { css, styled } from '../../../styles';\nimport { copyToClipboard, isCmdCtrlPressed } from '../../../util/ui';\n\nimport {\n    Filter,\n    FilterSet,\n    StringFilter,\n    FilterClass,\n    emptyFilterSet\n} from '../../../model/filters/search-filters';\nimport {\n    matchFilters,\n    buildCustomFilter,\n    CustomFilterClass\n} from '../../../model/filters/filter-matching';\nimport { UiStore } from '../../../model/ui/ui-store';\nimport { AccountStore } from '../../../model/account/account-store';\n\nimport { IconButton, IconButtonLink } from '../../common/icon-button';\nimport { FilterTag } from './filter-tag';\nimport { FilterInput } from './filter-input';\n\nconst CLEAR_BUTTON_WIDTH = '30px';\n\nconst SearchFilterBox = styled.div<{ hasContents: boolean }>`\n    position: relative;\n\n    &:focus-within {\n        border-color: ${p => p.theme.highlightColor};\n    }\n\n    flex-grow: 1;\n    min-width: 0; /* Don't let flexbox force this to expand given long tags */\n    padding-right: ${p => p.hasContents ? CLEAR_BUTTON_WIDTH : '0'};\n\n    border-radius: 4px;\n\n    border: 1px solid ${p => p.theme.containerBorder};\n    box-shadow: inset 0 2px 4px 1px rgba(0, 0, 0, 0.1);\n    background-color: ${p => p.theme.highlightBackground};\n    color: ${p => p.theme.highlightColor};\n\n    font-size: ${p => p.theme.textSize};\n\n    display: flex;\n\n    &:hover, &:focus-within {\n        flex-wrap: wrap;\n    }\n    &:not(:hover):not(:focus-within) {\n        overflow: hidden;\n    }\n\n    /* Add a layer to act as a button background over non-wrapping content */\n    &:after {\n        content: \"\";\n        position: absolute;\n        display: block;\n\n        z-index: 5;\n\n        top: 4px;\n        bottom: 4px;\n\n        right: 0px;\n        width: 36px;\n        background: linear-gradient(\n            to right,\n            transparent 0%,\n            ${p => polished.rgba(p.theme.highlightBackground, 0.9)} 25%\n        );\n    }\n\n    .react-autosuggest__container {\n        flex-grow: 1;\n        flex-basis: 100px; /* Shrink down to this, then wrap */\n    }\n\n    padding-bottom: 4px;\n    > div {\n        margin: 4px 0 0 4px;\n    }\n`;\n\nconst FloatingSearchButtonStyles = css`\n    width: ${CLEAR_BUTTON_WIDTH};\n    padding: 4px 10px;\n    box-sizing: border-box;\n\n    /* This isn't needed for button, but is for buttonlink - unclear why but it works */\n    display: flex;\n    align-items: center;\n\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n\n    /* Appears in front of the :after background layer */\n    z-index: 10;\n`;\n\nconst FloatingClearFiltersButton = styled(IconButton)`${FloatingSearchButtonStyles}`;\nconst FloatingFilterDocsButtonLink = styled(IconButtonLink)`\n    ${FloatingSearchButtonStyles}\n    opacity: 0.8;\n`;\n\nconst deleteFilter = (filters: FilterSet, filter: Filter): FilterSet => {\n    return [\n        filters[0],\n        ...filters.slice(1).filter((f, i) =>\n            f !== filter // Keep all except our given filter\n        )\n    ] as const;\n};\n\nconst deleteFilterIndex = (filters: FilterSet, index: number): FilterSet => {\n    if (index === 0 || filters.length === 0) return filters; // No-op, we never remove the StringFilter\n    else return [\n        filters[0] as StringFilter,\n        ...filters.slice(1, index),\n        ...filters.slice(index + 1)\n    ];\n};\n\nconst getSelectedFilterElements = (filterBox: HTMLDivElement) => {\n    const selection = document.getSelection();\n    if (!selection || selection.isCollapsed) {\n        return [];\n    }\n\n    return [\n        ...Array.from(filterBox.querySelectorAll('.filter-tag')) as HTMLElement[],\n        filterBox.querySelector('input') as HTMLElement\n    ].filter((element) =>\n        selection.containsNode(element, true) // True => include partial selection\n    );\n}\n\n@inject('uiStore')\n@inject('accountStore')\n@observer\nexport class SearchFilter<T> extends React.Component<{\n    uiStore?: UiStore,\n    accountStore?: AccountStore,\n    onFiltersConsidered: (filters: FilterSet | undefined) => void,\n    availableFilters: FilterClass<T>[],\n    filterSuggestionContext?: T,\n    placeholder: string,\n    searchInputRef?: React.Ref<HTMLInputElement>\n}> {\n    private boxRef = React.createRef<HTMLDivElement>();\n\n    // Map HTML elements back to their corresponding filters, for selection tracking later\n    private tagRefs = new Map<HTMLElement, Filter>();\n\n    @observable.struct\n    private selectedFilters: Filter[] = [];\n\n    @computed\n    private get activeFilters() {\n        return this.props.uiStore!.activeFilterSet;\n    }\n\n    @action.bound\n    onFiltersChanged(filters: FilterSet) {\n        this.props.uiStore!.activeFilterSet = filters;\n    }\n\n    @computed\n    private get availableFilters() {\n        const builtInFilters = this.props.availableFilters;\n        const customFilters = Object.entries(this.props.uiStore!.customFilters)\n            .map(([name, filterString]) =>\n                buildCustomFilter(name, filterString, builtInFilters)\n            );\n\n        return builtInFilters.concat(customFilters);\n    }\n\n    private readonly undoer = trackUndo(\n        () => this.activeFilters,\n        (value) => this.onFiltersChanged(value)\n    );\n\n    getSelectedFilters() {\n        const selection = document.getSelection();\n        if (!selection || selection.isCollapsed) {\n            return [];\n        }\n\n        const { boxRef, tagRefs, activeFilters } = this;\n\n        const filterBox = boxRef.current;\n        if (filterBox) {\n            // Manually map the input element to the string search filter. We\n            // could probably do this with a ref, but it's messy, updating on\n            // demand here is easier.\n            tagRefs.set(filterBox.querySelector('input')!, activeFilters[0]);\n        }\n\n        // Update selectedFilters to match the filters selected for real in the document:\n        const currentlySelectedFilters: Filter[] = [];\n        Array.from(tagRefs.entries()).forEach(([tagElement, filter]) => {\n            // Clean up any dangling filter element keys:\n            if (!document.contains(tagElement)) {\n                tagRefs.delete(tagElement);\n                return;\n            }\n\n            if (selection.containsNode(tagElement, true)) { // True => include partial selection\n                currentlySelectedFilters.push(filter);\n            }\n        });\n\n        return currentlySelectedFilters;\n    }\n\n    updateSelectedTags = action(() => {\n        this.selectedFilters = this.getSelectedFilters();\n    })\n\n    componentDidMount() {\n        // Run the above, to match our internal selection state to the DOM, now and\n        // every time the DOM's selection state updates whilst we're mounted:\n        this.updateSelectedTags();\n\n        document.addEventListener('selectionchange', this.updateSelectedTags);\n        disposeOnUnmount(this, () => {\n            document.removeEventListener('selectionchange', this.updateSelectedTags);\n        });\n    }\n\n    private selectAllFilterTags() {\n        const filterBox = this.boxRef.current;\n        if (!filterBox) return;\n\n        window.getSelection()!.setBaseAndExtent(\n            filterBox, 0, // From the start (all tags)\n            filterBox.querySelector('[role=listbox]')!, 0 // Up to but excluding the suggestions box\n        );\n        // ^ This will trigger selectionchange and then updateSelectedTags\n    }\n\n    private deleteSelectedFilters() {\n        const { selectedFilters, onFiltersChanged, activeFilters } = this;\n\n        const remainingInputText = selectedFilters.includes(activeFilters[0])\n            ? \"\"\n            : activeFilters[0].filter || '';\n\n        onFiltersChanged([\n            new StringFilter(remainingInputText),\n            ...activeFilters.filter((f, i) =>\n                i > 0 && !selectedFilters.includes(f)\n            )\n        ]);\n    }\n\n    private onKeyDown = (event: React.KeyboardEvent<HTMLElement>) => {\n        const filterBox = this.boxRef.current;\n        if (!filterBox) return;\n\n        const { onFiltersChanged, activeFilters } = this;\n\n        const selectedFilterElements = getSelectedFilterElements(filterBox);\n\n        if (!filterBox.contains(document.activeElement)) {\n            // Somehow the focus & input is going elsewhere. Ignore this,\n            // and clear our selection entirely if we have one. Unlikely to\n            // happen in normal behaviour, this is here as a backstop.\n            if (selectedFilterElements) {\n                document.getSelection()!.removeAllRanges();\n            }\n            return;\n        }\n\n        if (event.key === 'a' && isCmdCtrlPressed(event)) {\n            // If you select-all, select both the filters and the input\n            this.selectAllFilterTags();\n            event.preventDefault();\n            return;\n        }\n\n        if (event.key.toLowerCase() === 'z' && isCmdCtrlPressed(event)) {\n            if (event.shiftKey) {\n                this.undoer.redo();\n            } else {\n                this.undoer.undo();\n            }\n            event.preventDefault();\n            return;\n        }\n\n        const filterTagElements = Array.from(filterBox.querySelectorAll('.filter-tag'));\n        const filterInput = filterBox.querySelector('input')!;\n        const filterElements = [...filterTagElements, filterInput] as HTMLElement[];\n\n        const focusedElement = document.activeElement;\n        const focusedElementIndex = filterElements.indexOf(focusedElement as HTMLElement);\n\n        if (focusedElement !== filterInput && event.key === 'v' && isCmdCtrlPressed(event)) {\n            // Inconsistently, onPaste doesn't fire on non-editable manually focused elements, and manually\n            // simulating it is difficult (since we need clipboardData). Instead, we redirect all\n            // pastes to the input field, which should always receive them correctly:\n            filterInput.focus();\n            const lastCursorPosition = filterInput.value.length;\n            filterInput.setSelectionRange(lastCursorPosition, lastCursorPosition);\n            return;\n        }\n\n        if (focusedElementIndex === -1) return; // These key bindings apply only to the input & tags:\n\n        if (selectedFilterElements.length > 0) {\n            if (event.key === 'ArrowLeft' || event.key === 'ArrowRight') {\n                const indexToSelect = event.key === 'ArrowLeft'\n                    ? 0\n                    : selectedFilterElements.length - 1;\n\n                const elementToSelect = selectedFilterElements[indexToSelect];\n\n                document.getSelection()!.removeAllRanges();\n                elementToSelect.focus();\n\n                if (elementToSelect === filterInput) {\n                    const cursorPosition = event.key === 'ArrowLeft'\n                        ? 0\n                        : filterInput.value.length;\n                    filterInput.setSelectionRange(cursorPosition, cursorPosition);\n                }\n                event.preventDefault();\n            } else if (event.key === 'Delete' || event.key === 'Backspace') {\n                const lastSelectedIndex = filterElements.indexOf(selectedFilterElements[selectedFilterElements.length - 1]);\n                this.deleteSelectedFilters();\n                document.getSelection()!.removeAllRanges();\n\n                // If we don't delete the last filter tag, React will magically shift focus correctly for us,\n                // because we index filter tags by key. If we delete the last though, we need to focus input manually:\n                if (filterElements.length - lastSelectedIndex < 3) {\n                    filterInput.focus();\n\n                    // This shouldn't be required, but it seems reasonable (we're either deleting filters left of the\n                    // input, or filters including all the input content). Without this, when ctrl-a selects the\n                    // input entirely, focusing the input again here doesn't put the cursor back automatically.\n                    filterInput.setSelectionRange(0, 0);\n                }\n\n                event.preventDefault();\n            } else if (event.key === 'Escape') {\n                document.getSelection()!.removeAllRanges();\n\n                filterInput.focus();\n                const inputEndPosition = filterInput.value.length;\n                filterInput.setSelectionRange(inputEndPosition, inputEndPosition);\n                event.preventDefault();\n            } else if (\n                [...event.key].length === 1 && // Exactly equivalent to 'printable character', AFAICT\n                !event.ctrlKey &&\n                !event.altKey &&\n                !event.metaKey\n            ) {\n                const inputCursorPosition = filterInput.selectionStart || filterInput.value.length;\n                this.deleteSelectedFilters();\n                document.getSelection()!.removeAllRanges();\n\n                // Direct the input directly into the text field:\n                filterInput.setSelectionRange(inputCursorPosition, inputCursorPosition);\n                filterInput.focus();\n            }\n            // -> else we just fire the key event as normal, come what may\n        } else if (filterInput.selectionStart === filterInput.selectionEnd) {\n            // Otherwise, as long as nothing is selected in the input, we're just handling a cursor:\n            const inputCursorIndex = filterInput.selectionStart ?? -1;\n            const isInputSelected = focusedElement === filterInput;\n\n            if (event.key === 'Backspace' || event.key === 'Delete') {\n                // We're deleting something (or a char in the input). Remember that UI order\n                // is reversed, so we map the element index to an index in the model:\n                let filterIndexToDelete = !isInputSelected\n                    ? filterElements.length - 1 - focusedElementIndex // Delete the selected filter\n                : inputCursorIndex <= 0 && event.key === 'Backspace'\n                    ? 1 // Delete back from the start of the input -> delete the first non-string filter\n                : null; // We're within text in the input, do nothing (i.e. delete a char as normal)\n\n                if (filterIndexToDelete) {\n                    onFiltersChanged(\n                        deleteFilterIndex(activeFilters, filterIndexToDelete)\n                    );\n\n                    // If we're not the last filter tag, React will magically shift focus to the next for us,\n                    // because we index elements by key. If we are last though, we need to shift manually:\n                    if (filterIndexToDelete === 1) filterInput.focus();\n                    event.preventDefault();\n                }\n            } else if (event.key === 'ArrowLeft' && focusedElementIndex > 0 && inputCursorIndex <= 0) {\n                filterElements[focusedElementIndex - 1].focus();\n                event.preventDefault();\n            } else if (event.key === 'ArrowRight' && focusedElementIndex < filterElements.length - 1) {\n                const nextFilter = filterElements[focusedElementIndex + 1];\n                nextFilter.focus();\n                if (nextFilter === filterInput) filterInput.setSelectionRange(0, 0);\n                event.preventDefault();\n            }\n        }\n    }\n\n    private onCopy = (e: React.ClipboardEvent) => {\n        const { activeFilters } = this;\n\n        // Get the selected filters in reverse order (i.e. matching the UI order)\n        const filtersToCopy = _.orderBy(this.getSelectedFilters(), f =>\n            activeFilters.indexOf(f),\n        ['desc']);\n\n        if (filtersToCopy.length > 0) {\n            const serialization = filtersToCopy.map(t => t.serialize()).join(' ');\n            copyToClipboard(serialization);\n            e.preventDefault();\n        }\n    }\n\n    private onCut = (e: React.ClipboardEvent) => {\n        this.onCopy(e);\n        this.deleteSelectedFilters();\n    }\n\n    private onPaste = (e: React.ClipboardEvent<HTMLElement>) => {\n        const filterBox = this.boxRef.current;\n        const input = filterBox?.querySelector('input');\n        if (!filterBox || !input) return;\n        e.preventDefault();\n\n        const {\n            selectedFilters,\n            activeFilters,\n            onFiltersChanged,\n            props: { availableFilters }\n        } = this;\n\n        const pastedText = e.clipboardData.getData(\"text\");\n        const pastedFilters = matchFilters(availableFilters, pastedText);\n\n        const pastedStringInput = pastedFilters[0].filter;\n        const selectionStart = input.selectionStart ?? 0;\n        const selectionEnd = input.selectionEnd ?? 0;\n\n        const currentTextInput = activeFilters[0].filter;\n\n        const updatedTextInput = selectedFilters.includes(activeFilters[0])\n            ? pastedStringInput // If whole stringfilter is selected, replace all text\n            : ( // Otherwise, replace selected & paste at cursor position\n                currentTextInput.slice(0, selectionStart) +\n                pastedStringInput +\n                currentTextInput.slice(selectionEnd)\n            );\n\n        // We *always* place pasted filters in position 1 (between text input and filter tags) because\n        // pasting into non-input fields doesn't work reliably, so we redirect it to the input anyway.\n        // This is nice and consistent, and works well enough for now.\n        onFiltersChanged([\n            new StringFilter(updatedTextInput),\n            // Skip both StringFilters below, we've already combined them above:\n            ...pastedFilters.slice(1),\n            ...activeFilters.slice(1)\n                .filter(f => !selectedFilters.includes(f)) // Paste deletes currently selected filters\n        ]);\n\n        // Jump the cursor to the end of the newly pasted content after render:\n        requestAnimationFrame(() => {\n            const endOfPastedContent = selectionStart + pastedStringInput.length;\n            input.setSelectionRange(endOfPastedContent, endOfPastedContent);\n            input.focus();\n        });\n    }\n\n    private onInputChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\n        const { onFiltersChanged, activeFilters } = this;\n\n        onFiltersChanged([\n            new StringFilter(event.target.value),\n            ...activeFilters.slice(1)\n        ]);\n    }\n\n    private onFiltersCleared = () => {\n        this.onFiltersChanged(emptyFilterSet());\n\n        const textInput = (this.boxRef.current?.querySelector('input[type=text]') as HTMLElement | undefined);\n        textInput?.focus();\n    };\n\n    @action.bound\n    private onFiltersSaved(filters: Filter[], name: string) {\n        const uiStore = this.props.uiStore!;\n\n        // Save a custom filter using the provided input text\n        uiStore.customFilters[name] = filters.map(f => f.serialize()).reverse().join(' ');\n\n        // Clear the used input text\n        uiStore.activeFilterSet = [\n            new StringFilter(\"\"),\n            ...uiStore.activeFilterSet.slice(1)\n        ];\n    }\n\n    @action.bound\n    private onCustomFilterDeleted(filter: CustomFilterClass) {\n        const uiStore = this.props.uiStore!;\n        delete uiStore.customFilters[filter.filterName];\n    }\n\n    render() {\n        const {\n            boxRef,\n            onCopy,\n            onCut,\n            onPaste,\n            onKeyDown,\n            onInputChanged,\n            onFiltersCleared,\n            onFiltersChanged,\n            onFiltersSaved,\n            onCustomFilterDeleted,\n\n            tagRefs,\n            selectedFilters,\n            activeFilters,\n            availableFilters,\n            props: {\n                accountStore,\n                placeholder,\n                searchInputRef,\n                filterSuggestionContext,\n                onFiltersConsidered\n            }\n        } = this;\n\n        // Note that the model stores filters in the opposite order to how they're shown in the UI.\n        // Mainly just because destructuring (of types & values) only works this way round.\n        const [stringFilter, ...otherFilters] = activeFilters;\n\n        // The text input always edits the first (last, in the UI) filter directly as a string\n        const textInputValue = stringFilter?.filter ?? '';\n\n        const hasContents = !!textInputValue || !!otherFilters.length;\n\n        return <SearchFilterBox\n            ref={boxRef}\n            hasContents={hasContents}\n            onCopy={onCopy}\n            onCut={onCut}\n            onPaste={onPaste}\n            onKeyDown={onKeyDown}\n        >\n            {\n                otherFilters.reverse().map((f, i) =>\n                    <FilterTag\n                        key={i}\n                        filter={f}\n                        isSelected={selectedFilters.includes(f)}\n                        onDelete={() => onFiltersChanged(\n                            deleteFilter(activeFilters, f)\n                        )}\n                        ref={(ref) => { if (ref) tagRefs.set(ref, f); }}\n                    />\n                )\n            }\n            <FilterInput\n                value={textInputValue}\n                onChange={onInputChanged}\n                placeholder={otherFilters.length === 0\n                    ? placeholder\n                    : '...'\n                }\n                searchInputRef={searchInputRef}\n\n                onFiltersConsidered={onFiltersConsidered}\n                onFiltersChanged={onFiltersChanged}\n                onFiltersSaved={onFiltersSaved}\n                onCustomFilterDeleted={onCustomFilterDeleted}\n                activeFilters={activeFilters}\n                availableFilters={availableFilters}\n                suggestionContext={filterSuggestionContext}\n\n                isPaidUser={accountStore!.isPaidUser}\n                getPro={accountStore!.getPro}\n            />\n            { hasContents\n                ? <FloatingClearFiltersButton\n                    title=\"Clear all search filters\"\n                    icon={['fas', 'times']}\n                    onClick={onFiltersCleared}\n                />\n                : <FloatingFilterDocsButtonLink\n                    icon={['fas', 'question']}\n                    title=\"Open filtering docs\"\n\n                    href=\"https://httptoolkit.com/docs/reference/view-page/#filtering-intercepted-traffic\"\n                    target='_blank'\n                    rel='noreferrer noopener'\n                />\n            }\n        </SearchFilterBox>;\n    }\n}","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { observer } from 'mobx-react';\n\nimport { styled } from '../../styles';\nimport { CollectedEvent } from '../../types';\n\nimport {\n    FilterSet,\n    SelectableSearchFilterClasses\n} from '../../model/filters/search-filters';\n\nimport { ClearAllButton, ExportAsHarButton, ImportHarButton, PlayPauseButton, ScrollToEndButton } from './view-event-list-buttons';\nimport { SearchFilter } from './filters/search-filter';\n\nexport const HEADER_FOOTER_HEIGHT = 38;\n\nconst RequestCounter = styled(observer((props: {\n    className?: string,\n    eventCount: number,\n    filteredEventCount: number\n}) =>\n    <div className={props.className}>\n        <span className='count'>\n            { props.filteredEventCount }\n            { props.eventCount !== props.filteredEventCount &&\n                ` / ${ props.eventCount }`\n            }\n        </span>\n        <span className='label'>requests</span>\n</div>\n))`\n    margin-left: auto;\n    padding: 0 10px;\n\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n\n    .count {\n        font-size: 20px;\n        font-weight: bold;\n        white-space: nowrap;\n    }\n\n    .label {\n        margin-top: -4px;\n        font-size: ${p => p.theme.textSize};\n        opacity: 0.8;\n        font-weight: lighter;\n    }\n`;\n\n\nconst ButtonsContainer = styled.div`\n    display: flex;\n`;\n\nexport const ViewEventListFooter = styled(observer((props: {\n    className?: string,\n    onClear: () => void,\n    onFiltersConsidered: (filters: FilterSet | undefined) => void,\n    onScrollToEnd: () => void,\n\n    allEvents: CollectedEvent[],\n    filteredEvents: CollectedEvent[],\n\n    // We track this separately because it's not 100% accurate to show it\n    // live from the events above, because filteredEvents is debounced. If\n    // we're not careful, we show 9/10 at times just because filtering\n    // hasn't been run against the latest events quite yet.\n    filteredCount: [filtered: number, fromTotal: number],\n\n    searchInputRef?: React.Ref<HTMLInputElement>\n}) => <div className={props.className}>\n    <SearchFilter\n        onFiltersConsidered={props.onFiltersConsidered}\n        availableFilters={SelectableSearchFilterClasses}\n        filterSuggestionContext={props.allEvents}\n        placeholder={'Filter by method, host, headers, status...'}\n        searchInputRef={props.searchInputRef}\n    />\n    <RequestCounter\n        filteredEventCount={props.filteredCount[0]}\n        eventCount={props.filteredCount[1]}\n    />\n    <ButtonsContainer>\n        <PlayPauseButton />\n        <ScrollToEndButton onScrollToEnd={props.onScrollToEnd} />\n        <ExportAsHarButton events={props.filteredEvents} />\n        <ImportHarButton />\n        <ClearAllButton\n            disabled={props.allEvents.length === 0}\n            onClear={props.onClear}\n        />\n    </ButtonsContainer>\n</div>))`\n    order: 1;\n\n    min-height: ${HEADER_FOOTER_HEIGHT}px;\n    width: 100%;\n    padding-left: 2px;\n    box-sizing: border-box;\n\n    background-color: ${p => p.theme.mainBackground};\n\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n`;","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { inject, observer, Observer } from 'mobx-react';\nimport { action, computed } from 'mobx';\n\nimport AutoSizer from 'react-virtualized-auto-sizer';\nimport { FixedSizeList as List, ListChildComponentProps } from 'react-window';\n\nimport { css, highContrastTheme, styled } from '../../styles'\nimport { ArrowIcon, Icon, WarningIcon } from '../../icons';\n\nimport {\n    CollectedEvent,\n    HttpExchange,\n    RTCStream,\n    FailedTlsConnection,\n    RTCConnection,\n    TlsTunnel\n} from '../../types';\n\nimport {\n    getSummaryColour,\n    EventCategory,\n    describeEventCategory\n} from '../../model/events/categorization';\nimport { nameHandlerClass } from '../../model/rules/rule-descriptions';\nimport { getReadableSize } from '../../model/events/bodies';\n\nimport { UnreachableCheck } from '../../util/error';\nimport { filterProps } from '../component-utils';\n\nimport { EmptyState } from '../common/empty-state';\nimport { StatusCode } from '../common/status-code';\n\nimport { HEADER_FOOTER_HEIGHT } from './view-event-list-footer';\nimport { ViewEventContextMenuBuilder } from './view-context-menu-builder';\n\nconst SCROLL_BOTTOM_MARGIN = 5; // If you're in the last 5 pixels of the scroll area, we say you're at the bottom\n\nconst EmptyStateOverlay = styled(EmptyState)`\n    position: absolute;\n    top: ${HEADER_FOOTER_HEIGHT}px;\n    bottom: 0;\n    height: auto;\n\n    line-height: 1.3;\n`;\n\ninterface ViewEventListProps {\n    className?: string;\n    events: CollectedEvent[];\n    filteredEvents: CollectedEvent[];\n    selectedEvent: CollectedEvent | undefined;\n    isPaused: boolean;\n\n    contextMenuBuilder: ViewEventContextMenuBuilder;\n\n    moveSelection: (distance: number) => void;\n    onSelected: (event: CollectedEvent | undefined) => void;\n}\n\nconst ListContainer = styled.div`\n    flex-grow: 1;\n    position: relative;\n    width: 100%;\n    box-sizing: border-box;\n\n    font-size: ${p => p.theme.textSize};\n\n    &::after { /* Insert shadow over table contents */\n        content: '';\n        position: absolute;\n        top: ${HEADER_FOOTER_HEIGHT}px;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 30px inset;\n        pointer-events: none;\n    }\n`;\n\nconst Column = styled.div`\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    padding: 3px 0;\n`;\n\nconst RowPin = styled(\n    filterProps(Icon, 'pinned')\n).attrs((p: { pinned: boolean }) => ({\n    icon: ['fas', 'thumbtack'],\n    title: p.pinned ? \"This exchange is pinned, and won't be deleted by default\" : ''\n}))`\n    font-size: 90%;\n    background-color: ${p => p.theme.containerBackground};\n\n    /* Without this, 0 width pins create a large & invisible but still clickable icon */\n    overflow: hidden;\n\n    transition: width 0.1s, padding 0.1s, margin 0.1s;\n\n    ${(p: { pinned: boolean }) =>\n        p.pinned\n        ? `\n            width: auto;\n            padding: 8px 7px;\n            && { margin-right: -3px; }\n        `\n        : `\n            padding: 8px 0;\n            width: 0 !important;\n            margin: 0 !important;\n\n            > path {\n                display: none;\n            }\n        `\n    }\n`;\n\nconst RowMarker = styled(Column)`\n    transition: color 0.2s;\n    color: ${(p: { category: EventCategory }) => getSummaryColour(p.category)};\n\n    background-color: currentColor;\n\n    flex-basis: 5px;\n    flex-shrink: 0;\n    flex-grow: 0;\n    height: 100%;\n    padding: 0;\n\n    border-left: 5px solid ${p => p.theme.containerBackground};\n`;\n\nconst MarkerHeader = styled.div`\n    flex-basis: 10px;\n    flex-shrink: 0;\n`;\n\nconst Method = styled(Column)`\n    transition: flex-basis 0.1s;\n    ${(p: { pinned?: boolean }) =>\n        p.pinned\n        ? 'flex-basis: 50px;'\n        : 'flex-basis: 71px;'\n    }\n\n    flex-shrink: 0;\n    flex-grow: 0;\n`;\n\nconst Status = styled(Column)`\n    flex-basis: 45px;\n    flex-shrink: 0;\n    flex-grow: 0;\n`;\n\nconst Source = styled(Column)`\n    flex-basis: 49px;\n    flex-shrink: 0;\n    flex-grow: 0;\n    text-align: center;\n`;\n\nconst Host = styled(Column)`\n    flex-shrink: 1;\n    flex-grow: 0;\n    flex-basis: 500px;\n`;\n\nconst PathAndQuery = styled(Column)`\n    flex-shrink: 1;\n    flex-grow: 0;\n    flex-basis: 1000px;\n`;\n\n// Match Method + Status, but shrink right margin slightly so that\n// spinner + \"WebRTC Media\" fits OK.\nconst EventTypeColumn = styled(Column)`\n    transition: flex-basis 0.1s;\n    ${(p: { pinned?: boolean }) =>\n        p.pinned\n        ? 'flex-basis: 109px;'\n        : 'flex-basis: 130px;'\n    }\n\n    margin-right: 6px !important;\n\n    flex-shrink: 0;\n    flex-grow: 0;\n`;\n\n// Match Host column:\nconst RTCEventLabel = styled(Column)`\n    flex-shrink: 1;\n    flex-grow: 0;\n    flex-basis: 500px;\n\n    > svg {\n        padding-right: 0; /* Right, not left - it's rotated */\n    }\n`;\n\n// Match PathAndQuery column:\nconst RTCEventDetails = styled(Column)`\n    flex-shrink: 1;\n    flex-grow: 0;\n    flex-basis: 1000px;\n`;\n\nconst RTCConnectionDetails = styled(RTCEventDetails)`\n    text-align: center;\n`;\n\n// Host + Path + Query columns:\nconst BuiltInApiRequestDetails = styled(Column)`\n    flex-shrink: 1;\n    flex-grow: 0;\n    flex-basis: 1000px;\n`;\n\nconst EventListRow = styled.div`\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n\n    user-select: none;\n    cursor: pointer;\n\n    &.selected {\n        background-color: ${p => p.theme.highlightBackground};\n        color: ${p => p.theme.highlightColor};\n        font-weight: bold;\n\n        ${(p): any => p.theme === highContrastTheme &&\n            css`\n                ${StatusCode} {\n                    color: ${p => p.theme.highlightColor};\n                }\n            `\n        }\n    }\n\n    &:focus {\n        outline: thin dotted ${p => p.theme.popColor};\n    }\n`;\n\nconst TrafficEventListRow = styled(EventListRow)`\n    background-color: ${props => props.theme.mainBackground};\n\n    border-width: 2px 0;\n    border-style: solid;\n    border-color: transparent;\n    background-clip: padding-box;\n    box-sizing: border-box;\n\n    &:hover ${RowMarker}, &.selected ${RowMarker} {\n        border-color: currentColor;\n    }\n\n    > * {\n        margin-right: 10px;\n    }\n`;\n\nconst TlsListRow = styled(EventListRow)`\n    height: 28px !important; /* Important required to override react-window's style attr */\n    margin: 2px 0;\n\n    font-style: italic;\n    justify-content: center;\n    text-align: center;\n\n    opacity: 0.7;\n\n    &:hover {\n        opacity: 1;\n    }\n\n    &.selected {\n        opacity: 1;\n        color: ${p => p.theme.mainColor};\n        background-color: ${p => p.theme.mainBackground};\n    }\n`;\n\nexport const TableHeader = styled.header`\n    height: 38px;\n    overflow: hidden;\n    width: 100%;\n\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n\n    background-color: ${props => props.theme.mainBackground};\n    color: ${props => props.theme.mainColor};\n    font-weight: bold;\n\n    border-bottom: 1px solid ${props => props.theme.containerBorder};\n    box-shadow: 0 0 30px rgba(0,0,0,0.2);\n\n    padding-right: 18px;\n    box-sizing: border-box;\n\n    > div {\n        padding: 5px 0;\n        margin-right: 10px;\n        min-width: 0px;\n\n        &:first-of-type {\n            margin-left: 0;\n        }\n    }\n`;\n\ninterface EventRowProps extends ListChildComponentProps {\n    data: {\n        selectedEvent: CollectedEvent | undefined;\n        events: CollectedEvent[];\n        contextMenuBuilder: ViewEventContextMenuBuilder;\n    }\n}\n\nconst EventRow = observer((props: EventRowProps) => {\n    const { index, style } = props;\n    const { events, selectedEvent, contextMenuBuilder } = props.data;\n    const event = events[index];\n\n    const isSelected = (selectedEvent === event);\n\n    if (event.isTlsFailure() || event.isTlsTunnel()) {\n        return <TlsRow\n            index={index}\n            isSelected={isSelected}\n            style={style}\n            tlsEvent={event}\n        />;\n    } else if (event.isHttp()) {\n        if (event.api?.isBuiltInApi && event.api.matchedOperation()) {\n            return <BuiltInApiRow\n                index={index}\n                isSelected={isSelected}\n                style={style}\n                exchange={event}\n                contextMenuBuilder={contextMenuBuilder}\n            />\n        } else {\n            return <ExchangeRow\n                index={index}\n                isSelected={isSelected}\n                style={style}\n                exchange={event}\n                contextMenuBuilder={contextMenuBuilder}\n            />;\n        }\n    } else if (event.isRTCConnection()) {\n        return <RTCConnectionRow\n            index={index}\n            isSelected={isSelected}\n            style={style}\n            event={event}\n        />;\n    } else if (event.isRTCDataChannel() || event.isRTCMediaTrack()) {\n        return <RTCStreamRow\n            index={index}\n            isSelected={isSelected}\n            style={style}\n            event={event}\n        />;\n    } else {\n        throw new UnreachableCheck(event);\n    }\n});\n\nconst ExchangeRow = inject('uiStore')(observer(({\n    index,\n    isSelected,\n    style,\n    exchange,\n    contextMenuBuilder\n}: {\n    index: number,\n    isSelected: boolean,\n    style: {},\n    exchange: HttpExchange,\n    contextMenuBuilder: ViewEventContextMenuBuilder\n}) => {\n    const {\n        request,\n        response,\n        pinned,\n        category\n    } = exchange;\n\n    return <TrafficEventListRow\n        role=\"row\"\n        aria-label='row'\n        aria-rowindex={index + 1}\n        data-event-id={exchange.id}\n        tabIndex={isSelected ? 0 : -1}\n        onContextMenu={contextMenuBuilder.getContextMenuCallback(exchange)}\n        className={isSelected ? 'selected' : ''}\n        style={style}\n    >\n        <RowPin pinned={pinned}/>\n        <RowMarker category={category} title={describeEventCategory(category)} />\n        <Method pinned={pinned}>{ request.method }</Method>\n        <Status>\n            {\n                response === 'aborted'\n                    ? <StatusCode status={'aborted'} />\n                : exchange.isBreakpointed\n                    ? <WarningIcon title='Breakpointed, waiting to be resumed' />\n                : exchange.isWebSocket() && response?.statusCode === 101\n                    ? <StatusCode // Special UI for accepted WebSockets\n                        status={exchange.closeState\n                            ? 'WS:closed'\n                            : 'WS:open'\n                        }\n                        message={`${exchange.closeState\n                            ? 'A closed'\n                            : 'An open'\n                        } WebSocket connection`}\n                    />\n                : <StatusCode\n                    status={response?.statusCode}\n                    message={response?.statusMessage}\n                />\n            }\n        </Status>\n        <Source>\n            <Icon\n                title={request.source.summary}\n                {...request.source.icon}\n                fixedWidth={true}\n            />\n            {\n                exchange.matchedRule &&\n                exchange.matchedRule.handlerStepTypes.some(t =>\n                    t !== 'passthrough' && t !== 'ws-passthrough' && t !== 'rtc-dynamic-proxy'\n                ) &&\n                <Icon\n                    title={`Handled by ${\n                        exchange.matchedRule.handlerStepTypes.length === 1\n                        ? nameHandlerClass(exchange.matchedRule.handlerStepTypes[0])\n                        : 'multi-step'\n                    } rule`}\n                    icon={['fas', 'theater-masks']}\n                    color={getSummaryColour('mutative')}\n                    fixedWidth={true}\n                />\n            }\n        </Source>\n        <Host title={ request.parsedUrl.host }>\n            { request.parsedUrl.host }\n        </Host>\n        <PathAndQuery title={ request.parsedUrl.pathname + request.parsedUrl.search }>\n            { request.parsedUrl.pathname + request.parsedUrl.search }\n        </PathAndQuery>\n    </TrafficEventListRow>;\n}));\n\nconst ConnectedSpinnerIcon = styled(Icon).attrs(() => ({\n    icon: ['fas', 'spinner'],\n    spin: true,\n    title: 'Connected'\n}))`\n    margin: 0 5px 0 0;\n`;\n\nconst RTCConnectionRow = observer(({\n    index,\n    isSelected,\n    style,\n    event\n}: {\n    index: number,\n    isSelected: boolean,\n    style: {},\n    event: RTCConnection\n}) => {\n    const { category, pinned } = event;\n\n    return <TrafficEventListRow\n        role=\"row\"\n        aria-label='row'\n        aria-rowindex={index + 1}\n        data-event-id={event.id}\n        tabIndex={isSelected ? 0 : -1}\n\n        className={isSelected ? 'selected' : ''}\n        style={style}\n    >\n        <RowPin pinned={pinned}/>\n        <RowMarker category={category} title={describeEventCategory(category)} />\n        <EventTypeColumn>\n            { !event.closeState && <ConnectedSpinnerIcon /> } WebRTC\n        </EventTypeColumn>\n        <Source title={event.source.summary}>\n            <Icon\n                {...event.source.icon}\n                fixedWidth={true}\n            />\n        </Source>\n        <RTCConnectionDetails>\n            {\n                event.clientURL\n            } <ArrowIcon direction='right' /> {\n                event.remoteURL || '?'\n            }\n        </RTCConnectionDetails>\n    </TrafficEventListRow>;\n});\n\nconst RTCStreamRow = observer(({\n    index,\n    isSelected,\n    style,\n    event\n}: {\n    index: number,\n    isSelected: boolean,\n    style: {},\n    event: RTCStream\n}) => {\n    const { category, pinned } = event;\n\n    return <TrafficEventListRow\n        role=\"row\"\n        aria-label='row'\n        aria-rowindex={index + 1}\n        data-event-id={event.id}\n        tabIndex={isSelected ? 0 : -1}\n\n        className={isSelected ? 'selected' : ''}\n        style={style}\n    >\n        <RowPin pinned={pinned}/>\n        <RowMarker category={category} title={describeEventCategory(category)} />\n        <EventTypeColumn>\n            { !event.closeState && <ConnectedSpinnerIcon /> } WebRTC {\n                event.isRTCDataChannel()\n                    ? 'Data'\n                : // RTCMediaTrack:\n                    'Media'\n            }\n        </EventTypeColumn>\n        <Source title={event.rtcConnection.source.summary}>\n            <Icon\n                {...event.rtcConnection.source.icon}\n                fixedWidth={true}\n            />\n        </Source>\n        <RTCEventLabel>\n            <ArrowIcon direction='right' /> { event.rtcConnection.remoteURL }\n        </RTCEventLabel>\n        <RTCEventDetails>\n            {\n                event.isRTCDataChannel()\n                    ? <>\n                        { event.label } <em>\n                            ({event.protocol ? `${event.protocol} - ` : ''}\n                            { event.messages.length } message{\n                                event.messages.length !== 1 ? 's' : ''\n                            })\n                        </em>\n                    </>\n                // Media track:\n                    : <>\n                        { event.direction } { event.type } <em>{\n                            getReadableSize(event.totalBytesSent)\n                        } sent, {\n                            getReadableSize(event.totalBytesReceived)\n                        } received</em>\n                    </>\n            }\n        </RTCEventDetails>\n    </TrafficEventListRow>;\n});\n\nconst BuiltInApiRow = observer((p: {\n    index: number,\n    exchange: HttpExchange,\n    isSelected: boolean,\n    style: {},\n    contextMenuBuilder: ViewEventContextMenuBuilder\n}) => {\n    const {\n        request,\n        pinned,\n        category\n    } = p.exchange;\n    const api = p.exchange.api!; // Only shown for built-in APIs, so this must be set\n\n    return <TrafficEventListRow\n        role=\"row\"\n        aria-label='row'\n        aria-rowindex={p.index + 1}\n        data-event-id={p.exchange.id}\n        tabIndex={p.isSelected ? 0 : -1}\n\n        onContextMenu={p.contextMenuBuilder.getContextMenuCallback(p.exchange)}\n        className={p.isSelected ? 'selected' : ''}\n        style={p.style}\n    >\n        <RowPin pinned={pinned}/>\n        <RowMarker category={category} title={describeEventCategory(category)} />\n        <EventTypeColumn>\n            { api.service.shortName }: {\n                _.startCase(\n                    api.operation.name\n                    .replace('eth_', '') // One-off hack for Ethereum, but result looks much nicer.\n                )\n            }\n        </EventTypeColumn>\n        <Source title={request.source.summary}>\n            <Icon\n                {...request.source.icon}\n                fixedWidth={true}\n            />\n        </Source>\n        <BuiltInApiRequestDetails>\n            {\n                api.request.parameters\n                .filter(param => param.value !== undefined)\n                .map(param => `${param.name}=${JSON.stringify(param.value)}`)\n                .join(', ')\n            }\n        </BuiltInApiRequestDetails>\n    </TrafficEventListRow>\n});\n\nconst TlsRow = observer((p: {\n    index: number,\n    tlsEvent: FailedTlsConnection | TlsTunnel,\n    isSelected: boolean,\n    style: {}\n}) => {\n    const { tlsEvent } = p;\n\n    const description = tlsEvent.isTlsTunnel()\n        ? 'Tunnelled TLS '\n        : ({\n            'closed': 'Aborted ',\n            'reset': 'Aborted ',\n            'unknown': 'Aborted ',\n            'cert-rejected': 'Certificate rejected for ',\n            'no-shared-cipher': 'HTTPS setup failed for ',\n        } as _.Dictionary<string>)[tlsEvent.failureCause]\n\n    return <TlsListRow\n        role=\"row\"\n        aria-label='row'\n        aria-rowindex={p.index + 1}\n        data-event-id={tlsEvent.id}\n        tabIndex={p.isSelected ? 0 : -1}\n\n        className={p.isSelected ? 'selected' : ''}\n        style={p.style}\n    >\n        {\n            tlsEvent.isTlsTunnel() &&\n            tlsEvent.isOpen() &&\n                <ConnectedSpinnerIcon />\n        } {\n            description\n        } connection to { tlsEvent.upstreamHostname || 'unknown domain' }\n    </TlsListRow>\n});\n\n@observer\nexport class ViewEventList extends React.Component<ViewEventListProps> {\n\n    @computed\n    get selectedEventId() {\n        return this.props.selectedEvent\n            ? this.props.selectedEvent.id\n            : undefined;\n    }\n\n    @computed get listItemData(): EventRowProps['data'] {\n        return {\n            selectedEvent: this.props.selectedEvent,\n            events: this.props.filteredEvents,\n            contextMenuBuilder: this.props.contextMenuBuilder\n        };\n    }\n\n    private listBodyRef = React.createRef<HTMLDivElement>();\n    private listRef = React.createRef<List>();\n\n    private KeyBoundListWindow = observer(\n        React.forwardRef<HTMLDivElement>(\n            (props: any, ref) => <section\n                {...props}\n                style={Object.assign({}, props.style, { 'overflowY': 'scroll' })}\n                ref={ref}\n\n                onFocus={this.focusSelectedEvent}\n                onKeyDown={this.onKeyDown}\n                onMouseDown={this.onListMouseDown}\n                tabIndex={this.isSelectedEventVisible() ? -1 : 0}\n            />\n        )\n    );\n\n    render() {\n        const { events, filteredEvents, isPaused } = this.props;\n\n        return <ListContainer>\n            <TableHeader>\n                <MarkerHeader />\n                <Method>Method</Method>\n                <Status>Status</Status>\n                <Source>Source</Source>\n                <Host>Host</Host>\n                <PathAndQuery>Path and query</PathAndQuery>\n            </TableHeader>\n\n            {\n                events.length === 0\n                ? (isPaused\n                    ? <EmptyStateOverlay icon={['fas', 'pause']}>\n                        Interception is paused, resume it to collect intercepted requests\n                    </EmptyStateOverlay>\n                    : <EmptyStateOverlay icon={['fas', 'plug']}>\n                        Connect a client and intercept some requests, and they'll appear here\n                    </EmptyStateOverlay>\n                )\n\n                : filteredEvents.length === 0\n                ? <EmptyStateOverlay icon={['fas', 'question']}>\n                        No requests match this search filter{\n                            isPaused ? ' and interception is paused' : ''\n                        }\n                </EmptyStateOverlay>\n\n                : <AutoSizer>{({ height, width }) =>\n                    <Observer>{() =>\n                        <List\n                            innerRef={this.listBodyRef}\n                            outerElementType={this.KeyBoundListWindow}\n                            ref={this.listRef}\n\n                            height={height - HEADER_FOOTER_HEIGHT}\n                            width={width}\n                            itemCount={filteredEvents.length}\n                            itemSize={32}\n                            itemData={this.listItemData}\n\n                            onScroll={this.updateScrolledState}\n                        >\n                            { EventRow }\n                        </List>\n                    }</Observer>\n                }</AutoSizer>\n            }\n        </ListContainer>;\n    }\n\n    private isSelectedEventVisible = () => {\n        if (!this.selectedEventId) return false;\n\n        const listBody = this.listBodyRef.current;\n        if (!listBody) return false;\n\n        return !!listBody.querySelector(`[data-event-id='${this.selectedEventId}']`);\n    }\n\n    private focusEvent(event?: CollectedEvent) {\n        const listBody = this.listBodyRef.current;\n        if (!listBody) return;\n\n        if (event) {\n            const rowElement = listBody.querySelector(\n                `[data-event-id='${event.id}']`\n            ) as HTMLDivElement;\n            rowElement?.focus();\n        } else {\n            const listWindow = listBody.parentElement!;\n            listWindow.focus();\n        }\n    }\n\n    private focusSelectedEvent = () => {\n        this.focusEvent(this.props.selectedEvent);\n    }\n\n    private isListAtBottom() {\n        const listWindow = this.listBodyRef.current?.parentElement;\n        if (!listWindow) return true; // This means no rows, so we are effectively at the bottom\n        else return (listWindow.scrollTop + SCROLL_BOTTOM_MARGIN) >= (listWindow.scrollHeight - listWindow.offsetHeight);\n    }\n\n    private wasListAtBottom = true;\n    private updateScrolledState = () => {\n        requestAnimationFrame(() => { // Measure async, once the scroll has actually happened\n            this.wasListAtBottom = this.isListAtBottom();\n        });\n    }\n\n    componentDidMount() {\n        this.updateScrolledState();\n    }\n\n    componentDidUpdate() {\n        if (this.listBodyRef.current?.parentElement?.contains(document.activeElement)) {\n            // If we previously had something here focused, and we've updated, update\n            // the focus too, to make sure it's in the right place.\n            this.focusSelectedEvent();\n        }\n\n        // If we previously were scrolled to the bottom of the list, but now we're not,\n        // scroll there again ourselves now.\n        if (this.wasListAtBottom && !this.isListAtBottom()) {\n            this.listRef.current?.scrollToItem(this.props.events.length - 1);\n        }\n    }\n\n    public scrollToEvent(event: CollectedEvent) {\n        const targetIndex = this.props.filteredEvents.indexOf(event);\n        if (targetIndex === -1) return;\n\n        this.listRef.current?.scrollToItem(targetIndex);\n\n        requestAnimationFrame(() => this.focusEvent(event));\n    }\n\n    public scrollToCenterEvent(event: CollectedEvent) {\n        const list = this.listRef.current;\n        const listBody = this.listBodyRef.current;\n        if (!list || !listBody) return;\n        const listWindow = listBody.parentElement!;\n\n        const targetIndex = this.props.filteredEvents.indexOf(event);\n        if (targetIndex === -1) return;\n\n        // TODO: scrollToItem(\"center\") doesn't work well, need to resolve\n        // https://github.com/bvaughn/react-window/issues/441 to fix this.\n        const rowCount = this.props.filteredEvents.length;\n        const rowHeight = 32;\n        const windowHeight = listWindow.clientHeight;\n        const halfHeight = windowHeight / 2;\n        const rowOffset = targetIndex * rowHeight;\n        const maxOffset = Math.max(0, rowCount * rowHeight - windowHeight);\n        const targetOffset = rowOffset - halfHeight + rowHeight / 2;\n        list.scrollTo(_.clamp(targetOffset, 0, maxOffset));\n\n        // Focus the row, after the UI has updated, to make it extra obvious:\n        requestAnimationFrame(() => this.focusEvent(event));\n    }\n\n    public scrollToEnd() {\n        this.listRef.current?.scrollToItem(this.props.filteredEvents.length, 'start');\n    }\n\n    onListMouseDown = (mouseEvent: React.MouseEvent) => {\n        if (mouseEvent.button !== 0) return; // Left clicks only\n\n        let row: Element | null = mouseEvent.target as Element;\n        let ariaRowIndex: string | null = null;\n\n        // Climb up until we find the row, or the container\n        while (ariaRowIndex === null && row && row !== this.listBodyRef.current) {\n            // Be a little careful - React thinks event targets might not have getAttribute\n            ariaRowIndex = row.getAttribute && row.getAttribute('aria-rowindex');\n            row = row.parentElement;\n        }\n\n        if (!ariaRowIndex) return;\n\n        const eventIndex = parseInt(ariaRowIndex, 10) - 1;\n        const event = this.props.filteredEvents[eventIndex];\n        if (event !== this.props.selectedEvent) {\n            this.onEventSelected(eventIndex);\n        } else {\n            // Clicking the selected row deselects it\n            this.onEventDeselected();\n        }\n    }\n\n    @action.bound\n    onEventSelected(index: number) {\n        this.props.onSelected(this.props.filteredEvents[index]);\n    }\n\n    @action.bound\n    onEventDeselected() {\n        this.props.onSelected(undefined);\n    }\n\n    @action.bound\n    onKeyDown(event: React.KeyboardEvent<HTMLDivElement>) {\n        const { moveSelection } = this.props;\n\n        switch (event.key) {\n            case 'ArrowDown':\n                moveSelection(1);\n                break;\n            case 'ArrowUp':\n                moveSelection(-1);\n                break;\n            case 'PageUp':\n                moveSelection(-10);\n                break;\n            case 'PageDown':\n                moveSelection(10);\n                break;\n            case 'Home':\n                moveSelection(-Infinity);\n                break;\n            case 'End':\n                moveSelection(Infinity);\n                break;\n            default:\n                return;\n        }\n\n        event.preventDefault();\n    }\n}","import * as _ from 'lodash';\nimport * as HTTPSnippet from \"@httptoolkit/httpsnippet\";\n\nimport { saveFile } from \"../../util/ui\";\nimport { ObservablePromise } from '../../util/observable';\n\nimport { HttpExchange } from \"../http/exchange\";\nimport { generateHarRequest, generateHar, ExtendedHarRequest } from '../http/har';\n\nexport const exportHar = async (exchange: HttpExchange) => {\n    const harContent = JSON.stringify(\n        await generateHar([exchange], {\n            bodySizeLimit: Infinity\n        })\n    );\n    const filename = `${\n        exchange.request.method\n    } ${\n        exchange.request.parsedUrl.hostname\n    }.har`;\n\n    saveFile(filename, 'application/har+json;charset=utf-8', harContent);\n};\n\nexport function generateCodeSnippet(\n    exchange: HttpExchange,\n    snippetFormat: SnippetOption,\n    options: { waitForBodyDecoding: true }\n): ObservablePromise<string>;\nexport function generateCodeSnippet(\n    exchange: HttpExchange,\n    snippetFormat: SnippetOption,\n    options?: { waitForBodyDecoding?: boolean }\n): string;\nexport function generateCodeSnippet(\n    exchange: HttpExchange,\n    snippetFormat: SnippetOption,\n    options: { waitForBodyDecoding?: boolean } = {}\n): string | ObservablePromise<string> {\n    // If the body isn't decoded yet, and it should be, wait for that decoding first.\n    if (options.waitForBodyDecoding && (\n        exchange.request.body.decodedPromise.state === 'pending' ||\n        exchange.request.body.decodedPromise.state === undefined\n    )) {\n        // Doesn't matter if this errors - we'll make that explicit in the export later.\n        return exchange.request.body.decodedPromise.catch(() => {})\n            .then(() => generateCodeSnippet(exchange, snippetFormat, options));\n    }\n\n    // First, we need to get a HAR that appropriately represents this request as we\n    // want to export it:\n    const harRequest = generateHarRequest(exchange.request, false, {\n        bodySizeLimit: Infinity\n    });\n    const harSnippetBase = simplifyHarForSnippetExport(harRequest);\n\n    // Then, we convert that HAR to code for the given target:\n    return new HTTPSnippet(harSnippetBase).convert(snippetFormat.target, snippetFormat.client);\n};\n\nconst simplifyHarForSnippetExport = (harRequest: ExtendedHarRequest) => {\n    const postData = !!harRequest.postData\n            ? harRequest.postData\n        : harRequest._requestBodyStatus === 'discarded:not-representable'\n            ? {\n                mimeType: 'text/plain',\n                text: \"!!! UNREPRESENTABLE BINARY REQUEST BODY - BODY MUST BE EXPORTED SEPARATELY !!!\"\n            }\n        : harRequest._requestBodyStatus === 'discarded:too-large'\n            ? {\n                mimeType: 'text/plain',\n                text: \"!!! VERY LARGE REQUEST BODY - BODY MUST BE EXPORTED & INCLUDED SEPARATELY !!!\"\n            }\n        : harRequest._requestBodyStatus === 'discarded:not-decodable'\n            ? {\n                mimeType: 'text/plain',\n                text: \"!!! REQUEST BODY COULD NOT BE DECODED !!!\"\n            }\n        : undefined;\n\n    // When exporting code snippets the primary goal is to generate convenient code to send the\n    // request that's *sematantically* equivalent to the original request, not to force every\n    // tool to produce byte-for-byte identical requests (that's effectively impossible). To do\n    // this, we drop headers that tools can produce automatically for themselves:\n    return {\n        ...harRequest,\n        postData,\n        headers: harRequest.headers.filter((header) => {\n            // All clients should be able to automatically generate the correct content-length\n            // headers as required for a request where it's unspecified. If we override this,\n            // it can cause problems if tools change the body length (due to encoding/compression).\n            if (header.name.toLowerCase() === 'content-length') return false;\n\n            // HTTP/2 headers should never be included in snippets - they're implicitly part of\n            // the other request data (the method etc).\n            // We can drop this after fixing https://github.com/Kong/httpsnippet/issues/298\n            if (header.name.startsWith(':')) return false;\n\n            return true;\n        })\n    };\n};\n\nexport interface SnippetOption {\n    target: HTTPSnippet.Target,\n    client: HTTPSnippet.Client,\n    name: string,\n    description: string,\n    link: string\n}\n\nexport const snippetExportOptions: _.Dictionary<SnippetOption[]> = _(HTTPSnippet.availableTargets())\n    .keyBy(target => target.title)\n    .mapValues(target =>\n        target.clients.map((client) => ({\n            target: target.key,\n            client: client.key,\n            name: client.title,\n            description: client.description,\n            link: client.link\n        }))\n    ).value();\n\nconst EXPORT_SNIPPET_KEY_SEPARATOR = '~~';\n\nexport const DEFAULT_SNIPPET_FORMAT_KEY = `shell${EXPORT_SNIPPET_KEY_SEPARATOR}curl`;\n\nexport const getCodeSnippetFormatKey = (option: SnippetOption) =>\n    option.target + EXPORT_SNIPPET_KEY_SEPARATOR + option.client;\n\nexport const getCodeSnippetOptionFromKey = (key: string) => {\n    const [target, client] = key.split(EXPORT_SNIPPET_KEY_SEPARATOR) as\n        [HTTPSnippet.Target, HTTPSnippet.Client];\n\n    return _(snippetExportOptions)\n        .values()\n        .flatten()\n        .find({ target, client }) as SnippetOption;\n};\n\n\n// Show the client name, or an overridden name in some ambiguous cases\nexport const getCodeSnippetFormatName = (option: SnippetOption) => ({\n    'php~~curl': 'PHP ext-cURL',\n    'php~~http1': 'PHP HTTP v1',\n    'php~~http2': 'PHP HTTP v2',\n    'node~~native': 'Node.js HTTP'\n} as _.Dictionary<string>)[getCodeSnippetFormatKey(option)] || option.name;","import { action, runInAction } from 'mobx';\n\nimport { CollectedEvent } from '../../types';\n\nimport { copyToClipboard } from '../../util/ui';\n\nimport { AccountStore } from '../../model/account/account-store';\nimport { UiStore } from '../../model/ui/ui-store';\nimport { HttpExchange } from '../../model/http/exchange';\nimport {\n    exportHar,\n    generateCodeSnippet,\n    getCodeSnippetFormatKey,\n    getCodeSnippetFormatName,\n    getCodeSnippetOptionFromKey,\n    snippetExportOptions\n} from '../../model/ui/export';\n\nexport class ViewEventContextMenuBuilder {\n\n    constructor(\n        private accountStore: AccountStore,\n        private uiStore: UiStore,\n\n        private onPin: (event: CollectedEvent) => void,\n        private onDelete: (event: CollectedEvent) => void,\n        private onBuildRuleFromExchange: (exchange: HttpExchange) => void\n    ) {}\n\n    private readonly BaseOptions = {\n        Pin: {\n            type: 'option',\n            label: 'Toggle Pinning',\n            callback: this.onPin\n        },\n        Delete: {\n            type: 'option',\n            label: 'Delete',\n            callback: this.onDelete\n        }\n    } as const;\n\n    getContextMenuCallback(event: CollectedEvent) {\n        return (mouseEvent: React.MouseEvent) => {\n            const { isPaidUser } = this.accountStore;\n\n            const preferredExportFormat = this.uiStore.exportSnippetFormat\n                ? getCodeSnippetOptionFromKey(this.uiStore.exportSnippetFormat)\n                : undefined;\n\n            if (event.isHttp()) {\n                this.uiStore.handleContextMenuEvent(mouseEvent, [\n                    this.BaseOptions.Pin,\n                    {\n                        type: 'option',\n                        label: 'Copy Request URL',\n                        callback: (data: HttpExchange) => copyToClipboard(data.request.url)\n                    },\n                    this.BaseOptions.Delete,\n                    ...(!isPaidUser ? [\n                        { type: 'separator' },\n                        { type: 'option', label: 'With Pro:', enabled: false, callback: () => {} }\n                    ] as const : []),\n                    {\n                        type: 'option',\n                        enabled: isPaidUser,\n                        label: `Create Matching Mock Rule`,\n                        callback: this.onBuildRuleFromExchange\n                    },\n                    {\n                        type: 'option',\n                        enabled: isPaidUser,\n                        label: `Export Exchange as HAR`,\n                        callback: exportHar\n                    },\n                    // If you have a preferred default format, we show that option at the top level:\n                    ...(preferredExportFormat && isPaidUser ? [{\n                        type: 'option',\n                        label: `Copy as ${getCodeSnippetFormatName(preferredExportFormat)} Snippet`,\n                        callback: async (data: HttpExchange) => {\n                            copyToClipboard(\n                                await generateCodeSnippet(data, preferredExportFormat, {\n                                    waitForBodyDecoding: true\n                                })\n                            );\n                        }\n                    }] as const : []),\n                    {\n                        type: 'submenu',\n                        enabled: isPaidUser,\n                        label: `Copy as Code Snippet`,\n                        items: Object.keys(snippetExportOptions).map((snippetGroupName) => ({\n                            type: 'submenu',\n                            label: snippetGroupName,\n                            items: snippetExportOptions[snippetGroupName].map((snippetOption) => ({\n                                type: 'option',\n                                label: getCodeSnippetFormatName(snippetOption),\n                                callback: async (data: HttpExchange) => {\n                                    // When you pick an option here, it updates your preferred default option\n                                    runInAction(() => {\n                                        this.uiStore.exportSnippetFormat = getCodeSnippetFormatKey(snippetOption);\n                                    });\n\n                                    copyToClipboard(\n                                        await generateCodeSnippet(data, snippetOption, {\n                                            waitForBodyDecoding: true\n                                        })\n                                    );\n                                }\n                            }))\n                        }))\n                    },\n                ], event)\n            } else {\n                // For non-HTTP events, we just show the super-basic globally supported options:\n                this.uiStore.handleContextMenuEvent(mouseEvent, [\n                    this.BaseOptions.Pin,\n                    this.BaseOptions.Delete\n                ], event);\n            }\n        };\n    }\n\n}","import * as React from 'react';\n\nimport { styled } from '../../styles';\n\nexport const PaneOuterContainer = styled.div`\n    height: 100%;\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n`;\n\nconst PaneScrollOuterContainer = styled.div`\n    position: relative;\n    overflow-y: scroll;\n\n    flex-grow: 1;\n    padding: 0 20px 0 20px;\n\n    background-color: ${p => p.theme.containerBackground};\n`;\n\nconst PaneScrollInnerContainer = styled.div`\n    min-height: 100%;\n    box-sizing: border-box;\n\n    display: flex;\n    flex-direction: column;\n\n    /*\n    * This padding could be padding on the scroll container, but doing so causes odd\n    * behaviour where position: sticky headers don't take it into account, on OSX only.\n    * Moving to the direct parent of the header makes that consistent, for some reason. Ew.\n    */\n    padding-top: 20px;\n`;\n\nexport const PaneScrollContainer = (p: { children: React.ReactNode }) =>\n    <PaneScrollOuterContainer>\n        <PaneScrollInnerContainer>\n            { p.children }\n        </PaneScrollInnerContainer>\n    </PaneScrollOuterContainer>;","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { observable, autorun, action } from 'mobx';\nimport { disposeOnUnmount, observer } from 'mobx-react';\nimport * as portals from 'react-reverse-portal';\n\nimport { styled, warningColor } from '../../styles';\nimport { asBuffer, bufferToString } from '../../util';\nimport { ArrowIcon } from '../../icons';\n\nimport {\n    ViewableContentType,\n    getCompatibleTypes,\n    getContentEditorName\n} from '../../model/events/content-types';\nimport { getReadableSize } from '../../model/events/bodies';\nimport { StreamMessage } from '../../model/events/stream-message';\n\nimport { ContentLabel, ContentMonoValue } from '../common/text-content';\nimport { Pill, PillSelector } from '../common/pill';\nimport { IconButton } from '../common/icon-button';\n\nimport { ContentViewer } from '../editor/content-viewer';\nimport { SelfSizedEditor } from '../editor/base-editor';\nimport { EditorCardContent } from '../editor/body-card-components';\n\nconst visualDirection = (message: StreamMessage) =>\n    message.direction === 'sent'\n        ? 'left'\n        : 'right';\n\n\nexport const StreamMessageCollapsedRow = React.memo((p: {\n    message: StreamMessage\n    index: number,\n    onClick: (index: number) => void\n}) => <CollapsedStreamRowContainer\n        messageDirection={visualDirection(p.message)}\n        onClick={() => p.onClick(p.index)}\n\n        tabIndex={0}\n        onKeyDown={(e) => {\n            if (e.key === 'Enter') p.onClick(p.index);\n\n            // If focused, up/down move up & down the list. This is slightly different from\n            // tab focus: it stops at the ends, and moving to an open editor row focuses the\n            // entire row (jumping to the editor only on 'enter').\n            if (e.key === 'ArrowDown') {\n                e.preventDefault();\n                (e.currentTarget.nextElementSibling as HTMLElement)?.focus?.();\n            }\n            if (e.key === 'ArrowUp') {\n                e.preventDefault();\n                (e.currentTarget.previousElementSibling as HTMLElement)?.focus?.();\n            }\n        }}\n    >\n    <MessageArrow selected={false} messageDirection={visualDirection(p.message)} />\n    <CollapsedStreamContent>\n        {\n            bufferToString( // Show everything as UTF-8 - binary data can be viewed up close instead.\n                p.message.content\n                // Limit the length - no point showing huge messages here. On a typical UI, we show about\n                // 100 chars here, so this should give us a good bit of buffer\n                .slice(0, 200)\n            )\n        }\n    </CollapsedStreamContent>\n    {\n        p.message.isBinary &&\n            <Pill color={warningColor}>Binary</Pill>\n    }\n    <Pill>\n        { getReadableSize(p.message.content.byteLength) }\n    </Pill>\n</CollapsedStreamRowContainer>);\n\nconst MessageArrow = styled(React.memo((p: {\n    className?: string,\n    messageDirection: 'left' | 'right',\n    selected: boolean\n}) => {\n    return <div className={p.className}>\n        <ArrowIcon direction={p.messageDirection} />\n    </div>\n}))`\n    width: 25px;\n    flex-grow: 0;\n    flex-shrink: 0;\n\n    padding-right: 1px;\n    box-sizing: border-box;\n    margin: -4px 0;\n\n    > svg {\n        padding: 0;\n        color: ${p => p.selected\n            ? p.theme.popColor\n            : p.theme.containerBorder\n        };\n    }\n\n    text-align: center;\n`;\n\nconst CollapsedStreamRowContainer = styled.div<{ messageDirection: 'left' | 'right' }>`\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n\n    border-style: solid;\n    border-width: 0 5px 1px;\n\n    border-color: transparent;\n    border-${p => p.messageDirection}-color: ${p => p.theme.containerBorder};\n    border-bottom-color: ${p => p.theme.containerWatermark};\n\n    cursor: pointer;\n    &:hover, &:focus {\n        outline: none;\n        border-${p => p.messageDirection}-color: ${p => p.theme.popColor};\n        background-color: ${p => p.theme.mainBackground};\n    }\n\n    padding: 4px 15px 4px 0;\n\n    ${Pill} {\n        flex-shrink: 0;\n        &:last-of-type {\n            margin-right: 0;\n        }\n    }\n`;\n\nconst CollapsedStreamContent = styled(ContentMonoValue)`\n    overflow: hidden;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    flex-grow: 1;\n    width: auto;\n    padding: 3px 0 4px;\n`;\n\ninterface MessageEditorRowProps {\n    streamId: string,\n    message: StreamMessage,\n    editorNode: portals.HtmlPortalNode<typeof SelfSizedEditor>,\n    isPaidUser: boolean,\n    onExportMessage: (message: StreamMessage) => void\n}\n\n@observer\nexport class StreamMessageEditorRow extends React.Component<MessageEditorRowProps> {\n\n    @observable\n    private selectedContentType: ViewableContentType | undefined;\n\n    private containerRef = React.createRef<HTMLDivElement>();\n\n    componentDidMount() {\n        disposeOnUnmount(this, autorun(() => {\n            const message = this.props.message;\n\n            if (!message) {\n                this.setContentType(undefined);\n                return;\n            }\n        }));\n\n        this.onMessageChanged();\n    }\n\n    componentDidUpdate(prevProps: MessageEditorRowProps) {\n        if (prevProps?.message.messageIndex !== this.props.message.messageIndex) {\n            this.onMessageChanged();\n        }\n    }\n\n    onMessageChanged() {\n        // We've just changed message - scroll to show this editor fully and\n        // focus the contained editor itself.\n        const container = this.containerRef.current!;\n\n        container.scrollIntoView({\n            behavior: 'smooth',\n        });\n\n        const editor = container.querySelector('.monaco-editor textarea');\n        if (editor) {\n            (editor as HTMLElement).focus();\n        } else {\n            // If the editor content needs formatting, e.g. for JSON messages, the editor itself won't\n            // yet be visible. In this case, we'll focus the container instead, and jump to the editor\n            // when onContentRendered fires from the content viewer.\n            container.focus();\n        }\n    }\n\n    onEditorContentRendered = () => {\n        // Only if the row is focused (not any buttons within etc) and the content has just rendered then\n        // you should jump to it. This should only happen if the editor content was not visible initially.\n        if (this.containerRef.current === document.activeElement) {\n            const editor = this.containerRef.current?.querySelector('.monaco-editor textarea');\n            (editor as HTMLElement | undefined)?.focus();\n        }\n    }\n\n    @action.bound\n    setContentType(contentType: ViewableContentType | undefined) {\n        if (contentType === this.props.message.contentType) {\n            this.selectedContentType = undefined;\n        } else {\n            this.selectedContentType = contentType;\n        }\n    }\n\n    render() {\n        const { message, isPaidUser, onExportMessage, editorNode, streamId } = this.props;\n\n        const compatibleContentTypes = getCompatibleTypes(\n            message.contentType,\n            undefined,\n            asBuffer(message.content)\n        );\n        const contentType = _.includes(compatibleContentTypes, this.selectedContentType) ?\n            this.selectedContentType! : message.contentType;\n\n        const messageDirection = message.direction === 'sent' ? 'left' : 'right';\n\n        return <EditorRowContainer\n            ref={this.containerRef}\n            tabIndex={-1} // Only ever focused by up/down on other rows\n            onKeyDown={(e) => {\n                // Only listen to events where the entire row is specifically focused:\n                if (e.target !== e.currentTarget) return;\n\n                // When focused (via up/down) if you press enter is jumps to the content. That means\n                // you can up/down past this no problem, or press enter and then move to tab-based\n                // control back to the rows, and then up/down again.\n                else if (e.target === e.currentTarget && e.key === 'Enter') {\n                    const editor = (e.target as HTMLElement).querySelector('.monaco-editor textarea');\n                    (editor as HTMLElement | undefined)?.focus();\n                }\n\n                // TODO: It would be nice to allow Escape here to exit the editor, but because it's a portal, the keydown\n                // events don't actually bubble back up here. Might be worth re-investigating this after eventually\n                // fixing https://github.com/httptoolkit/react-reverse-portal/issues/13. Not easy though.\n\n                // Keep the same up/down behaviour as the collapsed rows\n                else if (e.key === 'ArrowDown') {\n                    e.preventDefault();\n                    (e.currentTarget.nextElementSibling as HTMLElement)?.focus?.();\n                } else if (e.key === 'ArrowUp') {\n                    e.preventDefault();\n                    (e.currentTarget.previousElementSibling as HTMLElement)?.focus?.();\n                }\n            }}\n        >\n            <EditorRowHeader messageDirection={messageDirection}>\n                <MessageArrow selected={true} messageDirection={messageDirection} />\n                <ContentLabel>\n                    {message.direction === 'sent'\n                        ? 'Received from server' // I.e. 'sent' by Mockttp\n                        : 'Sent by client'\n                    }:\n                </ContentLabel>\n                <IconButton\n                    icon={['fas', 'download']}\n                    title={\n                        isPaidUser\n                            ? \"Save this message as a file\"\n                            : \"With Pro: Save this message as a file\"\n                    }\n                    disabled={!isPaidUser}\n                    onClick={() => onExportMessage(message)}\n                />\n                <PillSelector<ViewableContentType>\n                    onChange={this.setContentType}\n                    value={contentType}\n                    options={compatibleContentTypes}\n                    nameFormatter={getContentEditorName}\n                />\n                <Pill>{ getReadableSize(message.content.byteLength) }</Pill>\n            </EditorRowHeader>\n            <RowEditorContent>\n                <ContentViewer\n                    contentId={`ws-${streamId}-${message.messageIndex}`}\n                    editorNode={editorNode}\n                    contentType={contentType}\n                    cache={message.cache}\n                    expanded={false}\n                    onContentRendered={this.onEditorContentRendered}\n                >\n                    {message.content}\n                </ContentViewer>\n            </RowEditorContent>\n        </EditorRowContainer>;\n    }\n\n}\n\nconst EditorRowContainer = styled.div`\n    background-color: ${p => p.theme.mainBackground};\n    border-bottom: 1px solid ${p => p.theme.containerWatermark};\n\n    display: flex;\n    flex-direction: column;\n`;\n\nconst EditorRowHeader = styled.div<{ messageDirection: 'left' | 'right' }>`\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    gap: 8px;\n\n    padding: 4px 15px 4px 0;\n\n    cursor: pointer;\n\n    border-style: solid;\n    border-width: 0 5px 1px;\n\n    border-color: transparent;\n    border-${p => p.messageDirection}-color: ${p => p.theme.popColor};\n    border-bottom-color: ${p => p.theme.containerWatermark};\n\n    > ${ContentLabel} {\n        flex-grow: 1;\n        text-overflow: ellipsis;\n        overflow: hidden;\n\n        margin-left: -8px;\n    }\n\n    > ${IconButton} {\n        margin: -5px 0;\n    }\n\n    ${Pill}, select {\n        &:last-of-type {\n            margin-right: 0;\n        }\n    }\n`;\n\nconst RowEditorContent = styled(EditorCardContent)`\n    /* Undo the whole-card specific bits of styling */\n    border-top: none;\n    margin: 0;\n`;","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { action, computed, observable } from 'mobx';\nimport { observer } from 'mobx-react';\nimport * as portals from 'react-reverse-portal';\n\nimport { styled } from '../../styles';\nimport { saveFile } from '../../util/ui';\n\nimport { StreamMessage } from '../../model/events/stream-message';\nimport { getSummaryColour } from '../../model/events/categorization';\n\nimport { Pill } from '../common/pill';\nimport { IconButton } from '../common/icon-button';\nimport { CollapsingButtons } from '../common/collapsing-buttons';\nimport { ExpandShrinkButton } from '../common/expand-shrink-button';\nimport { CollapsibleCard, CollapsibleCardHeading, ExpandableCardProps } from '../common/card';\n\nimport { SelfSizedEditor } from '../editor/base-editor';\nimport {\n    StreamMessageCollapsedRow,\n    StreamMessageEditorRow\n} from './stream-message-rows';\n\nfunction getFilename(\n    filenamePrefix: string,\n    someBinary: boolean,\n    messageIndex?: number\n) {\n    const extension = someBinary ? 'bin' : 'txt';\n\n    return `${filenamePrefix} ${\n        messageIndex ? `message ${messageIndex}` : 'messages'\n    }.${extension}`;\n}\n\nexport type StreamType = 'WebSocket' | 'DataChannel';\n\n@observer\nexport class StreamMessageListCard extends React.Component<ExpandableCardProps & {\n    isPaidUser: boolean,\n    filenamePrefix: string,\n    streamId: string,\n    streamType: StreamType,\n    streamLabel?: string,\n    messages: Array<StreamMessage>,\n    editorNode: portals.HtmlPortalNode<typeof SelfSizedEditor>\n}> {\n\n    @observable\n    expandedRow: number | undefined = undefined;\n\n    @computed\n    get someBinaryMessages() {\n        return this.props.messages.some(m => m.isBinary);\n    }\n\n    render() {\n        const {\n            streamId,\n            streamType,\n            streamLabel,\n            messages,\n            isPaidUser,\n            editorNode,\n            collapsed,\n            expanded,\n            onCollapseToggled,\n            onExpandToggled\n        } = this.props;\n\n        return <CollapsibleCard\n            collapsed={collapsed}\n            onCollapseToggled={onCollapseToggled}\n            expanded={expanded}\n        >\n            <header>\n                <CollapsingButtons>\n                    { onExpandToggled && <ExpandShrinkButton\n                        expanded={expanded}\n                        onClick={onExpandToggled}\n                    /> }\n                    <IconButton\n                        icon={['fas', 'download']}\n                        title={\n                            isPaidUser\n                                ? \"Save these message as a file\"\n                                : \"With Pro: Save these messages as a file\"\n                        }\n                        disabled={!isPaidUser}\n                        onClick={this.exportMessages}\n                    />\n                </CollapsingButtons>\n                { streamLabel && <Pill\n                    color={getSummaryColour('data')}\n                    title={streamLabel}\n                >\n                    { streamLabel }\n                </Pill> }\n                <Pill>\n                    { messages.length } message{\n                        messages.length !== 1 ? 's' : ''\n                    }\n                </Pill>\n                <CollapsibleCardHeading\n                    onCollapseToggled={onCollapseToggled}\n                >\n                    { streamType } messages\n                </CollapsibleCardHeading>\n            </header>\n            <StreamMessagesList expanded={!!expanded}>\n                {\n                    messages.map((message, i) =>\n                        this.expandedRow === i\n                        ? <StreamMessageEditorRow\n                            key='expanded' // Constant, which preserves content type between rows\n                            message={message}\n\n                            streamId={streamId}\n                            isPaidUser={isPaidUser}\n                            onExportMessage={this.exportMessage}\n                            editorNode={editorNode}\n                        />\n                        : <StreamMessageCollapsedRow\n                            key={i}\n                            message={message}\n\n                            index={i}\n                            onClick={this.expandRow}\n                        />\n                    )\n                }\n            </StreamMessagesList>\n        </CollapsibleCard>;\n    }\n\n    @action.bound\n    expandRow(index: number) {\n        this.expandedRow = index;\n    }\n\n    exportMessages = () => {\n        saveFile(\n            getFilename(this.props.filenamePrefix, this.someBinaryMessages),\n            this.someBinaryMessages\n                ? 'application/octet-stream'\n                : 'text/plain',\n            this.props.messages\n                .map(m => m.content)\n                .join('\\n\\n---\\n\\n')\n        );\n    };\n\n    exportMessage = (message: StreamMessage) => {\n        const filename = getFilename(\n            this.props.filenamePrefix,\n            message.isBinary,\n            this.props.messages.indexOf(message)\n        );\n\n        saveFile(\n            filename,\n            message.isBinary\n                ? 'application/octet-stream'\n                : 'text/plain',\n            message.content\n        );\n    }\n\n}\n\nconst StreamMessagesList = styled.div<{ expanded: boolean }>`\n    width: calc(100% + 40px);\n    margin: 0 -20px -20px -20px;\n\n    border-top: solid 1px ${p => p.theme.containerWatermark};\n    background-color: ${p => p.theme.mainLowlightBackground};\n\n    display: flex;\n    flex-direction: column;\n    white-space: nowrap;\n\n    position: relative;\n    ${p => p.expanded && `\n        height: auto !important;\n        overflow-y: auto;\n    `}\n`;\n","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { observer } from 'mobx-react';\nimport { observable, action } from 'mobx';\n\nimport { styled, css } from \"../../styles\";\nimport { isReactElement } from '../../util/ui';\nimport { Icon, IconProp } from '../../icons';\n\ninterface CollapsibleSectionProps {\n    children: React.ReactNode;\n    className?: string;\n    withinGrid?: boolean;\n    prefixTrigger?: boolean;\n}\n\nconst CollapsibleSectionWrapper = styled.section`\n    ${(p: { withinGrid: boolean}) => p.withinGrid && css`\n        display: contents;\n    `}\n`;\n\nconst SummaryWrapper = styled.span`\n    margin-right: 10px;\n\n    ${(p: { withinGrid: boolean}) => p.withinGrid && css`\n        display: contents;\n    `}\n`;\n\nconst SummaryAsSpacer = styled.div`\n    visibility: hidden;\n    margin-top: -2px;\n    margin-bottom: 6px;\n    display: inline-block;\n\n    max-height: 31px;\n    overflow: hidden;\n`;\n\n/**\n * This component lets us create collapsible sections. It takes always 1 or 2 children,\n * the 1st a collapsible summary, and the 2nd a body to show when expanded. The expand\n * toggle button & behaviour are injected automatically. This works either in a automatic\n * 'normal' layout, or as part of an existing grid layout (using display: contents, if\n * withinGrid is true).\n *\n * Outside a grid, the body area wraps around its summary, and sufficiently small\n * content from the body can fit into the wraparound area, if there's space.\n * This establishes a hierarchy, and provides a nice space for non-essential metadata.\n * That should look something like this:\n *  ____________________   ____________\n * [      summary       ] [ wraparound ]\n *  --------------------  [            ]\n * [           Body                    ]\n *  -----------------------------------\n *\n * Where the wraparound & body are only visible when the section is expanded. In a grid\n * we don't do this, primarily just because it's very hard.\n *\n * This component also works if there is no body provided - it falls back to just\n * showing the summary without the expand/collapse toggle.\n */\n@observer\nexport class CollapsibleSection extends React.Component<CollapsibleSectionProps> {\n\n    @observable\n    open = false;\n\n    render() {\n        const {\n            children,\n            withinGrid = false,\n        } = this.props;\n        const prefixTrigger = withinGrid || this.props.prefixTrigger;\n\n        const [ sectionSummary, sectionBody, ...otherChildren ] = React.Children.toArray(children);\n\n        if (otherChildren.length) {\n            throw new Error(`Collapsible section has extra children: ${otherChildren}`);\n        } else if (!isReactElement(sectionSummary)) {\n            throw new Error('Collapsible section 1st child must be a summary element');\n        }\n\n        const hasBody = !!sectionBody;\n        if (hasBody && !isReactElement(sectionBody)) {\n            throw new Error('Collapsible section 2nd child must be a body element');\n        }\n        // Undefined (if !hasBody) or a proper React element. Only really necessary\n        // to make the types here a bit clearer.\n        const bodyElement = (sectionBody as React.ReactElement);\n\n        const trigger = <CollapsibleTrigger\n            open={this.open}\n            canOpen={hasBody}\n            withinGrid={withinGrid}\n            onClick={this.toggleOpen}\n        />;\n\n        const summary = React.cloneElement(\n            sectionSummary,\n            { open: this.open, withinGrid: withinGrid },\n\n            // In a grid or if requested, we always prepend the trigger (but it may be hidden)\n            prefixTrigger ? <>\n                { trigger }\n                <SummaryWrapper withinGrid={withinGrid}>\n                    { sectionSummary.props.children }\n                </SummaryWrapper>\n            </>\n\n            // Outside the grid we append triggers by default, and only if they're usable.\n            : <>\n                <SummaryWrapper withinGrid={withinGrid}>\n                    { sectionSummary.props.children }\n                </SummaryWrapper>\n                { hasBody && trigger }\n            </>\n        );\n\n        const body = hasBody && this.open ? React.cloneElement(\n            bodyElement,\n            { withinGrid },\n            withinGrid ?\n                // Grid body is a simple full width block\n                bodyElement.props.children\n            :\n                // Non-grid body copies the summary (invisibly), to allow content to\n                // wrap around the summary into the wraparound section.\n                <>\n                    <SummaryAsSpacer>{ summary }</SummaryAsSpacer>\n                    { bodyElement.props.children }\n                </>\n        ) : null;\n\n        return <CollapsibleSectionWrapper withinGrid={withinGrid}>\n            { summary }\n            { body }\n        </CollapsibleSectionWrapper>;\n    }\n\n    @action.bound\n    toggleOpen(e: React.SyntheticEvent) {\n        e.preventDefault();\n        this.open = !this.open;\n    }\n}\n\nconst OPEN_ICON: IconProp = ['fas', 'minus'];\nconst CLOSED_ICON: IconProp = ['fas', 'plus'];\n\nconst CollapsibleTrigger = styled((p: {\n    open: boolean,\n    canOpen: boolean,\n    withinGrid: boolean,\n    onClick: (e: React.SyntheticEvent) => void\n}) =>\n    <button {..._.omit(p, ['open', 'canOpen', 'withinGrid'])}>\n        <Icon icon={p.open ? OPEN_ICON : CLOSED_ICON} />\n    </button>\n)`\n    border: none;\n    background: none;\n\n    position: relative;\n    top: -1px;\n\n    cursor: pointer;\n    user-select: none;\n\n    outline: none;\n    &:focus {\n        color: ${p => p.theme.popColor};\n    }\n    &:hover {\n        color: ${p => p.theme.mainColor};\n    }\n\n    padding: 5px 10px;\n\n    ${p => p.withinGrid ? css`\n        margin: -3px 0 -5px -10px;\n        align-self: baseline;\n    ` : css`\n        margin: -5px 0 -5px -10px;\n        vertical-align: baseline;\n    `}\n\n    scale: 0.7;\n    color: ${p => p.theme.containerWatermark};\n\n    ${p => !p.canOpen && css`\n        visibility: hidden;\n    `}\n`;\n\ninterface CollapsibleSectionSummaryProps {\n    open?: boolean;\n    withinGrid?: boolean;\n}\n\nexport const CollapsibleSectionSummary = styled.header`\n    ${(p: CollapsibleSectionSummaryProps) => p.withinGrid ? css`\n        display: contents;\n    ` : css`\n        display: inline-block;\n    `}\n\n    margin: -6px 0 0 -20px;\n    padding: 9px 0 12px 20px;\n\n    box-sizing: border-box;\n\n    ${(p: CollapsibleSectionSummaryProps) => p.open && !p.withinGrid && css`\n        z-index: 1;\n        position: relative;\n\n        background-color: ${p => p.theme.mainBackground};\n\n        &:before {\n            content: '';\n            position: absolute;\n            right: -1px;\n            bottom: 0;\n            height: 35px;\n            width: 1px;\n            background-color: rgba(0,0,0,0.1);\n            box-shadow: 1px 1px 5px rgba(0,0,0,0.2);\n        }\n\n        &:after {\n            content: '';\n            position: absolute;\n            bottom: -1px;\n            left: 0;\n            right: 0;\n            height: 1px;\n            background-color: rgba(0,0,0,0.1);\n            box-shadow: 1px 1px 5px rgba(0,0,0,0.2);\n        }\n    `}\n`;\n\nexport const CollapsibleSectionBody = styled.div`\n    ${(p: { withinGrid?: boolean }) => p.withinGrid ? css`\n        grid-column: 1 / -1; /* Full width grid row */\n    ` : css`\n        margin-top: -37px; /* Pull up behind the summary section */\n        margin-bottom: 10px; /* Spacing below (grid uses grid-gap) */\n    `}\n\n    background-color: ${p => p.theme.mainLowlightBackground};\n    box-shadow:\n        inset 0px 12px 8px -10px rgba(0,0,0,0.15),\n        inset 0px -8px 8px -10px rgba(0,0,0,0.15);\n\n    padding: 8px 10px 10px 10px;\n\n    word-break: break-all; /* Fallback for anybody without break-word */\n    word-break: break-word;\n\n    line-height: 1.3;\n\n    position: relative;\n\n    margin-left: -20px;\n    margin-right: -20px;\n    padding-left: 20px;\n    padding-right: 20px;\n`;","import * as React from 'react';\nimport { observer } from 'mobx-react';\n\nimport { Theme } from '../../styles';\nimport { InputWebSocketClose } from '../../types';\n\nimport { getWebSocketCloseColor } from '../../model/events/categorization';\nimport { getWebSocketCloseCodeDocs } from '../../model/http/http-docs';\n\nimport {\n    CollapsibleCard,\n    CollapsibleCardHeading,\n    CollapsibleCardProps\n} from '../common/card';\nimport {\n    CollapsibleSection,\n    CollapsibleSectionSummary,\n    CollapsibleSectionBody\n} from '../common/collapsible-section';\nimport { Pill } from '../common/pill';\nimport {\n    ContentLabel,\n    ContentValue,\n    BlankContentPlaceholder,\n    Markdown\n} from '../common/text-content';\nimport { DocsLink } from '../common/docs-link';\n\ninterface WebSocketCloseCardProps extends CollapsibleCardProps {\n    theme: Theme;\n    closeState: InputWebSocketClose | 'aborted';\n}\n\nexport const WebSocketCloseCard = observer((props: WebSocketCloseCardProps) => {\n    const { closeState, theme } = props;\n\n    const closeCodeDocs = props.closeState !== 'aborted'\n        ? getWebSocketCloseCodeDocs(props.closeState.closeCode)\n        : undefined;\n\n    const responseDetails = closeCodeDocs && [\n        <Markdown\n            key='code-docs'\n            content={closeCodeDocs.summary}\n        />,\n        // We just link to the RFC every time for close codes, no better docs available really:\n        <p key='docs-link'>\n            <DocsLink href='https://www.rfc-editor.org/rfc/rfc6455.html#section-7.4.1'>Find out more</DocsLink>\n        </p>\n    ];\n\n\n    if (closeState === 'aborted') {\n        return <CollapsibleCard {...props}>\n            <header>\n                <Pill color={getWebSocketCloseColor('aborted', theme)}>Aborted</Pill>\n                <CollapsibleCardHeading onCollapseToggled={props.onCollapseToggled}>\n                    Connection closed\n                </CollapsibleCardHeading>\n            </header>\n            <div>\n                The connection was closed abruptly, without a clean close message.\n            </div>\n        </CollapsibleCard>;\n    } else {\n        const { closeCode, closeReason } = closeState;\n\n        return <CollapsibleCard {...props}>\n            <header>\n                <Pill color={getWebSocketCloseColor(closeCode, theme)}>{\n                    closeCode ?? 'No close code'\n                }</Pill>\n                <CollapsibleCardHeading onCollapseToggled={props.onCollapseToggled}>\n                    Connection closed\n                </CollapsibleCardHeading>\n            </header>\n\n            <CollapsibleSection>\n                <CollapsibleSectionSummary>\n                    <ContentLabel>Close code: </ContentLabel>\n                    { closeCode\n                        ? <ContentValue>{ closeCode }</ContentValue>\n                        : <BlankContentPlaceholder>(No close code)</BlankContentPlaceholder>\n                    }\n                </CollapsibleSectionSummary>\n\n                { responseDetails &&\n                    <CollapsibleSectionBody>\n                        { responseDetails }\n                    </CollapsibleSectionBody>\n                }\n            </CollapsibleSection>\n\n            <div>\n                <ContentLabel>Close reason: </ContentLabel>\n                { closeReason\n                    ? <ContentValue>{ closeReason }</ContentValue>\n                    : <BlankContentPlaceholder>(No reason provided)</BlankContentPlaceholder>\n                }\n            </div>\n        </CollapsibleCard>;\n    }\n});","import * as React from 'react';\n\nfunction showOnceLoaded(e: React.SyntheticEvent<HTMLImageElement, Event>) {\n    const elem = e.target as HTMLImageElement;\n    elem.style.display = 'initial';\n}\n\n// An img element which isn't shown at all, until it successfully loads\nexport const OptionalImage = (p: React.ImgHTMLAttributes<HTMLImageElement>) =>\n        <img {...p} onLoad={showOnceLoaded} style={{ display: 'none' }} />\n","import React from \"react\";\nimport { inject, observer } from \"mobx-react\";\n\nimport { styled, popColor } from \"../../styles\";\nimport { Icon } from \"../../icons\";\n\nimport { UiStore } from \"../../model/ui/ui-store\";\n\nimport { Pill } from \"../common/pill\";\nimport { UnstyledButton } from \"../common/inputs\";\nimport { AccountStore } from \"../../model/account/account-store\";\n\nexport const ProPill = styled(inject('uiStore')((p: { uiStore?: UiStore, className?: string }) =>\n    <Pill className={p.className} color={p.uiStore!.theme.popColor}>PRO</Pill>\n))`\n    font-size: ${p => p.theme.textSize};\n\n    color: ${popColor};\n    background-color: rgba(225,66,31,0.2);\n`;\n\nexport const ProHeaderPill = styled(ProPill)`\n    margin-right: auto;\n`;\n\nconst GetProButton = styled(UnstyledButton)`\n    box-sizing: border-box;\n    padding: 20px;\n\n    margin: 0 auto;\n\n    user-select: none;\n\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    text-align: center;\n\n    font-weight: bold;\n    color: ${p => p.theme.primaryInputColor};\n    background-color: ${p => p.theme.primaryInputBackground};\n    border-radius: 4px;\n    box-shadow: 0 2px 10px 0 rgba(0,0,0,0.3);\n\n    > svg {\n        margin-bottom: 5px;\n    }\n\n    &:hover {\n        background-image: linear-gradient(transparent, rgba(0,0,0,.05) 40%, rgba(0,0,0,.1));\n    }\n\n    &:active {\n        background-image: linear-gradient(rgba(0,0,0,.1), rgba(0,0,0,.05) 40%, transparent);\n    }\n`;\n\nexport const CardSalesPitch = inject('accountStore')(observer((p: {\n    children: React.ReactNode,\n    source: string,\n    accountStore?: AccountStore\n}) => <CardSalesPitchContainer>\n\n    { p.children }\n\n    <GetProButton onClick={() => p.accountStore!.getPro(p.source)}>\n        <Icon icon={['far', 'star']} size='2x' />\n        Get HTTP Toolkit Pro\n    </GetProButton>\n</CardSalesPitchContainer>));\n\nconst CardSalesPitchContainer = styled.div`\n    padding: 20px 25%;\n    margin: 0 -20px -20px -20px;\n    background-color: ${p => p.theme.mainLowlightBackground};\n    box-shadow: inset 0px 12px 8px -10px rgba(0,0,0,0.15);\n\n    p {\n        color: ${p => p.theme.mainColor};\n        line-height: 1.2;\n        font-weight: bold;\n        margin-bottom: 10px;\n    }\n\n    ${GetProButton} {\n        width: 100%;\n    }\n`;\n\nconst BlurOverlay = styled.div<{ inert?: boolean }>`\n    filter: blur(1px);\n    opacity: 0.6;\n\n    pointer-events: none;\n    user-select: none;\n`;\n\nconst OverlayContainer = styled.div`\n    position: relative;\n    min-height: 140px;\n`;\n\nconst OverlayGetProButton = styled(GetProButton)`\n    position: absolute;\n    top: 52%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    z-index: 1;\n`;\n\n@observer\nexport class GetProOverlay extends React.Component<{\n    getPro: (source: string) => void,\n    source: string,\n    children: React.ReactNode\n}> {\n    private buttonRef = React.createRef<HTMLButtonElement>();\n\n    render() {\n        return <OverlayContainer>\n            <OverlayGetProButton\n                ref={this.buttonRef}\n                onClick={() => this.props.getPro(this.props.source)}\n            >\n                <Icon icon={['far', 'star']} size='2x' />\n                Get Pro\n            </OverlayGetProButton>\n\n            <BlurOverlay\n                inert\n                // 'inert' doesn't actually work - it's non-standard, so we need this:\n                ref={node => node && node.setAttribute('inert', '')}\n                onFocus={() =>\n                    // Inert isn't well supported: quick hack to block focus on children\n                    this.buttonRef.current &&\n                    this.buttonRef.current.focus()\n                }\n            >\n                { this.props.children }\n            </BlurOverlay>\n        </OverlayContainer>;\n    }\n}","import * as React from 'react';\nimport { observer } from 'mobx-react';\n\nimport { Html } from '../../../types';\nimport { styled } from '../../../styles';\nimport { Icon } from '../../../icons';\nimport { joinAnd } from '../../../util/text';\n\nimport { ApiExchange, ApiParameter } from '../../../model/api/api-interfaces';\n\nimport {\n    CollapsibleCardHeading,\n    CollapsibleCard,\n    CollapsibleCardProps\n} from '../../common/card';\nimport {\n    CollapsibleSection,\n    CollapsibleSectionSummary,\n    CollapsibleSectionBody\n} from '../../common/collapsible-section';\nimport { OptionalImage } from '../../common/optional-image';\nimport {\n    ContentLabel,\n    ContentLabelBlock,\n    ExternalContent\n} from '../../common/text-content';\nimport { DocsLink } from '../../common/docs-link';\nimport { CardSalesPitch, ProHeaderPill } from '../../account/pro-placeholders';\n\nconst ServiceLogo = styled(OptionalImage)`\n    float: right;\n    height: 26px;\n\n    border: 4px solid #ffffff;\n    border-radius: 2px;\n`;\n\nconst ParametersGrid = styled.section`\n    display: grid;\n    grid-template-columns: 20px fit-content(40%) 1fr min-content;\n\n    grid-gap: 5px 0;\n    &:not(:last-child) {\n        margin-bottom: 10px;\n    }\n`;\n\nconst ParameterKeyValue = styled(CollapsibleSectionSummary)`\n    word-break: break-all; /* Fallback for anybody without break-word */\n    word-break: break-word;\n    font-family: ${p => p.theme.monoFontFamily};\n    line-height: 1.1;\n`;\n\nconst ParamName = styled.span`\n    margin-right: 10px;\n`;\n\nconst UnsetValue = styled.span`\n    font-style: italic;\n    opacity: ${p => p.theme.lowlightTextOpacity};\n    margin-right: 5px;\n`;\n\nconst ParamMetadata = styled((p: {\n    param: ApiParameter,\n    className?: string\n}) => <div className={p.className}>\n        {\n            [\n                p.param.required ? 'Required' : 'Optional',\n                p.param.type,\n                p.param.in\n            ]\n            .filter((x) => !!x)\n            .join(' ')\n        } parameter\n        {\n            p.param.defaultValue !== undefined ?\n                `. Defaults to ${p.param.defaultValue}`\n                : ''\n        }\n        {\n            p.param.enum !== undefined && p.param.enum.length > 0 ?\n                <>\n                    .<br/>\n                    Valid values: {joinAnd(\n                        p.param.enum.map(v => JSON.stringify(v))\n                    )}\n                </>\n                : ''\n        }.\n</div>)`\n    font-style: italic;\n`;\n\nconst WarningIcon = styled(Icon).attrs(() => ({\n    icon: ['fas', 'exclamation-triangle']\n}))`\n    color: ${p => p.theme.warningColor};\n    line-height: 1.2;\n\n    &:not(:first-child) {\n        margin-left: 9px;\n    }\n\n    &:not(:last-child) {\n        margin-right: 9px;\n    }\n`;\n\nconst Warning = styled((p) => <div {...p}>\n    <WarningIcon /><span>{p.children}</span>\n</div>)`\n    color: ${p => p.theme.popColor};\n\n    :not(:last-child) {\n        margin-bottom: 10px;\n    }\n`;\n\nfunction formatValue(value: unknown): string | undefined {\n        if (typeof value === 'string') return value;\n        if (typeof value === 'number') return value.toString(10);\n        if (typeof value === 'boolean') return value.toString();\n        if (value == null) return undefined;\n        else return JSON.stringify(value);\n}\n\nconst getDetailsWithWarnings = (details: Html | undefined, warnings: string[]) => [\n    warnings.length && warnings.map((warning, i) => <Warning key={warning}>{ warning }</Warning>),\n    details && <ExternalContent key='details' content={details} />\n].filter(d => !!d);\n\n\nconst ObjectParamContainer = styled.div`\n    display: grid;\n    grid-template-columns: fit-content(30%) auto;\n    grid-gap: 5px;\n    margin-bottom: 10px;\n`;\n\nconst ObjectParamKey = styled.div`\n    font-family: ${p => p.theme.monoFontFamily};\n    word-break: break-all;\n    text-align: right;\n`;\n\nconst ObjectParamValue = styled.pre`\n    font-family: ${p => p.theme.monoFontFamily};\n    word-break: break-all;\n    white-space: pre-wrap;\n`;\n\nconst ObjectParamDetails = (p: { value: object }) => <ObjectParamContainer>{\n    Object.entries(p.value).map(([key, value], i) => [\n        <ObjectParamKey key={`${i}-key`}>{ key }:</ObjectParamKey>,\n        <ObjectParamValue key={`${i}-value`}>{ value }</ObjectParamValue>\n    ])\n}</ObjectParamContainer>;\n\nconst ApiRequestDetails = (props: {\n    api: ApiExchange\n}) => {\n    const { api } = props;\n    const setParameters = api.request.parameters\n        .filter((param) => !!param.value || param.required || param.defaultValue);\n\n    // If that leaves us with lots of parameters then ignore the ones that\n    // are just unset default values.\n    const relevantParameters = setParameters.length > 5 ?\n        setParameters.filter((param) => !!param.value || param.required) :\n        setParameters;\n\n    const operationDetails = getDetailsWithWarnings(api.operation.description, api.operation.warnings);\n    const hasOperationDetails = !!operationDetails.length;\n\n    return <>\n        <CollapsibleSection>\n            <CollapsibleSectionSummary>\n                <ContentLabel>Service:</ContentLabel> { api.service.name }\n                { !api.service.description &&\n                    <DocsLink href={api.service.docsUrl} />\n                }\n            </CollapsibleSectionSummary>\n\n            { api.service.description &&\n                <CollapsibleSectionBody>\n                    <ServiceLogo src={ api.service.logoUrl } alt='' />\n                    <ExternalContent content={api.service.description} />\n                    <DocsLink href={api.service.docsUrl}>\n                        Find out more\n                    </DocsLink>\n                </CollapsibleSectionBody>\n            }\n        </CollapsibleSection>\n\n        <CollapsibleSection>\n            <CollapsibleSectionSummary>\n                <ContentLabel>Operation:</ContentLabel> { api.operation.name }\n                { !hasOperationDetails &&\n                    <DocsLink href={api.operation.docsUrl} />\n                }\n                { api.operation.warnings.length ? <WarningIcon /> : null }\n            </CollapsibleSectionSummary>\n\n            { hasOperationDetails &&\n                <CollapsibleSectionBody>\n                    { operationDetails }\n                    <DocsLink href={api.operation.docsUrl}>\n                        Find out more\n                    </DocsLink>\n                </CollapsibleSectionBody>\n            }\n        </CollapsibleSection>\n\n        { relevantParameters.length >= 1 && <>\n            <ContentLabelBlock>\n                Parameters\n            </ContentLabelBlock>\n            <ParametersGrid>\n                { relevantParameters.map((param) =>\n                    <CollapsibleSection withinGrid={true} key={param.name}>\n                        <ParameterKeyValue>\n                            <ParamName>{ param.name }: </ParamName>\n\n                            <span>{ formatValue(param.value) ||\n                                <UnsetValue>{\n                                    param.defaultValue ?\n                                        formatValue(param.defaultValue) + ' [default]' :\n                                        '[not set]'\n                                }</UnsetValue>\n                            }</span>\n\n                            { param.warnings.length ? <WarningIcon /> : <div/> }\n                        </ParameterKeyValue>\n\n                        <CollapsibleSectionBody>\n                            { getDetailsWithWarnings(param.description, param.warnings) }\n                            { param.type === 'object' && Object.keys(param).length > 1\n                                ? <ObjectParamDetails value={param.value as object} />\n                                : null\n                            }\n                            <ParamMetadata param={param}/>\n                        </CollapsibleSectionBody>\n                    </CollapsibleSection>\n                ) }\n            </ParametersGrid>\n        </> }\n    </>;\n}\n\ninterface HttpApiCardProps extends CollapsibleCardProps {\n    apiName: string;\n    apiExchange: ApiExchange\n}\n\nexport const HttpApiCard = observer((props: HttpApiCardProps) => {\n    const { apiName, apiExchange } = props;\n\n    return <CollapsibleCard {...props}>\n        <header>\n            <CollapsibleCardHeading onCollapseToggled={props.onCollapseToggled}>\n                { apiName }\n            </CollapsibleCardHeading>\n        </header>\n\n        <ApiRequestDetails api={apiExchange} />\n    </CollapsibleCard>;\n});\n\ninterface HttpApiPlaceholderCardProps extends CollapsibleCardProps {\n    apiName: string;\n}\n\nexport const HttpApiPlaceholderCard = observer((props: HttpApiPlaceholderCardProps) => {\n    const { apiName } = props;\n\n    return <CollapsibleCard {...props}>\n        <header>\n            <ProHeaderPill />\n\n            <CollapsibleCardHeading onCollapseToggled={props.onCollapseToggled}>\n                { apiName }\n            </CollapsibleCardHeading>\n        </header>\n\n        <CardSalesPitch source='api'>\n            <p>\n                HTTP Toolkit Pro can show you more information about this API.\n            </p>\n            <p>\n                Instantly understand this request with inline documentation for the\n                endpoint, parameters, and responses.\n            </p>\n            <p>\n                Automatically validate that this request &amp; its body match the API\n                schema. See all the parameters that you're <em>not</em> sending too,\n                and their default values, and get warned about deprecated or invalid\n                endpoints and parameters.\n            </p>\n        </CardSalesPitch>\n    </CollapsibleCard>;\n});","import * as React from 'react';\n\nimport { styled } from '../../styles';\nimport { SourceIcons, Icon } from '../../icons';\n\nimport { TrafficSource } from '../../model/http/sources';\n\nexport const SourceIcon = styled(({ source, className }: {\n    source: TrafficSource,\n    className?: string\n}) => source.icon !== SourceIcons.Unknown\n    ? <Icon\n        className={className}\n        title={source.summary}\n        {...source.icon}\n    />\n    : null\n)`\n    margin-left: 8px;\n`;","import * as React from 'react';\n\nimport { parse as parseCookie, Cookie } from 'set-cookie-parser';\nimport {\n    isFuture,\n    addSeconds,\n    format as formatDate,\n    distanceInWordsToNow\n} from 'date-fns';\n\nimport { Content } from '../../common/text-content';\n\nfunction getExpiryExplanation(date: Date) {\n    const exactTime = formatDate(date, 'YYYY-MM-DD [at] HH:mm:ss');\n    const relativeTime = distanceInWordsToNow(date);\n\n    if (isFuture(date)) {\n        return <>\n            will expire <span title={exactTime}>in {relativeTime}</span>\n        </>\n    } else {\n        return <>\n            expired <span title={exactTime}>{relativeTime} ago</span>\n        </>\n    }\n}\n\nexport const CookieHeaderDescription = (p: { value: string, requestUrl: URL }) => {\n    const cookies = parseCookie(p.value);\n\n    // The effective path at which cookies will be set by default.\n    const requestPath = p.requestUrl.pathname.replace(/\\/[^\\/]*$/, '') || '/';\n\n    return <>{\n        // In 99% of cases there is only one cookie here, but we can play it safe.\n        cookies.map((\n            cookie: Cookie & { sameSite?: 'Strict' | 'Lax' | 'None' }\n        ) => {\n            if (cookie.sameSite?.toLowerCase() === 'none' && !cookie.secure) {\n                return <Content key={cookie.name}>\n                    <p>\n                        This attempts to set cookie '<code>{cookie.name}</code>' to\n                        '<code>{cookie.value}</code>'\n                    </p>\n                    <p>\n                        <strong>This will fail so this cookie will not be set</strong>,\n                        because <code>SameSite=None</code> can only be used for cookies\n                        with the <code>Secure</code> flag.\n                    </p>\n                </Content>;\n            }\n\n            return <Content key={cookie.name}>\n                <p>\n                    Set cookie '<code>{cookie.name}</code>' to '<code>{cookie.value}</code>'\n                </p>\n\n                <p>\n                    This cookie will be sent in future\n                    { cookie.secure ? ' secure ' : ' secure and insecure ' }\n                    requests to{' '}\n                    { cookie.domain ? <>\n                        {cookie.domain.replace(/^\\./, '')} and subdomains\n                    </> : <>\n                        {p.requestUrl.hostname}, but not its subdomains\n                    </> }\n\n                    { cookie.path === '/' || requestPath === '/' ? <>\n                        .\n                    </> : cookie.path !== undefined ? <>\n                        , for paths within '{cookie.path}'.\n                    </> : <>\n                        , for paths within '{requestPath}'.\n                    </> }\n                </p>\n                <p>\n                    The cookie is {\n                        cookie.httpOnly ?\n                            'not accessible from client-side scripts' :\n                            'accessible from client-side scripts running on matching pages'\n                    }\n                    { (cookie.sameSite === undefined || cookie.sameSite.toLowerCase() === 'lax')\n                        // Lax is default for modern browsers (e.g. Chrome 80+)\n                        ? <>\n                            . Matching requests triggered from other origins will {\n                                cookie.httpOnly ? 'however' : 'also'\n                            } include this cookie, if they are top-level navigations (not subresources).\n                        </>\n                    : cookie.sameSite.toLowerCase() === 'strict' && cookie.httpOnly\n                        ? <>\n                            , or sent in requests triggered from other origins.\n                        </>\n                    : cookie.sameSite.toLowerCase() === 'strict' && !cookie.httpOnly\n                        ? <>\n                            , but will not be sent in requests triggered from other origins.\n                        </>\n                    : cookie.sameSite.toLowerCase() === 'none' && cookie.secure\n                        ? <>\n                            . Matching requests triggered from other origins will {\n                                cookie.httpOnly ? 'however' : 'also'\n                            } include this cookie.\n                        </>\n                    : <>\n                        . This cookie uses an unrecognized SameSite property, which may cause issues.\n                    </>\n                    }\n                </p>\n\n                <p>\n                    The cookie {\n                        cookie.maxAge ? <>\n                            { getExpiryExplanation(addSeconds(new Date(), cookie.maxAge)) }\n                            { cookie.expires && ` ('max-age' overrides 'expires')` }\n                        </> :\n                        cookie.expires ?\n                            getExpiryExplanation(cookie.expires)\n                        : 'expires at the end of the current session'\n                    }.\n                </p>\n            </Content>;\n        })\n    }</>\n};","import * as React from 'react';\n\nimport { parseSource } from '../../../model/http/sources';\nimport { getHeaderDocs } from '../../../model/http/http-docs';\n\nimport { Content } from '../../common/text-content';\n\nexport const UserAgentHeaderDescription = (p: { value: string }) => {\n    const { description } = parseSource(p.value);\n\n    if (!description) return <p>\n        { getHeaderDocs('user-agent')!.summary }\n    </p>;\n\n    return <Content>\n        <p>{ description }</p>\n    </Content>;\n};","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { inject, observer } from 'mobx-react';\n\nimport { styled } from '../../../styles';\nimport { RawHeaders } from '../../../types';\n\nimport { getHeaderDocs } from '../../../model/http/http-docs';\nimport { AccountStore } from '../../../model/account/account-store';\n\nimport { CollapsibleSection } from '../../common/collapsible-section';\nimport { DocsLink } from '../../common/docs-link';\nimport { BlankContentPlaceholder } from '../../common/text-content';\nimport {\n    CollapsibleSectionSummary,\n    CollapsibleSectionBody\n} from '../../common/collapsible-section';\n\nimport { CookieHeaderDescription } from './set-cookie-header-description';\nimport { UserAgentHeaderDescription } from './user-agent-header-description';\n\nconst HeadersGrid = styled.section`\n    display: grid;\n    grid-template-columns: 20px fit-content(30%) 1fr;\n\n    grid-gap: 5px 0;\n    &:not(:last-child) {\n        margin-bottom: 10px;\n    }\n`;\n\nconst HeaderKeyValue = styled(CollapsibleSectionSummary)`\n    word-break: break-all; /* Fallback for anybody without break-word */\n    word-break: break-word;\n    font-family: ${p => p.theme.monoFontFamily};\n    line-height: 1.1;\n`;\n\nconst HeaderName = styled.span`\n    margin-right: 10px;\n`;\n\nconst HeaderDescriptionContainer = styled(CollapsibleSectionBody)`\n    line-height: 1.3;\n`;\n\nconst HeaderDocsLink = styled(DocsLink)`\n    display: block;\n    margin-top: 10px;\n`;\n\nconst getHeaderDescription = (\n    name: string,\n    value: string,\n    requestUrl: URL,\n    isPaidUser: boolean\n) => {\n    name = name.toLowerCase();\n\n    if (isPaidUser) {\n        if (name === 'set-cookie') {\n            return <CookieHeaderDescription\n                value={value}\n                requestUrl={requestUrl}\n            />;\n        } else if (name === 'user-agent') {\n            return <UserAgentHeaderDescription\n                value={value}\n            />;\n        }\n    }\n\n    const headerDocs = getHeaderDocs(name)?.summary;\n\n    return headerDocs && <p>\n        { headerDocs }\n    </p>\n};\n\nexport const HeaderDetails = inject('accountStore')(observer((props: {\n    headers: RawHeaders,\n    requestUrl: URL,\n    accountStore?: AccountStore\n}) => {\n    const sortedHeaders = _.sortBy(props.headers, ([key]) => key.toLowerCase());\n\n    return sortedHeaders.length === 0 ?\n        <BlankContentPlaceholder>(None)</BlankContentPlaceholder>\n    :\n        <HeadersGrid>\n            { _.flatMap(sortedHeaders, ([key, value], i) => {\n                const docs = getHeaderDocs(key);\n                const description = getHeaderDescription(\n                    key,\n                    value,\n                    props.requestUrl,\n                    props.accountStore!.isPaidUser\n                )\n\n                return <CollapsibleSection withinGrid={true} key={`${key}-${i}`}>\n                    <HeaderKeyValue>\n                        <HeaderName>{ key }: </HeaderName>\n                        <span>{ value }</span>\n                    </HeaderKeyValue>\n\n                    { description && <HeaderDescriptionContainer>\n                        { description }\n                        { docs && <HeaderDocsLink href={docs.url}>\n                            Find out more\n                        </HeaderDocsLink> }\n                    </HeaderDescriptionContainer> }\n                </CollapsibleSection>\n            }) }\n        </HeadersGrid>;\n}));","import * as React from 'react';\n\nimport { styled } from '../../styles';\nimport { ContentLabel } from '../common/text-content';\n\nconst BreakdownContainer = styled.div`\n    display: grid;\n    grid-template-columns: fit-content(50%) auto;\n    grid-gap: 5px;\n`;\n\nconst BreakdownKey = styled.div`\n    font-family: ${p => p.theme.monoFontFamily};\n    word-break: break-all;\n    text-align: right;\n`;\n\nconst BreakdownValue = styled.pre`\n    font-family: ${p => p.theme.monoFontFamily};\n    word-break: break-all;\n    white-space: pre-wrap;\n`;\n\nconst ParameterSeparator = styled(ContentLabel)`\n    margin-top: 10px;\n    grid-column: 1 / span 2;\n`;\n\nexport const UrlBreakdown = (p: { url: URL }) => {\n    const params = [...p.url.searchParams];\n\n    let decodedPathname: string;\n    try {\n        decodedPathname = decodeURIComponent(p.url.pathname);\n    } catch (e) {\n        decodedPathname = p.url.pathname;\n    }\n\n    return <BreakdownContainer>\n        <BreakdownKey>Protocol:</BreakdownKey> <BreakdownValue>{ p.url.protocol.slice(0, -1) }</BreakdownValue>\n\n        { (p.url.username || p.url.password) && <>\n            <BreakdownKey>Username:</BreakdownKey> <BreakdownValue>{ p.url.username }</BreakdownValue>\n            <BreakdownKey>Password:</BreakdownKey> <BreakdownValue>{ p.url.password }</BreakdownValue>\n        </> }\n\n        <BreakdownKey>Host:</BreakdownKey> <BreakdownValue>{ p.url.host }</BreakdownValue>\n        <BreakdownKey>Path:</BreakdownKey> <BreakdownValue>{ decodedPathname }</BreakdownValue>\n\n        { params.length ? <ParameterSeparator>Parameters</ParameterSeparator> : null }\n\n        { params.map(([key, value], i) => [\n            <BreakdownKey key={`${i}-key`}>{ key }:</BreakdownKey>,\n            <BreakdownValue key={`${i}-value`}>{ value }</BreakdownValue>\n        ]) }\n    </BreakdownContainer>;\n}","import * as React from 'react';\nimport { inject, observer } from 'mobx-react';\n\nimport { HttpExchange, HtkRequest } from '../../../types';\nimport { styled } from '../../../styles';\nimport { Icon } from '../../../icons';\n\nimport { aOrAn, uppercaseFirst } from '../../../util/text';\n\nimport { UiStore } from '../../../model/ui/ui-store';\nimport { getSummaryColour } from '../../../model/events/categorization';\nimport { getMethodDocs } from '../../../model/http/http-docs';\nimport { nameHandlerClass } from '../../../model/rules/rule-descriptions';\nimport { HandlerClassKey } from '../../../model/rules/rules';\n\nimport {\n    CollapsibleCardHeading,\n    CollapsibleCard,\n    CollapsibleCardProps\n} from '../../common/card';\nimport { Pill, PillButton } from '../../common/pill';\nimport {\n    CollapsibleSection,\n    CollapsibleSectionSummary,\n    CollapsibleSectionBody\n} from '../../common/collapsible-section';\nimport {\n    ContentLabel,\n    ContentLabelBlock,\n    ContentMonoValueInline,\n    Markdown\n} from '../../common/text-content';\nimport { DocsLink } from '../../common/docs-link';\nimport { SourceIcon } from '../../common/source-icon';\nimport { HeaderDetails } from './header-details';\nimport { UrlBreakdown } from '../url-breakdown';\n\nconst MatchedRulePill = styled(inject('uiStore')((p: {\n    className?: string,\n    uiStore?: UiStore,\n    ruleData: {\n        stepTypes: HandlerClassKey[],\n        status: 'unchanged' | 'modified-types' | 'deleted'\n    },\n    onClick: () => void\n}) => {\n    const { stepTypes } = p.ruleData;\n    const stepDescription = stepTypes.length !== 1\n        ? 'multi-step'\n        : nameHandlerClass(stepTypes[0]);\n\n    return <PillButton\n        color={getSummaryColour('mutative')} // Conceptually similar - we've modified traffic\n        className={p.className}\n\n        // For now we show modified as unchanged, but we could highlight this later:\n        disabled={p.ruleData.status === 'deleted'}\n        onClick={p.ruleData.status !== 'deleted' ? p.onClick : undefined}\n\n        title={\n            `This request was handled by ${\n                aOrAn(stepDescription)\n             } ${stepDescription} rule${\n                p.ruleData.status === 'deleted'\n                    ? ' which has since been deleted'\n                : p.ruleData.status === 'modified-types'\n                    ? ' (which has since been modified)'\n                : ''\n            }.${\n                p.ruleData.status !== 'deleted'\n                    ? '\\nClick here to jump to the rule on the Mock page.'\n                    : ''\n            }`\n        }\n    >\n        <Icon icon={['fas', 'theater-masks']} />\n        { uppercaseFirst(stepDescription) }\n    </PillButton>;\n}))`\n    margin-right: auto;\n\n    text-decoration: none;\n    word-spacing: 0;\n\n    > svg {\n        margin-right: 5px;\n    }\n`;\n\nconst RawRequestDetails = (p: { request: HtkRequest }) => {\n    const methodDocs = getMethodDocs(p.request.method);\n    const methodDetails = [\n        methodDocs && <Markdown\n            key='method-docs'\n            content={methodDocs.summary}\n        />,\n        methodDocs && <p key='method-link'>\n            <DocsLink href={methodDocs.url}>Find out more</DocsLink>\n        </p>\n    ].filter(d => !!d);\n\n    return <div>\n        <CollapsibleSection>\n            <CollapsibleSectionSummary>\n                <ContentLabel>Method:</ContentLabel> { p.request.method }\n            </CollapsibleSectionSummary>\n\n            {\n                methodDetails.length ?\n                    <CollapsibleSectionBody>\n                        { methodDetails }\n                    </CollapsibleSectionBody>\n                : null\n            }\n        </CollapsibleSection>\n\n        <ContentLabelBlock>URL</ContentLabelBlock>\n\n        <CollapsibleSection prefixTrigger={true}>\n            <CollapsibleSectionSummary>\n                <ContentMonoValueInline>{\n                    p.request.parsedUrl.parseable\n                        ? p.request.parsedUrl.toString()\n                        : p.request.url\n                }</ContentMonoValueInline>\n            </CollapsibleSectionSummary>\n\n            {\n                <CollapsibleSectionBody>\n                    <UrlBreakdown url={p.request.parsedUrl} />\n                </CollapsibleSectionBody>\n            }\n        </CollapsibleSection>\n\n        <ContentLabelBlock>Headers</ContentLabelBlock>\n        <HeaderDetails headers={p.request.rawHeaders} requestUrl={p.request.parsedUrl} />\n    </div>;\n}\n\ninterface HttpRequestCardProps extends CollapsibleCardProps {\n    exchange: HttpExchange;\n    matchedRuleData: {\n        stepTypes: HandlerClassKey[],\n        status: 'unchanged' | 'modified-types' | 'deleted'\n    } | undefined;\n    onRuleClicked: () => void;\n}\n\nexport const HttpRequestCard = observer((props: HttpRequestCardProps) => {\n    const { exchange, matchedRuleData, onRuleClicked } = props;\n    const { request } = exchange;\n\n    // We consider passthrough as a no-op, and so don't show anything in that case.\n    const noopRule = matchedRuleData?.stepTypes.every(\n        type => type === 'passthrough' || type === 'ws-passthrough'\n    )\n\n    return <CollapsibleCard {...props} direction='right'>\n        <header>\n            { matchedRuleData && !noopRule &&\n                <MatchedRulePill\n                    ruleData={matchedRuleData}\n                    onClick={onRuleClicked}\n                />\n            }\n            <SourceIcon source={request.source} />\n            <Pill color={getSummaryColour(exchange)}>\n                { exchange.isWebSocket() ? 'WebSocket ' : '' }\n                { request.method } {\n                    (request.hostname || '')\n                    // Add some tiny spaces to split up parts of the hostname\n                    .replace(/\\./g, '\\u2008.\\u2008')\n                }\n            </Pill>\n            <CollapsibleCardHeading onCollapseToggled={props.onCollapseToggled}>\n                Request\n            </CollapsibleCardHeading>\n        </header>\n\n        <RawRequestDetails request={request} />\n    </CollapsibleCard>;\n});","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { observer } from 'mobx-react';\nimport { get } from 'typesafe-get';\n\nimport { HtkResponse, Omit } from '../../../types';\nimport { Theme } from '../../../styles';\n\nimport { ApiExchange } from '../../../model/api/api-interfaces';\nimport { getStatusColor } from '../../../model/events/categorization';\nimport { getStatusDocs, getStatusMessage } from '../../../model/http/http-docs';\n\nimport {\n    CollapsibleCard,\n    CollapsibleCardProps,\n    CollapsibleCardHeading\n} from '../../common/card';\nimport { Pill } from '../../common/pill';\nimport { HeaderDetails } from './header-details';\nimport {\n} from '../../common/card';\nimport {\n    CollapsibleSection,\n    CollapsibleSectionSummary,\n    CollapsibleSectionBody\n} from '../../common/collapsible-section';\nimport {\n    ContentLabel,\n    ContentLabelBlock,\n    ExternalContent,\n    Markdown\n} from '../../common/text-content';\nimport { DocsLink } from '../../common/docs-link';\n\ninterface HttpResponseCardProps extends CollapsibleCardProps  {\n    theme: Theme;\n    requestUrl: URL;\n    response: HtkResponse;\n    apiExchange: ApiExchange | undefined;\n}\n\nexport const HttpResponseCard = observer((props: HttpResponseCardProps) => {\n    const { response, requestUrl, theme, apiExchange } = props;\n\n    const apiResponseDescription = get(apiExchange, 'response', 'description');\n    const statusDocs = getStatusDocs(response.statusCode);\n\n    const responseDetails = [\n        apiResponseDescription && <ExternalContent\n            key='api-response-docs'\n            content={apiResponseDescription}\n        />,\n        statusDocs && <Markdown\n            key='status-docs'\n            content={statusDocs.summary}\n        />,\n        statusDocs && <p key='status-link'>\n            <DocsLink href={statusDocs.url}>Find out more</DocsLink>\n        </p>\n    ].filter(d => !!d);\n\n    return <CollapsibleCard {...props} direction='left'>\n        <header>\n            <Pill color={getStatusColor(response.statusCode, theme)}>{\n                response.statusCode\n            }</Pill>\n            <CollapsibleCardHeading onCollapseToggled={props.onCollapseToggled}>\n                Response\n            </CollapsibleCardHeading>\n        </header>\n\n        <div>\n            <CollapsibleSection>\n                <CollapsibleSectionSummary>\n                    <ContentLabel>Status:</ContentLabel>{' '}\n                    {response.statusCode} {response.statusMessage || getStatusMessage(response.statusCode)}\n                </CollapsibleSectionSummary>\n\n                {\n                    responseDetails.length ?\n                        <CollapsibleSectionBody>\n                            { responseDetails }\n                        </CollapsibleSectionBody>\n                    : null\n                }\n            </CollapsibleSection>\n\n            <ContentLabelBlock>Headers</ContentLabelBlock>\n            <HeaderDetails headers={response.rawHeaders} requestUrl={requestUrl} />\n        </div>\n    </CollapsibleCard>;\n});","import * as React from 'react';\nimport { observer, inject } from 'mobx-react';\n\nimport { HttpExchange } from '../../../types';\nimport { styled } from '../../../styles';\n\nimport { UiStore } from '../../../model/ui/ui-store';\nimport { getStatusColor } from '../../../model/events/categorization';\n\nimport { Pill } from '../../common/pill';\nimport {\n    CollapsibleCard,\n    CollapsibleCardHeading,\n    CollapsibleCardProps\n} from '../../common/card';\nimport { ContentMonoValue } from '../../common/text-content';\n\nconst ErrorContent = styled(ContentMonoValue)`\n    margin-top: 10px;\n`;\n\nexport const HttpAbortedResponseCard = inject('uiStore')(observer((p: {\n    cardProps: CollapsibleCardProps,\n    exchange: HttpExchange,\n    uiStore?: UiStore\n}) =>\n    <CollapsibleCard {...p.cardProps} direction='left'>\n        <header>\n            <Pill color={getStatusColor('aborted', p.uiStore!.theme)}>\n                Aborted\n            </Pill>\n            <CollapsibleCardHeading onCollapseToggled={p.cardProps.onCollapseToggled}>\n                Response\n            </CollapsibleCardHeading>\n        </header>\n        <div>\n            The connection failed before a response could be completed{\n                p.exchange.abortMessage\n                ? <> with error:\n                        <ErrorContent>\n                            { p.exchange.abortMessage }\n                        </ErrorContent>\n                </>\n                : '.'\n            }\n        </div>\n    </CollapsibleCard>\n));","import * as _ from 'lodash';\nimport * as dedent from \"dedent\";\nimport {\n    parse as parseDate,\n    differenceInSeconds,\n    addSeconds,\n    distanceInWordsStrict\n} from 'date-fns';\n\nimport { HttpExchange, ExchangeMessage } from '../../types';\nimport { lastHeader, asHeaderArray } from '../../util/headers';\nimport { joinAnd } from '../../util/text';\n\n// https://tools.ietf.org/html/draft-ietf-httpbis-semantics-04#section-7.2.3\nconst CACHEABLE_METHODS = ['GET', 'HEAD', 'POST'];\n\n// https://tools.ietf.org/html/draft-ietf-httpbis-semantics-01#section-9.1\nconst CACHEABLE_STATUSES = [\n    200,\n    203,\n    204,\n    206,\n    300,\n    301,\n    404,\n    405,\n    410,\n    414,\n    501\n];\n\n// The cacheable behaviour of these isn't explicitly defined, but the semantics clearly\n// indicate permanence, and Chrome at least caches them forever if no lifetime is set.\n// See https://chromium.googlesource.com/chromium/src/+/74.0.3729.30/net/http/http_response_headers.cc#1087\nconst PERMANENTLY_CACHEABLE_STATUSES = [\n    300,\n    301,\n    308,\n    410\n];\n\n// The set of CORS methods/headers which do never require preflight\n// requests (and so don't block cache matches)\nconst CORS_SIMPLE_METHODS = ['GET', 'HEAD', 'POST'];\nconst CORS_SIMPLE_HEADERS = [\n    'Cache-Control',\n    'Content-Language',\n    'Content-Type',\n    'Expires',\n    'Last-Modified',\n    'Pragma'\n];\n\nfunction formatHeader(headerName: string): string {\n    // Upper case the first letter of each word (including hyphenated parts)\n    return headerName.toLowerCase().replace(/(\\b\\w)/g, v => v.toUpperCase())\n}\n\nconst THE_DAWN_OF_TIME = parseDate(0);\nfunction formatDuration(seconds: number): string {\n    return distanceInWordsStrict(\n        THE_DAWN_OF_TIME,\n        parseDate(seconds * 1000)\n    )\n}\n\ninterface Explanation {\n    summary: string,\n    explanation: string,\n    type?: 'suggestion' | 'warning',\n};\n\nfunction parseCCDirectives(message: ExchangeMessage): {\n    'max-age'?: number;\n    's-maxage'?: number;\n    'stale-while-revalidate'?: number;\n    'stale-if-error'?: number;\n    [name: string]: true | number | undefined;\n} {\n    return asHeaderArray(message.headers['cache-control'])\n        .reduce<{ [name: string]: true | number }>((result, directive) => {\n            const [ name, value ] = directive.split('=');\n            result[name.trim()] = value !== undefined ? parseInt(value) : true;\n            return result;\n        }, {});\n}\n\nexport function explainCacheability(exchange: HttpExchange): (\n    Explanation & { cacheable: boolean }\n) | undefined {\n    const { request, response } = exchange;\n\n    if (typeof response !== 'object') return;\n\n    const isCacheableMethod = CACHEABLE_METHODS.includes(request.method);\n\n    if (!isCacheableMethod) {\n        if (request.method === 'OPTIONS' && request.headers['origin']) {\n            // This is a CORS preflight request - it's not really cacheable, but the CORS\n            // headers specifically (probably the only interesting bit) are, via their\n            // own separate funky mechanism.\n            const maxAgeHeader = lastHeader(response.headers['access-control-max-age']);\n            const maxAge = maxAgeHeader ? parseInt(maxAgeHeader, 10) : undefined;\n\n            if (maxAge !== undefined && maxAge >= 1) {\n                return {\n                    cacheable: true,\n                    summary: 'Cacheable',\n                    explanation: dedent`\n                        OPTIONS preflight requests are not normally cacheable, and don't observe\n                        standard Cache-Control mechanisms, but the CORS result itself will be\n                        cached if a Access-Control-Max-Age header is provided, as here.\n\n                        This only affects CORS behaviour for cross-origin requests, and should be\n                        ignored (so not cached at all) by all other clients and proxies.\n                    `\n                };\n            }\n\n            if (maxAge !== undefined && maxAge <= 0) {\n                return {\n                    cacheable: false,\n                    summary: 'Not cacheable',\n                    explanation: dedent`\n                        OPTIONS preflight requests don't observe standard Cache-Control\n                        mechanisms, but the CORS result itself can be cached if a\n                        Access-Control-Max-Age header is provided.\n\n                        In this case that header is set to ${maxAgeHeader}, explicitly\n                        requesting that this result should not be cached, and that clients\n                        should not reuse this CORS response in future.\n                    `\n                };\n            }\n\n            return {\n                cacheable: true,\n                summary: 'Very briefly cacheable',\n                explanation: dedent`\n                    OPTIONS preflight requests are not cacheable, unless an Access-Control-Max-Age\n                    header is provided. Many clients will very briefly cache the CORS response\n                    though, for example Chrome will cache this for 5 seconds.\n                `\n            };\n        } else {\n            return {\n                cacheable: false,\n                summary: 'Not cacheable',\n                explanation: `${request.method} requests are never cacheable.`\n            };\n        }\n    }\n\n    const responseCCDirectives = parseCCDirectives(response);\n\n    const hasRevalidationOptions = response.headers['etag'] || response.headers['last-modified'];\n    const revalidationSuggestion =\n        !hasRevalidationOptions &&\n        // Revalidation makes no sense without a body\n        response.body.encoded.byteLength &&\n        !responseCCDirectives['immutable'] ?\n        dedent`\n            :suggestion: This response doesn't however include any validation headers. That\n            means that once it expires, the content must be requested again from scratch. If\n            a Last-Modified or ETag header were included then these could be used to make\n            conditional HTTP requests and revalidate cached content without re-requesting\n            it, saving time and bandwidth.\n        ` : '';\n\n    if (!!responseCCDirectives['no-store']) {\n        return {\n            cacheable: false,\n            summary: 'Not cacheable',\n            explanation: dedent`\n                This response includes a \\`no-store\\` directive in its Cache-Control\n                header. This explicitly tells all caches that this response should\n                never be cached. It should never be persistently stored, should\n                be removed from any volatile/temporary storage as soon as possible,\n                and should be requested fresh from the network in future.\n            `\n        }\n    }\n\n    if (asHeaderArray(response.headers['pragma']).includes('no-store')) {\n        return {\n            cacheable: false,\n            summary: 'Not cacheable',\n            type: 'suggestion',\n            explanation: dedent`\n                This response includes a \\`no-store\\` directive in its Pragma\n                header. This explicitly tells all caches that this response should\n                never be cached. It should never be persistently stored, should\n                be removed from any volatile/temporary storage as soon as possible,\n                and should be requested fresh from the network in future.\n\n                :suggestion: This Pragma header is commonly supported, but officially\n                deprecated. It's typically better to use \\`Cache-Control: no-store\\` instead.\n            `\n        }\n    }\n\n    if (asHeaderArray(response.headers['vary']).includes('*')) {\n        return {\n            cacheable: false,\n            summary: 'Not cacheable',\n            explanation: dedent`\n                This response includes a \\`*\\` value in its Vary header. This tells caches\n                that the response content may vary unpredictably, possibly including factors\n                outside the request's content (e.g. the client's network address),\n                and so must never be cached.\n            `\n        };\n    }\n\n    if (request.method === 'POST') {\n        // POSTS aren't really cacheable like anything else - they have their own unique rules\n        const postExplanation = dedent`\n            POST responses are not typically cacheable, but can be used in some\n            specific circumstances to prepopulate GET & HEAD caches for the same URI.\n            This is allowed by the spec, but not supported by many clients.\n\n            A POST response may be cached and used by for future GET/HEAD requests only if:\n\n            * Explicit freshness information is included (e.g. a \\`max-age\\` Cache-Control\n                directive), and\n            * a Content-Location header is included, set to the same\n                URI as this request\n        `;\n\n        const contentLocationUrl = response.headers['content-location'] ?\n            new URL(lastHeader(response.headers['content-location']!), request.url) : undefined;\n\n        const hasFreshnessInfo =\n            !!responseCCDirectives['max-age'] ||\n            response.headers['expires'] !== undefined;\n        const contentLocationIsCurrentUri = contentLocationUrl && (\n            contentLocationUrl.toString().split('#')[0] === request.parsedUrl.toString().split('#')[0]\n        );\n\n        if (hasFreshnessInfo && contentLocationIsCurrentUri) {\n            return {\n                cacheable: true,\n                summary: 'May be cacheable for future GET/HEAD requests',\n                type: revalidationSuggestion ? 'suggestion' : undefined,\n                explanation: [\n                    postExplanation,\n                    'This response fulfills those conditions, so may be cacheable by some clients.',\n                    revalidationSuggestion\n                ].join('\\n\\n')\n            };\n        } else {\n            return {\n                cacheable: false,\n                summary: 'Not cacheable',\n                explanation: postExplanation + '\\n\\n' +\n                    'This response does not fulfill those conditions, so is not cacheable by anybody.'\n            };\n        }\n    }\n\n    if (responseCCDirectives['max-age'] !== undefined) {\n        let warning: string | undefined;\n\n        const responseDateHeader = response.headers['date'] ?\n            parseDate(lastHeader(response.headers['date'])!)\n            : undefined;\n\n        if (!responseDateHeader) {\n            warning = dedent`\n                :warning: However, this response does not include a Date header. That value\n                would be used in combination with the \\`max-age\\` value to calculate\n                the exact time to expire this content.\n\n                Clients may infer their own expiry start time, potentially using the time they\n                received this response, but it's strongly recommended to explicitly specify\n                one in the response instead, to ensure this content expires reliably and\n                predictably.\n            `;\n        } else if (response.headers['expires'] && Math.abs(differenceInSeconds(\n            parseDate(lastHeader(response.headers['expires']!)),\n            addSeconds(responseDateHeader, responseCCDirectives['max-age'])\n        )) > 60) {\n            warning = dedent`\n                :warning: This response also includes an Expires header, which appears to disagree\n                with the expiry time calculated from the \\`max-age\\` directive. The Cache-Control\n                headers take precedence, so this will only be used by clients that don't\n                support that, but this could cause unpredictable behaviour. It's typically\n                better to ensure these values agree on a single expiry time.\n            `;\n        }\n\n        return {\n            cacheable: true,\n            summary: 'Cacheable',\n            type:\n                warning ? 'warning' :\n                revalidationSuggestion ? 'suggestion' :\n                undefined,\n            explanation: dedent`\n                This response is cacheable because it specifies an explicit expiry time,\n                using a \\`max-age\\` directive in its Cache-Control header.\n                ${\n                    warning ? '\\n' + warning :\n                    revalidationSuggestion ? '\\n' + revalidationSuggestion :\n                    ''\n                }\n            `\n        };\n    }\n\n    if (lastHeader(response.headers['expires']) !== undefined) {\n        // Expires set, but not max-age (checked above).\n        return {\n            cacheable: true,\n            summary: 'Cacheable',\n            type: 'suggestion',\n            explanation: dedent`\n                This response is cacheable because it specifies an explicit expiry time,\n                using an Expires header.\n\n                :suggestion: The Expires header is commonly supported, but officially deprecated.\n                It's typically better to use \\`Cache-Control: max-age=<seconds>\\` instead,\n                or in addition.\n            `\n        };\n    }\n\n    const isDefaultCacheableStatus = CACHEABLE_STATUSES.includes(response.statusCode);\n\n    if (isDefaultCacheableStatus || responseCCDirectives['public']) {\n        // We're cacheable, but with no expiry details at all.\n\n        if (PERMANENTLY_CACHEABLE_STATUSES.includes(response.statusCode)) {\n            return {\n                cacheable: true,\n                summary: 'Cacheable',\n                explanation: dedent`\n                    ${response.statusCode} responses are cacheable by default. The lifetime of the\n                    cached response isn't strictly specified, but since this status code is\n                    intended to indicate a permanent change the overwhelming majority of clients\n                    will cache it forever.\n                `\n            };\n        }\n\n        // Temporarily cacheable, but for no specified time. Not a great idea.\n\n        const cacheableReason = isDefaultCacheableStatus ?\n            `${response.statusCode} responses are cacheable by default` :\n            `This response includes a \\`public\\` Cache-Control directive, explicitly marking it cacheable`;\n\n        if (!hasRevalidationOptions) {\n            // We're cacheable, but with no clear expiry *and* no way to revalidate.\n            return {\n                cacheable: false,\n                summary: 'Typically not cacheable',\n                type: 'warning',\n                explanation: dedent`\n                    ${cacheableReason}. However most caches will not store a response\n                    like this, which has no explicit expiry time and no way to revalidate\n                    the content in future.\n\n                    :warning: It's typically better to be explicit about if and how responses\n                    should be cached, rather than depending on the unpredictable behaviour this\n                    can cause.\n\n                    This request would be reliably cached if an explicit expiry was set (e.g.\n                    with a \\`max-age\\` Cache-Control directive). Alternatively this would be\n                    reliably excluded from caching if a \\`no-store\\` Cache-Control directive\n                    was present.\n                `\n            }\n        } else if (responseCCDirectives['no-cache']) {\n            // We're cacheable and revalidateable, with forced revalidation every time, so 0 expiry\n            return {\n                cacheable: true,\n                summary: 'Cacheable',\n                explanation: dedent`\n                    ${cacheableReason}.\n\n                    The response does not include any explicit expiry information,\n                    but does include a \\`no-cache\\` directive, meaning the cached content will\n                    be revalidated with the origin server on every request, making\n                    expiry irrelevant.\n                `\n            };\n        } else {\n            // We're cacheable and revalidateable, but there's no clear expiry\n\n            return {\n                cacheable: true,\n                summary: 'Probably cacheable',\n                type: 'warning',\n                explanation: dedent`\n                    ${cacheableReason}. However this response does not explicitly\n                    specify when it expires (e.g. with a \\`max-age\\` Cache-Control\n                    directive), so its expiry behaviour is not well defined. Caches\n                    may use a heuristic to decide when this response is no longer\n                    considered fresh, and some clients may refuse to cache the response\n                    entirely.\n\n                    :warning: It's typically better to be explicit about how responses should\n                    be cached and expired, rather than depending on this unpredictable behaviour.\n\n                    If an explicit expiry time was set (e.g. using a \\`max-age\\` Cache-Control\n                    directive), this would take precedence over any heuristics, and provide\n                    reliable cache expiry. Alternatively this content would be reliably\n                    excluded from caching if a \\`no-store\\` Cache-Control directive was present.\n                `\n            };\n        }\n    }\n\n    if (responseCCDirectives['s-maxage'] !== undefined) {\n        // We're not locally cacheable at all, but we are proxy cacheable???!!! Super funky\n        return {\n            cacheable: true,\n            summary: 'Not cacheable by private (HTTP client) caches',\n            explanation: dedent`\n                This response is cacheable because it specifies an explicit expiry time,\n                using an \\`s-maxage\\` Cache-Control directive. This only applies to shared\n                caches (e.g. proxies and CDNs), and this response would otherwise not be\n                cacheable, so it won't be cached by any HTTP user agents (e.g. browsers).\n            `\n        };\n    }\n\n    return {\n        cacheable: false,\n        summary: 'Not cacheable',\n        explanation: dedent`\n            ${response.statusCode} responses are not cacheable by default.\n            This could become cacheable if explicit caching headers were added,\n            such as a \\`max-age\\` Cache-Control directive.\n        `\n    };\n}\n\nconst ALL_CACHES = 'May be cached in both private and shared caches';\nconst PRIVATE_ONLY = 'May only be cached in private caches'\nconst SHARED_ONLY = 'May only be cached in shared caches';\n\n/**\n * Explains the details of which types of cache can be store this response,\n * and why. This assumes that explainCacheability has returned cacheability: true,\n * and doesn't fully repeat the checks included there.\n */\nexport function explainValidCacheTypes(exchange: HttpExchange): Explanation | undefined {\n    const { request, response } = exchange;\n    if (typeof response !== 'object') return;\n\n    if (request.method === 'OPTIONS' && request.headers['origin']) {\n        return {\n            summary: PRIVATE_ONLY,\n            explanation: dedent`\n                OPTIONS responses are not cached through the normal HTTP response caching mechanisms.\n                Only the CORS metadata for the resource is cached, and only by HTTP clients that\n                implement CORS checks, such as browsers, not by intermediate caches.\n            `\n        };\n    }\n\n    const responseCCDirectives = parseCCDirectives(response);\n\n    if (responseCCDirectives['private'] !== undefined) {\n        return {\n            summary: PRIVATE_ONLY,\n            explanation: dedent`\n                This response may only be cached by private caches, such as your browser cache,\n                because it includes an explicit \\`private\\` Cache-Control directive.\n            `\n        };\n    }\n\n    if (responseCCDirectives['public'] !== undefined) {\n        return {\n            summary: ALL_CACHES,\n            explanation: dedent`\n                This response may be cached by both private HTTP client caches and shared caches\n                such as CDNs and proxies, because it includes an explicit \\`public\\` Cache-Control\n                directive.\n            `\n        };\n    }\n\n    if (\n        request.headers['authorization'] !== undefined && !(\n            responseCCDirectives['s-maxage'] !== undefined ||\n            responseCCDirectives['must-revalidate'] !== undefined ||\n            responseCCDirectives['public'] !== undefined\n        )\n    ) {\n        return {\n            summary: PRIVATE_ONLY,\n            explanation: dedent`\n                This response may only be cached by private caches, such as your browser cache,\n                because it includes an Authorization header, and doesn't include the explicit\n                directives that would allow it to be stored by shared caches.\n\n                Shared caches, such as CDNs and proxies, would only be allowed to store this\n                response if it contained \\`s-maxage\\`, \\`must-revalidate\\` or \\`public\\`\n                Cache-Control directives.\n            `\n        };\n    }\n\n    if (responseCCDirectives['s-maxage'] !== undefined && !(\n            responseCCDirectives['max-age'] !== undefined ||\n            response.headers['expires'] !== undefined ||\n            responseCCDirectives['public'] !== undefined ||\n            CACHEABLE_STATUSES.includes(response.statusCode)\n        )\n    ) {\n        return {\n            summary: SHARED_ONLY,\n            explanation: dedent`\n                This response may only be cached by shared caches, such as proxies & CDNs,\n                not by private client caches, because it includes an \\`s-maxage\\` Cache-Control\n                directive but is otherwise not cacheable by default, and does not include\n                any other explicit caching directives.\n            `\n        };\n    }\n\n    return {\n        summary: ALL_CACHES,\n        explanation: dedent`\n            This response may be cached by both private client caches & shared\n            CDN or proxy caches, because it is cacheable and does not include\n            either a \\`private\\` Cache-Control directive or an Authorization header.\n        `\n    };\n}\n\n/**\n * Explains how this response will be matched against future requests and why.\n * This assumes that explainCacheability has returned cacheability: true,\n * so doesn't fully repeat the checks included there.\n */\nexport function explainCacheMatching(exchange: HttpExchange): Explanation | undefined {\n    const { request, response } = exchange;\n    if (typeof response !== 'object') return;\n\n    if (request.method === 'OPTIONS' && request.headers['origin']) {\n        const allowedMethods = _.union(\n            CORS_SIMPLE_METHODS,\n            asHeaderArray(response.headers['access-control-allow-methods'])\n                .map(m => m.toUpperCase()),\n        );\n        const allowedHeaders = _.union(\n            CORS_SIMPLE_HEADERS,\n            asHeaderArray(response.headers['access-control-allow-headers'])\n                .map(formatHeader)\n        );\n        const allowsCredentials = response.headers['Access-Control-Allow-Credentials'] === 'true';\n\n        return {\n            summary: 'Will match corresponding future CORS requests for this URL',\n            explanation: dedent`\n                The CORS configuration returned here may be used to avoid a preflight\n                request for future CORS requests, when:\n\n                * The CORS request would be sent to the same URL\n                * The origin is \\`${request.headers['origin']}\\`\n                ${!allowsCredentials ? '* No credentials are being sent\\n' : ''\n                }* The request method would be ${joinAnd(allowedMethods, ', ', ' or ')}\n                * There are no extra request headers other than ${joinAnd(allowedHeaders)}\n            `\n        };\n    }\n\n    const varyHeaders = asHeaderArray(response.headers['vary']).map(formatHeader);\n\n    const hasVaryHeaders = varyHeaders.length > 0;\n\n    // Don't need to handle Vary: *, as that would've excluded cacheability entirely.\n\n    const varySummary = hasVaryHeaders ?\n        ` that have the same ${\n            joinAnd(varyHeaders)\n        } header${varyHeaders.length > 1 ? 's' : ''}`\n        : '';\n\n    const varyExplanation = hasVaryHeaders ? dedent`\n        , as long as those requests have ${joinAnd(varyHeaders.map(headerName => {\n            const realHeaderValue = request.headers[headerName.toLowerCase()];\n\n            return realHeaderValue === undefined ?\n                `no ${headerName} header` :\n                `a ${headerName} header set to \\`${realHeaderValue}\\``\n        }))}.\n\n        ${varyHeaders.length > 1 ? 'These headers are' : 'This header is'}\n        required because ${varyHeaders.length > 1 ? \"they're\" : \"it's\"} listed in\n        the Vary header of the response.\n    ` : dedent`\n        , regardless of header values or other factors.\n\n        If this response is only valid for certain header configurations (e.g.\n        Accept-Encoding or Accept-Language headers), it should include a Vary header.\n    `;\n\n    if (request.method === 'POST') {\n        return {\n            summary: `Will match future GET & HEAD requests to this URL${varySummary}`,\n            explanation: dedent`\n                The response content & headers returned here may be used for future safe requests\n                for the resource updated by this POST${varyExplanation}\n            `\n        };\n    }\n\n    return {\n        summary: `Will match future GET & HEAD requests to this URL${varySummary}`,\n        explanation: dedent`\n            The response content & headers returned here may be used for future safe requests\n            for the same resource${varyExplanation}\n        `\n    };\n}\n\n/**\n * Explains when response will be matched against future requests, why,\n * and what will happen after that time passes.\n * This assumes that explainCacheability has returned cacheability: true,\n * so doesn't fully repeat the checks included there.\n */\nexport function explainCacheLifetime(exchange: HttpExchange): Explanation | undefined {\n    const { request, response } = exchange;\n    if (typeof response !== 'object') return;\n\n    const responseCCDirectives = parseCCDirectives(response);\n\n    if (request.method === 'OPTIONS') {\n        const maxAgeHeader = lastHeader(response.headers['access-control-max-age']);\n\n        if (maxAgeHeader) {\n            const maxAge = parseInt(maxAgeHeader!, 10);\n\n            return {\n                summary: `Expires after ${formatDuration(maxAge)}`,\n                explanation: dedent`\n                    This CORS response includes an Access-Control-Max-Age header explicitly\n                    set to ${maxAge} seconds, which defines the valid lifetime for the\n                    cached response. Once this expires it will immediately cease to be used.\n                `\n            };\n        }\n\n        // Don't need to deal with negative max age, as we exclude that as non-cacheable\n        // in explainCacheability\n\n        return {\n            summary: `Expires unpredictably, around 5 seconds`,\n            explanation: dedent`\n                This CORS response does not include an Access-Control-Max-Age header, so\n                does not explicitly specify when it should expire. That means the\n                exact expiry is left up to the client implementation. This may be a\n                small number of seconds, or it may be considered expired immediately.\n            `\n        };\n    }\n\n    if (responseCCDirectives['no-cache']) {\n        return {\n            summary: \"Must be revalidated every time it's used\",\n            explanation: dedent`\n                This response includes an explicit \\`no-cache\\` directive. This means that\n                before the cached content can be used, the matching requests must always be\n                forwarded to the origin server, and the response content must be revalidated.\n\n                This requires a request to the origin server for every client request, but\n                does still offer performance benefits compared to not caching at all,\n                because conditional requests can be used to avoid redownloading the\n                full response from scratch if it hasn't changed.\n            `\n        };\n    }\n\n    const dateHeader = lastHeader(response.headers['date']);\n    const expiresHeader = lastHeader(response.headers['expires']);\n    const maxAge = responseCCDirectives['max-age'];\n    const sharedMaxAge = responseCCDirectives['s-maxage'] !== undefined ?\n        responseCCDirectives['s-maxage'] : maxAge;\n\n    const hasExplicitLifetime = maxAge !== undefined || expiresHeader !== undefined;\n    const lifetime =\n        maxAge !== undefined ? maxAge :\n        expiresHeader !== undefined ? differenceInSeconds(\n            expiresHeader,\n            dateHeader\n                ? parseDate(dateHeader)\n                : parseDate(exchange.timingEvents.startTime ?? Date.now())\n        )\n        : undefined;\n    const hasNegativeLifetime = lifetime !== undefined && lifetime <= 0;\n\n    if (\n        !hasExplicitLifetime &&\n        PERMANENTLY_CACHEABLE_STATUSES.includes(response.statusCode)\n    ) {\n        return {\n            summary: 'Never expires' + (sharedMaxAge !== maxAge ?\n                ` from private caches, expires from shared caches after ${\n                    formatDuration(sharedMaxAge!)\n                }` : ''\n            ),\n            explanation: dedent`\n                This ${response.statusCode} response is intended to describe a permanent state,\n                and has no explicitly defined expiry time, so by default most clients will\n                cache it forever.\n\n                ${sharedMaxAge !== maxAge ? dedent`\n                    The response does include a \\`s-maxage\\` directive however, set to ${\n                        sharedMaxAge\n                    } seconds, which overrides this for shared caches such as CDNs and\n                    proxies. In that specific case, the response will be considered stale\n                    after ${formatDuration(sharedMaxAge!)}. As there is no \\`proxy-revalidate\\`\n                    directive, it may still be used whilst stale if necessary or explicitly\n                    allowed by a client.\n\n                    If the response included a specific expiry time for private caches, e.g.\n                    with a \\`max-age\\` Cache-Control directive, that typically would limit the\n                    lifetime of this response in those caches too. In general though in that\n                    case it would be better to use a more accurate status code.\n                ` : dedent`\n                    If this response did include a specific expiry time, e.g. with a max-age\n                    Cache-Control directive, that would typically override this. In general\n                    though in that case it would be better to use a more accurate status code.\n                `}\n            `\n        };\n    }\n\n    const explainSharedCacheLifetime = sharedMaxAge !== maxAge ? dedent`\n        .\n\n        This response also includes a \\`s-maxage\\` directive, set to ${\n            formatDuration(sharedMaxAge!)\n        } seconds which overrides this expiry for shared caches such as CDNs or proxies.\n        This means in that case, the response will become stale in ${\n            formatDuration(sharedMaxAge!)\n        }\n    ` : '';\n\n    const explainLifetime =\n        !hasExplicitLifetime ? dedent`\n            ${sharedMaxAge === maxAge ? dedent `\n                This response does not explicitly declare its expiry time. Caches\n            `: dedent `\n                This response only declares an explicit expiry time for shared caches, such\n                as proxies or CDNs, not for private caches. Content in shared caches will\n                expire after ${formatDuration(sharedMaxAge!)}, as declared by the \\`s-maxage\\`\n                Cache-Control directive, whilst content in private caches may expire\n                unpredictably.\n\n                Private caches\n            `} may\n            use a heuristic to decide when this response is considered stale, typically\n            some percentage of the time since the content was last modified, often using\n            the Last-Modified header value${\n                response.headers['last-modified'] ?\n                    ` (${response.headers['last-modified']})`\n                    : ', although that is not explicitly defined in this response either'\n            }\n        ` :\n        hasNegativeLifetime ? dedent`\n            This response expires immediately because it has ${\n                maxAge! <= 0 ? dedent`\n                    a \\`max-age\\` directive set to ${maxAge} seconds\n                ` :\n                dateHeader ? dedent `\n                    an Expires header set to ${expiresHeader}, which is\n                    not after its Date header value (${dateHeader})\n                `\n                : dedent`\n                    an Expires header set to ${expiresHeader}, which is\n                    before the response was received\n                `\n            }${explainSharedCacheLifetime}\n        ` :\n        maxAge !== undefined ? dedent`\n            This response expires after ${maxAge} seconds (${formatDuration(maxAge)}),\n            as specified by its \\`max-age\\` directive${explainSharedCacheLifetime}\n        `\n        : dedent`\n            This response expires at ${expiresHeader} (after ${formatDuration(lifetime!)}),\n            as specified by its Expires header${explainSharedCacheLifetime}\n        `;\n\n    if (hasNegativeLifetime && responseCCDirectives['must-revalidate']) {\n        return {\n            summary: \"Must be revalidated every time it's used\" + (sharedMaxAge !== maxAge ?\n                ` (or after ${formatDuration(sharedMaxAge!)} for shared caches)`\n                : ''\n            ),\n            explanation: dedent`\n                ${explainLifetime}.\n\n                In addition, it includes a \\`must-revalidate\\` directive.\n\n                Together, these mean that before the cached content can be used${\n                    sharedMaxAge !== maxAge && sharedMaxAge! > 0 ?\n                        ' by private caches' : ''\n                } the matching requests must always be forwarded to the origin server,\n                and the response content must be revalidated.\n\n                This requires a request to the origin server for every client request, but\n                does still offer performance benefits compared to not caching at all,\n                because conditional requests can be used to avoid redownloading the\n                full response from scratch if it hasn't changed.\n            `\n        };\n    }\n\n    const staleBonusBehaviourSummary = (\n            responseCCDirectives['stale-while-revalidate'] !== undefined &&\n            responseCCDirectives['stale-if-error'] !== undefined\n        ) ?\n            `can be served stale temporarily whilst revalidating or if receiving errors` :\n        responseCCDirectives['stale-while-revalidate'] !== undefined ?\n            `can be served stale whilst revalidating for ${\n                formatDuration(responseCCDirectives['stale-while-revalidate'])\n            }` :\n        responseCCDirectives['stale-if-error'] !== undefined ?\n            `can be served stale if errors are received for ${\n                formatDuration(responseCCDirectives['stale-if-error'])\n            }` :\n        '';\n\n    const revalidationSummary =\n        responseCCDirectives['must-revalidate'] ?\n            `, then must always be revalidated` :\n        responseCCDirectives['proxy-revalidate'] && staleBonusBehaviourSummary ?\n            `, then ${staleBonusBehaviourSummary} (but must be revalidated by shared caches)` :\n        responseCCDirectives['proxy-revalidate'] ?\n            `, then must always be revalidated by shared caches, but may be used privately` :\n        staleBonusBehaviourSummary ?\n            `, then ${staleBonusBehaviourSummary}`\n        : '';\n\n    const staleBonusBehaviour = (\n            responseCCDirectives['stale-while-revalidate'] !== undefined &&\n            responseCCDirectives['stale-if-error'] !== undefined\n        ) ? dedent`\n            The response includes both \\`stale-while-revalidate\\` and \\`stale-if-error\\`\n            directives, set to ${\n                responseCCDirectives['stale-while-revalidate']\n            } seconds and ${responseCCDirectives['stale-if-error']} seconds respectively.\n\n            \\`stale-while-revalidate\\` means that after the response has expired, new\n            requests should trigger revalidation, but the stale content can still be served\n            in the meantime, for ${\n                formatDuration(responseCCDirectives['stale-while-revalidate']!)\n            } extra.\n\n            \\`stale-if-error\\` means that after the response has expired, new\n            requests should trigger revalidation, but the stale content can still be served\n            in the meantime if any errors are encountered, for ${\n                formatDuration(responseCCDirectives['stale-if-error']!)\n            } after the response expires.\n        ` :\n        responseCCDirectives['stale-while-revalidate'] !== undefined ? dedent`\n            The response includes a \\`stale-while-revalidate\\` directive set to ${\n                responseCCDirectives['stale-while-revalidate']\n            } seconds. This means that after the response has expired new requests\n            should trigger revalidation, but the stale content can still be served in\n            the meantime for ${\n                formatDuration(responseCCDirectives['stale-while-revalidate']!)\n            } extra.\n        ` :\n        responseCCDirectives['stale-if-error'] !== undefined ? dedent`\n            The response includes a \\`stale-if-error\\` directive set to ${\n                responseCCDirectives['stale-if-error']\n            } seconds. This means that after the response has expired, new\n            requests should trigger revalidation, but the stale content can still be\n            served in the meantime if any errors are encountered, for ${\n                formatDuration(responseCCDirectives['stale-if-error']!)\n            } after the response expires.\n        ` : '';\n\n    const explainRevalidation =\n        responseCCDirectives['must-revalidate'] ? dedent`\n            This response includes a \\`must-revalidate\\` directive, which means caches must\n            ensure expired content is _always_ forwarded to & revalidated by the origin server,\n            and expired content must never be used, even if the server is unavailable, if\n            requested explicitly, or if serving stale content has been enabled elsewhere.\n        ` :\n        responseCCDirectives['proxy-revalidate'] ? dedent`\n            This response includes a \\`proxy-revalidate\\` directive, which means shared\n            caches (e.g. CDNs or proxies) must ensure expired content is always forwarded\n            to & revalidated by the origin server, and expired content must never be used,\n            even if the server is unavailable, if requested explicitly, or if serving\n            stale content has been enabled elsewhere.\n\n            ${staleBonusBehaviour ? staleBonusBehaviour : dedent`\n                It does not include a \\`must-revalidate\\` directive, so private client caches\n                are still allowed to use stale responses if necessary.\n            `}\n        ` : dedent`\n            ${staleBonusBehaviour}\n\n            As the response does not include a \\`must-revalidate\\` directive,\n            expired responses may be used if explicitly requested or necessary, for\n            example if the origin server is not responding.\n        `;\n\n    if (hasNegativeLifetime) {\n        return {\n            summary: `Expires immediately${\n                sharedMaxAge !== maxAge ?\n                    ` (or after ${formatDuration(sharedMaxAge!)} for shared caches)`\n                    : ''\n            }${revalidationSummary}`,\n            explanation: dedent`\n                ${explainLifetime}.\n\n                ${explainRevalidation}\n            `\n        };\n    }\n\n    const shouldSuggestImmutable =\n        !responseCCDirectives['immutable'] &&\n        (lifetime && lifetime >= 31536000); // 1 year\n\n    return {\n        summary:\n            lifetime !== undefined ?\n                `Expires after ${formatDuration(lifetime)}${\n                    sharedMaxAge !== maxAge ?\n                        ` (${formatDuration(sharedMaxAge!)} for shared caches)`\n                        : ''\n                }${revalidationSummary}`\n            :\n                `Expires unpredictably${\n                    sharedMaxAge !== maxAge ?\n                        ` for private caches, or after ${\n                            formatDuration(sharedMaxAge!)\n                        } for shared caches`\n                        : ''\n                }${revalidationSummary}`,\n        type: shouldSuggestImmutable ? 'suggestion' : undefined,\n        explanation: dedent`\n            ${explainLifetime}.\n\n            ${explainRevalidation}\n\n            ${shouldSuggestImmutable ? dedent`\n                :suggestion: This expiry time is more than a year away, which suggests that the\n                content never changes. This could be more effective with the \\`immutable\\`\n                Cache-Control directive, which completely avoids revalidation\n                requests for this content in extra cases, such as explicit page refreshes,\n                saving validation time.\n            `\n            : ''}\n        `\n    };\n}","import * as React from 'react';\nimport { observer } from 'mobx-react';\nimport { TimingEvents } from '../../types';\n\nimport { Pill } from './pill';\n\nfunction sigFig(num: number, figs: number): number {\n    return parseFloat(num.toFixed(figs));\n}\n\ntype DurationPillProps = { className?: string } & (\n    | { durationMs: number }\n    | { timingEvents: Partial<TimingEvents> }\n)\n\nexport const DurationPill = observer((p: DurationPillProps) => {\n    let duration: number | undefined;\n\n    if ('durationMs' in p) {\n        duration = p.durationMs;\n    } else {\n        const timingEvents = p.timingEvents;\n        const doneTimestamp = timingEvents.responseSentTimestamp ?? timingEvents.abortedTimestamp;\n\n        duration = doneTimestamp !== undefined && timingEvents.startTimestamp !== undefined\n            ? doneTimestamp - timingEvents.startTimestamp\n            : undefined;\n    }\n\n    if (duration === undefined) return null;\n\n    return <Pill className={p.className}>{\n        duration < 100 ? sigFig(duration, 2) + 'ms' : // 22.34ms\n        duration < 1000 ? sigFig(duration, 1) + 'ms' : // 999.5ms\n        duration < 10000 ? sigFig(duration / 1000, 3) + ' seconds' : // 3.045 seconds\n        sigFig(duration / 1000, 1) + ' seconds' // 11.2 seconds\n    }</Pill>;\n});","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { observer, inject } from 'mobx-react';\nimport { get } from 'typesafe-get';\n\nimport { styled } from '../../../styles';\nimport {\n    HttpExchange,\n    TimingEvents,\n    ExchangeMessage\n} from '../../../types';\nimport { asHeaderArray } from '../../../util/headers';\nimport { joinAnd } from '../../../util/text';\nimport { Icon, WarningIcon, SuggestionIcon } from '../../../icons';\n\nimport { AccountStore } from '../../../model/account/account-store';\nimport { getReadableSize, testEncodings } from '../../../model/events/bodies';\nimport {\n    explainCacheability,\n    explainCacheLifetime,\n    explainCacheMatching,\n    explainValidCacheTypes\n} from '../../../model/http/caching';\n\nimport {\n    CollapsibleCardHeading,\n    CollapsibleCard,\n    CollapsibleCardProps\n} from '../../common/card';\nimport { Pill } from '../../common/pill';\nimport { DurationPill } from '../../common/duration-pill';\nimport {\n    CollapsibleSection,\n    CollapsibleSectionSummary,\n    CollapsibleSectionBody\n} from '../../common/collapsible-section';\nimport { ContentLabelBlock, Markdown } from '../../common/text-content';\nimport { ProHeaderPill, CardSalesPitch } from '../../account/pro-placeholders';\n\ninterface HttpPerformanceCardProps extends CollapsibleCardProps {\n    exchange: HttpExchange;\n    accountStore?: AccountStore;\n}\n\nexport const HttpPerformanceCard = inject('accountStore')(observer((props: HttpPerformanceCardProps) => {\n    const { exchange, accountStore } = props;\n    const { isPaidUser } = accountStore!;\n\n    return <CollapsibleCard {...props}>\n        <header>\n            { isPaidUser\n                ? <DurationPill timingEvents={exchange.timingEvents} />\n                : <ProHeaderPill />\n            }\n            <CollapsibleCardHeading onCollapseToggled={props.onCollapseToggled}>\n                Performance\n            </CollapsibleCardHeading>\n        </header>\n\n        { isPaidUser ?\n            <div>\n                <CompressionPerformance exchange={exchange} />\n                <CachingPerformance exchange={exchange} />\n            </div>\n        :\n            <CardSalesPitch source='performance'>\n                <p>\n                    See timing info, dive into the real and potential compression of every\n                    exchange, and understand how &amp; where this response could\n                    be cached, for a full performance overview.\n                </p>\n            </CardSalesPitch>\n        }\n    </CollapsibleCard>;\n}));\n\nfunction getEncodingName(key: string): string {\n    if (key === 'br') return 'brotli';\n    if (key === 'zstd') return 'zstandard';\n    if (key === 'gzip' || key === 'x-gzip') {\n        return 'gzip';\n    }\n    if (key === 'deflate' || key === 'x-deflate') {\n        return 'zlib';\n    }\n\n    return _.upperFirst(key);\n}\n\nfunction getEncodings(message: ExchangeMessage | 'aborted' | undefined) {\n    if (!message || message === 'aborted') return [];\n\n    return asHeaderArray(message.headers['content-encoding'])\n        .filter((encoding) => !!encoding && encoding !== 'identity')\n        .map(getEncodingName);\n}\n\nconst CompressionDescription = observer((p: {\n    encodings: string[],\n    encodedBodyLength: number,\n    decodedBodyLength: number | undefined\n}) => {\n    const { encodings, encodedBodyLength, decodedBodyLength } = p;\n\n    const compressionRatio = decodedBodyLength ? Math.round(100 * (\n        1 - (encodedBodyLength / decodedBodyLength)\n    )) : undefined;\n\n    return <>\n        { encodings.length ? <>\n            compressed with <strong>{joinAnd(encodings, ', ', ' and then ')}</strong>,\n            making it {\n                compressionRatio !== undefined && decodedBodyLength ? <>\n                    <strong>\n                        { compressionRatio >= 0 ?\n                            `${compressionRatio}% smaller`\n                        :\n                            `${-compressionRatio}% bigger`\n                        }\n                    </strong> ({\n                        getReadableSize(decodedBodyLength)\n                    } to {\n                        getReadableSize(encodedBodyLength)\n                    })\n                </> : <Icon icon={['fas', 'spinner']} spin />\n            }\n        </> :\n            <strong>not compressed</strong>\n        }\n    </>;\n});\n\nconst CompressionResultsContainer = styled.div`\n    display: flex;\n    flex-wrap: wrap;\n    gap: 10px;\n    margin-right: 10px;\n`;\n\nconst CompressionResultsPill = styled(Pill)`\n    flex-shrink: 0;\n`;\n\nconst CompressionOptions = observer((p: {\n    encodings: string[],\n    encodedBodyLength: number,\n    decodedBodyLength: number | undefined,\n    encodingTestResults: { [encoding: string]: number } | undefined\n}) => {\n    const { encodings, encodedBodyLength, decodedBodyLength, encodingTestResults } = p;\n\n    if (!_.isEmpty(encodingTestResults) && decodedBodyLength) {\n        const realCompressionRatio = Math.round(100 * (\n            1 - (encodedBodyLength / decodedBodyLength)\n        ));\n\n        return <CompressionResultsContainer>{\n            _(encodingTestResults)\n            .omitBy((_size, encoding) =>\n                encodings.length === 1 && encoding === encodings[0]\n            ).map((size: number, encoding) => {\n                const testedCompressionRatio = Math.round(100 * (\n                    1 - (size / decodedBodyLength)\n                ));\n\n                return <CompressionResultsPill key={encoding} title={\n                        `${\n                            getReadableSize(decodedBodyLength)\n                        } would compress to ${\n                            getReadableSize(size)\n                        } using ${encoding}`\n                    }\n                    color={\n                        testedCompressionRatio > realCompressionRatio! &&\n                        testedCompressionRatio > 0 ?\n                            '#4caf7d' : '#888'\n                    }\n                >\n                    { _.upperFirst(encoding) }: { testedCompressionRatio }%\n                </CompressionResultsPill>\n            }).valueOf()\n        }</CompressionResultsContainer>\n    } else {\n        return <Icon icon={['fas', 'spinner']} spin />;\n    }\n});\n\nconst CompressionOptionsContainer = styled.div`\n    display: flex;\n    align-items: center;\n\n    margin-bottom: 10px;\n    &:last-child {\n        margin-bottom: 0;\n    }\n`;\n\nconst PerformanceExplanation = styled.p`\n    margin-bottom: 10px;\n    line-height: 1.3;\n\n    &:last-child {\n        margin-bottom: 0;\n    }\n`;\n\nconst CompressionOptionsTips = styled(PerformanceExplanation)`\n    font-style: italic;\n`;\n\nconst CompressionPerformance = observer((p: { exchange: HttpExchange }) => {\n    const messageTypes: Array<'request' | 'response'> = ['request', 'response'];\n    const clientAcceptedEncodings = asHeaderArray(p.exchange.request.headers['accept-encoding'])\n        .map(getEncodingName);\n\n    return <>{ messageTypes.map((messageType) => {\n        const message = p.exchange[messageType];\n        const encodings = getEncodings(message);\n\n        if (typeof message !== 'object' || !message.body.encoded.byteLength) return null;\n\n        const encodedBody = message.body.encoded;\n        const decodedBody = message.body.decoded;\n        const decodedBodySize = decodedBody ? decodedBody.byteLength : 0;\n        const encodedBodySize = encodedBody.byteLength;\n\n        const encodingTestResults = _.mapKeys(testEncodings(message),\n            (_size, encoding) => getEncodingName(encoding)\n        );\n\n        let bestOtherEncoding = _.minBy(\n            Object.keys(encodingTestResults),\n            (encoding) => encodingTestResults[encoding]\n        );\n\n        const betterEncodingAvailable =\n            decodedBodySize &&\n            bestOtherEncoding &&\n            !(encodings.length === 1 && bestOtherEncoding === encodings[0]) &&\n            encodingTestResults[bestOtherEncoding] < Math.min(encodedBodySize, decodedBodySize);\n\n        return <React.Fragment key={messageType}>\n            <ContentLabelBlock>{ _.upperFirst(messageType) } Compression</ContentLabelBlock>\n            <PerformanceExplanation>\n                The {messageType} body was <CompressionDescription\n                    encodings={encodings}\n                    encodedBodyLength={encodedBodySize}\n                    decodedBodyLength={get(decodedBody, 'byteLength')}\n                />.\n            </PerformanceExplanation>\n            <CompressionOptionsContainer>\n                <CompressionOptions\n                    encodings={encodings}\n                    encodedBodyLength={encodedBodySize}\n                    decodedBodyLength={get(decodedBody, 'byteLength')}\n                    encodingTestResults={encodingTestResults}\n                />\n                <CompressionOptionsTips>{\n                    !!betterEncodingAvailable && <>\n                        <SuggestionIcon />\n                        This would be {\n                            Math.round(100 * (\n                                1 - (encodingTestResults[bestOtherEncoding!] / encodedBodySize)\n                            ))\n                        }% smaller { decodedBodySize !== encodedBodySize &&\n                            `(${\n                                Math.round(100 * (\n                                    1 - (encodingTestResults[bestOtherEncoding!] / decodedBodySize)\n                                ))\n                            }% total compression)`\n                        } with { bestOtherEncoding }{\n                            messageType === 'response' &&\n                            clientAcceptedEncodings &&\n                            !_.includes(clientAcceptedEncodings, bestOtherEncoding) &&\n                                ` (not supported by this client)`\n                        }.\n                    </>\n                }{\n                    !!decodedBodySize &&\n                    !betterEncodingAvailable &&\n                    decodedBodySize < encodedBodySize && <>\n                        <WarningIcon />\n                        This { messageType } would be smaller without compression.\n                    </>\n                }</CompressionOptionsTips>\n            </CompressionOptionsContainer>\n        </React.Fragment>\n    }) }</>;\n});\n\nconst CachingPerformance = observer((p: { exchange: HttpExchange }) => {\n    if (typeof p.exchange.response !== 'object') return null;\n\n    const cacheability = explainCacheability(p.exchange);\n\n    if (!cacheability) return null;\n\n    const cacheDetails = cacheability.cacheable ? [\n        cacheability,\n        explainCacheMatching(p.exchange)!,\n        explainValidCacheTypes(p.exchange)!,\n        explainCacheLifetime(p.exchange)!\n    ] : [\n        cacheability\n    ];\n\n    return <>\n        <ContentLabelBlock>\n            Caching\n        </ContentLabelBlock>\n        { cacheDetails.map((details, i) =>\n            <CollapsibleSection prefixTrigger={true} key={i}>\n                <CollapsibleSectionSummary>\n                    { details.summary }{' '}\n                    { details.type === 'warning' && <WarningIcon /> }\n                    { details.type === 'suggestion' && <SuggestionIcon /> }\n                </CollapsibleSectionSummary>\n                <CollapsibleSectionBody>\n                    <Markdown content={ details.explanation } />\n                </CollapsibleSectionBody>\n            </CollapsibleSection>\n        ) }\n    </>;\n});","import React from \"react\";\nimport { action, computed } from \"mobx\";\nimport { inject, observer } from \"mobx-react\";\nimport dedent from 'dedent';\n\nimport { HttpExchange } from '../../../types';\nimport { styled } from '../../../styles';\nimport { Icon } from '../../../icons';\nimport { logError } from '../../../errors';\n\nimport { AccountStore } from '../../../model/account/account-store';\nimport { UiStore } from '../../../model/ui/ui-store';\nimport {\n    exportHar,\n    generateCodeSnippet,\n    getCodeSnippetFormatKey,\n    getCodeSnippetFormatName,\n    getCodeSnippetOptionFromKey,\n    DEFAULT_SNIPPET_FORMAT_KEY,\n    snippetExportOptions,\n    SnippetOption\n} from '../../../model/ui/export';\n\nimport { ProHeaderPill, CardSalesPitch } from '../../account/pro-placeholders';\nimport {\n    CollapsibleCard,\n    CollapsibleCardProps,\n    CollapsibleCardHeading\n} from '../../common/card';\nimport { PillSelector, PillButton } from '../../common/pill';\nimport { CopyButtonPill } from '../../common/copy-button';\nimport { DocsLink } from '../../common/docs-link';\nimport { SelfSizedEditor } from '../../editor/base-editor';\n\ninterface ExportCardProps extends CollapsibleCardProps  {\n    exchange: HttpExchange;\n    accountStore?: AccountStore;\n    uiStore?: UiStore;\n}\n\nconst SnippetDescriptionContainer = styled.div`\n    p {\n        margin-bottom: 10px;\n    }\n`;\n\nconst SnippetDetailButtons = styled.div`\n    display: flex;\n    align-items: center;\n\n    gap: 10px;\n    margin-bottom: 10px;\n`;\n\nconst SnippetEditorContainer = styled.div`\n    margin: 0 -20px -20px -20px;\n    border-top: solid 1px ${p => p.theme.containerBorder};\n    background-color: ${p => p.theme.highlightBackground};\n    color: ${p => p.theme.highlightColor};\n`;\n\nconst snippetEditorOptions = {\n    readOnly: true,\n    hover: { enabled: false }\n};\n\nconst ExportSnippetEditor = observer((p: {\n    exchange: HttpExchange\n    exportOption: SnippetOption\n}) => {\n    const { target, client, link, description } = p.exportOption;\n\n    let snippet: string;\n    try {\n        snippet = generateCodeSnippet(p.exchange, p.exportOption);\n    } catch (e) {\n        console.log(`Failed to export request for ${target}--${client}`);\n        logError(e);\n        snippet = dedent`\n            Could not generate a snippet for this request\n\n            Is this unexpected? Please file a bug at github.com/httptoolkit/httptoolkit.\n        `;\n    }\n\n    return <>\n        <SnippetDescriptionContainer>\n            <p>\n                <strong>{\n                    getCodeSnippetFormatName(p.exportOption)\n                }</strong>: { description }\n            </p>\n            <SnippetDetailButtons>\n                <DocsLink href={link}>\n                    Find out more\n                </DocsLink>\n                <CopyButtonPill content={snippet}>\n                    {' '}Copy snippet\n                </CopyButtonPill>\n            </SnippetDetailButtons>\n        </SnippetDescriptionContainer>\n        <SnippetEditorContainer>\n            <SelfSizedEditor\n                contentId={null}\n                value={snippet}\n                language={\n                    ({\n                        'javascript': 'javascript',\n                        'node': 'javascript',\n                        'shell': 'shell',\n                    } as Record<string, string>)[target] || 'text'\n                }\n                options={snippetEditorOptions}\n            />\n        </SnippetEditorContainer>\n    </>;\n});\n\nconst ExportHarPill = styled(observer((p: {\n    className?: string,\n    exchange: HttpExchange\n}) =>\n    <PillButton\n        className={p.className}\n        onClick={() => exportHar(p.exchange)}\n        disabled={!p.exchange.response || p.exchange.response === 'aborted'}\n    >\n        <Icon icon={['fas', 'download']} /> Save as HAR\n    </PillButton>\n))`\n    margin-right: auto;\n`;\n\n@inject('accountStore')\n@inject('uiStore')\n@observer\nexport class HttpExportCard extends React.Component<ExportCardProps> {\n\n    render() {\n        const { exchange, accountStore } = this.props;\n        const { isPaidUser } = accountStore!;\n\n        return <CollapsibleCard {...this.props}>\n            <header>\n                { isPaidUser\n                    ? <ExportHarPill exchange={exchange} />\n                    : <ProHeaderPill />\n                }\n\n                <PillSelector<SnippetOption>\n                    onChange={this.setSnippetOption}\n                    value={this.snippetOption}\n                    optGroups={snippetExportOptions}\n                    keyFormatter={getCodeSnippetFormatKey}\n                    nameFormatter={getCodeSnippetFormatName}\n                />\n\n                <CollapsibleCardHeading onCollapseToggled={this.props.onCollapseToggled}>\n                    Export\n                </CollapsibleCardHeading>\n            </header>\n\n            { isPaidUser ?\n                <div>\n                    <ExportSnippetEditor\n                        exchange={exchange}\n                        exportOption={this.snippetOption}\n                    />\n                </div>\n            :\n                <CardSalesPitch source='export'>\n                    <p>\n                        Instantly export requests as code, for languages and tools including cURL, wget, JS\n                        (XHR, Node HTTP, Request, ...), Python (native or Requests), Ruby, Java (OkHttp\n                        or Unirest), Go, PHP, Swift, HTTPie, and a whole lot more.\n                    </p>\n                    <p>\n                        Want to save the exchange itself? Export one or all requests as HAR (the{' '}\n                        <a href=\"https://en.wikipedia.org/wiki/.har\">HTTP Archive Format</a>), to import\n                        and examine elsewhere, share with your team, or store for future reference.\n                    </p>\n                </CardSalesPitch>\n            }\n        </CollapsibleCard>;\n    }\n\n    @computed\n    private get snippetOption(): SnippetOption {\n        let exportSnippetFormat = this.props.uiStore!.exportSnippetFormat ||\n            DEFAULT_SNIPPET_FORMAT_KEY;\n        return getCodeSnippetOptionFromKey(exportSnippetFormat);\n    }\n\n    @action.bound\n    setSnippetOption(optionKey: string) {\n        this.props.uiStore!.exportSnippetFormat = optionKey;\n    }\n};","import { styled, css } from '../../styles';\n\nimport { MediumCard } from '../common/card';\nimport { Button, SecondaryButton } from '../common/inputs';\n\nexport const HeaderCard = styled(MediumCard)`\n    position: sticky;\n    top: -10px;\n    z-index: 2;\n\n    display: flex;\n    flex-wrap: wrap;\n    flex-direction: row;\n    align-items: center;\n    justify-content: flex-end;\n\n    flex-shrink: 0;\n`;\n\nconst HeaderButtonStyles = css`\n    padding: 10px 15px;\n    font-weight: bold;\n    font-size: ${p => p.theme.textSize};\n\n    margin: 10px 0 0 10px;\n    align-self: stretch;\n`;\n\nexport const HeaderText = styled.p`\n    width: 100%;\n    margin-bottom: 10px;\n    line-height: 1.3;\n\n    a[href] {\n        color: ${p => p.theme.linkColor};\n\n        &:visited {\n            color: ${p => p.theme.visitedLinkColor};\n        }\n    }\n`;\n\nexport const HeaderButton = styled(Button)`${HeaderButtonStyles}`;\nexport const SecondaryHeaderButton = styled(SecondaryButton)`${HeaderButtonStyles}`;","import * as React from 'react';\nimport * as semver from 'semver';\n\nimport { WarningIcon } from '../../../icons';\nimport { logError } from '../../../errors';\n\nimport {\n    desktopVersion,\n    versionSatisfies,\n    DESKTOP_HEADER_LIMIT_CONFIGURABLE\n} from '../../../services/service-versions';\n\nimport { unreachableCheck } from '../../../util/error';\nimport { clickOnEnter } from '../../component-utils';\nimport {\n    HeaderCard,\n    HeaderText,\n    HeaderButton\n} from '../header-card';\n\ntype ErrorType =\n    | 'untrusted'\n    | 'expired'\n    | 'not-yet-valid'\n    | 'wrong-host'\n    | 'tls-error'\n    | 'host-not-found'\n    | 'host-unreachable'\n    | 'dns-error'\n    | 'connection-refused'\n    | 'connection-reset'\n    | 'client-abort'\n    | 'server-timeout'\n    | 'client-timeout'\n    | 'invalid-http-version'\n    | 'invalid-method'\n    | 'client-unparseable-url'\n    | 'client-unparseable'\n    | 'server-unparseable'\n    | 'header-overflow'\n    | 'invalid-headers'\n    | 'unknown';\n\nexport function tagsToErrorType(tags: string[]): ErrorType | undefined {\n    if (\n        tags.includes(\"passthrough-error:SELF_SIGNED_CERT_IN_CHAIN\") ||\n        tags.includes(\"passthrough-error:DEPTH_ZERO_SELF_SIGNED_CERT\") ||\n        tags.includes(\"passthrough-error:UNABLE_TO_VERIFY_LEAF_SIGNATURE\") ||\n        tags.includes(\"passthrough-error:UNABLE_TO_GET_ISSUER_CERT_LOCALLY\")\n    ) {\n        return 'untrusted';\n    }\n\n    if (tags.includes(\"passthrough-error:CERT_HAS_EXPIRED\")) return 'expired';\n    if (tags.includes(\"passthrough-error:CERT_NOT_YET_VALID\")) return 'not-yet-valid';\n    if (tags.includes(\"passthrough-error:ERR_TLS_CERT_ALTNAME_INVALID\")) return 'wrong-host';\n\n    if (\n        tags.filter(t => t.startsWith(\"passthrough-tls-error:\")).length > 0 ||\n        tags.includes(\"passthrough-error:EPROTO\") ||\n        tags.includes(\"passthrough-error:ERR_SSL_WRONG_VERSION_NUMBER\") ||\n        tags.includes(\"passthrough-error:ERR_SSL_DECRYPTION_FAILED_OR_BAD_RECORD_MAC\") ||\n        tags.includes(\"passthrough-error:ERR_SSL_CIPHER_OPERATION_FAILED\") ||\n        tags.includes(\"passthrough-error:ERR_SSL_BAD_RECORD_TYPE\") ||\n        tags.includes(\"passthrough-error:ERR_SSL_INTERNAL_ERROR\")\n    ) {\n        return 'tls-error';\n    }\n\n    if (tags.includes(\"passthrough-error:ENOTFOUND\")) return 'host-not-found';\n    if (\n        tags.includes(\"passthrough-error:EHOSTUNREACH\") || // No known route to this host\n        tags.includes(\"passthrough-error:ENETUNREACH\") // Whole network is unreachable\n    ) return 'host-unreachable';\n    if (tags.includes(\"passthrough-error:EAI_AGAIN\")) return 'dns-error';\n    if (tags.includes(\"passthrough-error:ECONNREFUSED\")) return 'connection-refused';\n    if (tags.includes(\"passthrough-error:ECONNRESET\")) return 'connection-reset';\n    if (tags.includes(\"passthrough-error:ETIMEDOUT\")) return 'server-timeout';\n    if (\n        tags.includes(\"passthrough-error:HPE_INVALID_CONSTANT\") ||\n        tags.includes(\"passthrough-error:ERR_INVALID_HTTP_TOKEN\") ||\n        tags.includes(\"passthrough-error:ERR_HTTP_INVALID_STATUS_CODE\") ||\n        tags.includes(\"passthrough-error:ERR_INVALID_CHAR\")\n    ) {\n        return 'server-unparseable';\n    }\n\n    if (tags.includes(\"http-2\") || tags.includes(\"client-error:HPE_INVALID_VERSION\")) {\n        return 'invalid-http-version';\n    }\n\n    if (tags.includes(\"client-error:HPE_INVALID_METHOD\")) return 'invalid-method'; // QWE / HTTP/1.1\n    if (tags.includes(\"client-error:HPE_INVALID_URL\")) return 'client-unparseable-url'; // http://<unicode>\n    if (\n        tags.includes(\"client-error:HPE_INVALID_CONSTANT\") || // GET / HTTQ <- incorrect constant char\n        tags.includes(\"client-error:HPE_INVALID_EOF_STATE\") // Unexpected 0-length packet in parser\n    ) return 'client-unparseable'; // ABC/1.1\n    if (tags.includes(\"client-error:HPE_HEADER_OVERFLOW\")) return 'header-overflow'; // More than ~80KB of headers\n    if (\n        tags.includes(\"client-error:HPE_INVALID_CONTENT_LENGTH\") ||\n        tags.includes(\"client-error:HPE_INVALID_TRANSFER_ENCODING\") ||\n        tags.includes(\"client-error:HPE_INVALID_HEADER_TOKEN\") || // Invalid received (req or res) headers\n        tags.includes(\"client-error:HPE_UNEXPECTED_CONTENT_LENGTH\") || // T-E with C-L\n        tags.includes(\"passthrough-error:HPE_INVALID_HEADER_TOKEN\") // Invalid headers upstream, e.g. after breakpoint\n    ) return 'invalid-headers';\n\n    if (tags.includes(\"client-error:ERR_HTTP_REQUEST_TIMEOUT\")) return 'client-timeout';\n    if (\n        tags.includes(\"client-error:ECONNABORTED\") ||\n        tags.includes(\"client-error:EPIPE\")\n    ) return 'client-abort';\n\n    if (\n        tags.filter(t => t.startsWith(\"passthrough-error:\")).length > 0 ||\n        tags.filter(t => t.startsWith(\"client-error:\")).length > 0\n    ) {\n        logError(`Unrecognized error tag ${JSON.stringify(tags)}`);\n        return 'unknown';\n    }\n}\n\nfunction typeCheck<T extends string>(types: readonly T[]) {\n    return (type: string): type is T => types.includes(type as T);\n}\n\nconst isInitialRequestError = typeCheck([\n    'invalid-http-version',\n    'invalid-method',\n    'client-unparseable',\n    'client-unparseable-url',\n    'header-overflow',\n    'invalid-headers'\n]);\n\nconst isClientBug = typeCheck([\n    'client-unparseable',\n    'client-unparseable-url',\n    'invalid-headers'\n]);\n\nconst wasNotForwarded = typeCheck([\n    'untrusted',\n    'expired',\n    'not-yet-valid',\n    'wrong-host',\n    'tls-error',\n    'host-not-found',\n    'host-unreachable',\n    'dns-error',\n    'connection-refused'\n]);\n\nconst wasResponseIssue = typeCheck([\n    'server-unparseable',\n    'connection-reset'\n]);\n\nconst wasTimeout = typeCheck([\n    'client-timeout',\n    'server-timeout'\n]);\n\nconst isWhitelistable = typeCheck([\n    'untrusted',\n    'expired',\n    'not-yet-valid',\n    'wrong-host',\n    'tls-error'\n]);\n\nconst isMockable = typeCheck([\n    'host-not-found',\n    'host-unreachable',\n    'dns-error',\n    'connection-refused',\n    'connection-reset',\n    'server-timeout'\n]);\n\nexport const HttpErrorHeader = (p: {\n    isPaidUser: boolean,\n    type: ErrorType,\n    getPro: (source: string) => void,\n    navigate: (path: string) => void,\n    mockRequest: () => void,\n    ignoreError: () => void\n}) => {\n    const advancedHeaderOverflowSupported =\n        desktopVersion.state === 'fulfilled' &&\n        semver.valid(desktopVersion.value as string) &&\n        versionSatisfies(\n            desktopVersion.value as string,\n            DESKTOP_HEADER_LIMIT_CONFIGURABLE\n        );\n\n    return <HeaderCard>\n        <HeaderText>\n            <WarningIcon /> {\n                isInitialRequestError(p.type)\n                    ? <strong>This request could not be handled</strong>\n                : wasNotForwarded(p.type)\n                    ? <strong>This request was not forwarded successfully</strong>\n                : // Forwarded but failed later, or unknown:\n                    <strong>This exchange was not completed successfully</strong>\n            }\n        </HeaderText>\n\n        <HeaderText>\n            { isInitialRequestError(p.type)\n                ? <>\n                    The client's request {\n                        p.type === 'invalid-method'\n                            ? 'used an unsupported HTTP method'\n                        : p.type === 'invalid-http-version'\n                            ? 'used an unsupported HTTP version'\n                        : p.type === 'invalid-headers'\n                            ? 'included an invalid or unparseable header'\n                        : p.type === 'client-unparseable-url'\n                            ? 'included an unparseable URL'\n                        : p.type === 'header-overflow'\n                            ? 'headers were too large to be processed'\n                        : p.type === 'client-unparseable'\n                            ? 'could not be parsed'\n                        : unreachableCheck(p.type)\n                    }, so HTTP Toolkit did not handle this request.\n                </>\n            : wasNotForwarded(p.type)\n                ? <>\n                    The upstream server {\n                        p.type === 'wrong-host'\n                            ? 'responded with an HTTPS certificate for the wrong hostname'\n                        : p.type === 'expired'\n                            ? 'has an expired HTTPS certificate'\n                        : p.type === 'not-yet-valid'\n                            ? 'has an HTTPS certificate with a start date in the future'\n                        : p.type === 'untrusted'\n                            ? 'has an untrusted HTTPS certificate'\n                        : p.type === 'tls-error'\n                            ? 'failed to complete a TLS handshake'\n                        : p.type === 'host-unreachable'\n                            ? 'was not reachable on your network connection'\n                        : p.type === 'host-not-found' || p.type === 'dns-error'\n                            ? 'hostname could be not found'\n                        : p.type === 'connection-refused'\n                            ? 'refused the connection'\n                        : unreachableCheck(p.type)\n                    }, so HTTP Toolkit did not forward the request.\n                </>\n            : wasTimeout(p.type)\n                ? <>\n                    The request timed out {\n                        p.type === 'client-timeout'\n                            ? 'waiting for the client to send the complete request'\n                        : p.type === 'server-timeout'\n                            ? 'waiting for a response from the server'\n                        : unreachableCheck(p.type)\n                    }\n                </>\n            : p.type === 'client-abort'\n                ? <>\n                    The client unexpectedly disconnected during the request, so\n                    the response could not be completed.\n                </>\n            : wasResponseIssue(p.type)\n                ? <>\n                    The upstream request failed because {\n                        p.type === 'connection-reset'\n                            ? 'the connection to the server was reset'\n                        : p.type === 'server-unparseable'\n                            ? 'the response from the server was unparseable'\n                        : unreachableCheck(p.type)\n                    }, so HTTP Toolkit could not return a response to the client.\n                </>\n            : p.type === 'unknown'\n                ? <>\n                    The request failed because of an unknown error,\n                    so HTTP Toolkit could not return a response.\n                </>\n            : unreachableCheck(p.type)\n        }\n        </HeaderText>\n\n        { p.type === 'tls-error'\n            ? <>\n                <HeaderText>\n                    This could be caused by the server not supporting modern cipher\n                    standards or TLS versions, requiring a client certificate that hasn't\n                    been provided, or other TLS configuration issues.\n                </HeaderText>\n                <HeaderText>\n                    { p.isPaidUser\n                        ? <>\n                            From the Settings page you can configure client certificates, or\n                            whitelist this host to relax HTTPS requirements and allow\n                            self-signed certificates, which may resolve some TLS issues.\n                        </>\n                        : <>\n                            Pro users can relax HTTPS requirements for configured hosts to\n                            accept older TLS configurations and self-signed/invalid certificates, and\n                            configure per-host client certificates for authentication.\n                        </>\n                    }\n                </HeaderText>\n            </>\n        : p.type === 'host-not-found'\n            ? <>\n                <HeaderText>\n                    This typically means the host doesn't exist, although it\n                    could be an issue with your DNS or network configuration.\n                </HeaderText>\n                <HeaderText>\n                    You can define mock responses for requests like this from the\n                    Mock page, to return fake data even for servers and hostnames\n                    that don't exist.\n                </HeaderText>\n            </>\n        : p.type === 'host-unreachable'\n            ? <>\n                <HeaderText>\n                    This is typically an issue with your network connection or the\n                    host's DNS records.\n                </HeaderText>\n                <HeaderText>\n                    You can define mock responses for requests like this from the\n                    Mock page, to return fake data even for servers and hostnames\n                    that aren't accessible.\n                </HeaderText>\n            </>\n        : p.type === 'dns-error'\n            ? <>\n                <HeaderText>\n                    The DNS server hit an unknown error looking up this hostname.\n                    This is likely due to a issue in your DNS configuration or network\n                    connectivity, and may just be a temporary issue.\n                </HeaderText>\n                <HeaderText>\n                    You can define mock responses for requests like this from the\n                    Mock page, to return fake data even for servers and hostnames\n                    that don't exist or aren't accessible.\n                </HeaderText>\n            </>\n        : p.type === 'untrusted'\n            ? <HeaderText>\n                By default unrecognized certificate authorities (CAs) are only accepted for localhost servers, but {\n                    p.isPaidUser\n                        ? 'additional CAs can be trusted from the Settings page.'\n                        : 'Pro users can trust additional CAs or disable HTTPS validation for a host entirely.'\n                }\n            </HeaderText>\n        : isWhitelistable(p.type)\n            ? <HeaderText>\n                By default this is only allowed for localhost servers, but {\n                    p.isPaidUser\n                        ? 'other hosts can be added to the whitelist from the Settings page.'\n                        : 'Pro users can whitelist other custom hosts.'\n                }\n            </HeaderText>\n        : p.type === 'connection-refused'\n            ? <HeaderText>\n                This typically means the server isn't running on the port you're using, though\n                it is possible this is an intermittent connection issue. You can either try\n                again, or mock requests like this to avoid sending them upstream at all.\n            </HeaderText>\n        : p.type === 'connection-reset'\n            ? <HeaderText>\n                This could be due to a connection issue, or an issue with the server.\n                This may be an intermittent issue that will be solved by retrying the request, or\n                you can mock requests like this to avoid sending them upstream at all.\n            </HeaderText>\n        : p.type === 'client-abort'\n            ? <HeaderText>\n                This could be due to connection issues, problems within the client, or that\n                the client simply no longer wanted to receive the response and closed the\n                connection intentionally.\n            </HeaderText>\n        : p.type === 'client-timeout'\n            ? <HeaderText>\n                This could be due to connection issues, problems within the client, or delays\n                generating the complete body of the request. This might be resolved by retrying\n                the request, or sending a simpler request with a smaller or easier to generate body.\n            </HeaderText>\n        : p.type === 'server-timeout'\n            ? <HeaderText>\n                This could be due to connection issues, problems within the server, or issues\n                with handling this request specifically. This might be resolved by retrying\n                the request, or you can mock requests like this to avoid sending them upstream\n                at all.\n            </HeaderText>\n        : isClientBug(p.type)\n            ? <HeaderText>\n                This means the client sent HTTP Toolkit some fundamentally invalid data that does\n                not follow the HTTP spec. That suggests either a major bug in the client, or that\n                they're not sending HTTP at all.\n            </HeaderText>\n        : p.type === 'server-unparseable'\n            ? <HeaderText>\n                This means the server sent HTTP Toolkit some fundamentally invalid data that does\n                not follow the HTTP spec. That suggests either a major bug in the server, or that\n                they're not sending HTTP at all.\n            </HeaderText>\n        : p.type === 'header-overflow'\n            ? <HeaderText>\n                { desktopVersion.value && advancedHeaderOverflowSupported\n                    ? <>\n                        This means the request included more than 100KB of headers. The HTTP specification\n                        doesn't set a max length, but most servers will refuse to process anything longer\n                        than 8KB. This is likely an issue with your client, but if necessary you can increase\n                        the HTTP Toolkit limit by setting <code>max-http-header-size</code> using the <code>HTTPTOOLKIT_NODE_OPTIONS</code> environment variable.\n                    </>\n                : desktopVersion.value // Old desktop:\n                    ? <>\n                        In more recent HTTP Toolkit versions the built-in limit has been increased, so please\n                        update HTTP Toolkit to handle requests like these.\n                    </>\n                : // Non-desktop use:\n                    <>\n                        The HTTP specification doesn't set a max length for HTTP headers, but most\n                        servers will refuse to process anything longer than 8KB.\n                    </>\n                }\n            </HeaderText>\n        : p.type === 'invalid-method'\n            ? <HeaderText>\n                Because this method is unrecognized, HTTP Toolkit doesn't know how it should\n                be handled, and cannot safely forward it on elsewhere. If you think this\n                method should be supported, please <a\n                    href='https://github.com/httptoolkit/httptoolkit/issues/new'\n                >\n                    get in touch\n                </a>.\n            </HeaderText>\n        : p.type === 'invalid-http-version'\n            ? <HeaderText>\n                The client may be using a newer or experimental HTTP version that HTTP\n                Toolkit doesn't yet support. If you think this version should be supported,\n                please <a\n                    href='https://github.com/httptoolkit/httptoolkit/issues/new'\n                >\n                    get in touch\n                </a>.\n            </HeaderText>\n        : p.type === 'unknown'\n            ? <HeaderText>\n                It's not clear what's gone wrong here, but for some reason HTTP Toolkit\n                couldn't successfully and/or securely complete this request.\n                This might be an intermittent issue, and may be resolved by retrying\n                the request.\n            </HeaderText>\n        : unreachableCheck(p.type)}\n\n        { isInitialRequestError(p.type) && <HeaderText>\n            The data shown below is a best guess from the data that was available\n            and parseable, and may be incomplete or inaccurate.\n        </HeaderText> }\n\n        <HeaderButton onClick={p.ignoreError} onKeyPress={clickOnEnter}>\n            Ignore\n        </HeaderButton>\n\n        { isMockable(p.type)\n            ? <HeaderButton onClick={p.mockRequest} onKeyPress={clickOnEnter}>\n                Mock requests like this\n            </HeaderButton>\n        : isWhitelistable(p.type)\n            ? (p.isPaidUser\n                ? <HeaderButton onClick={() => p.navigate('/settings')} onKeyPress={clickOnEnter}>\n                    Go to Settings\n                </HeaderButton>\n                : <HeaderButton\n                    onClick={() => p.getPro(`error-header-${p.type}`)}\n                    onKeyPress={clickOnEnter}\n                >\n                    Get Pro\n                </HeaderButton>\n            )\n        : null }\n\n    </HeaderCard>;\n};","import * as React from 'react';\nimport { action, runInAction } from 'mobx';\nimport { observer, inject } from 'mobx-react';\n\nimport { CollectedEvent } from '../../../types';\nimport { styled, css } from '../../../styles';\nimport { Ctrl } from '../../../util/ui';\n\nimport { HttpExchange } from '../../../model/http/exchange';\nimport { RulesStore } from '../../../model/rules/rules-store';\nimport { buildRuleFromExchange } from '../../../model/rules/rule-creation';\n\nimport { HEADER_FOOTER_HEIGHT } from '../view-event-list-footer';\nimport { IconButton } from '../../common/icon-button';\n\nconst ButtonsContainer = styled.div`\n    height: ${HEADER_FOOTER_HEIGHT}px;\n    flex-shrink: 0;\n    width: 100%;\n    padding-left: 5px;\n    box-sizing: border-box;\n\n    background-color: ${p => p.theme.mainBackground};\n\n    display: flex;\n\n    align-items: center;\n    justify-content: center;\n\n    z-index: 1;\n    box-shadow: 0 -10px 30px -5px rgba(0,0,0,0.1);\n`;\n\nconst ScrollToButton = observer((p: {\n    onClick: () => void\n}) => <IconButton\n    icon={['fas', 'eye']}\n    title={'Scroll the list to show this exchange'}\n    onClick={p.onClick}\n/>);\n\nconst PinButton = styled(observer((p: {\n    className?: string,\n    pinned: boolean,\n    onClick: () => void\n}) => <IconButton\n    className={p.className}\n    icon={['fas', 'thumbtack']}\n    title={\n        (\n            p.pinned\n            ? \"Unpin this exchange so it can be deleted\"\n            : \"Pin this exchange, so it can't be deleted\"\n        ) + ` (${Ctrl}+P)`\n    }\n    onClick={p.onClick}\n/>))`\n    transition: transform 0.1s;\n\n    ${p => !p.pinned && css`\n        transform: rotate(45deg);\n    `}\n`;\n\nconst DeleteButton = observer((p: {\n    pinned: boolean,\n    onClick: () => void\n}) => <IconButton\n    icon={['far', 'trash-alt']}\n    title={`Delete this exchange (${Ctrl}+Delete)`}\n    onClick={p.onClick}\n/>);\n\nconst MockButton = observer((p: {\n    isExchange: boolean,\n    isPaidUser: boolean,\n    onClick: () => void\n}) => <IconButton\n    icon={['fas', 'theater-masks']}\n    onClick={p.onClick}\n    title={\n        p.isPaidUser\n            ? 'Create a mock rule from this exchange'\n            : 'With Pro: create a mock rule from this exchange'\n    }\n    disabled={!p.isExchange || !p.isPaidUser}\n/>);\n\nexport const HttpDetailsFooter = inject('rulesStore')(\n    observer(\n        (props: {\n            rulesStore?: RulesStore,\n\n            event: CollectedEvent,\n            onDelete: (event: CollectedEvent) => void,\n            onScrollToEvent: (event: CollectedEvent) => void,\n            onBuildRuleFromExchange: (event: HttpExchange) => void,\n            isPaidUser: boolean,\n            navigate: (url: string) => void\n        }) => {\n            const { event } = props;\n            const { pinned } = event;\n\n            return <ButtonsContainer>\n                <ScrollToButton\n                    onClick={() => props.onScrollToEvent(props.event)}\n                />\n                <PinButton\n                    pinned={pinned}\n                    onClick={action(() => {\n                        event.pinned = !event.pinned;\n                    })}\n                />\n                <DeleteButton\n                    pinned={pinned}\n                    onClick={() => props.onDelete(event)}\n                />\n                <MockButton\n                    isExchange={event.isHttp()}\n                    isPaidUser={props.isPaidUser}\n                    onClick={() => props.onBuildRuleFromExchange(props.event as HttpExchange)}\n                />\n            </ButtonsContainer>;\n        }\n    )\n);","import * as React from 'react';\n\nimport { WarningIcon } from '../../../icons';\n\nimport { versionSatisfies, serverVersion, CLOSE_IN_BREAKPOINT } from '../../../services/service-versions';\n\nimport { clickOnEnter } from '../../component-utils';\nimport {\n    HeaderCard,\n    HeaderText,\n    HeaderButton,\n    SecondaryHeaderButton\n} from '../header-card';\n\nexport const HttpRequestBreakpointHeader = (p: {\n    onResume: () => void,\n    onCreateResponse: () => void,\n    onClose: () => void\n}) =>\n    <HeaderCard>\n        <HeaderText>\n            <WarningIcon /> <strong>This request is paused at a breakpoint</strong>\n        </HeaderText>\n        <HeaderText>\n            {\n                versionSatisfies(serverVersion.value as string, CLOSE_IN_BREAKPOINT)\n                ? <>\n                    Edit the request and then resume to let your edited request continue to the target URL,\n                    respond directly to provide a response yourself, or close to immediately end the connection.\n                </>\n                : <>\n                    Respond directly to provide a response yourself, or edit the request as you'd like\n                    and then resume to let your edited request continue to the target URL.\n                </>\n            }\n        </HeaderText>\n\n        <SecondaryHeaderButton onClick={p.onCreateResponse} onKeyPress={clickOnEnter}>\n            Respond directly\n        </SecondaryHeaderButton>\n\n        { versionSatisfies(serverVersion.value as string, CLOSE_IN_BREAKPOINT)\n            ? <SecondaryHeaderButton onClick={p.onClose} onKeyPress={clickOnEnter}>\n                Close\n            </SecondaryHeaderButton>\n            : null\n        }\n\n        <HeaderButton onClick={p.onResume} onKeyPress={clickOnEnter}>\n            Resume\n        </HeaderButton>\n    </HeaderCard>;\n\nexport const HttpResponseBreakpointHeader = (p: {\n    onResume: () => void,\n    onClose: () => void\n}) =>\n    <HeaderCard>\n        <HeaderText>\n            <WarningIcon /> <strong>This response is paused at a breakpoint</strong>\n        </HeaderText>\n        <HeaderText>\n            {\n                versionSatisfies(serverVersion.value as string, CLOSE_IN_BREAKPOINT)\n                ? <>\n                    Edit it as you'd like and resume to let the edited response continue back to the client,\n                    or close to immediately end the connection.\n                </>\n                : <>\n                    Edit it as you'd like, then resume to let the edited response continue back to the client.\n                </>\n            }\n        </HeaderText>\n\n        { versionSatisfies(serverVersion.value as string, CLOSE_IN_BREAKPOINT)\n            ? <SecondaryHeaderButton onClick={p.onClose} onKeyPress={clickOnEnter}>\n                Close\n            </SecondaryHeaderButton>\n            : null\n        }\n\n        <HeaderButton onClick={p.onResume} onKeyPress={clickOnEnter}>\n            Resume\n        </HeaderButton>\n    </HeaderCard>;","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { action, observable, reaction, runInAction } from 'mobx';\nimport { disposeOnUnmount, observer } from 'mobx-react';\n\nimport { RawHeaders } from '../../types';\nimport { HEADER_NAME_PATTERN } from '../../util/headers';\n\nimport { EditablePairs, PairsArray } from './editable-pairs';\n\nconst tupleArrayToPairsArray = (headers: RawHeaders): PairsArray =>\n    headers.map(([key, value]) => ({ key, value }));\n\nconst withH2HeadersDisabled = (headers: PairsArray): PairsArray =>\n    headers.map(({ key, value }) =>\n        key.startsWith(':')\n        ? { key, value, disabled: true }\n        : { key, value }\n    );\n\nconst rawHeadersAsEditablePairs = (rawHeaders: RawHeaders) => {\n    return withH2HeadersDisabled(tupleArrayToPairsArray(rawHeaders));\n};\n\nconst outputToRawHeaders = (output: PairsArray): RawHeaders =>\n    output.map(({ key, value }) => [key, value]);\n\nconst stripPseudoHeaders = (headers: PairsArray): PairsArray =>\n    // Strip leading colons - HTTP/2 headers should never be entered raw (but don't lower case)\n    headers.map(({ key, value, disabled }) => ({\n        key: !disabled && key.startsWith(':')\n            ? key.slice(1)\n            : key,\n        value,\n        disabled\n    }));\n\nconst stripPseudoHeadersAndLowercase = (headers: PairsArray): PairsArray =>\n    // Lowercase header keys, and strip any leading colons - HTTP/2 headers should never be entered raw\n    headers.map(({ key, value, disabled }) => ({\n        key: !disabled && key.startsWith(':')\n            ? key.slice(1).toLowerCase()\n            : key.toLowerCase(),\n        value,\n        disabled\n    }));\n\ninterface EditableRawHeadersProps {\n    headers: RawHeaders;\n    onChange: (headers: RawHeaders) => void;\n\n    // It's unclear whether you're strictly allowed completely empty header values, but it's definitely\n    // not recommended and poorly supported. By default we disable it except for special use cases.\n    allowEmptyValues?: boolean;\n\n    // By default, we lowercase headers. This isn't strictly required, but it's generally clearer,\n    // simpler, and semantically meaningless. HTTP/2 is actually even forced lowercase on the wire.\n    // Nonetheless, sometimes (breakpoints) you want to ignore that and edit with case regardless\n    // because the real raw headers have existing cases and otherwise it's weird:\n    preserveKeyCase?: boolean;\n}\n\nexport const EditableRawHeaders = observer((\n    props: EditableRawHeadersProps\n) => {\n    const { headers, onChange, allowEmptyValues, preserveKeyCase } = props;\n\n    return <EditablePairs<RawHeaders>\n        pairs={rawHeadersAsEditablePairs(headers)}\n        onChange={onChange}\n        transformInput={\n            preserveKeyCase\n            ? stripPseudoHeaders\n            : stripPseudoHeadersAndLowercase\n        }\n        convertResult={outputToRawHeaders}\n\n        allowEmptyValues={allowEmptyValues}\n\n        keyPattern={HEADER_NAME_PATTERN}\n        keyTitle=\"Header names must contain only alphanumeric characters and !#$%&'*+-.^_`|~ symbols\"\n\n        keyPlaceholder='Header name'\n        valuePlaceholder='Header value'\n    />;\n});\n\ninterface EditableHeadersProps<T> {\n    headers: T;\n\n    convertToRawHeaders: (input: T) => RawHeaders;\n    convertFromRawHeaders: (headers: RawHeaders) => T;\n\n    onChange: (headers: T) => void;\n    onInvalidState?: () => void;\n\n    // It's unclear whether you're strictly allowed completely empty header values, but it's definitely\n    // not recommended and poorly supported. By default we disable it except for special use cases.\n    allowEmptyValues?: boolean;\n}\n\n// Editable headers acts as a wrapper around the raw header pair modification, converting to and from other\n// formats (most commonly header objects, rather than arrays) whilst avoiding unnecessary updates that\n// cause churn in the UI due to unrepresentable states in that format (e.g. duplicate headers that aren't\n// directly next to each other). This allows you to edit as if the data was in raw header format, but\n// get different data live as it changes, without collapsing to that state until later.\n@observer\nexport class EditableHeaders<T> extends React.Component<EditableHeadersProps<T>> {\n\n    @observable\n    private rawHeaders: RawHeaders = this.props.convertToRawHeaders(this.props.headers);\n\n    private output: T = this.props.headers;\n\n    componentDidMount() {\n        // Watch the input, but only update our state if its materially different\n        // to the last output we returned.\n        disposeOnUnmount(this, reaction(\n            () => this.props.headers,\n            (input) => {\n                if (!_.isEqual(input, this.output)) {\n                    const newInput = this.props.convertToRawHeaders(input);\n                    runInAction(() => {\n                        this.rawHeaders = newInput;\n                    });\n                }\n            }\n        ));\n    }\n\n    @action.bound\n    onChangeRawHeaders(rawHeaders: RawHeaders) {\n        this.rawHeaders = rawHeaders;\n\n        const { allowEmptyValues, convertFromRawHeaders, onChange, onInvalidState } = this.props;\n\n        if (allowEmptyValues) {\n            this.output = convertFromRawHeaders(rawHeaders);\n            onChange(this.output);\n        } else {\n            if (rawHeaders.some((([_, value]) => !value))) return onInvalidState?.();\n            if (rawHeaders.some(([key]) => !key)) return onInvalidState?.();\n\n            this.output = convertFromRawHeaders(rawHeaders);\n            onChange(this.output);\n        }\n    }\n\n    render() {\n        const { allowEmptyValues } = this.props;\n        const { rawHeaders, onChangeRawHeaders } = this;\n\n        return <EditableRawHeaders\n            headers={rawHeaders}\n            onChange={onChangeRawHeaders}\n            allowEmptyValues={allowEmptyValues}\n        />;\n    }\n\n}","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { action, computed } from 'mobx';\nimport { observer } from 'mobx-react';\nimport { Method } from 'mockttp';\n\nimport { BreakpointRequestResult, HttpExchange, RawHeaders } from '../../../types';\nimport { styled } from '../../../styles';\n\nimport { getSummaryColour } from '../../../model/events/categorization';\nimport { withHeaderValue } from '../../../util/headers';\n\nimport {\n    CollapsibleCardHeading,\n    CollapsibleCard,\n    CollapsibleCardProps,\n} from '../../common/card';\nimport { Pill } from '../../common/pill';\nimport { ContentLabelBlock, ContentLabel } from '../../common/text-content';\nimport { EditableRawHeaders } from '../../common/editable-headers';\nimport { TextInput, Select } from '../../common/inputs';\nimport { SourceIcon } from '../../common/source-icon';\n\ninterface RequestBreakpointCardProps extends CollapsibleCardProps {\n    exchange: HttpExchange;\n    onChange: (request: Partial<BreakpointRequestResult>) => void;\n}\n\nconst UrlInput = styled(TextInput)`\n    width: 100%;\n    box-sizing: border-box;\n    margin-bottom: 10px;\n`;\n\ntype MethodName = keyof typeof Method;\nconst validMethods = Object.values(Method)\n    .filter(\n        value => typeof value === 'string'\n    ) as Array<MethodName>;\n\nconst MethodSelect = styled(Select)`\n    font-size: ${p => p.theme.textSize};\n    display: inline-block;\n\n    width: auto;\n    margin-left: 8px;\n    margin-bottom: 5px;\n`;\n\n@observer\nexport class HttpBreakpointRequestCard extends React.Component<RequestBreakpointCardProps> {\n\n    render() {\n        const { exchange, onChange, ...cardProps } = this.props;\n        const { request } = exchange;\n\n        const { inProgressResult } = this.props.exchange.requestBreakpoint!;\n        const headers = inProgressResult.rawHeaders || [];\n        const { method, url } = inProgressResult;\n\n        return <CollapsibleCard {...cardProps} direction='right'>\n            <header>\n                <SourceIcon source={request.source} />\n                <Pill color={getSummaryColour(exchange)}>\n                    { method } {\n                        (request.hostname || '')\n                        // Add some tiny spaces to split up parts of the hostname\n                        .replace(/\\./g, '\\u2008.\\u2008')\n                    }\n                </Pill>\n                <CollapsibleCardHeading onCollapseToggled={cardProps.onCollapseToggled}>\n                    Request\n                </CollapsibleCardHeading>\n            </header>\n\n            <div>\n                <ContentLabel>Method:</ContentLabel>\n                <MethodSelect value={method} onChange={this.onMethodChanged}>\n                    { !validMethods.includes(method as MethodName) &&\n                        <option key={method} value={undefined}>\n                            { method }\n                        </option>\n                    }\n                    { validMethods.map((methodOption) =>\n                        <option\n                            key={methodOption}\n                            value={methodOption}\n                        >\n                            { methodOption }\n                        </option>\n                    ) }\n                </MethodSelect>\n            </div>\n\n            <ContentLabelBlock>URL</ContentLabelBlock>\n            <UrlInput value={url} onChange={this.onUrlChanged} />\n\n            <ContentLabelBlock>Headers</ContentLabelBlock>\n            <EditableRawHeaders\n                headers={headers}\n                onChange={this.onHeadersChanged}\n                preserveKeyCase={true}\n            />\n        </CollapsibleCard>;\n    }\n\n    @computed\n    get isHttp2() {\n        return this.props.exchange.httpVersion === 2;\n    }\n\n    @action.bound\n    onMethodChanged(event: React.ChangeEvent<HTMLSelectElement>) {\n        const method = event.target.value;\n        const { inProgressResult } = this.props.exchange.requestBreakpoint!;\n\n        if (method === inProgressResult.method) return;\n\n        if (this.isHttp2) {\n            this.props.onChange({\n                method,\n                rawHeaders: withHeaderValue(inProgressResult.rawHeaders, { ':method': method })\n            });\n        } else {\n            this.props.onChange({ method });\n        }\n    }\n\n    @action.bound\n    onUrlChanged(event: React.ChangeEvent<HTMLInputElement>) {\n        const url = event.target.value;\n        const { inProgressResult } = this.props.exchange.requestBreakpoint!;\n\n        let rawHeaders = inProgressResult.rawHeaders;\n\n        try {\n            // Automatically update the host/H2 headers to match, if we can:\n            const parsedUrl = new URL(url);\n\n            if (this.isHttp2) {\n                rawHeaders = withHeaderValue(rawHeaders, {\n                    ':authority': parsedUrl.host,\n                    ':path': parsedUrl.pathname + parsedUrl.search,\n                    ':scheme':  parsedUrl.protocol.slice(0, -1)\n                });\n            } else {\n                rawHeaders = withHeaderValue(rawHeaders, { host: parsedUrl.host });\n            }\n        } catch (e) { }\n\n        this.props.onChange({ url: event.target.value, rawHeaders });\n    }\n\n    @action.bound\n    onHeadersChanged(rawHeaders: RawHeaders) {\n        this.props.onChange({ rawHeaders });\n    }\n\n}","import * as _ from 'lodash';\nimport * as React from 'react';\n\nimport { styled } from '../../styles';\n\nimport { TextInput } from './inputs';\nimport { getStatusMessage } from '../../model/http/http-docs';\n\nconst StatusContainer = styled.div`\n    margin-top: 5px;\n\n    display: flex;\n    flex-direction: row;\n    align-items: stretch;\n\n    > :not(:last-child) {\n        margin-right: 5px;\n    }\n\n    > :last-child {\n        flex-grow: 1;\n    }\n`;\n\nfunction isDefaultMessage(statusMessage: string, statusCode: number | undefined) {\n    return statusMessage.toLowerCase() === getStatusMessage(statusCode).toLowerCase()\n}\n\nexport const EditableStatus = (props: {\n    className?: string,\n    httpVersion: 1 | 2,\n    statusCode: number | undefined,\n    statusMessage: string | undefined,\n    onChange: (statusCode: number | undefined, statusMessage: string | undefined) => void\n}) => {\n    const { statusCode } = props;\n\n    // Undefined status message = use default. Note that the status\n    // message can still be shown as _empty_, just not undefined.\n    const statusMessage = props.statusMessage === undefined || props.httpVersion === 2\n        ? getStatusMessage(statusCode)\n        : props.statusMessage;\n\n    return <StatusContainer className={props.className}>\n        <TextInput\n            type='number'\n            min='100'\n            max='999'\n            invalid={!statusCode}\n            value={statusCode}\n            onChange={(event) => {\n                let newStatusCode = (event.target.value !== '')\n                    ? parseInt(event.target.value, 10)\n                    : undefined;\n\n                if (_.isNaN(newStatusCode)) return;\n\n                // If the status message was the default message, update it to\n                // match the new status code\n                const newStatusMessage = isDefaultMessage(statusMessage, statusCode)\n                    ? undefined\n                    : props.statusMessage;\n\n                props.onChange(newStatusCode, newStatusMessage);\n            }}\n        />\n\n        <TextInput\n            disabled={props.httpVersion === 2}\n            value={statusMessage}\n            onChange={(event) => {\n                let newMessage: string | undefined = event.target.value;\n\n                if (isDefaultMessage(newMessage, statusCode)) {\n                    newMessage = undefined;\n                }\n\n                props.onChange(statusCode, newMessage);\n            }}\n        />\n    </StatusContainer>;\n}","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { action } from 'mobx';\nimport { observer } from 'mobx-react';\n\nimport { BreakpointResponseResult, HttpExchange, RawHeaders } from '../../../types';\nimport { styled, Theme } from '../../../styles';\n\nimport { getStatusColor } from '../../../model/events/categorization';\nimport { withHeaderValue } from '../../../util/headers';\n\nimport {\n    CollapsibleCardHeading,\n    CollapsibleCard,\n    CollapsibleCardProps,\n} from '../../common/card';\nimport { Pill } from '../../common/pill';\nimport { ContentLabelBlock, ContentLabel } from '../../common/text-content';\nimport { EditableRawHeaders } from '../../common/editable-headers';\nimport { EditableStatus } from '../../common/editable-status';\n\ninterface ResponseBreakpointCardProps extends CollapsibleCardProps {\n    theme: Theme;\n    exchange: HttpExchange;\n    onChange: (response: Partial<BreakpointResponseResult>) => void;\n}\n\nconst StatusContainer = styled.div`\n    display: flex;\n    flex-direction: row;\n    align-items: baseline;\n`;\n\nconst InlineEditableStatus = styled(EditableStatus)`\n    margin-left: 10px;\n    margin-bottom: 5px;\n    flex-basis: 100%;\n`;\n\n@observer\nexport class HttpBreakpointResponseCard extends React.Component<ResponseBreakpointCardProps> {\n\n    render() {\n        const { exchange, onChange, theme, ...cardProps } = this.props;\n\n        const { inProgressResult } = exchange.responseBreakpoint!;\n        const headers = inProgressResult.rawHeaders || [];\n        const { statusCode, statusMessage } = inProgressResult;\n\n        return <CollapsibleCard {...cardProps} direction='left'>\n            <header>\n                <Pill color={getStatusColor(inProgressResult.statusCode, theme!)}>{ statusCode }</Pill>\n                <CollapsibleCardHeading onCollapseToggled={cardProps.onCollapseToggled}>\n                    Response\n                </CollapsibleCardHeading>\n            </header>\n\n            <StatusContainer>\n                <ContentLabel>Status:</ContentLabel>\n                <InlineEditableStatus\n                    httpVersion={exchange.httpVersion}\n                    statusCode={statusCode}\n                    statusMessage={statusMessage}\n                    onChange={this.onStatusChange}\n                />\n            </StatusContainer>\n\n            <ContentLabelBlock>Headers</ContentLabelBlock>\n            <EditableRawHeaders\n                headers={headers}\n                onChange={this.onHeadersChanged}\n                preserveKeyCase={true}\n            />\n        </CollapsibleCard>;\n    }\n\n    @action.bound\n    onHeadersChanged(rawHeaders: RawHeaders) {\n        this.props.onChange({ rawHeaders });\n    }\n\n    @action.bound\n    onStatusChange(statusCode: number | undefined, statusMessage: string | undefined) {\n        if (this.props.exchange.httpVersion === 2) {\n            const { rawHeaders } = this.props.exchange.responseBreakpoint!.inProgressResult;\n            this.props.onChange({\n                statusCode: statusCode || NaN,\n                statusMessage,\n                rawHeaders: withHeaderValue(rawHeaders, {\n                    ':status': statusCode?.toString() ?? ''\n                })\n            });\n        } else {\n            this.props.onChange({ statusCode: statusCode || NaN, statusMessage });\n        }\n    }\n\n}","import * as React from 'react';\nimport { observable, action, reaction, computed } from 'mobx';\nimport { observer, disposeOnUnmount } from 'mobx-react';\nimport * as portals from 'react-reverse-portal';\n\nimport { RawHeaders } from '../../../types';\nimport {\n    isProbablyUtf8,\n    bufferToString,\n    stringToBuffer\n} from '../../../util';\nimport { getHeaderValue } from '../../../util/headers';\nimport {\n    EditableContentType,\n    EditableContentTypes,\n    getEditableContentType\n} from '../../../model/events/content-types';\n\nimport { CollapsibleCard, ExpandableCardProps } from '../../common/card';\nimport { SelfSizedEditor } from '../../editor/base-editor';\nimport { EditableBodyCardHeader, EditorCardContent } from '../../editor/body-card-components';\n\n@observer\nexport class HttpBreakpointBodyCard extends React.Component<ExpandableCardProps & {\n    title: string,\n    direction: 'left' | 'right',\n\n    exchangeId: string,\n    body: Buffer,\n    rawHeaders: RawHeaders,\n    onChange: (result: Buffer) => void,\n    editorNode: portals.HtmlPortalNode<typeof SelfSizedEditor>;\n}> {\n\n    @observable\n    private contentType: EditableContentType = 'text';\n\n    @action.bound\n    onChangeContentType(value: string) {\n        this.contentType = value as EditableContentType;\n    }\n\n    componentDidMount() {\n        // If the content header is changed (manually, or when switching requests), update the\n        // selected editor content type to match:\n        disposeOnUnmount(this, reaction(\n            () => getHeaderValue(this.props.rawHeaders, 'content-type'),\n            (contentTypeHeader) => {\n                this.contentType = getEditableContentType(contentTypeHeader) || 'text';\n            },\n            { fireImmediately: true }\n        ));\n    }\n\n    @computed\n    private get textEncoding() {\n        // If we're handling text data, we want to show & edit it as UTF8.\n        // If it's binary, that's a lossy operation, so we use binary (latin1) instead.\n        return isProbablyUtf8(this.props.body)\n            ? 'utf8'\n            : 'binary';\n    }\n\n    render() {\n        const {\n            body,\n            title,\n            exchangeId,\n            direction,\n            collapsed,\n            expanded,\n            onCollapseToggled,\n            onExpandToggled\n        } = this.props;\n\n        const bodyString = bufferToString(body, this.textEncoding);\n\n        return <CollapsibleCard\n            direction={direction}\n            collapsed={collapsed}\n            onCollapseToggled={onCollapseToggled}\n            expanded={expanded}\n        >\n            <header>\n                <EditableBodyCardHeader\n                    body={body}\n                    onBodyFormatted={this.onBodyChange}\n\n                    title={title}\n                    expanded={expanded}\n                    onExpandToggled={onExpandToggled}\n                    onCollapseToggled={onCollapseToggled}\n\n                    selectedContentType={this.contentType}\n                    contentTypeOptions={EditableContentTypes}\n                    onChangeContentType={this.onChangeContentType}\n                />\n            </header>\n            <EditorCardContent>\n                <portals.OutPortal<typeof SelfSizedEditor>\n                    contentId={`bp-${exchangeId}-${direction}`}\n                    node={this.props.editorNode}\n                    language={this.contentType}\n                    value={bodyString}\n                    onChange={this.onBodyChange}\n                    expanded={!!expanded}\n                />\n            </EditorCardContent>\n        </CollapsibleCard>;\n    }\n\n    private onBodyChange = (body: string) => {\n        this.props.onChange(stringToBuffer(body, this.textEncoding));\n    }\n\n}","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { action, computed } from 'mobx';\nimport { observer, inject } from 'mobx-react';\nimport * as portals from 'react-reverse-portal';\n\nimport { CollectedEvent, HtkResponse, HttpExchange } from '../../../types';\nimport { styled } from '../../../styles';\nimport { logError } from '../../../errors';\n\nimport { ExpandableViewCardKey, UiStore } from '../../../model/ui/ui-store';\nimport { RulesStore } from '../../../model/rules/rules-store';\nimport { AccountStore } from '../../../model/account/account-store';\nimport { ApiExchange } from '../../../model/api/api-interfaces';\nimport { buildRuleFromRequest } from '../../../model/rules/rule-creation';\nimport { findItem } from '../../../model/rules/rules-structure';\nimport { HtkMockRule, getRulePartKey } from '../../../model/rules/rules';\nimport { WebSocketStream } from '../../../model/websockets/websocket-stream';\n\nimport { PaneOuterContainer, PaneScrollContainer } from '../view-details-pane';\nimport { StreamMessageListCard } from '../stream-message-list-card';\nimport { WebSocketCloseCard } from '../websocket-close-card';\n\nimport { HttpBodyCard } from './http-body-card';\nimport { HttpApiCard, HttpApiPlaceholderCard } from './http-api-card';\nimport { HttpRequestCard } from './http-request-card';\nimport { HttpResponseCard } from './http-response-card';\nimport { HttpAbortedResponseCard } from './http-aborted-card';\nimport { HttpPerformanceCard } from './http-performance-card';\nimport { HttpExportCard } from './http-export-card';\nimport { SelfSizedEditor } from '../../editor/base-editor';\nimport { HttpErrorHeader, tagsToErrorType } from './http-error-header';\nimport { HttpDetailsFooter } from './http-details-footer';\nimport { HttpRequestBreakpointHeader, HttpResponseBreakpointHeader } from './http-breakpoint-header';\nimport { HttpBreakpointRequestCard } from './http-breakpoint-request-card';\nimport { HttpBreakpointResponseCard } from './http-breakpoint-response-card';\nimport { HttpBreakpointBodyCard } from './http-breakpoint-body-card';\n\n// Used to push all cards below it to the bottom (when less than 100% height)\nconst CardDivider = styled.div`\n    margin-top: auto;\n`;\n\nconst makeFriendlyApiName = (rawName: string) => {\n    // Some API names are camelCase: make *only* those more readable\n    const cleanedName = !rawName.includes(' ') && rawName.length > 6\n        ? _.startCase(rawName)\n        : rawName;\n\n    // Trim down any REALLY long names (\"U.S. EPA Enforcement and ...\")\n    return cleanedName.length > 75\n        ? cleanedName.slice(0, 72).trimRight() + '\\u2026' // ...\n        : cleanedName;\n}\n\n@inject('uiStore')\n@inject('accountStore')\n@inject('rulesStore')\n@observer\nexport class HttpDetailsPane extends React.Component<{\n    exchange: HttpExchange,\n\n    requestEditor: portals.HtmlPortalNode<typeof SelfSizedEditor>,\n    responseEditor: portals.HtmlPortalNode<typeof SelfSizedEditor>,\n    streamMessageEditor: portals.HtmlPortalNode<typeof SelfSizedEditor>,\n\n    navigate: (path: string) => void,\n    onDelete: (event: CollectedEvent) => void,\n    onScrollToEvent: (event: CollectedEvent) => void,\n    onBuildRuleFromExchange: (exchange: HttpExchange) => void,\n\n    // Injected:\n    uiStore?: UiStore,\n    accountStore?: AccountStore,\n    rulesStore?: RulesStore\n}> {\n\n    get cardProps() {\n        return this.props.uiStore!.viewCardProps;\n    }\n\n    render() {\n        const {\n            exchange,\n            onDelete,\n            onScrollToEvent,\n            onBuildRuleFromExchange,\n            uiStore,\n            accountStore,\n            navigate\n        } = this.props;\n\n        const { isPaidUser } = accountStore!;\n        const { expandedViewCard } = uiStore!;\n        const { requestBreakpoint, responseBreakpoint } = exchange;\n\n        // The full API details - for paid APIs, and non-paid users, we don't show\n        // the detailed API data in any of the cards, we just show the name (below)\n        // in a collapsed API card.\n        const apiExchange = (isPaidUser || exchange.api?.isBuiltInApi)\n            ? exchange.api\n            : undefined;\n\n        // We do still want the API name though, if there is one - we use this to\n        // show non-paid users when API data might be available, iff this request\n        // does actually match a documented operation.\n        const apiName = exchange.api?.matchedOperation()\n            ? makeFriendlyApiName(exchange.api.service.name)\n            : undefined;\n\n        const headerCard = this.renderHeaderCard(exchange);\n\n        if (expandedViewCard) {\n            return <PaneOuterContainer>\n                { headerCard }\n                { this.renderExpandedCard(expandedViewCard, exchange, apiExchange) }\n            </PaneOuterContainer>;\n        }\n\n        const cards = (requestBreakpoint || responseBreakpoint)\n            ? this.renderBreakpointCards(exchange, apiName, apiExchange)\n            : this.renderNormalCards(exchange, apiName, apiExchange);\n\n        return <PaneOuterContainer>\n            <PaneScrollContainer>\n                { headerCard }\n                { cards }\n            </PaneScrollContainer>\n            <HttpDetailsFooter\n                event={exchange}\n                onDelete={onDelete}\n                onScrollToEvent={onScrollToEvent}\n                onBuildRuleFromExchange={onBuildRuleFromExchange}\n                navigate={navigate}\n                isPaidUser={isPaidUser}\n            />\n        </PaneOuterContainer>;\n    }\n\n    renderHeaderCard(exchange: HttpExchange): JSX.Element | null {\n        const { accountStore, navigate } = this.props;\n        const { isPaidUser, getPro } = accountStore!;\n        const {\n            requestBreakpoint,\n            respondToBreakpointedRequest,\n            responseBreakpoint,\n            tags\n        } = exchange;\n\n        if (requestBreakpoint) {\n            return <HttpRequestBreakpointHeader\n                key='breakpoint-header'\n                onCreateResponse={respondToBreakpointedRequest}\n                onResume={requestBreakpoint.resume}\n                onClose={requestBreakpoint.close}\n            />;\n        }\n\n        if (responseBreakpoint) {\n            return <HttpResponseBreakpointHeader\n                key='breakpoint-header'\n                onResume={responseBreakpoint.resume}\n                onClose={responseBreakpoint.close}\n            />;\n        }\n\n        const errorHeaderProps = {\n            key: 'error-header',\n            isPaidUser,\n            getPro,\n            navigate,\n            mockRequest: this.mockRequest,\n            ignoreError: this.ignoreError\n        };\n\n        const errorType = tagsToErrorType(tags);\n\n        if (errorType) {\n            return <HttpErrorHeader type={errorType} {...errorHeaderProps} />;\n        } else {\n            return null;\n        }\n    }\n\n    private renderApiCard(\n        apiName: string | undefined,\n        apiExchange: ApiExchange | undefined\n    ) {\n        if (!apiName) return null;\n\n        if (!apiExchange) {\n            // If you're not a paid user, and it's a paid API, then we only have\n            // the basic API name here but no details, so we just show a placeholder:\n            return <HttpApiPlaceholderCard\n                {...this.cardProps.api}\n                apiName={apiName}\n            />;\n        }\n\n        // If paid/built-in API & we have a name, we must have full API details, show them:\n        return <HttpApiCard\n            {...this.cardProps.api}\n            apiName={apiName}\n            apiExchange={apiExchange!}\n        />;\n    }\n\n    private renderExpandedCard(\n        expandedCard: ExpandableViewCardKey,\n        exchange: HttpExchange,\n        apiExchange: ApiExchange | undefined\n    ) {\n        if (expandedCard === 'requestBody') {\n            return this.renderRequestBody(exchange, apiExchange);\n        } else if (\n            expandedCard === 'responseBody' && (\n                exchange.isSuccessfulExchange() ||\n                !!exchange.responseBreakpoint\n            )) {\n            return this.renderResponseBody(exchange, apiExchange);\n        } else if (\n            expandedCard === 'webSocketMessages' &&\n            exchange.isWebSocket() &&\n            exchange.wasAccepted()\n        ) {\n            return this.renderWebSocketMessages(exchange);\n        } else {\n            logError(`Expanded ${expandedCard}, but can't show anything`);\n            return null; // Shouldn't ever happen, unless we get into a funky broken state\n        }\n    }\n\n    private renderBreakpointCards(\n        exchange: HttpExchange,\n        apiName: string | undefined,\n        apiExchange: ApiExchange | undefined\n    ) {\n        const { uiStore } = this.props;\n        const { requestBreakpoint } = exchange;\n\n        const cards: Array<JSX.Element | null> = [];\n\n        if (requestBreakpoint) {\n            cards.push(<HttpBreakpointRequestCard\n                {...this.cardProps.request}\n                exchange={exchange}\n                onChange={requestBreakpoint.updateMetadata}\n            />);\n\n            cards.push(this.renderRequestBody(exchange, apiExchange));\n        } else {\n            const responseBreakpoint = exchange.responseBreakpoint!;\n\n            cards.push(this.renderApiCard(apiName, apiExchange));\n            cards.push(<HttpRequestCard\n                {...this.cardProps.request}\n                matchedRuleData={this.matchedRuleData}\n                onRuleClicked={this.jumpToRule}\n                exchange={exchange}\n            />);\n\n            if (exchange.hasRequestBody()) {\n                cards.push(this.renderRequestBody(exchange, apiExchange));\n            }\n\n            cards.push(<HttpBreakpointResponseCard\n                {...this.cardProps.response}\n                exchange={exchange}\n                onChange={responseBreakpoint.updateMetadata}\n                theme={uiStore!.theme}\n            />);\n\n            cards.push(this.renderResponseBody(exchange, apiExchange));\n        }\n\n        return cards;\n    }\n\n    private renderNormalCards(\n        exchange: HttpExchange,\n        apiName: string | undefined,\n        apiExchange: ApiExchange | undefined\n    ) {\n        const { uiStore } = this.props;\n        const { response } = exchange;\n\n        const cards: Array<JSX.Element | null> = [];\n\n        cards.push(this.renderApiCard(apiName, apiExchange));\n\n        cards.push(<HttpRequestCard\n            {...this.cardProps.request}\n            matchedRuleData={this.matchedRuleData}\n            onRuleClicked={this.jumpToRule}\n            exchange={exchange}\n        />);\n\n        if (exchange.hasRequestBody()) {\n            cards.push(this.renderRequestBody(exchange, apiExchange));\n        }\n\n        if (response === 'aborted') {\n            cards.push(<HttpAbortedResponseCard\n                key={this.cardProps.response.key}\n                cardProps={this.cardProps.response}\n                exchange={exchange}\n            />);\n        } else if (!!response) {\n            cards.push(<HttpResponseCard\n                {...this.cardProps.response}\n                response={response}\n                requestUrl={exchange.request.parsedUrl}\n                apiExchange={apiExchange}\n                theme={uiStore!.theme}\n            />);\n\n            if (exchange.hasResponseBody()) {\n                cards.push(this.renderResponseBody(exchange, apiExchange));\n            }\n        }\n\n        if (exchange.isWebSocket() && exchange.wasAccepted()) {\n            cards.push(this.renderWebSocketMessages(exchange));\n\n            if (exchange.closeState) {\n                cards.push(<WebSocketCloseCard\n                    {...this.cardProps.webSocketClose}\n                    theme={uiStore!.theme}\n                    closeState={exchange.closeState}\n                />);\n            }\n        } else {\n            // We only show performance & export for non-websockets, for now:\n\n            // Push all cards below this point to the bottom\n            cards.push(<CardDivider key='divider' />);\n\n            cards.push(<HttpPerformanceCard\n                exchange={exchange}\n                {...this.cardProps.performance}\n            />);\n\n            cards.push(<HttpExportCard\n                exchange={exchange}\n                {...this.cardProps.export}\n            />);\n        }\n\n        return cards;\n    }\n\n    private renderRequestBody(exchange: HttpExchange, apiExchange: ApiExchange | undefined) {\n        const { request, requestBreakpoint } = exchange;\n\n        return requestBreakpoint\n            ? <HttpBreakpointBodyCard\n                {...this.requestBodyParams()}\n                exchangeId={exchange.id}\n                body={requestBreakpoint.inProgressResult.body.decoded}\n                rawHeaders={requestBreakpoint.inProgressResult.rawHeaders}\n                onChange={requestBreakpoint.updateBody}\n            />\n            : <HttpBodyCard\n                {...this.requestBodyParams()}\n                isPaidUser={this.props.accountStore!.isPaidUser}\n                url={exchange.request.url}\n                message={request}\n                apiBodySchema={apiExchange?.request?.bodySchema}\n            />;\n    }\n\n    private renderResponseBody(exchange: HttpExchange, apiExchange: ApiExchange | undefined) {\n        const { response, responseBreakpoint } = exchange;\n\n        return responseBreakpoint\n            ? <HttpBreakpointBodyCard\n                {...this.responseBodyParams()}\n                exchangeId={exchange.id}\n                body={responseBreakpoint.inProgressResult.body.decoded}\n                rawHeaders={responseBreakpoint.inProgressResult.rawHeaders}\n                onChange={responseBreakpoint.updateBody}\n            />\n            : <HttpBodyCard\n                {...this.responseBodyParams()}\n                isPaidUser={this.props.accountStore!.isPaidUser}\n                url={exchange.request.url}\n                message={response as HtkResponse}\n                apiBodySchema={apiExchange?.response?.bodySchema}\n            />;\n    }\n\n    private renderWebSocketMessages(exchange: WebSocketStream) {\n        const urlParts = exchange.request.url.split('/');\n        const domain = urlParts[2].split(':')[0];\n        const baseName = urlParts.length >= 2 ? urlParts[urlParts.length - 1] : undefined;\n\n        const filenamePrefix = `${domain}${baseName ? `- ${baseName}` : ''} - websocket`;\n\n        return <StreamMessageListCard\n            {...this.cardProps.webSocketMessages}\n\n            // Link the key to the exchange, to ensure selected-message state gets\n            // reset when we switch between exchanges:\n            key={`${this.cardProps.webSocketMessages.key}-${this.props.exchange.id}`}\n            streamId={this.props.exchange.id}\n            streamType='WebSocket'\n\n            editorNode={this.props.streamMessageEditor}\n\n            isPaidUser={this.props.accountStore!.isPaidUser}\n            filenamePrefix={filenamePrefix}\n            messages={exchange.messages}\n        />;\n    }\n\n    // The common request body params, for both normal & breakpointed bodies\n    private requestBodyParams() {\n        return {\n            ...this.cardProps.requestBody,\n            title: 'Request Body',\n            direction: 'right' as const,\n            editorNode: this.props.requestEditor\n        };\n    }\n\n    // The common response body params, for both normal & breakpointed bodies\n    private responseBodyParams() {\n        return {\n            ...this.cardProps.responseBody,\n            title: 'Response Body',\n            direction: 'left' as const,\n            editorNode: this.props.responseEditor\n        };\n    }\n\n    @action.bound\n    private mockRequest() {\n        const { exchange, rulesStore, navigate } = this.props;\n\n        const rule = buildRuleFromRequest(rulesStore!, exchange.request);\n        rulesStore!.draftRules.items.unshift(rule);\n        navigate(`/mock/${rule.id}`);\n    }\n\n    @computed\n    private get matchedRuleData() {\n        const { exchange, rulesStore } = this.props;\n\n        const { matchedRule } = exchange;\n        if (!matchedRule) return;\n\n        const currentRuleDraft = findItem(rulesStore!.draftRules, { id: matchedRule.id }) as HtkMockRule | undefined;\n        if (!currentRuleDraft) {\n            return { stepTypes: matchedRule.handlerStepTypes, status: 'deleted' } as const;\n        }\n\n        const currentStepTypes = ('handler' in currentRuleDraft\n            ? [currentRuleDraft.handler]\n            : currentRuleDraft.steps\n        ).map(s => getRulePartKey(s));\n\n        if (!_.isEqual(currentStepTypes, matchedRule.handlerStepTypes)) {\n            return { stepTypes: matchedRule.handlerStepTypes, status: 'modified-types' } as const;\n        }\n\n        return { stepTypes: matchedRule.handlerStepTypes, status: 'unchanged' } as const;\n    }\n\n    @action.bound\n    private jumpToRule() {\n        const { navigate, exchange } = this.props;\n        const { matchedRule } = exchange;\n        if (!matchedRule) return;\n        navigate(`/mock/${matchedRule.id}`);\n    }\n\n    @action.bound\n    private ignoreError() {\n        const { exchange } = this.props;\n\n        // Drop all error tags from this exchange\n        exchange.tags = exchange.tags.filter(t =>\n            !t.startsWith('passthrough-error:') &&\n            !t.startsWith('passthrough-tls-error:') &&\n            !t.startsWith('client-error:') &&\n            !['header-overflow', 'http-2'].includes(t)\n        );\n    }\n\n};","import * as _ from 'lodash';\nimport * as React from 'react';\n\nimport { styled } from '../../../styles';\nimport { Icon, SourceIcons } from '../../../icons';\n\nimport { getReadableIP } from '../../../model/network';\nimport { FailedTlsConnection } from '../../../model/tls/failed-tls-connection';\n\nimport { MediumCard } from '../../common/card';\nimport { ContentLabelBlock, Content, CopyableMonoValue } from '../../common/text-content';\nimport { PaneOuterContainer, PaneScrollContainer } from '../view-details-pane';\n\nconst AndroidIcon = styled(Icon).attrs({\n    icon: SourceIcons.Android.icon\n})`\n    float: left;\n    margin-right: 10px;\n    margin-top: 3px;\n    color: ${SourceIcons.Android.color};\n`;\n\nexport class TlsFailureDetailsPane extends React.Component<{\n    failure: FailedTlsConnection,\n    certPath: string\n}> {\n    render() {\n        const { failure, certPath } = this.props;\n\n        const sourceDetailParts = getReadableIP(failure.remoteIpAddress).split(' ');\n        const sourceIp = sourceDetailParts[0];\n        const sourceDetails = sourceDetailParts.slice(1).join(' ');\n\n        return <PaneOuterContainer>\n            <PaneScrollContainer>\n                <MediumCard>\n                    <header>\n                        <h1>Failed HTTPS Request</h1>\n                    </header>\n\n                    <ContentLabelBlock>Details</ContentLabelBlock>\n                    <Content>\n                        <p>{\n                            ({\n                                'closed': <>\n                                    This connection was aborted and closed before any HTTP request was sent.\n                                </>,\n                                'reset': <>\n                                    This connection was aborted and reset before any HTTP request was sent.\n                                </>,\n                                'cert-rejected': <>\n                                    This connection was aborted, before any HTTP request was sent,\n                                    because the client did not trust the HTTP Toolkit certificate.\n                                </>,\n                                'no-shared-cipher': <>\n                                    This connection was aborted, before any HTTP request was sent,\n                                    because the client failed to agree on a TLS configuration.\n                                </>,\n                                'unknown': <>\n                                    This connection was aborted, before any HTTP request was sent,\n                                    due to a TLS error.\n                                </>,\n                            } as _.Dictionary<JSX.Element>)[failure.failureCause]\n                        }</p>\n                        <p>\n                            The request was sent by <CopyableMonoValue>\n                                { sourceIp }\n                            </CopyableMonoValue> { sourceDetails }.\n                        </p>\n                    </Content>\n\n                    <ContentLabelBlock>Cause</ContentLabelBlock>\n                    <Content>{\n                        failure.failureCause === 'cert-rejected'\n                            ? <p>\n                                This means that the client hasn't yet been fully configured\n                                to work with HTTP Toolkit. It has the proxy settings,\n                                but it doesn't trust our certificate authority (CA), so we\n                                can't we can't intercept its HTTPS traffic.\n                            </p>\n                        : failure.failureCause === 'no-shared-cipher'\n                            ? <>\n                                <p>\n                                    This usually means that the client hasn't yet been 100% configured\n                                    to work with HTTP Toolkit, although it's also possible that\n                                    it has an unusual TLS setup.\n                                </p>\n                                <p>\n                                    The former case is much more likely. That would mean that the\n                                    client has the right proxy settings, but doesn't trust our\n                                    certificate authority (CA), so we can't imitate HTTPS sites and\n                                    we can't collect or see its HTTPS traffic.\n                                </p>\n                            </>\n                        : <>\n                            <p>This could be caused by a few things:</p>\n                            <ul>\n                                <li>The client might no longer want to make the request</li>\n                                <li>The client might have connection issues</li>\n                                <li>The client might not trust our HTTPS certificate</li>\n                            </ul>\n                        </>\n                    }</Content>\n                    <ContentLabelBlock>Solutions</ContentLabelBlock>\n                    <Content>\n                        <p>\n                            {\n                                failure.failureCause === 'cert-rejected'\n                                    ? <>\n                                        To resolve this, you need to configure the client to trust\n                                        your HTTP Toolkit CA.\n                                    </>\n                                : failure.failureCause === 'no-shared-cipher'\n                                    ? <>\n                                        You probably need to ensure the client is configured to trust the\n                                        HTTP Toolkit CA.\n                                    </>\n                                : <>\n                                    In the first two cases, this is not related to HTTP Toolkit.\n                                    In the third case, you need to configure the client to trust your\n                                    HTTP Toolkit CA.\n                                </>\n                            }\n                        </p>\n                        <p>\n                            How you do this depends on the specific client. Opening the certificate file\n                            on the device may prompt you to trust it device-wide, or you may need a\n                            specific option for the HTTP library or tool that's being used.\n                        </p>\n\n                        <p>\n                            Your HTTP Toolkit certificate is stored on your machine at <CopyableMonoValue>\n                                { certPath }\n                            </CopyableMonoValue>\n                        </p>\n                        <AndroidIcon />\n                        <p>\n                            <strong>For Android devices</strong>, modern apps will not\n                            trust your installed CA certificates by default. For apps targeting\n                            API level 24+, the app must opt in to trusting user CA certificates, or\n                            you need to inject a system certificate (only possible on rooted devices\n                            and emulators).\n                        </p>\n                        <p>\n                            Trusting user CA certificates in your own app is a small & simple\n                            configuration change, see <a\n                                href=\"https://httptoolkit.com/docs/guides/android#intercepting-traffic-from-your-own-android-app\"\n                            >the HTTP Toolkit docs</a> for more details. Alternatively HTTP Toolkit\n                            can inject the system certificate for you automatically, on devices that\n                            support this, by connecting the device with ADB and using the \"Android\n                            device via ADB\" interception option.\n                        </p>\n                        <p>\n                            Take a look at the <a href=\"https://httptoolkit.com/docs/guides/android/\">\n                                Android interception guide\n                            </a> for more information.\n                        </p>\n                    </Content>\n                </MediumCard>\n            </PaneScrollContainer>\n        </PaneOuterContainer>;\n    }\n}","import * as _ from 'lodash';\nimport * as React from 'react';\n\nimport { getReadableIP } from '../../../model/network';\nimport { TlsTunnel } from '../../../model/tls/tls-tunnel';\n\nimport { MediumCard } from '../../common/card';\nimport { ContentLabelBlock, Content, CopyableMonoValue } from '../../common/text-content';\nimport { PaneOuterContainer, PaneScrollContainer } from '../view-details-pane';\n\nexport class TlsTunnelDetailsPane extends React.Component<{\n    tunnel: TlsTunnel\n}> {\n    render() {\n        const { tunnel } = this.props;\n\n        const sourceDetailParts = getReadableIP(tunnel.remoteIpAddress).split(' ');\n        const sourceIp = sourceDetailParts[0];\n        const sourceDetails = sourceDetailParts.slice(1).join(' ');\n\n        return <PaneOuterContainer>\n            <PaneScrollContainer>\n                <MediumCard>\n                    <header>\n                        <h1>TLS Tunnel</h1>\n                    </header>\n\n                    <ContentLabelBlock>Details</ContentLabelBlock>\n                    <Content>\n                        <p>\n                            This TLS connection was not intercepted by HTTP Toolkit, as it matched\n                            a hostname that is configured for TLS passthrough in your settings.\n                        </p>\n                    </Content>\n                    <Content>\n                        <p>\n                            The connection was made from <CopyableMonoValue>{\n                                sourceIp\n                            }:{\n                                tunnel.remotePort\n                            }</CopyableMonoValue> { sourceDetails } to <CopyableMonoValue>{\n                                tunnel.upstreamHostname\n                            }:{\n                                tunnel.upstreamPort\n                            }</CopyableMonoValue>.\n                        </p>\n                    </Content>\n                </MediumCard>\n            </PaneScrollContainer>\n        </PaneOuterContainer>;\n    }\n}","/*\n * SPDX-FileCopyrightText: 2022 Tim Perry <tim@httptoolkit.com>\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport * as React from 'react';\nimport { observer } from 'mobx-react';\nimport * as portals from 'react-reverse-portal';\n\nimport { RTCDataChannel } from '../../../model/webrtc/rtc-data-channel';\n\nimport { ExpandableCardProps } from '../../common/card';\nimport { SelfSizedEditor } from '../../editor/base-editor';\nimport { StreamMessageListCard } from '../stream-message-list-card';\n\nexport const RTCDataChannelCard = observer(({\n    dataChannel,\n    isPaidUser,\n    streamMessageEditor,\n    ...cardProps\n}: ExpandableCardProps & {\n    dataChannel: RTCDataChannel,\n    isPaidUser: boolean,\n    streamMessageEditor: portals.HtmlPortalNode<typeof SelfSizedEditor>\n}) => <StreamMessageListCard\n    {...cardProps}\n\n    // Link the key to the channel, to ensure selected-message state gets\n    // reset when we switch between traffic:\n    key={dataChannel.id}\n    streamId={dataChannel.id}\n    streamType='DataChannel'\n    streamLabel={dataChannel.label}\n\n    editorNode={streamMessageEditor}\n\n    isPaidUser={isPaidUser}\n    filenamePrefix={'DataChannel ' + (dataChannel.label || dataChannel.channelId)}\n    messages={dataChannel.messages}\n/>);","/*\n * SPDX-FileCopyrightText: 2022 Tim Perry <tim@httptoolkit.com>\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport * as React from 'react';\nimport { observer } from 'mobx-react';\n\nimport { RTCConnection } from '../../../model/webrtc/rtc-connection';\n\nimport { clickOnEnter } from '../../component-utils';\nimport {\n    HeaderCard,\n    HeaderText,\n    HeaderButton,\n    SecondaryHeaderButton\n} from '../header-card';\nimport { CopyableMonoValue } from '../../common/text-content';\n\nexport const RTCConnectionHeader = observer((p: {\n    connection: RTCConnection,\n\n    hideConnection: () => void,\n    jumpToConnection: () => void\n}) => <HeaderCard>\n    <HeaderText>\n        Part of a WebRTC Connection from <CopyableMonoValue>{\n            p.connection.clientURL\n        }</CopyableMonoValue> to <CopyableMonoValue>{\n            p.connection.remoteURL\n        }</CopyableMonoValue>\n    </HeaderText>\n\n    <SecondaryHeaderButton\n        onClick={p.hideConnection}\n        onKeyPress={clickOnEnter}\n    >\n        Hide\n    </SecondaryHeaderButton>\n\n    <HeaderButton\n        onClick={p.jumpToConnection}\n        onKeyPress={clickOnEnter}\n    >\n        Jump to connection\n    </HeaderButton>\n</HeaderCard>);","/*\n * SPDX-FileCopyrightText: 2022 Tim Perry <tim@httptoolkit.com>\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport * as _ from 'lodash';\nimport * as React from 'react';\nimport { action, observable } from 'mobx';\nimport { observer, inject } from 'mobx-react';\nimport * as portals from 'react-reverse-portal';\n\nimport { AccountStore } from '../../../model/account/account-store';\nimport { RTCDataChannel } from '../../../model/webrtc/rtc-data-channel';\n\nimport { PaneOuterContainer } from '../view-details-pane';\nimport { SelfSizedEditor } from '../../editor/base-editor';\nimport { RTCDataChannelCard } from './rtc-data-channel-card';\nimport { RTCConnectionHeader } from './rtc-connection-header';\n\n@inject('accountStore')\n@observer\nexport class RTCDataChannelDetailsPane extends React.Component<{\n    dataChannel: RTCDataChannel,\n\n    streamMessageEditor: portals.HtmlPortalNode<typeof SelfSizedEditor>,\n    navigate: (path: string) => void,\n\n    // Injected:\n    accountStore?: AccountStore\n}> {\n\n    @observable\n    private isConnectionHidden = false;\n\n    @action.bound\n    hideConnection() {\n        this.isConnectionHidden = true;\n    }\n\n    jumpToConnection = () => {\n        const { rtcConnection } = this.props.dataChannel;\n        this.props.navigate(`/view/${rtcConnection.id}`);\n    }\n\n    render() {\n        const {\n            dataChannel,\n            streamMessageEditor,\n            accountStore\n        } = this.props;\n\n        return <PaneOuterContainer>\n            { !this.isConnectionHidden &&\n                <RTCConnectionHeader\n                    connection={dataChannel.rtcConnection}\n                    hideConnection={this.hideConnection}\n                    jumpToConnection={this.jumpToConnection}\n                />\n            }\n            <RTCDataChannelCard\n                dataChannel={dataChannel}\n                isPaidUser={accountStore!.isPaidUser}\n                streamMessageEditor={streamMessageEditor}\n\n                collapsed={false}\n                expanded={true}\n                onExpandToggled={this.jumpToConnection}\n                onCollapseToggled={undefined} // Hide the collapse button\n            />\n        </PaneOuterContainer>;\n\n    }\n\n};","import _ from 'lodash';\nimport React from 'react';\n\nimport { ScaleLinear, scaleLinear } from 'd3-scale';\nimport { AreaClosed, LinePath } from '@vx/shape';\nimport { curveMonotoneX } from '@vx/curve';\nimport { Group } from '@vx/group';\nimport { AxisLeft } from '@vx/axis';\n\nimport { styled } from '../../styles';\n\nimport { getSummaryColour } from '../../model/events/categorization';\nimport { getReadableSize } from '../../model/events/bodies';\n\n// Somewhat arbitrary colour selections, but picking from our existing category\n// pallet for vaugely related colours, that work together and which don't have\n// accessibility issues for colourblind usersL\nexport const SentDataColour = getSummaryColour('data');\nexport const ReceivedDataColour = getSummaryColour('rtc-media');\n\nconst GraphSvg = styled.svg`\n    background-color: ${p => p.theme.mainLowlightBackground};\n    color: ${p => p.theme.mainColor};\n\n    .axis-label {\n        font-size: 15px;\n    }\n\n    .axis-tick text {\n        font-size: 12px;\n    }\n`;\n\nexport const SendReceiveGraph = ({\n    width,\n    height,\n    graphPaddingPx,\n    data\n}: {\n    width: number,\n    height: number,\n    graphPaddingPx: number\n    data: Array<{ sent: number, received: number }>\n}) => {\n    const top = graphPaddingPx;\n    const bottom = height - graphPaddingPx;\n    const innerHeight = bottom - top;\n\n    const axisMargin = 85 + graphPaddingPx;\n    const innerWidth = width - axisMargin;\n    // ^ Note we don't subtract right-edge padding: we go fully up to the right edge\n\n    const xScale = scaleLinear()\n        .domain([0, data.length - 1])\n        .range([0, innerWidth]);\n\n    const dataMax = _.max(data.map(d => Math.max(d.sent, d.received))) ?? 0;\n\n    const sentYScale = scaleLinear()\n        .domain([0, dataMax])\n        .range([innerHeight / 2, top]);\n\n    const receivedYScale = scaleLinear()\n        .domain([0, dataMax])\n        .range([innerHeight / 2, bottom]);\n\n    const sentData = data.map(d => d.sent);\n    const receivedData = data.map(d => d.received);\n\n    return <GraphSvg\n        width={width}\n        height={height}\n    >\n        <Group left={axisMargin}>\n            <GraphArea\n                label='Received'\n                data={receivedData}\n                xScale={xScale}\n                yScale={receivedYScale}\n                fill={ReceivedDataColour}\n            />\n            <GraphArea\n                label='Sent'\n                data={sentData}\n                xScale={xScale}\n                yScale={sentYScale}\n                fill={SentDataColour}\n            />\n        </Group>\n    </GraphSvg>;\n};\n\nconst GraphArea = (props: {\n    label: string,\n    data: Array<number>,\n    xScale: ScaleLinear<number, number>,\n    yScale: ScaleLinear<number, number>,\n    fill: string\n}) => {\n    return <>\n        <AxisLeft\n            scale={props.yScale}\n\n            label={props.label}\n            labelOffset={55}\n            labelClassName='axis-label'\n\n            tickFormat={d => getReadableSize(d.valueOf())}\n            tickClassName='axis-tick'\n            numTicks={6}\n        />\n\n        <AreaClosed\n            data={props.data}\n\n            x={(d, i) => props.xScale(i)!}\n            y={d => props.yScale(d) ?? 0}\n            yScale={props.yScale}\n\n            fill={props.fill}\n            curve={curveMonotoneX}\n        />\n        <LinePath\n            data={props.data}\n\n            x={(d, i) => props.xScale(i)!}\n            y={d => props.yScale(d) ?? 0}\n\n            stroke=\"#222\"\n            strokeWidth={1.5}\n            curve={curveMonotoneX}\n\n        />\n    </>\n};","/*\n * SPDX-FileCopyrightText: 2022 Tim Perry <tim@httptoolkit.com>\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport * as _ from 'lodash';\nimport * as React from 'react';\nimport { computed } from 'mobx';\nimport { Observer, observer } from 'mobx-react';\nimport { ParentSize } from '@vx/responsive';\n\nimport { styled } from '../../../styles';\n\nimport { getReadableSize } from '../../../model/events/bodies';\nimport { RTCMediaTrack } from '../../../model/webrtc/rtc-media-track';\n\nimport {\n    CollapsibleCard,\n    CollapsibleCardHeading\n} from '../../common/card';\nimport { Pill } from '../../common/pill';\nimport {\n    SendReceiveGraph,\n    SentDataColour,\n    ReceivedDataColour\n} from '../../common/send-recieve-graph';\nimport { CollapsingButtons } from '../../common/collapsing-buttons';\nimport { ExpandShrinkButton } from '../../common/expand-shrink-button';\n\nexport type RTCMediaCardProps = {\n    mediaTrack: RTCMediaTrack,\n\n    collapsed: boolean,\n    expanded: boolean,\n    onExpandToggled: () => void,\n    onCollapseToggled?: () => void\n};\n\nexport const RTCMediaCard = observer((props: RTCMediaCardProps) => {\n    const { mediaTrack, ...cardProps } = props;\n\n    return <CollapsibleCard {...cardProps}>\n        <header>\n            <CollapsingButtons>\n                <ExpandShrinkButton\n                    expanded={cardProps.expanded}\n                    onClick={cardProps.onExpandToggled}\n                />\n            </CollapsingButtons>\n\n            <Pill color={SentDataColour}>\n                { getReadableSize(mediaTrack.totalBytesSent) } sent\n            </Pill>\n            <Pill color={ReceivedDataColour}>\n                { getReadableSize(mediaTrack.totalBytesReceived) } received\n            </Pill>\n            <CollapsibleCardHeading onCollapseToggled={cardProps.onCollapseToggled}>\n                RTC { mediaTrack.type }\n            </CollapsibleCardHeading>\n        </header>\n\n        <StatsGraphWrapper>\n            <RTCMediaStats mediaTrack={mediaTrack} />\n        </StatsGraphWrapper>\n    </CollapsibleCard>;\n});\n\nconst StatsGraphWrapper = styled.div`\n    margin: 0 -20px -20px -20px;\n    border-top: solid 1px ${p => p.theme.containerBorder};\n    background-color: ${p => p.theme.highlightBackground};\n\n    position: relative;\n    flex-grow: 1;\n\n    min-height: 400px;\n\n    /* Fix the ParentSize measuring div to match our size exactly. */\n    > div {\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n    }\n`;\n\n@observer\nclass RTCMediaStats extends React.Component<{ mediaTrack: RTCMediaTrack }> {\n\n    @computed\n    get graphData(): Array<{ sent: number, received: number }> {\n        const { stats } = this.props.mediaTrack;\n        return _.map(stats, (stat) => ({ sent: stat.sentDelta, received: stat.receivedDelta }));\n    }\n\n    render() {\n        return <ParentSize>{ parent =>\n            <Observer>{() =>\n                <SendReceiveGraph\n                    width={parent.width}\n                    height={parent.height}\n                    graphPaddingPx={10}\n                    data={this.graphData}\n                />\n            }</Observer>\n        }</ParentSize>;\n    }\n}","/*\n * SPDX-FileCopyrightText: 2022 Tim Perry <tim@httptoolkit.com>\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport * as _ from 'lodash';\nimport * as React from 'react';\nimport { action, observable } from 'mobx';\nimport { observer } from 'mobx-react';\n\nimport { RTCMediaTrack } from '../../../model/webrtc/rtc-media-track';\n\nimport { PaneOuterContainer } from '../view-details-pane';\nimport { RTCMediaCard } from './rtc-media-card';\nimport { RTCConnectionHeader } from './rtc-connection-header';\n\n@observer\nexport class RTCMediaDetailsPane extends React.Component<{\n    mediaTrack: RTCMediaTrack,\n    navigate: (path: string) => void\n}> {\n\n    @observable\n    private isConnectionHidden = false;\n\n    @action.bound\n    hideConnection() {\n        this.isConnectionHidden = true;\n    }\n\n    jumpToConnection = () => {\n        const { rtcConnection } = this.props.mediaTrack;\n        this.props.navigate(`/view/${rtcConnection.id}`);\n    }\n\n    render() {\n        const {\n            mediaTrack\n        } = this.props;\n\n        return <PaneOuterContainer>\n            { !this.isConnectionHidden &&\n                <RTCConnectionHeader\n                    connection={mediaTrack.rtcConnection}\n                    hideConnection={this.hideConnection}\n                    jumpToConnection={this.jumpToConnection}\n                />\n            }\n            <RTCMediaCard\n                collapsed={false}\n                expanded={true}\n                onExpandToggled={this.jumpToConnection}\n                onCollapseToggled={undefined} // Hide the collapse button\n\n                // Link the key to the track, to ensure selected-message state gets\n                // reset when we switch between traffic:\n                key={mediaTrack.id}\n\n                mediaTrack={mediaTrack}\n            />\n        </PaneOuterContainer>;\n\n    }\n\n};","/*\n * SPDX-FileCopyrightText: 2022 Tim Perry <tim@httptoolkit.com>\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport * as _ from 'lodash';\nimport * as React from 'react';\nimport { computed } from 'mobx';\nimport { observer } from 'mobx-react';\n\nimport { UNKNOWN_SOURCE } from '../../../model/http/sources';\nimport { RTCConnection } from '../../../model/webrtc/rtc-connection';\nimport { getSummaryColour } from '../../../model/events/categorization';\n\nimport {\n    CollapsibleCard,\n    CollapsibleCardHeading,\n    ExpandableCardProps\n} from '../../common/card';\nimport {\n    CollapsibleSection,\n    CollapsibleSectionSummary,\n    CollapsibleSectionBody\n} from '../../common/collapsible-section';\nimport {\n    ContentLabel,\n    ContentLabelBlock,\n    ContentMonoValueInline,\n    ContentValue\n} from '../../common/text-content';\nimport { SourceIcon } from '../../common/source-icon';\nimport { Pill } from '../../common/pill';\nimport { UrlBreakdown } from '../url-breakdown';\n\ninterface RTCConnectionCardProps extends ExpandableCardProps {\n    connection: RTCConnection;\n    onCollapseToggled?: () => void;\n};\n\n@observer\nexport class RTCConnectionCard extends React.Component<RTCConnectionCardProps> {\n\n    @computed\n    get hasData() {\n        const { streams } = this.props.connection;\n        return streams.some(s => s.isRTCDataChannel());\n    }\n\n    @computed\n    get hasAudio() {\n        const { streams } = this.props.connection;\n        return streams.some(s =>\n            s.isRTCMediaTrack() && s.type === 'audio'\n        );\n    }\n\n    @computed\n    get hasVideo() {\n        const { streams } = this.props.connection;\n        return streams.some(s =>\n            s.isRTCMediaTrack() && s.type === 'video'\n        );\n    }\n\n    render() {\n        const { connection, ...cardProps } = this.props;\n\n        return <CollapsibleCard {...cardProps}>\n            <header>\n                <SourceIcon source={connection.source} />\n\n                { this.hasData &&\n                    <Pill color={getSummaryColour('data')}>Data</Pill>\n                }\n\n                { this.hasVideo &&\n                    <Pill color={getSummaryColour('image')}>Video</Pill>\n                }\n\n                { this.hasAudio &&\n                    <Pill color={getSummaryColour('css')}>Audio</Pill>\n                }\n\n                <CollapsibleCardHeading onCollapseToggled={cardProps.onCollapseToggled}>\n                    WebRTC Connection\n                </CollapsibleCardHeading>\n            </header>\n\n            <CollapsibleSection>\n                <CollapsibleSectionSummary>\n                    <ContentLabel>Connection type: </ContentLabel>\n                    <ContentValue>\n                        {\n                            connection.remoteCandidate.type === 'host'\n                                ? 'Direct'\n                            : connection.remoteCandidate.type === 'relay'\n                                ? 'TURN-relayed'\n                            : connection.remoteCandidate.type === 'srflx'\n                                ? 'STUN-directed'\n                            : // === prflx\n                                'Peer-reflexive'\n                        } {\n                            connection.remoteCandidate.protocol.toUpperCase()\n                        }\n                    </ContentValue>\n                </CollapsibleSectionSummary>\n            </CollapsibleSection>\n\n            <CollapsibleSection>\n                <CollapsibleSectionSummary>\n                    <ContentLabel>From: </ContentLabel>\n                    <ContentMonoValueInline>{ connection.clientURL }</ContentMonoValueInline>\n                </CollapsibleSectionSummary>\n            </CollapsibleSection>\n\n            <CollapsibleSection>\n                <CollapsibleSectionSummary>\n                    <ContentLabel>To: </ContentLabel>\n                    <ContentMonoValueInline>{ connection.remoteURL }</ContentMonoValueInline>\n                </CollapsibleSectionSummary>\n            </CollapsibleSection>\n\n            { connection.sourceURL && <>\n                <ContentLabelBlock>Source page: </ContentLabelBlock>\n\n                <CollapsibleSection prefixTrigger={true}>\n                    <CollapsibleSectionSummary>\n                        <ContentMonoValueInline>\n                            { connection.sourceURL.toString() }\n                        </ContentMonoValueInline>\n                    </CollapsibleSectionSummary>\n\n                    <CollapsibleSectionBody>\n                        <UrlBreakdown url={connection.sourceURL} />\n                    </CollapsibleSectionBody>\n                </CollapsibleSection>\n            </> }\n\n            { connection.source !== UNKNOWN_SOURCE && <>\n                <ContentLabelBlock>Client: </ContentLabelBlock>\n\n                <CollapsibleSection prefixTrigger={true}>\n                    <CollapsibleSectionSummary>\n                        <ContentMonoValueInline>\n                            { connection.source.ua }\n                        </ContentMonoValueInline>\n                    </CollapsibleSectionSummary>\n\n                    <CollapsibleSectionBody>\n                        <p>{ connection.source.description }</p>\n                    </CollapsibleSectionBody>\n                </CollapsibleSection>\n            </> }\n        </CollapsibleCard>;\n    }\n}","/*\n * SPDX-FileCopyrightText: 2022 Tim Perry <tim@httptoolkit.com>\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport * as _ from 'lodash';\nimport * as React from 'react';\nimport { observer } from 'mobx-react';\nimport { MockRTCSessionDescription } from 'mockrtc';\nimport * as portals from 'react-reverse-portal';\n\nimport {\n    CollapsibleCard,\n    CollapsibleCardHeading,\n    ExpandableCardProps\n} from '../../common/card';\nimport { SelfSizedEditor } from '../../editor/base-editor';\nimport { ContentViewer } from '../../editor/content-viewer';\nimport { EditorCardContent } from '../../editor/body-card-components';\n\nimport { RTCConnection } from '../../../model/webrtc/rtc-connection';\n\ninterface RtcSdpCardProps extends ExpandableCardProps {\n    connection: RTCConnection;\n    type: 'local' | 'remote';\n    sessionDescription: MockRTCSessionDescription;\n    editorNode: portals.HtmlPortalNode<typeof SelfSizedEditor>;\n}\n\n@observer\nexport class SDPCard extends React.Component<RtcSdpCardProps> {\n\n    render() {\n        const {\n            connection,\n            type,\n            sessionDescription,\n            editorNode,\n            ...cardProps\n        } = this.props;\n\n        return <CollapsibleCard {...cardProps}>\n            <header>\n                <CollapsibleCardHeading onCollapseToggled={cardProps.onCollapseToggled}>\n                    {\n                        type === 'local' ? 'Sent' : 'Received'\n                    } Session {\n                        _.capitalize(sessionDescription.type)\n                    }\n                </CollapsibleCardHeading>\n            </header>\n\n            <EditorCardContent>\n                <ContentViewer\n                    contentId={`${connection.id}:${type}:${sessionDescription.type}:sdp`}\n                    editorNode={this.props.editorNode}\n                    contentType='text'\n                    expanded={false}\n                    cache={connection.cache}\n                >\n                    { sessionDescription.sdp }\n                </ContentViewer>\n            </EditorCardContent>\n        </CollapsibleCard>;\n    }\n}","/*\n * SPDX-FileCopyrightText: 2022 Tim Perry <tim@httptoolkit.com>\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport * as React from 'react';\nimport { action, computed, observable } from 'mobx';\nimport { inject, observer } from 'mobx-react';\nimport * as portals from 'react-reverse-portal';\n\nimport { UiStore } from '../../../model/ui/ui-store';\nimport { AccountStore } from '../../../model/account/account-store';\nimport { RTCConnection } from '../../../model/webrtc/rtc-connection';\nimport { RTCDataChannel } from '../../../model/webrtc/rtc-data-channel';\nimport { RTCMediaTrack } from '../../../model/webrtc/rtc-media-track';\n\nimport { SelfSizedEditor } from '../../editor/base-editor';\nimport { PaneOuterContainer, PaneScrollContainer } from '../view-details-pane';\n\nimport { RTCConnectionCard } from './rtc-connection-card';\nimport { SDPCard } from './sdp-card';\nimport { RTCDataChannelCard } from './rtc-data-channel-card';\nimport { RTCMediaCard } from './rtc-media-card';\n\n@inject('uiStore')\n@inject('accountStore')\n@observer\nexport class RTCConnectionDetailsPane extends React.Component<{\n    connection: RTCConnection,\n\n    offerEditor: portals.HtmlPortalNode<typeof SelfSizedEditor>,\n    answerEditor: portals.HtmlPortalNode<typeof SelfSizedEditor>,\n\n    navigate: (path: string) => void,\n\n    uiStore?: UiStore,\n    accountStore?: AccountStore\n}> {\n\n    @computed.struct\n    get mediaTracks() {\n        const { streams } = this.props.connection;\n        return streams.filter((s): s is RTCMediaTrack => s.isRTCMediaTrack());\n    }\n\n    @computed.struct\n    get dataChannels() {\n        const { streams } = this.props.connection;\n        return streams.filter((s): s is RTCDataChannel => s.isRTCDataChannel());\n    }\n\n    // Create a editor portal node for every data channel.\n    private readonly dataChannelEditors = this.dataChannels.map(() =>\n        portals.createHtmlPortalNode<typeof SelfSizedEditor>()\n    );\n\n    @observable\n    private streamCardState: {\n        [streamId: string]: { collapsed: boolean } | undefined\n    } = {};\n\n    @action.bound\n    toggleCollapse(streamId: string) {\n        this.streamCardState[streamId] = {\n            collapsed: !this.streamCardState[streamId]?.collapsed ?? true\n        };\n    }\n\n    expandStream(streamId: string) {\n        this.props.navigate(`/view/${streamId}`);\n    }\n\n    render() {\n        const {\n            connection,\n            uiStore,\n            offerEditor,\n            answerEditor,\n            accountStore\n        } = this.props;\n        const {\n            localSessionDescription,\n            remoteSessionDescription\n        } = connection;\n\n        const locallyInitiated = localSessionDescription.type === 'offer';\n\n        const offerDescription = locallyInitiated\n            ? localSessionDescription\n            : remoteSessionDescription;\n        const answerDescription = locallyInitiated\n            ? remoteSessionDescription\n            : localSessionDescription;\n\n        const offerCardProps = {\n            ...uiStore!.viewCardProps.rtcSessionOffer,\n            direction: locallyInitiated ? 'right' : 'left'\n        } as const;\n\n        const answerCardProps = {\n            ...uiStore!.viewCardProps.rtcSessionAnswer,\n            direction: locallyInitiated ? 'left' : 'right'\n        } as const;\n\n        return <PaneOuterContainer>\n            <PaneScrollContainer>\n                <RTCConnectionCard\n                    {...uiStore!.viewCardProps.rtcConnection}\n                    connection={connection}\n                />\n                <SDPCard\n                    {...offerCardProps}\n                    connection={connection}\n                    type={locallyInitiated ? 'local' : 'remote'}\n                    sessionDescription={offerDescription}\n                    editorNode={offerEditor}\n                />\n                <SDPCard\n                    {...answerCardProps}\n                    connection={connection}\n                    type={locallyInitiated ? 'remote' : 'local'}\n                    sessionDescription={answerDescription}\n                    editorNode={answerEditor}\n                />\n\n                {\n                    this.mediaTracks.map((mediaTrack) =>\n                        <RTCMediaCard\n                            // Link the key to the track, to ensure selected-message state gets\n                            // reset when we switch between traffic:\n                            key={mediaTrack.id}\n\n                            mediaTrack={mediaTrack}\n\n                            expanded={false}\n                            collapsed={!!this.streamCardState[mediaTrack.id]?.collapsed}\n                            onCollapseToggled={this.toggleCollapse.bind(this, mediaTrack.id)}\n                            onExpandToggled={this.expandStream.bind(this, mediaTrack.id)}\n                        />\n                    )\n                }\n\n                {\n                    this.dataChannels.map((dataChannel, i) =>\n                        <RTCDataChannelCard\n                            key={dataChannel.id}\n                            dataChannel={dataChannel}\n                            isPaidUser={accountStore!.isPaidUser}\n                            streamMessageEditor={this.dataChannelEditors[i]}\n\n                            expanded={false}\n                            collapsed={!!this.streamCardState[dataChannel.id]?.collapsed}\n                            onCollapseToggled={this.toggleCollapse.bind(this, dataChannel.id)}\n                            onExpandToggled={this.expandStream.bind(this, dataChannel.id)}\n                        />\n                    )\n                }\n\n                { this.dataChannelEditors.map((node, i) =>\n                    <portals.InPortal key={i} node={node}>\n                        <SelfSizedEditor\n                            contentId={null}\n                        />\n                    </portals.InPortal>\n                )}\n            </PaneScrollContainer>\n        </PaneOuterContainer>;\n    }\n\n}","import * as React from 'react';\nimport * as _ from 'lodash';\nimport {\n    observable,\n    autorun,\n    action,\n    computed,\n    runInAction,\n    when,\n    comparer,\n    observe\n} from 'mobx';\nimport { observer, disposeOnUnmount, inject } from 'mobx-react';\nimport * as portals from 'react-reverse-portal';\n\nimport { WithInjected, CollectedEvent } from '../../types';\nimport { NARROW_LAYOUT_BREAKPOINT, styled } from '../../styles';\nimport { useHotkeys, isEditable, windowSize } from '../../util/ui';\nimport { debounceComputed } from '../../util/observable';\nimport { UnreachableCheck } from '../../util/error';\n\nimport { UiStore } from '../../model/ui/ui-store';\nimport { ProxyStore } from '../../model/proxy-store';\nimport { EventsStore } from '../../model/events/events-store';\nimport { RulesStore } from '../../model/rules/rules-store';\nimport { AccountStore } from '../../model/account/account-store';\nimport { HttpExchange } from '../../model/http/exchange';\nimport { FilterSet } from '../../model/filters/search-filters';\nimport { buildRuleFromExchange } from '../../model/rules/rule-creation';\n\nimport { SplitPane } from '../split-pane';\nimport { EmptyState } from '../common/empty-state';\nimport { SelfSizedEditor } from '../editor/base-editor';\n\nimport { ViewEventList } from './view-event-list';\nimport { ViewEventListFooter } from './view-event-list-footer';\nimport { ViewEventContextMenuBuilder } from './view-context-menu-builder';\nimport { HttpDetailsPane } from './http/http-details-pane';\nimport { TlsFailureDetailsPane } from './tls/tls-failure-details-pane';\nimport { TlsTunnelDetailsPane } from './tls/tls-tunnel-details-pane';\nimport { RTCDataChannelDetailsPane } from './rtc/rtc-data-channel-details-pane';\nimport { RTCMediaDetailsPane } from './rtc/rtc-media-details-pane';\nimport { RTCConnectionDetailsPane } from './rtc/rtc-connection-details-pane';\n\ninterface ViewPageProps {\n    className?: string;\n    eventsStore: EventsStore;\n    proxyStore: ProxyStore;\n    uiStore: UiStore;\n    accountStore: AccountStore;\n    rulesStore: RulesStore;\n    navigate: (path: string) => void;\n    eventId?: string;\n}\n\nconst ViewPageKeyboardShortcuts = (props: {\n    selectedEvent: CollectedEvent | undefined,\n    moveSelection: (distance: number) => void,\n    onPin: (event: HttpExchange) => void,\n    onDelete: (event: CollectedEvent) => void,\n    onClear: () => void,\n    onStartSearch: () => void\n}) => {\n    useHotkeys('j', (event) => {\n        if (isEditable(event.target)) return;\n        props.moveSelection(1);\n    }, [props.moveSelection]);\n\n    useHotkeys('k', (event) => {\n        if (isEditable(event.target)) return;\n        props.moveSelection(-1);\n    }, [props.moveSelection]);\n\n    useHotkeys('Ctrl+p, Cmd+p', (event) => {\n        if (props.selectedEvent?.isHttp()) {\n            props.onPin(props.selectedEvent);\n            event.preventDefault();\n        }\n    }, [props.selectedEvent, props.onPin]);\n\n    useHotkeys('Ctrl+Delete, Cmd+Delete', (event) => {\n        if (isEditable(event.target)) return;\n\n        if (props.selectedEvent) {\n            props.onDelete(props.selectedEvent);\n        }\n    }, [props.selectedEvent, props.onDelete]);\n\n    useHotkeys('Ctrl+Shift+Delete, Cmd+Shift+Delete', (event) => {\n        props.onClear();\n        event.preventDefault();\n    }, [props.onClear]);\n\n    useHotkeys('Ctrl+f, Cmd+f', (event) => {\n        props.onStartSearch();\n        event.preventDefault();\n    }, [props.onStartSearch]);\n\n    return null;\n};\n\nconst EDITOR_KEYS = [\n    'request',\n    'response',\n    'streamMessage'\n] as const;\ntype EditorKey = typeof EDITOR_KEYS[number];\n\n@inject('eventsStore')\n@inject('proxyStore')\n@inject('uiStore')\n@inject('accountStore')\n@inject('rulesStore')\n@observer\nclass ViewPage extends React.Component<ViewPageProps> {\n\n    @computed\n    private get splitDirection(): 'vertical' | 'horizontal' {\n        if (windowSize.width >= NARROW_LAYOUT_BREAKPOINT) {\n            return 'vertical';\n        } else {\n            return 'horizontal';\n        }\n    }\n\n    private readonly editors = EDITOR_KEYS.reduce((v, key) => ({\n        ...v,\n        [key]: portals.createHtmlPortalNode<typeof SelfSizedEditor>()\n    }), {} as {\n        [K in EditorKey]: portals.HtmlPortalNode<typeof SelfSizedEditor>\n    });\n\n    searchInputRef = React.createRef<HTMLInputElement>();\n\n    private listRef = React.createRef<ViewEventList>();\n\n    @observable\n    private searchFiltersUnderConsideration: FilterSet | undefined;\n\n    get confirmedSearchFilters() {\n        return this.props.uiStore.activeFilterSet;\n    }\n\n    @debounceComputed(250, { equals: comparer.structural })\n    get currentSearchFilters() {\n        // While we're considering some search filters, show the result in the view list.\n        return this.searchFiltersUnderConsideration ?? this.confirmedSearchFilters;\n    }\n\n    @debounceComputed(10) // Debounce slightly - most important for body filtering performance\n    get filteredEventState(): {\n        filteredEvents: CollectedEvent[],\n        filteredEventCount: [filtered: number, fromTotal: number]\n    } {\n        const { events } = this.props.eventsStore;\n\n        const filteredEvents = (this.currentSearchFilters.length === 0)\n            ? events\n            : events.filter((event) =>\n                this.currentSearchFilters.every((f) => f.matches(event))\n            );\n\n        return {\n            filteredEvents,\n            filteredEventCount: [filteredEvents.length, events.length]\n        };\n    }\n\n    @computed\n    get selectedEvent() {\n        return _.find(this.props.eventsStore.events, {\n            id: this.props.eventId\n        });\n    }\n\n    private readonly contextMenuBuilder = new ViewEventContextMenuBuilder(\n        this.props.accountStore,\n        this.props.uiStore,\n        this.onPin,\n        this.onDelete,\n        this.onBuildRuleFromExchange\n    );\n\n    componentDidMount() {\n        disposeOnUnmount(this, observe(this, 'selectedEvent', ({ oldValue, newValue }) => {\n            if (this.splitDirection !== 'horizontal') return;\n\n            // In horizontal mode, the details pane appears and disappears, so we need to do some\n            // tricks to stop the scroll position in the list doing confusing things.\n\n            if (!oldValue && newValue) {\n                // If we're bringing the details pane into view, we want to jump to where we were\n                // but then shift slightly to make sure the selected row is visible too.\n                setTimeout(() => {\n                    if (!this.selectedEvent) return;\n                    this.listRef.current?.scrollToEvent(this.selectedEvent);\n                }, 50); // We need to delay slightly to let DOM and then UI state catch up\n            }\n        }));\n\n        disposeOnUnmount(this, autorun(() => {\n            if (!this.props.eventId) return;\n            const selectedEvent = this.selectedEvent;\n\n            // If you somehow have a non-existent event selected, unselect it\n            if (!selectedEvent) {\n                this.onSelected(undefined);\n                return;\n            }\n\n            const { expandedViewCard } = this.props.uiStore;\n\n            if (!expandedViewCard) return;\n\n            // If you have a pane expanded, and select an event with no data\n            // for that pane, then disable the expansion\n            if (\n                !(selectedEvent.isHttp()) ||\n                (\n                    expandedViewCard === 'requestBody' &&\n                    !selectedEvent.hasRequestBody() &&\n                    !selectedEvent.requestBreakpoint\n                ) ||\n                (\n                    expandedViewCard === 'responseBody' &&\n                    !selectedEvent.hasResponseBody() &&\n                    !selectedEvent.responseBreakpoint\n                ) ||\n                (\n                    expandedViewCard === 'webSocketMessages' &&\n                    !selectedEvent.isWebSocket()\n                )\n            ) {\n                runInAction(() => {\n                    this.props.uiStore.expandedViewCard = undefined;\n                });\n                return;\n            }\n        }));\n\n        // Due to https://github.com/facebook/react/issues/16087 in React, which is fundamentally caused by\n        // https://bugs.chromium.org/p/chromium/issues/detail?id=1218275 in Chrome, we can leak filtered event\n        // list references, which means that HTTP exchanges persist in memory even after they're cleared.\n        // This observer ensures that the persisted array reference is always emptied after a new value appears:\n        disposeOnUnmount(this,\n            observe(this, 'filteredEventState', ({ newValue, oldValue }) => {\n                const newFilteredEvents = newValue.filteredEvents;\n                const oldFilteredEvents = oldValue?.filteredEvents;\n\n                if (\n                    oldFilteredEvents &&\n                    oldFilteredEvents !== newFilteredEvents &&\n                    oldFilteredEvents !== this.props.eventsStore.events\n                ) {\n                    oldFilteredEvents.length = 0;\n                }\n            })\n        );\n    }\n\n    render(): JSX.Element {\n        const { isPaused, events } = this.props.eventsStore;\n        const { certPath } = this.props.proxyStore;\n\n        const { filteredEvents, filteredEventCount } = this.filteredEventState;\n\n        let rightPane: JSX.Element | null;\n        if (!this.selectedEvent) {\n            if (this.splitDirection === 'vertical') {\n                rightPane = <EmptyState key='details' icon={['fas', 'arrow-left']}>\n                    Select an exchange to see the full details.\n                </EmptyState>;\n            } else {\n                rightPane = null;\n            }\n        } else if (this.selectedEvent.isHttp()) {\n            rightPane = <HttpDetailsPane\n                exchange={this.selectedEvent}\n\n                requestEditor={this.editors.request}\n                responseEditor={this.editors.response}\n                streamMessageEditor={this.editors.streamMessage}\n\n                navigate={this.props.navigate}\n                onDelete={this.onDelete}\n                onScrollToEvent={this.onScrollToCenterEvent}\n                onBuildRuleFromExchange={this.onBuildRuleFromExchange}\n            />;\n        } else if (this.selectedEvent.isTlsFailure()) {\n            rightPane = <TlsFailureDetailsPane\n                failure={this.selectedEvent}\n                certPath={certPath}\n            />;\n        } else if (this.selectedEvent.isTlsTunnel()) {\n            rightPane = <TlsTunnelDetailsPane\n                tunnel={this.selectedEvent}\n            />;\n        } else if (this.selectedEvent.isRTCDataChannel()) {\n            rightPane = <RTCDataChannelDetailsPane\n                dataChannel={this.selectedEvent}\n                streamMessageEditor={this.editors.streamMessage}\n                navigate={this.props.navigate}\n            />\n        } else if (this.selectedEvent.isRTCMediaTrack()) {\n            rightPane = <RTCMediaDetailsPane\n                mediaTrack={this.selectedEvent}\n                navigate={this.props.navigate}\n            />\n        } else if (this.selectedEvent.isRTCConnection()) {\n            rightPane = <RTCConnectionDetailsPane\n                connection={this.selectedEvent}\n                offerEditor={this.editors.request}\n                answerEditor={this.editors.response}\n                navigate={this.props.navigate}\n            />\n        } else {\n            throw new UnreachableCheck(this.selectedEvent);\n        }\n\n        const minSize = this.splitDirection === 'vertical'\n            ? 300\n            : 200;\n\n        return <div className={this.props.className}>\n            <ViewPageKeyboardShortcuts\n                selectedEvent={this.selectedEvent}\n                moveSelection={this.moveSelection}\n                onPin={this.onPin}\n                onDelete={this.onDelete}\n                onClear={this.onForceClear}\n                onStartSearch={this.onStartSearch}\n            />\n\n            <SplitPane\n                split={this.splitDirection}\n                primary='second'\n                defaultSize='50%'\n                minSize={minSize}\n                maxSize={-minSize}\n                hiddenPane={rightPane === null ? '2' : undefined}\n            >\n                <LeftPane>\n                    <ViewEventListFooter // Footer above the list to ensure correct tab order\n                        searchInputRef={this.searchInputRef}\n                        allEvents={events}\n                        filteredEvents={filteredEvents}\n                        filteredCount={filteredEventCount}\n                        onFiltersConsidered={this.onSearchFiltersConsidered}\n                        onClear={this.onClear}\n                        onScrollToEnd={this.onScrollToEnd}\n                    />\n                    <ViewEventList\n                        events={events}\n                        filteredEvents={filteredEvents}\n                        selectedEvent={this.selectedEvent}\n                        isPaused={isPaused}\n\n                        moveSelection={this.moveSelection}\n                        onSelected={this.onSelected}\n\n                        contextMenuBuilder={this.contextMenuBuilder}\n\n                        ref={this.listRef}\n                    />\n                </LeftPane>\n                {\n                    rightPane ?? <div />\n                    // The <div/> is hidden by hiddenPane, so does nothing, but avoids\n                    // a React error in react-split-pane for undefined children\n                }\n            </SplitPane>\n\n            {Object.values(this.editors).map((node, i) =>\n                <portals.InPortal key={i} node={node}>\n                    <SelfSizedEditor\n                        contentId={null}\n                    />\n                </portals.InPortal>\n            )}\n        </div>;\n    }\n\n    @action.bound\n    onSearchFiltersConsidered(filters: FilterSet | undefined) {\n        this.searchFiltersUnderConsideration = filters;\n    }\n\n    @action.bound\n    onSelected(event: CollectedEvent | undefined) {\n        this.props.navigate(event\n            ? `/view/${event.id}`\n            : '/view'\n        );\n    }\n\n    @action.bound\n    moveSelection(distance: number) {\n        const { filteredEvents } = this.filteredEventState;\n\n        if (filteredEvents.length === 0) return;\n\n        const currentIndex = this.selectedEvent\n            ? _.findIndex(filteredEvents, { id: this.selectedEvent.id })\n            : -1;\n\n        const targetIndex = (currentIndex === -1)\n            ? (distance >= 0 ? 0 : filteredEvents.length - 1) // Jump to the start or end\n            : _.clamp(  // Move, but clamped to valid values\n                currentIndex + distance,\n                0,\n                filteredEvents.length - 1\n            );\n\n        const targetEvent = filteredEvents[targetIndex];\n        this.onSelected(targetEvent);\n        this.onScrollToEvent(targetEvent);\n    }\n\n    @action.bound\n    onPin(event: CollectedEvent) {\n        event.pinned = !event.pinned;\n    }\n\n    @action.bound\n    onBuildRuleFromExchange(exchange: HttpExchange) {\n        const { rulesStore, navigate } = this.props;\n\n        const rule = buildRuleFromExchange(exchange);\n        rulesStore!.draftRules.items.unshift(rule);\n        navigate(`/mock/${rule.id}`);\n    }\n\n    @action.bound\n    onDelete(event: CollectedEvent) {\n        const { filteredEvents } = this.filteredEventState;\n\n        // Prompt before deleting pinned events:\n        if (event.pinned && !confirm(\"Delete this pinned exchange?\")) return;\n\n        const rowIndex = filteredEvents.indexOf(event);\n        const wasSelected = event === this.selectedEvent;\n\n        // If you delete the selected event, select the next event in the list\n        if (rowIndex !== -1 && wasSelected && filteredEvents.length > 0) {\n            // Because navigate is async, we can't delete & change selection together.\n            // Instead, we update the selection now, and delete the event later.\n            const nextEvent = filteredEvents[\n                Math.min(rowIndex + 1, filteredEvents.length - 1)\n            ];\n\n            this.onSelected(nextEvent);\n            when(() => this.selectedEvent === nextEvent, () => {\n                this.props.eventsStore.deleteEvent(event);\n            });\n        } else {\n            this.props.eventsStore.deleteEvent(event);\n        }\n    }\n\n    @action.bound\n    onForceClear() {\n        this.onClear(false);\n    }\n\n    @action.bound\n    onClear(confirmRequired = true) {\n        const { events } = this.props.eventsStore;\n        const someEventsPinned = _.some(events, { pinned: true });\n        const allEventsPinned = events.length > 0 &&\n            _.every(events, { pinned: true });\n\n        if (allEventsPinned) {\n            // We always confirm deletion of pinned exchanges:\n            const confirmResult = confirm(\"Delete pinned traffic?\");\n            if (!confirmResult) return;\n        } else if (confirmRequired && events.length > 0) {\n            // We confirm deletion of non-pinned exchanges when triggered from the\n            // button, but not from keyboard shortcuts (which set confirmRequired=false).\n            const confirmResult = confirm(\n                someEventsPinned\n                    ? \"Delete all non-pinned traffic?\"\n                    : \"Delete all collected traffic?\"\n            );\n            if (!confirmResult) return;\n        }\n\n        this.props.eventsStore.clearInterceptedData(allEventsPinned);\n    }\n\n    @action.bound\n    onStartSearch() {\n        this.searchInputRef.current?.focus();\n    }\n\n    @action.bound\n    onScrollToEvent(event: CollectedEvent) {\n        this.listRef.current?.scrollToEvent(event);\n    }\n\n    @action.bound\n    onScrollToCenterEvent(event: CollectedEvent) {\n        this.listRef.current?.scrollToCenterEvent(event);\n    }\n\n    @action.bound\n    onScrollToEnd() {\n        this.listRef.current?.scrollToEnd();\n    }\n}\n\nconst LeftPane = styled.div`\n    position: relative;\n\n    height: 100%;\n    box-sizing: border-box;\n\n    display: flex;\n    flex-direction: column;\n`;\n\nconst StyledViewPage = styled(\n    // Exclude stores etc from the external props, as they're injected\n    ViewPage as unknown as WithInjected<typeof ViewPage,\n        'uiStore' | 'proxyStore' | 'eventsStore' | 'rulesStore' | 'accountStore' | 'navigate'\n    >\n)`\n    height: 100vh;\n    position: relative;\n`;\n\nexport { StyledViewPage as ViewPage };","import * as React from 'react';\n\nimport { styled } from '../../styles';\nimport { Icon } from '../../icons';\n\nconst FloatingDragHandle = styled.div`\n    position: absolute;\n    left: -31px;\n    top: calc(50% - 1px);\n    transform: translateY(-50%);\n\n    cursor: row-resize;\n\n    opacity: 0;\n\n    :focus, :active {\n        outline: none;\n        opacity: 0.5;\n        color: ${p => p.theme.popColor};\n    }\n\n    && svg {\n        margin: 0;\n    }\n`;\n\nexport const DragHandle = styled((props: {}) =>\n    <FloatingDragHandle {...props}>\n        <Icon icon={['fas', 'grip-vertical']} />\n    </FloatingDragHandle>\n)``;","import * as _ from 'lodash';\nimport * as React from 'react';\n\nimport { styled, css } from '../../styles';\nimport { IconProp } from '../../icons';\n\nimport { IconButton } from '../common/icon-button';\n\nexport const IconMenu = styled.div<{ topOffset: number }>`\n    position: absolute;\n    top: ${p => p.topOffset}px;\n    right: 10px;\n\n    display: none; /* Made flex by container, on hover/expand */\n    flex-direction: row-reverse;\n    align-items: center;\n`;\n\nexport const IconMenuButton = styled(React.memo((p: {\n    className?: string,\n    icon: IconProp,\n    title: string,\n    onClick: (event: React.MouseEvent) => void,\n    disabled?: boolean\n}) => <IconButton\n    className={p.className}\n    icon={p.icon}\n    title={p.title}\n    disabled={p.disabled}\n    onClick={p.onClick}\n/>))`\n    padding: 5px;\n    margin: 0 5px;\n\n    z-index: 10;\n\n    font-size: 1.2em;\n\n    > svg {\n        display: block;\n    }\n\n    :disabled {\n        opacity: 1;\n        color: ${p => p.theme.containerWatermark};\n    }\n\n    :not(:disabled) {\n        cursor: pointer;\n        color: ${p => p.theme.primaryInputBackground};\n\n        &:hover, &:focus {\n            outline: none;\n            color: ${p => p.theme.popColor};\n        }\n    }\n`;","import * as React from 'react';\nimport { action } from 'mobx';\nimport { observer, Observer } from 'mobx-react-lite'\nimport { Method, matchers } from 'mockttp';\nimport {\n    Draggable,\n    DraggingStyle,\n    NotDraggingStyle,\n    DraggableStateSnapshot\n} from 'react-beautiful-dnd';\n\nimport { styled, css } from '../../styles';\nimport { Icon } from '../../icons';\n\nimport {\n    isRuleGroup,\n    ItemPath,\n    HtkMockRuleGroup,\n    mapRules,\n    flattenRules\n} from '../../model/rules/rules-structure';\nimport { getMethodColor } from '../../model/events/categorization';\n\nimport { clickOnEnter, noPropagation } from '../component-utils';\nimport { TextInput } from '../common/inputs';\nimport { DragHandle } from './mock-drag-handle';\nimport { IconMenu, IconMenuButton } from './mock-item-menu';\n\nconst CollapsedItemPlaceholder = styled.div<{\n    index: number,\n    borderColor: string,\n    activated: boolean\n}>`\n    position: absolute;\n    top: calc(50% - ${p => p.index * 3}px);\n    transform: translateY(-50%);\n    height: 150%;\n\n    left: calc(-5px + ${p => p.index * 10}px);\n    right: ${p => p.index * 10}px;\n\n    background-color: ${p => p.theme.mainBackground};\n    border-radius: 4px;\n    box-shadow: 0 2px 10px 0 rgba(0,0,0,0.2);\n\n    opacity: ${p => (p.activated ? 1 : 0.6) - p.index * 0.2};\n    z-index: ${p => 9 - p.index};\n\n    border-left: 5px solid ${(p) => p.borderColor};\n`;\n\nconst TitleButtonContainer = styled.div`\n    display: none; /* Made flex by container, on hover/expand */\n    flex-direction: row;\n    align-items: center;\n    margin-left: 5px;\n`;\n\nconst TitleButton = styled(IconMenuButton)`\n    font-size: 1em;\n    padding: 0;\n`;\n\nconst RuleGroupMenu = (p: {\n    toggleState: boolean,\n    onToggleActivation: (event: React.MouseEvent) => void,\n    onClone: (event: React.MouseEvent) => void,\n    onDelete: (event: React.MouseEvent) => void,\n}) => <IconMenu topOffset={-2}>\n    <IconMenuButton\n        title='Delete these rules'\n        icon={['far', 'trash-alt']}\n        onClick={p.onDelete}\n    />\n    <IconMenuButton\n        title='Clone this rule'\n        icon={['far', 'clone']}\n        onClick={p.onClone}\n    />\n    <IconMenuButton\n        title={p.toggleState ? 'Deactivate these rules' : 'Activate these rules'}\n        icon={['fas', p.toggleState ? 'toggle-on' : 'toggle-off']}\n        onClick={p.onToggleActivation}\n    />\n</IconMenu>;\n\nconst GroupHeaderContainer = styled.header<{\n    depth: number,\n    collapsed: boolean,\n    editingTitle: boolean\n}>`\n    ${p => p.collapsed\n        ? `\n            margin-top: 22px;\n            margin-bottom: 17px;\n        `\n        : `\n            margin-top: 10px;\n        `\n    }\n\n    width: calc(100% - 5px - ${p => p.depth * 40}px);\n    margin-left: calc(5px + ${p => p.depth * 40}px);\n\n    transition: padding 0.1s ease-out;\n    padding: ${p => p.collapsed\n        ? '5px 20px 5px 15px'\n        : '5px 20px 5px 0px'};\n    box-sizing: border-box;\n\n    display: flex;\n    align-items: center;\n\n    position: relative;\n\n    cursor: pointer;\n    &:focus {\n        outline: none;\n        > h2 > svg {\n            color: ${p => p.theme.popColor};\n        }\n    }\n    &:hover {\n        ${DragHandle} {\n            opacity: 0.5;\n        }\n\n        ${TitleButtonContainer}, ${IconMenu} {\n            display: flex;\n        }\n\n        ${p => !p.collapsed\n            ? 'text-shadow: 0 0 5px rgba(0,0,0,0.2);'\n            : css`\n                > ${CollapsedItemPlaceholder} {\n                    box-shadow: 0 2px 20px 0 rgba(0,0,0,0.3);\n                }\n            `\n        }\n    }\n\n    ${p => p.editingTitle && css`\n        ${TitleButtonContainer} {\n            display: flex;\n        }\n    `}\n\n    font-size: ${(p) => p.theme.headingSize};\n\n    > h2 {\n        user-select: none;\n        z-index: 10;\n\n        > svg {\n            margin-right: 10px;\n        }\n    }\n\n    input[type=text] {\n        margin: -7px 0;\n        position: relative;\n        top: -3px;\n    }\n`;\n\nconst extendGroupDraggableStyles = (\n    style: DraggingStyle | NotDraggingStyle | undefined,\n    snapshot: DraggableStateSnapshot\n) => {\n    const overrideStyles: _.Dictionary<string> = { };\n\n    if (style && style.transition) {\n        overrideStyles.transition = style.transition.replace(\n            /transform [\\d.]+s/,\n            'transform 100ms'\n        );\n    }\n\n    if (snapshot.combineWith && snapshot.combineWith.endsWith('-tail')) {\n        overrideStyles.opacity = '1';\n    }\n\n    return {\n        ...style,\n        ...overrideStyles\n    };\n};\n\nconst isFullyActiveGroup = (group: HtkMockRuleGroup) =>\n    flattenRules(group).every(r => r.activated);\n\nexport const GroupHeader = observer((p: {\n    group: HtkMockRuleGroup,\n    path: ItemPath,\n    index: number,\n    collapsed: boolean,\n\n    updateGroupTitle: (groupId: string, title: string) => void,\n    cloneGroup: (path: ItemPath) => void\n    deleteGroup: (path: ItemPath) => void\n}) => {\n    const [isEditing, setEditing] = React.useState(false);\n    const [unsavedTitle, setUnsavedTitle] = React.useState(p.group.title);\n\n    const toggleCollapsed = action(() => { p.group.collapsed = !p.group.collapsed });\n\n    const startEditing = () => {\n        setEditing(true);\n        setUnsavedTitle(p.group.title);\n    };\n    const editTitle = (e: React.ChangeEvent<HTMLInputElement>) => {\n        setUnsavedTitle(e.target.value)\n    }\n    const resetTitle = () => {\n        setEditing(false);\n    };\n    const saveTitle = () => {\n        setEditing(false);\n        p.updateGroupTitle(p.group.id, unsavedTitle);\n    };\n\n    const allRulesActivated = isFullyActiveGroup(p.group);\n    const toggleActivation = noPropagation(action(() => {\n        mapRules(p.group, (rule) => {\n            rule.activated = !allRulesActivated;\n        });\n    }));\n\n    const deleteGroup = noPropagation(() => p.deleteGroup(p.path));\n    const cloneGroup = noPropagation(() => p.cloneGroup(p.path));\n\n    return <Draggable\n        draggableId={p.group.id}\n        index={p.index}\n    >{ (provided, snapshot) => <Observer>{ () =>\n        <GroupHeaderContainer\n            depth={p.path.length - 1}\n            collapsed={p.collapsed}\n            editingTitle={isEditing}\n\n            {...provided.draggableProps}\n            style={extendGroupDraggableStyles(provided.draggableProps.style, snapshot)}\n            ref={provided.innerRef}\n\n            onClick={toggleCollapsed}\n            onKeyPress={clickOnEnter}\n            tabIndex={0}\n        >\n            <DragHandle {...provided.dragHandleProps} />\n\n            <h2>\n                <Icon\n                    icon={['fas', p.group.collapsed ? 'chevron-down' : 'chevron-up']}\n                />\n                { isEditing\n                    ? <TextInput\n                        autoFocus\n                        value={unsavedTitle}\n                        onChange={editTitle}\n                        onClick={(e) => e.stopPropagation()}\n                        onKeyPress={(e) => {\n                            if (e.key === 'Enter') saveTitle();\n                        }}\n                    />\n                    : p.group.title\n                }\n            </h2>\n\n            <TitleButtonContainer>\n                { isEditing\n                    ? <>\n                        <TitleButton\n                            title=\"Save group name\"\n                            icon={['fas', 'save']}\n                            onClick={noPropagation(saveTitle)}\n                        />\n                        <TitleButton\n                            title=\"Reset group name\"\n                            icon={['fas', 'undo']}\n                            onClick={noPropagation(resetTitle)}\n                        />\n                    </>\n                    : <TitleButton\n                        title=\"Edit group name\"\n                        icon={['fas', 'edit']}\n                        onClick={noPropagation(startEditing)}\n                    />\n                }\n            </TitleButtonContainer>\n\n            <RuleGroupMenu\n                toggleState={allRulesActivated}\n                onToggleActivation={toggleActivation}\n                onClone={cloneGroup}\n                onDelete={deleteGroup}\n            />\n\n            { p.collapsed && p.group.items.slice(0, 5).map((item, index) => {\n                const initialMatcher = isRuleGroup(item) ? undefined : item.matchers[0];\n                const method = initialMatcher === undefined\n                        ? undefined\n                    : initialMatcher instanceof matchers.MethodMatcher\n                        ? Method[initialMatcher.method]\n                    : 'unknown'\n\n                const borderColor = method === undefined\n                    ? 'transparent'\n                    : getMethodColor(method);\n\n                const activated = isRuleGroup(item)\n                    ? isFullyActiveGroup(item)\n                    : item.activated;\n\n                return <CollapsedItemPlaceholder\n                    key={index}\n                    index={index}\n                    borderColor={borderColor}\n                    activated={activated}\n                />\n            }) }\n        </GroupHeaderContainer>\n    }</Observer>}</Draggable>;\n});\n\nconst GroupTailPlaceholder = styled.div`\n    width: 100%;\n    height: 30px;\n    margin-bottom: -20px;\n`;\n\nexport const GroupTail = (p: { group: HtkMockRuleGroup, index: number }) =>\n    <Draggable\n        draggableId={p.group.id + '-tail'}\n        index={p.index}\n        isDragDisabled={true}\n    >{ (provided) =>\n        <GroupTailPlaceholder\n            {...provided.draggableProps}\n            ref={provided.innerRef}\n        />\n    }</Draggable>;","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { observable, action, autorun, runInAction, reaction, computed } from 'mobx';\nimport { observer, disposeOnUnmount } from 'mobx-react';\nimport * as Randexp from 'randexp';\n\nimport { matchers, Method, RawHeaders } from \"mockttp\";\n\nimport { css, styled } from '../../styles';\n\nimport { tryParseJson } from '../../util';\nimport { asError, UnreachableCheck } from '../../util/error';\nimport {\n    FlatHeaders,\n    headersToFlatHeaders,\n    headersToRawHeaders,\n    rawHeadersToHeaders\n} from '../../util/headers';\n\nimport {\n    Matcher,\n    MatcherClass,\n    MatcherClassKeyLookup,\n    InitialMatcher,\n    InitialMatcherKey,\n    AdditionalMatcherKey,\n    getRulePartKey,\n    isHiddenMatcherKey\n} from '../../model/rules/rules';\nimport { summarizeMatcherClass } from '../../model/rules/rule-descriptions';\nimport {\n    WebSocketMethodMatcher\n} from '../../model/rules/definitions/websocket-rule-definitions';\nimport {\n    EthereumMethod,\n    EthereumMethodMatcher,\n    EthereumMethods,\n    EthereumParamsMatcher\n} from '../../model/rules/definitions/ethereum-rule-definitions';\nimport {\n    IpfsInteraction,\n    IpfsInteractionMatcher,\n    IpfsArgMatcher,\n    IpfsInteractions,\n    IpfsArgDescription\n} from '../../model/rules/definitions/ipfs-rule-definitions';\nimport {\n    HasDataChannelMatcherDefinition,\n    HasVideoTrackMatcherDefinition,\n    HasAudioTrackMatcherDefinition,\n    HasMediaTrackMatcherDefinition\n} from '../../model/rules/definitions/rtc-rule-definitions';\n\nimport { Select, TextInput } from '../common/inputs';\nimport { EditablePairs, PairsArray } from '../common/editable-pairs';\nimport { EditableHeaders } from '../common/editable-headers';\nimport { SelfSizedEditor } from '../editor/base-editor';\n\ntype MatcherConfigProps<M extends Matcher> = {\n    matcher?: M;\n    matcherIndex: number | undefined,\n    onChange: (...matchers: Matcher[] & { 0?: M }) => void;\n    onInvalidState: () => void;\n};\n\nabstract class MatcherConfig<M extends Matcher, P = {}> extends\n    React.Component<MatcherConfigProps<M> & P> { }\n\nexport function InitialMatcherConfiguration(props: {\n        matcher?: InitialMatcher,\n        onChange: (matcher: InitialMatcher) => void\n    }\n) {\n    const { matcher } = props;\n\n    // If no there's matcher class selected, we have no config to show:\n    if (!matcher) return null;\n\n    const matcherKey = getRulePartKey(matcher) as InitialMatcherKey;\n\n    const configProps = {\n        matcher: matcher as any,\n        matcherIndex: 0,\n        onChange: props.onChange,\n        onInvalidState: _.noop\n    };\n\n    switch (matcherKey) {\n        case 'eth-method':\n            return <EthereumMethodMatcherConfig {...configProps} />;\n        case 'ipfs-interaction':\n            return <IpfsInteractionMatcherConfig {...configProps} />;\n        // All the other initial matchers need no configuration:\n        case 'wildcard':\n        case 'ws-wildcard':\n        case 'default-wildcard':\n        case 'default-ws-wildcard':\n        case 'rtc-wildcard':\n        case 'GET':\n        case 'POST':\n        case 'PUT':\n        case 'PATCH':\n        case 'DELETE':\n        case 'HEAD':\n        case 'OPTIONS':\n            return null;\n        default:\n            throw new UnreachableCheck(matcherKey);\n    }\n}\n\nexport function AdditionalMatcherConfiguration(props:\n    ({ matcher: Matcher } | { matcherClass?: MatcherClass }) & {\n        matcherIndex: number | undefined,\n        onChange: (...matchers: Matcher[]) => void,\n        onInvalidState?: () => void\n    }\n) {\n    const { matcher } = props as { matcher?: Matcher };\n    const { matcherClass } = props as { matcherClass?: MatcherClass };\n\n    let matcherKey = ('matcher' in props\n        ? getRulePartKey(props.matcher)\n        : MatcherClassKeyLookup.get(props.matcherClass!)\n    ) as AdditionalMatcherKey | undefined;\n\n    // If no there's matcher class selected, we have no config to show:\n    if (!matcherKey) return null;\n\n    if (isHiddenMatcherKey(matcherKey)) {\n        // This only happens, when we load a rule from elsewhere (defaults or file), and then\n        // you try to configure it. Notably case: the am-i-using matcher.\n\n        if (matcher && !isHiddenMatcherKey(matcher.type)) {\n            // For special cases like these, we show and allow reconfiguring the rule as its non-hidden\n            // base type, if there is one. I.e. we give some matchers a special display, which isn't selectable\n            // but we allow modifying them as a normal selectable format if you want to mess around.\n            matcherKey = matcher.type as AdditionalMatcherKey;\n        } else {\n            throw new Error(`Cannot configure hidden matcher type ${matcherKey}`);\n        }\n    }\n\n    const configProps = {\n        matcher: matcher as any,\n        matcherIndex: props.matcherIndex,\n        onChange: props.onChange,\n        onInvalidState: props.onInvalidState || _.noop\n    };\n\n    switch (matcherKey) {\n        case 'method':\n            return <WsMethodMatcherConfig {...configProps} />;\n        case 'host':\n            return <HostMatcherConfig {...configProps} />;\n        case 'simple-path':\n            return <SimplePathMatcherConfig {...configProps} />;\n        case 'regex-path':\n            return <RegexPathMatcherConfig {...configProps} />;\n        case 'query':\n            return <QueryMatcherConfig {...configProps} />;\n        case 'exact-query-string':\n            return <ExactQueryMatcherConfig {...configProps} />;\n        case 'header':\n            return <HeaderMatcherConfig {...configProps} />;\n        case 'raw-body':\n            return <RawBodyExactMatcherConfig {...configProps} />;\n        case 'raw-body-includes':\n            return <RawBodyIncludesMatcherConfig {...configProps} />;\n        case 'json-body':\n            return <JsonBodyExactMatcherConfig {...configProps} />;\n        case 'json-body-matching':\n            return <JsonBodyIncludingMatcherConfig {...configProps} />;\n        case 'eth-params':\n            return <EthParamsMatcherConfig {...configProps} />;\n        case 'ipfs-arg':\n            return <IpfsArgMatcherConfig {...configProps} />;\n\n        case 'has-rtc-data-channel':\n        case 'has-rtc-video-track':\n        case 'has-rtc-audio-track':\n        case 'has-rtc-media-track':\n            return <RTCContentMatcherConfig\n                matcherKey={matcherKey}\n                matcherClass={matcherClass as any} // Any because it must be the class for this key\n                {...configProps}\n            />;\n\n        default:\n            throw new UnreachableCheck(matcherKey);\n    }\n}\n\nconst ConfigLabel = styled.label`\n    margin: 5px 0;\n\n    text-transform: uppercase;\n    font-size: ${p => p.theme.textSize};\n    opacity: ${p => p.theme.lowlightTextOpacity};\n`;\n\nconst MatcherConfigContainer = styled.div`\n    display: flex;\n    flex-direction: column;\n`;\n\n@observer\nclass WsMethodMatcherConfig extends MatcherConfig<WebSocketMethodMatcher> {\n\n    private fieldId = _.uniqueId();\n\n    @observable\n    private method: Method = Method.GET;\n\n    componentDidMount() {\n        disposeOnUnmount(this, autorun(() => {\n            const method = this.props.matcher?.method ?? Method.GET;\n            runInAction(() => { this.method = method });\n        }));\n\n        // The matcher is valid by default, so immediately announce that (making the\n        // add button enabled) if this is a new matcher that we're adding:\n        if (!this.props.matcher) {\n            this.props.onChange(new WebSocketMethodMatcher(this.method));\n        }\n    }\n\n    render() {\n        const { method } = this;\n        const { matcherIndex } = this.props;\n\n        const methodName = Method[method];\n\n        // Extract the real numeric enum values from the TS enum:\n        const methodValues = Object.values(Method).filter(n => !isNaN(Number(n))) as Method[];\n\n        return <MatcherConfigContainer title={\n            methodName\n                ? `Matches all ${\n                    methodName\n                } requests`\n                : undefined\n        }>\n            { matcherIndex !== undefined &&\n                <ConfigLabel htmlFor={this.fieldId}>\n                    { matcherIndex !== 0 && 'and ' } with method\n                </ConfigLabel>\n            }\n            <Select\n                id={this.fieldId}\n                value={method}\n                onChange={this.onChange}\n            >\n                { methodValues.map((method) =>\n                    <option value={method} key={method}>\n                        { Method[method] }\n                    </option>\n                )}\n            </Select>\n        </MatcherConfigContainer>;\n    }\n\n    @action.bound\n    onChange(event: React.ChangeEvent<HTMLSelectElement>) {\n        this.method = parseInt(event.currentTarget.value, 10);\n        this.props.onChange(new WebSocketMethodMatcher(this.method));\n    }\n}\n\n@observer\nclass EthereumMethodMatcherConfig extends React.Component<{\n    matcher?: EthereumMethodMatcher;\n    matcherIndex: number | undefined,\n    onChange: (matcher: InitialMatcher) => void;\n}> {\n\n    private fieldId = _.uniqueId();\n\n    @observable\n    private method: EthereumMethod = 'eth_call';\n\n    componentDidMount() {\n        disposeOnUnmount(this, autorun(() => {\n            const method = this.props.matcher?.methodName ?? 'eth_call';\n            runInAction(() => { this.method = method });\n        }));\n\n        // The matcher is valid by default, so immediately announce that (making the\n        // add button enabled) if this is a new matcher that we're adding:\n        if (!this.props.matcher) {\n            this.props.onChange(new EthereumMethodMatcher(this.method));\n        }\n    }\n\n    render() {\n        const { method } = this;\n\n        return <MatcherConfigContainer title={\n            `Match ${\n                method\n            } requests to Ethereum nodes`\n        }>\n            <ConfigLabel htmlFor={this.fieldId}>\n                Requesting a node to\n            </ConfigLabel>\n            <Select\n                id={this.fieldId}\n                value={method}\n                onChange={this.onChange}\n            >\n                { (Object.keys(EthereumMethods) as EthereumMethod[]).map((method) =>\n                    <option value={method} key={method}>\n                        { EthereumMethods[method] }\n                    </option>\n                )}\n            </Select>\n        </MatcherConfigContainer>;\n    }\n\n    @action.bound\n    onChange(event: React.ChangeEvent<HTMLSelectElement>) {\n        this.method = event.currentTarget.value as EthereumMethod;\n        this.props.onChange(new EthereumMethodMatcher(this.method));\n    }\n}\n\n@observer\nclass IpfsInteractionMatcherConfig extends React.Component<{\n    matcher?: IpfsInteractionMatcher;\n    matcherIndex: number | undefined,\n    onChange: (matcher: InitialMatcher) => void;\n}> {\n\n    private fieldId = _.uniqueId();\n\n    @observable\n    private interaction: IpfsInteraction = 'cat';\n\n    componentDidMount() {\n        disposeOnUnmount(this, autorun(() => {\n            const interaction = this.props.matcher?.interactionName ?? 'cat';\n            runInAction(() => { this.interaction = interaction });\n        }));\n\n        // The matcher is valid by default, so immediately announce that (making the\n        // add button enabled) if this is a new matcher that we're adding:\n        if (!this.props.matcher) {\n            this.props.onChange(new IpfsInteractionMatcher(this.interaction));\n        }\n    }\n\n    render() {\n        const { interaction } = this;\n\n        return <MatcherConfigContainer title={\n            `Match ${\n                interaction\n            } IPFS interactions`\n        }>\n            <ConfigLabel htmlFor={this.fieldId}>\n                Requesting an IPFS node to\n            </ConfigLabel>\n            <Select\n                id={this.fieldId}\n                value={interaction}\n                onChange={this.onChange}\n            >\n                { (Object.keys(IpfsInteractions) as IpfsInteraction[]).map((interaction) =>\n                    <option value={interaction} key={interaction}>\n                        { IpfsInteractions[interaction] }\n                    </option>\n                )}\n            </Select>\n        </MatcherConfigContainer>;\n    }\n\n    @action.bound\n    onChange(event: React.ChangeEvent<HTMLSelectElement>) {\n        this.interaction = event.currentTarget.value as IpfsInteraction;\n        this.props.onChange(new IpfsInteractionMatcher(this.interaction));\n    }\n}\n\n@observer\nclass HostMatcherConfig extends MatcherConfig<matchers.HostMatcher> {\n\n    private fieldId = _.uniqueId();\n\n    @observable\n    private error: Error | undefined;\n\n    @observable\n    private host = '';\n\n    componentDidMount() {\n        disposeOnUnmount(this, autorun(() => {\n            const host = this.props.matcher ? this.props.matcher.host : '';\n            runInAction(() => { this.host = host });\n        }));\n    }\n\n    render() {\n        const { host } = this;\n        const { matcherIndex } = this.props;\n\n        return <MatcherConfigContainer title={\n            host\n                ? `Matches all requests to ${\n                    host\n                }, regardless of their path or protocol`\n                : undefined\n        }>\n            { matcherIndex !== undefined &&\n                <ConfigLabel htmlFor={this.fieldId}>\n                    { matcherIndex !== 0 && 'and ' } for host\n                </ConfigLabel>\n            }\n            <TextInput\n                id={this.fieldId}\n                invalid={!!this.error}\n                spellCheck={false}\n                value={host}\n                onChange={this.onChange}\n                placeholder='A specific host to match: example.com'\n            />\n        </MatcherConfigContainer>;\n    }\n\n    @action.bound\n    onChange(event: React.ChangeEvent<HTMLInputElement>) {\n        this.host = event.target.value;\n\n        try {\n            this.props.onChange(new matchers.HostMatcher(this.host));\n            this.error = undefined;\n            event.target.setCustomValidity('');\n        } catch (e) {\n            console.log(e);\n\n            this.error = asError(e);\n            this.props.onInvalidState();\n            event.target.setCustomValidity(this.error.message);\n        }\n        event.target.reportValidity();\n    }\n}\n\n@observer\nclass SimplePathMatcherConfig extends MatcherConfig<matchers.SimplePathMatcher> {\n\n    private fieldId = _.uniqueId();\n\n    @observable\n    private error: Error | undefined;\n\n    @observable\n    private url = '';\n\n    componentDidMount() {\n        // Avoid overriding state for new matchers, this lets us allow ? in the\n        // string initially, and delay splitting into two matchers until later.\n        if (this.props.matcherIndex === undefined) return;\n\n        disposeOnUnmount(this, autorun(() => {\n            const url = this.props.matcher ? this.props.matcher.path : '';\n\n            runInAction(() => { this.url = url });\n        }));\n    }\n\n    render() {\n        const { url } = this;\n        const { matcherIndex } = this.props;\n\n        const urlMatch = (/(\\w+:\\/\\/)?([^/?#]+)?(\\/[^?#]*)?/.exec(url) || []);\n        const [fullMatch, protocol, host, path] = urlMatch;\n\n        return <MatcherConfigContainer title={\n            (host || path)\n                ? `Matches ${\n                    protocol ? protocol.slice(0, -3) : 'any'\n                } requests to ${\n                    host ? `host ${host}` : 'any host'\n                } at ${\n                    path ? `path ${path}` : 'path /'\n                }`\n                : undefined\n        }>\n            { matcherIndex !== undefined &&\n                <ConfigLabel htmlFor={this.fieldId}>\n                    { matcherIndex !== 0 && 'and ' } for URL\n                </ConfigLabel>\n            }\n            <TextInput\n                id={this.fieldId}\n                invalid={!!this.error}\n                spellCheck={false}\n                value={url}\n                onChange={this.onChange}\n                placeholder='A specific URL to match: http://example.com/abc'\n            />\n        </MatcherConfigContainer>;\n    }\n\n    ensurePathIsValid() {\n        if (!this.url) throw new Error('The URL must not be empty');\n\n        // If you start a URL with a protocol, it must be fully parseable:\n        if (this.url.match(/\\w+:\\//)) {\n            new URL(this.url);\n        }\n\n        // We leave the rest of the parsing to the SimplePathMatcher itself\n    }\n\n    @action.bound\n    onChange(event: React.ChangeEvent<HTMLInputElement>) {\n        this.url = event.target.value.split('#')[0];\n\n        try {\n            this.ensurePathIsValid();\n\n            const [baseUrl, query] = this.url.split('?');\n\n            if (query === undefined) {\n                this.props.onChange(new matchers.SimplePathMatcher(baseUrl));\n            } else {\n                if (this.props.matcherIndex !== undefined) this.url = baseUrl;\n\n                this.props.onChange(\n                    new matchers.SimplePathMatcher(baseUrl),\n                    new matchers.ExactQueryMatcher('?' + query)\n                );\n            }\n            this.error = undefined;\n            event.target.setCustomValidity('');\n        } catch (e) {\n            console.log(e);\n\n            this.error = asError(e);\n            this.props.onInvalidState();\n            event.target.setCustomValidity(this.error.message);\n        }\n        event.target.reportValidity();\n    }\n}\n\nfunction unescapeRegexp(input: string): string {\n    return input.replace(/\\\\\\//g, '/');\n}\n\nconst RegexInput = styled(TextInput)`\n    font-family: ${p => p.theme.monoFontFamily};\n`;\n\n// A crazy (but fun) regex to spot literal ? characters in regular expression strings.\n// Has some false (crazy) negatives but should have no false positives. Example false negative: [\\]?]\n// This is a big silly - if it ever breaks, fall back to using regjsparser instead (spot codepoint 63)\nconst containsLiteralQuestionMark = /([^\\\\]|^)\\\\(\\?|u003F|x3F)|([^\\\\]|^)\\[[^\\]]*(\\?|u003F|x3F)/;\n\n@observer\nclass RegexPathMatcherConfig extends MatcherConfig<matchers.RegexPathMatcher> {\n\n    private fieldId = _.uniqueId();\n\n    @observable\n    private error: Error | undefined;\n\n    @observable\n    private pattern = '';\n\n    componentDidMount() {\n        disposeOnUnmount(this, autorun(() => {\n            const pattern = this.props.matcher\n                ? unescapeRegexp(this.props.matcher.regexSource)\n                : '';\n\n            runInAction(() => { this.pattern = pattern });\n        }));\n    }\n\n    render() {\n        const { matcherIndex } = this.props;\n\n        let examples: string[] = [];\n        let matchType: 'including' | 'that start with' | 'that end with' | 'like' = 'like';\n\n        if (!this.error && this.props.matcher) {\n            const { regexSource } = this.props.matcher;\n            const regex = new RegExp(regexSource);\n            const exp = new Randexp(regex);\n\n            exp.defaultRange.subtract(32, 47); // Symbols\n            exp.defaultRange.subtract(58, 64); // More symbols\n            exp.defaultRange.subtract(123, 126); // Yet more symbols\n\n            // For infinite ranges (.*), use up to 10 chars\n            exp.max = 10;\n\n            examples = _.uniq([exp.gen(), exp.gen(), exp.gen()])\n                .filter((example) => example.length && example.match(regex))\n                .sort();\n\n            matchType =\n                (regexSource.startsWith('^') && regexSource.endsWith('$'))\n                    ? 'like'\n                : regexSource.startsWith('^')\n                    ? 'that start with'\n                : regexSource.endsWith('$')\n                    ? 'that end with'\n                : 'including';\n        }\n\n        return <MatcherConfigContainer title={\n                examples.length === 0\n                    ? undefined\n                : examples.length === 1\n                    ? `Would match absolute URLs ${matchType} ${examples[0]}`\n                : `Would match absolute URLs ${matchType}:\\n\\n${examples.join('\\n')}`\n            }>\n            { matcherIndex !== undefined &&\n                <ConfigLabel htmlFor={this.fieldId}>\n                    { matcherIndex !== 0 && 'and ' } for URLs matching\n                </ConfigLabel>\n            }\n            <RegexInput\n                id={this.fieldId}\n                invalid={!!this.error}\n                spellCheck={false}\n                value={this.pattern}\n                onChange={this.onChange}\n                placeholder='Any regular expression: https?://abc.com/.*'\n            />\n        </MatcherConfigContainer>;\n    }\n\n    @action.bound\n    onChange(event: React.ChangeEvent<HTMLInputElement>) {\n        this.pattern = event.target.value;\n\n        try {\n            if (!this.pattern) throw new Error('A pattern to match is required');\n            if (this.pattern.match(containsLiteralQuestionMark)) {\n                throw new Error(\n                    'Query strings are matched separately, so a literal ? character will never match'\n                );\n            }\n            this.props.onChange(\n                new matchers.RegexPathMatcher(new RegExp(this.pattern))\n            );\n            this.error = undefined;\n            event.target.setCustomValidity('');\n        } catch (e) {\n            console.log(e);\n\n            this.error = asError(e);\n            this.props.onInvalidState();\n            event.target.setCustomValidity(this.error.message);\n        }\n        event.target.reportValidity();\n    }\n}\n\ntype QueryObject = { [key: string]: string | string[] };\n\nconst queryObjectToPairsArray = (query: QueryObject): PairsArray =>\n    _.flatMap(Object.entries(query), ([key, value]) => {\n        if (_.isArray(value)) {\n            return value.map((v) => ({ key, value: v }));\n        } else {\n            return { key, value };\n        }\n    });\n\nconst pairsArrayToQueryObject = (queryPairs: PairsArray): QueryObject =>\n    _.mapValues(\n        _.groupBy(queryPairs, ({ key }) => key),\n        (pairs) =>\n            pairs.length === 1\n            ? pairs[0].value // Work around a Mockttp bug: 1-element arrays don't match single values\n            : pairs.map(p => p.value)\n    );\n\n@observer\nclass QueryMatcherConfig extends MatcherConfig<matchers.QueryMatcher> {\n\n    render() {\n        const { matcherIndex, matcher } = this.props;\n\n        const queryParams = queryObjectToPairsArray(matcher?.queryObject || {});\n\n        return <MatcherConfigContainer>\n            { matcherIndex !== undefined &&\n                <ConfigLabel>\n                    { matcherIndex !== 0 && 'and ' } with query parameters including\n                </ConfigLabel>\n            }\n            <EditablePairs\n                pairs={queryParams}\n                convertResult={pairsArrayToQueryObject}\n                onChange={this.onChange}\n                keyPlaceholder='Query parameter name'\n                valuePlaceholder='Query parameter value'\n                allowEmptyValues={true}\n            />\n        </MatcherConfigContainer>;\n    }\n\n    @action.bound\n    onChange(queryParams: QueryObject) {\n        try {\n            if (Object.keys(queryParams).some(key => !key)) {\n                throw new Error(\"Invalid query parameter; query parameter names can't be empty\");\n            }\n\n            if (Object.keys(queryParams).length === 0) {\n                this.props.onChange();\n            } else {\n                this.props.onChange(new matchers.QueryMatcher(queryParams));\n            }\n        } catch (e) {\n            console.log(e);\n            this.props.onInvalidState();\n        }\n    }\n}\n\n@observer\nclass ExactQueryMatcherConfig extends MatcherConfig<matchers.ExactQueryMatcher> {\n\n    private fieldId = _.uniqueId();\n\n    @observable\n    private error: Error | undefined;\n\n    @observable\n    private query = '';\n\n    componentDidMount() {\n        disposeOnUnmount(this, autorun(() => {\n            const query = this.props.matcher ? this.props.matcher.query : '';\n\n            runInAction(() => { this.query = query });\n        }));\n    }\n\n    render() {\n        const { matcherIndex } = this.props;\n\n        return <MatcherConfigContainer>\n            { matcherIndex !== undefined &&\n                <ConfigLabel htmlFor={this.fieldId}>\n                    { matcherIndex !== 0 && 'and ' } with query\n                </ConfigLabel>\n            }\n            <TextInput\n                id={this.fieldId}\n                invalid={!!this.error}\n                spellCheck={false}\n                value={this.query}\n                onChange={this.onChange}\n                placeholder='An exact query string to match, e.g. ?a=b'\n            />\n        </MatcherConfigContainer>;\n    }\n\n    @action.bound\n    onChange(event: React.ChangeEvent<HTMLInputElement>) {\n        this.query = event.target.value;\n\n        try {\n            this.props.onChange(new matchers.ExactQueryMatcher(this.query));\n            this.error = undefined;\n            event.target.setCustomValidity('');\n        } catch (e) {\n            console.log(e);\n\n            this.error = asError(e);\n            this.props.onInvalidState();\n            event.target.setCustomValidity(this.error.message);\n        }\n        event.target.reportValidity();\n    }\n}\n\n@observer\nclass HeaderMatcherConfig extends MatcherConfig<matchers.HeaderMatcher> {\n\n    render() {\n        const { matcherIndex } = this.props;\n\n        const headers = this.props.matcher?.headers || {};\n\n        return <MatcherConfigContainer>\n            { matcherIndex !== undefined &&\n                <ConfigLabel>\n                    { matcherIndex !== 0 && 'and ' } with headers including\n                </ConfigLabel>\n            }\n            <EditableHeaders<FlatHeaders>\n                headers={headers}\n                convertToRawHeaders={this.convertInput}\n                convertFromRawHeaders={this.convertResult}\n                onChange={this.onChange}\n                onInvalidState={this.props.onInvalidState}\n            />\n        </MatcherConfigContainer>;\n    }\n\n    convertInput(input: FlatHeaders) {\n        return headersToRawHeaders(input);\n    }\n\n    convertResult(result: RawHeaders) {\n        return headersToFlatHeaders(rawHeadersToHeaders(result));\n    }\n\n    @action.bound\n    onChange(headers: FlatHeaders) {\n        if (Object.keys(headers).length === 0) {\n            this.props.onChange();\n        } else {\n            this.props.onChange(new matchers.HeaderMatcher(headers));\n        }\n    }\n}\n\nconst BodyContainer = styled.div<{ error?: boolean }>`\n    > div {\n        border-radius: 4px;\n        border: solid 1px ${p => p.theme.containerBorder};\n        padding: 1px;\n\n        ${p => p.error && css`\n            border-color: ${p => p.theme.warningColor};\n        `}\n    }\n`;\n\nclass RawBodyExactMatcherConfig extends MatcherConfig<matchers.RawBodyMatcher> {\n\n    render() {\n        return <RawBodyMatcherConfig\n            {...this.props}\n            matcherClass={matchers.RawBodyMatcher}\n            description='with a decoded body exactly matching'\n        />;\n    }\n\n}\n\nclass RawBodyIncludesMatcherConfig extends MatcherConfig<matchers.RawBodyIncludesMatcher> {\n\n    render() {\n        return <RawBodyMatcherConfig\n            {...this.props}\n            matcherClass={matchers.RawBodyIncludesMatcher}\n            description='with a decoded body including'\n        />;\n    }\n\n}\n\n@observer\nclass RawBodyMatcherConfig<\n    M extends (typeof matchers.RawBodyMatcher | typeof matchers.RawBodyIncludesMatcher)\n> extends MatcherConfig<InstanceType<M>, {\n    matcherClass: M,\n    description: string\n}> {\n\n    @observable\n    private content: string = '';\n\n    componentDidMount() {\n        disposeOnUnmount(this, autorun(() => {\n            const content = this.props.matcher ? this.props.matcher.content : '';\n            runInAction(() => { this.content = content });\n        }));\n\n        // Create the matcher immediately, so that this is already valid & addable,\n        // if that's what you want to do.\n        this.onBodyChange(this.content);\n    }\n\n    render() {\n        const { content } = this;\n        const { matcherIndex } = this.props;\n\n        return <MatcherConfigContainer>\n            { matcherIndex !== undefined &&\n                <ConfigLabel>\n                    { matcherIndex !== 0 && 'and ' } { this.props.description }\n                </ConfigLabel>\n            }\n            <BodyContainer>\n                <SelfSizedEditor\n                    contentId={null}\n                    value={content}\n                    onChange={this.onBodyChange}\n                    language='text'\n                />\n            </BodyContainer>\n        </MatcherConfigContainer>;\n    }\n\n    @action.bound\n    onBodyChange(content: string) {\n        this.content = content;\n        this.props.onChange(new this.props.matcherClass(content) as InstanceType<M>);\n    }\n}\n\nclass JsonBodyExactMatcherConfig extends MatcherConfig<matchers.JsonBodyMatcher> {\n\n    render() {\n        return <JsonMatcherConfig\n            {...this.props}\n            matcherClass={matchers.JsonBodyMatcher}\n            description='with a JSON body equivalent to'\n        />;\n    }\n\n}\n\nclass JsonBodyIncludingMatcherConfig extends MatcherConfig<matchers.JsonBodyFlexibleMatcher> {\n\n    render() {\n        return <JsonMatcherConfig\n            {...this.props}\n            matcherClass={matchers.JsonBodyFlexibleMatcher}\n            description='with a JSON body including'\n        />;\n    }\n\n}\n\n@observer\nclass JsonMatcherConfig<\n    M extends (typeof matchers.JsonBodyMatcher | typeof matchers.JsonBodyFlexibleMatcher)\n> extends MatcherConfig<InstanceType<M>, {\n    matcherClass: M,\n    description: string\n}> {\n\n    @observable\n    private content: string = this.props.matcher?.body\n        ? JSON.stringify(this.props.matcher?.body, null, 2)\n        : '{\\n    \\n}'; // Set up with a convenient open body initially\n\n    @observable\n    private error: Error | undefined;\n\n    componentDidMount() {\n        // When the matcher state changes (only that one direction) so that it's out of\n        // sync with the shown content, update the content here to match.\n        disposeOnUnmount(this, reaction(\n            () => this.props.matcher?.body ?? {},\n            (matcherContent) => {\n                const parsedContent = tryParseJson(this.content);\n\n                // If the matcher has changed and the content here either doesn't parse or\n                // doesn't match the matcher, we override the shown content:\n                if (parsedContent === undefined || !_.isEqual(parsedContent, matcherContent)) {\n                    runInAction(() => {\n                        this.content = JSON.stringify(matcherContent, null, 2);\n                    });\n                }\n            }\n        ));\n\n        // Create the matcher immediately, so that this is already valid & addable,\n        // if that's what you want to do.\n        this.onBodyChange(this.content);\n    }\n\n    render() {\n        const { content, error } = this;\n        const { matcherIndex } = this.props;\n\n        return <MatcherConfigContainer>\n            { matcherIndex !== undefined &&\n                <ConfigLabel>\n                    { matcherIndex !== 0 && 'and ' } { this.props.description }\n                </ConfigLabel>\n            }\n            <BodyContainer error={!!error}>\n                <SelfSizedEditor\n                    contentId={null}\n                    value={content}\n                    onChange={this.onBodyChange}\n                    language='json'\n                />\n            </BodyContainer>\n        </MatcherConfigContainer>;\n    }\n\n    @action.bound\n    onBodyChange(content: string) {\n        this.content = content;\n\n        try {\n            const parsedContent = JSON.parse(content);\n            this.props.onChange(new this.props.matcherClass(parsedContent) as InstanceType<M>);\n            this.error = undefined;\n        } catch (e) {\n            console.log(e);\n            this.error = asError(e);\n            this.props.onInvalidState();\n        }\n    }\n}\n\n@observer\nclass IpfsArgMatcherConfig extends MatcherConfig<IpfsArgMatcher> {\n\n    private fieldId = _.uniqueId();\n\n    @observable\n    private arg: string | undefined;\n\n    @computed get interaction(): IpfsInteraction {\n        return this.props.matcher?.interaction || 'cat';\n    }\n\n    componentDidMount() {\n        disposeOnUnmount(this, autorun(() => {\n            const arg = this.props.matcher?.argValue || undefined;\n            runInAction(() => { this.arg = arg });\n        }));\n    }\n\n    render() {\n        const { matcherIndex } = this.props;\n\n        const { placeholder, argType } = IpfsArgDescription[this.interaction]\n            ?? { placeholder: '', argType: 'IPFS argument' };\n\n        return <MatcherConfigContainer>\n            { matcherIndex !== undefined &&\n                <ConfigLabel htmlFor={this.fieldId}>\n                    { matcherIndex !== 0 && 'and ' } for { argType }\n                </ConfigLabel>\n            }\n            <TextInput\n                id={this.fieldId}\n                spellCheck={false}\n                value={this.arg || ''}\n                onChange={this.onChange}\n                placeholder={placeholder}\n            />\n        </MatcherConfigContainer>;\n    }\n\n    @action.bound\n    onChange(event: React.ChangeEvent<HTMLInputElement>) {\n        this.arg = event.target.value;\n        this.props.onChange(new IpfsArgMatcher(this.interaction, this.arg));\n    }\n}\n\n@observer\nclass EthParamsMatcherConfig extends MatcherConfig<EthereumParamsMatcher> {\n\n    @observable\n    private content: string = this.props.matcher?.params\n        ? JSON.stringify(this.props.matcher?.params, null, 2)\n        : '[\\n    \\n]'; // Set up with a convenient open array body initially\n\n    @observable\n    private error: Error | undefined;\n\n    componentDidMount() {\n        // When the matcher state changes (only that one direction) so that it's out of\n        // sync with the shown content, update the content here to match.\n        disposeOnUnmount(this, reaction(\n            () => this.props.matcher?.params ?? {},\n            (matcherContent) => {\n                const parsedContent = tryParseJson(this.content);\n\n                // If the matcher has changed and the content here either doesn't parse or\n                // doesn't match the matcher, we override the shown content:\n                if (parsedContent === undefined || !_.isEqual(parsedContent, matcherContent)) {\n                    runInAction(() => {\n                        this.content = JSON.stringify(matcherContent, null, 2);\n                    });\n                }\n            }\n        ));\n\n        // Create the matcher immediately, so that this is already valid & addable,\n        // if that's what you want to do.\n        this.onJsonChange(this.content);\n    }\n\n    render() {\n        const { content, error } = this;\n        const { matcherIndex } = this.props;\n\n        return <MatcherConfigContainer>\n            { matcherIndex !== undefined &&\n                <ConfigLabel>\n                    { matcherIndex !== 0 && 'and ' } with Ethereum parameters matching\n                </ConfigLabel>\n            }\n            <BodyContainer error={!!error}>\n                <SelfSizedEditor\n                    contentId={null}\n                    value={content}\n                    onChange={this.onJsonChange}\n                    language='json'\n                />\n            </BodyContainer>\n        </MatcherConfigContainer>;\n    }\n\n    @action.bound\n    onJsonChange(content: string) {\n        this.content = content;\n\n        try {\n            const parsedContent = JSON.parse(content);\n            this.props.onChange(new EthereumParamsMatcher(parsedContent));\n            this.error = undefined;\n        } catch (e) {\n            console.log(e);\n            this.error = asError(e);\n            this.props.onInvalidState();\n        }\n    }\n}\n\n@observer\nclass RTCContentMatcherConfig<T extends\n    | typeof HasDataChannelMatcherDefinition\n    | typeof HasVideoTrackMatcherDefinition\n    | typeof HasAudioTrackMatcherDefinition\n    | typeof HasMediaTrackMatcherDefinition\n> extends MatcherConfig<InstanceType<T>, { matcherClass?: T, matcherKey: InstanceType<T>['type'] }> {\n\n    componentDidMount() {\n        disposeOnUnmount(this, autorun(() => {\n            const { matcher, matcherClass, onChange } = this.props;\n\n            // Instantiate the matcher as-is, showing nothing.\n            if (!matcher && matcherClass) onChange(new matcherClass() as InstanceType<T>);\n        }));\n    }\n\n    render() {\n        const { matcherIndex, matcherKey } = this.props;\n\n        return <MatcherConfigContainer>\n            { matcherIndex !== undefined &&\n                <ConfigLabel>\n                    { matcherIndex !== 0 && 'and ' } {\n                        summarizeMatcherClass(matcherKey)\n                    }\n                </ConfigLabel>\n            }\n        </MatcherConfigContainer>;\n    }\n}","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { observer } from 'mobx-react';\nimport { action, observable } from 'mobx';\n\nimport { styled } from '../../styles';\nimport { Icon } from '../../icons';\nimport { Button, Select } from '../common/inputs';\n\nimport {\n    Matcher,\n    MatcherClass,\n    MatcherClassKeyLookup,\n    MatcherLookup,\n    MatcherClassKey,\n    InitialMatcher,\n    InitialMatcherClass,\n    getInitialMatchers,\n    getRuleTypeFromInitialMatcher\n} from '../../model/rules/rules';\nimport {\n    summarizeMatcherClass\n} from '../../model/rules/rule-descriptions';\n\nimport {\n    InitialMatcherConfiguration,\n    AdditionalMatcherConfiguration\n} from './matcher-config';\n\nconst getMatcherKey = (m: MatcherClass | Matcher | undefined) =>\n    MatcherClassKeyLookup.get(m as any) || MatcherClassKeyLookup.get(m?.constructor as any);\n\nconst getMatcherClassByKey = (k: MatcherClassKey) => MatcherLookup[k];\n\nconst MatcherRow = styled.li`\n    display: flex;\n    flex-direction: row;\n    margin: 5px 0;\n\n    &:first-child {\n        margin-top: 0;\n    }\n\n    &:last-child {\n        margin-bottom: 0;\n    }\n`;\n\nconst MatcherInputsContainer = styled.div`\n    flex-grow: 1;\n    flex-shrink: 1;\n    width: 0; /* Required to keep body editors resizing properly */\n`;\n\nconst MatcherButton = styled(Button)`\n    font-size: ${p => p.theme.textSize};\n    padding: 6px 10px;\n    display: inline-block;\n    margin-left: 5px;\n\n    flex-grow: 0;\n    flex-shrink: 0;\n`;\n\nconst InitialMatcherConfigContainer = styled.div`\n    &:not(:empty) {\n        margin-top: 5px;\n    }\n`\n\nexport const InitialMatcherRow = React.forwardRef((p: {\n    matcher?: InitialMatcher,\n    onChange: (m: InitialMatcher) => void\n}, ref: React.Ref<HTMLSelectElement>) => {\n    const availableInitialMatchers = getInitialMatchers();\n\n    const [httpMatchers, otherMatchers] = _.partition(availableInitialMatchers, m =>\n        getRuleTypeFromInitialMatcher(getMatcherKey(m)!) === 'http'\n    );\n\n    return <MatcherRow>\n        <MatcherInputsContainer>\n            <Select\n                ref={ref}\n                value={getMatcherKey(p.matcher)}\n                onChange={(event) => {\n                    const value = event.currentTarget.value as MatcherClassKey | undefined;\n                    if (value) {\n                        const MatcherCls = getMatcherClassByKey(value) as InitialMatcherClass;\n                        p.onChange(new MatcherCls());\n                    }\n                }}\n            >\n                { p.matcher === undefined &&\n                    <option value={''}>\n                        Never\n                    </option>\n                }\n\n                <MatcherOptions matchers={httpMatchers} />\n\n                { otherMatchers.length > 0 &&\n                    <optgroup label='Experimental'>\n                        <MatcherOptions matchers={otherMatchers} />\n                    </optgroup>\n                }\n            </Select>\n\n            <InitialMatcherConfigContainer>\n                <InitialMatcherConfiguration\n                    matcher={p.matcher}\n                    onChange={p.onChange}\n                />\n            </InitialMatcherConfigContainer>\n        </MatcherInputsContainer>\n    </MatcherRow>\n});\n\ninterface ExistingMatcherRowProps {\n    matcher: Matcher;\n    matcherIndex: number;\n    onDelete: () => void;\n    onChange: (m: Matcher, ...ms: Matcher[]) => void;\n}\n\n@observer\nexport class ExistingMatcherRow extends React.Component<ExistingMatcherRowProps> {\n    render() {\n        const { matcher, onChange, onDelete, matcherIndex } = this.props;\n\n        return <MatcherRow>\n            <MatcherInputsContainer>\n                <AdditionalMatcherConfiguration\n                    matcherIndex={matcherIndex}\n                    matcher={matcher}\n                    onChange={onChange}\n                />\n            </MatcherInputsContainer>\n\n            <MatcherButton onClick={onDelete}>\n                <Icon icon={['far', 'trash-alt']} />\n            </MatcherButton>\n        </MatcherRow>;\n    }\n}\n\n\nconst MatcherOptions = (p: { matchers: Array<MatcherClass> }) => <>{\n    p.matchers.map((matcher): JSX.Element | null => {\n        const key = getMatcherKey(matcher)!;\n        const description = summarizeMatcherClass(key);\n\n        return <option key={key} value={key}>\n            { description }\n        </option>;\n    })\n}</>\n\nconst NewMatcherConfigContainer = styled.form`\n    :not(:empty) {\n        margin-top: 5px;\n    }\n`;\n\nconst LowlightedOption = styled.option`\n    color: ${p => p.theme.containerWatermark};\n`;\n\n@observer\nexport class NewMatcherRow extends React.Component<{\n    onAdd: (matcher: Matcher) => void,\n    availableMatchers: MatcherClass[],\n    existingMatchers: Matcher[]\n}> {\n\n    @observable\n    matcherClass: MatcherClass | undefined;\n\n    @observable\n    draftMatchers: Array<Matcher> = [];\n\n    @observable\n    invalidMatcherState = false;\n\n    private dropdownRef = React.createRef<HTMLSelectElement>();\n\n    @action.bound\n    selectMatcher(event: React.ChangeEvent<HTMLSelectElement>) {\n        const matcherKey = event.target.value as MatcherClassKey;\n        this.matcherClass = MatcherLookup[matcherKey];\n\n        // Clear the existing matchers:\n        this.updateDraftMatcher();\n    }\n\n    @action.bound\n    updateDraftMatcher(...matchers: Matcher[]) {\n        this.draftMatchers = matchers;\n        this.invalidMatcherState = false;\n    }\n\n    @action.bound\n    markMatcherInvalid() {\n        this.invalidMatcherState = true;\n    }\n\n    @action.bound\n    saveMatcher(e?: React.FormEvent) {\n        if (e) e.preventDefault();\n\n        if (!this.draftMatchers.length) return;\n        this.draftMatchers.forEach(m => this.props.onAdd(m));\n\n        this.matcherClass = undefined;\n        this.draftMatchers = [];\n        this.invalidMatcherState = false;\n\n        // Reset the focus ready to add another element\n        const dropdown = this.dropdownRef.current;\n        if (dropdown) dropdown.focus();\n    }\n\n    render() {\n        const { availableMatchers } = this.props;\n\n        const {\n            matcherClass,\n            draftMatchers,\n            updateDraftMatcher,\n            invalidMatcherState,\n            markMatcherInvalid,\n            saveMatcher\n        } = this;\n\n        return <MatcherRow>\n            <MatcherInputsContainer>\n                <Select\n                    onChange={this.selectMatcher}\n                    value={getMatcherKey(matcherClass) ?? ''}\n                    ref={this.dropdownRef}\n                >\n                    <LowlightedOption value={''}>Add another matcher:</LowlightedOption>\n                    <LowlightedOption disabled>─────────────</LowlightedOption>\n                    <MatcherOptions matchers={availableMatchers} />\n                </Select>\n\n                <NewMatcherConfigContainer onSubmit={\n                    !invalidMatcherState && draftMatchers.length\n                        ? saveMatcher\n                        : (e) => e.preventDefault()\n                }>\n                    { draftMatchers.length >= 1\n                        ? <AdditionalMatcherConfiguration\n                            matcherIndex={undefined}\n                            matcher={draftMatchers[0]}\n                            onChange={updateDraftMatcher}\n                            onInvalidState={markMatcherInvalid}\n                        />\n                        : <AdditionalMatcherConfiguration\n                            matcherIndex={undefined}\n                            matcherClass={matcherClass}\n                            onChange={updateDraftMatcher}\n                            onInvalidState={markMatcherInvalid}\n                        />\n                    }\n                </NewMatcherConfigContainer>\n            </MatcherInputsContainer>\n\n            <MatcherButton\n                disabled={!draftMatchers.length || invalidMatcherState}\n                onClick={saveMatcher}\n            >\n                <Icon icon={['fas', 'plus']} />\n            </MatcherButton>\n        </MatcherRow>;\n    }\n}","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { inject, observer } from 'mobx-react';\n\nimport { styled } from '../../styles';\nimport { UnreachableCheck } from '../../util/error';\n\nimport { RulesStore } from '../../model/rules/rules-store';\nimport { AccountStore } from '../../model/account/account-store';\nimport {\n    HandlerClass,\n    Handler,\n    AvailableHandlerKey,\n    HandlerClassKeyLookup,\n    isPaidHandlerClass,\n    RuleType,\n} from '../../model/rules/rules';\nimport { summarizeHandlerClass } from '../../model/rules/rule-descriptions';\nimport {\n    StaticResponseHandler,\n    ForwardToHostHandler,\n    TransformingHandler,\n    RequestBreakpointHandler,\n    ResponseBreakpointHandler,\n    RequestAndResponseBreakpointHandler,\n    PassThroughHandler,\n    TimeoutHandler,\n    CloseConnectionHandler,\n    ResetConnectionHandler,\n    FromFileResponseHandler\n} from '../../model/rules/definitions/http-rule-definitions';\nimport {\n    WebSocketPassThroughHandler,\n    EchoWebSocketHandlerDefinition,\n    RejectWebSocketHandlerDefinition,\n    ListenWebSocketHandlerDefinition,\n    WebSocketForwardToHostHandler\n} from '../../model/rules/definitions/websocket-rule-definitions';\nimport {\n    EthereumCallResultHandler,\n    EthereumNumberResultHandler,\n    EthereumHashResultHandler,\n    EthereumReceiptResultHandler,\n    EthereumBlockResultHandler,\n    EthereumErrorHandler\n} from '../../model/rules/definitions/ethereum-rule-definitions';\nimport {\n    IpfsCatTextHandler,\n    IpfsCatFileHandler,\n    IpfsAddResultHandler,\n    IpnsResolveResultHandler,\n    IpnsPublishResultHandler,\n    IpfsPinsResultHandler,\n    IpfsPinLsResultHandler\n} from '../../model/rules/definitions/ipfs-rule-definitions';\nimport {\n    DynamicProxyStepDefinition,\n    EchoStepDefinition,\n    CloseStepDefinition,\n    WaitForMediaStepDefinition,\n    WaitForDurationStepDefinition,\n    WaitForChannelStepDefinition,\n    WaitForMessageStepDefinition,\n    CreateChannelStepDefinition,\n    SendStepDefinition\n} from '../../model/rules/definitions/rtc-rule-definitions';\n\nimport { Select } from '../common/inputs';\n\nconst getHandlerKey = (h: HandlerClass | Handler) =>\n    HandlerClassKeyLookup.get(h as any) || HandlerClassKeyLookup.get(h.constructor as any);\n\nconst HandlerOptions = (p: { handlers: Array<HandlerClass> }) => <>{\n    p.handlers.map((handler): JSX.Element | null => {\n        const key = getHandlerKey(handler)!;\n        const description = summarizeHandlerClass(key);\n\n        return <option key={key} value={key}>\n            { description }\n        </option>;\n    })\n}</>;\n\nconst HandlerSelect = styled(Select)`\n    &:not(:first-of-type) {\n        margin-top: 10px;\n    }\n`;\n\nconst instantiateHandler = (\n    handlerKey: AvailableHandlerKey,\n    rulesStore: RulesStore\n): Handler => {\n    switch (handlerKey) {\n        case 'simple':\n            return new StaticResponseHandler(200);\n        case 'file':\n            return new FromFileResponseHandler(200, undefined, '');\n        case 'passthrough':\n            return new PassThroughHandler(rulesStore);\n        case 'forward-to-host':\n            return new ForwardToHostHandler('', true, rulesStore);\n        case 'req-res-transformer':\n            return new TransformingHandler(rulesStore, {}, {});\n        case 'request-breakpoint':\n            return new RequestBreakpointHandler(rulesStore);\n        case 'response-breakpoint':\n            return new ResponseBreakpointHandler(rulesStore);\n        case 'request-and-response-breakpoint':\n            return new RequestAndResponseBreakpointHandler(rulesStore);\n        case 'timeout':\n            return new TimeoutHandler();\n        case 'close-connection':\n            return new CloseConnectionHandler();\n        case 'reset-connection':\n            return new ResetConnectionHandler();\n\n        case 'ws-passthrough':\n            return new WebSocketPassThroughHandler(rulesStore);\n        case 'ws-forward-to-host':\n            return new WebSocketForwardToHostHandler('', true, rulesStore);\n        case 'ws-echo':\n            return new EchoWebSocketHandlerDefinition();\n        case 'ws-reject':\n            return new RejectWebSocketHandlerDefinition(400);\n        case 'ws-listen':\n            return new ListenWebSocketHandlerDefinition();\n\n        case 'eth-call-result':\n            return new EthereumCallResultHandler([], []);\n        case 'eth-number-result':\n            return new EthereumNumberResultHandler(0);\n        case 'eth-hash-result':\n            return new EthereumHashResultHandler('0x0');\n        case 'eth-receipt-result':\n            return new EthereumReceiptResultHandler(undefined);\n        case 'eth-block-result':\n            return new EthereumBlockResultHandler(undefined);\n        case 'eth-error':\n            return new EthereumErrorHandler('Unknown Error');\n\n        case 'ipfs-cat-text':\n            return new IpfsCatTextHandler('');\n        case 'ipfs-cat-file':\n            return new IpfsCatFileHandler('');\n        case 'ipfs-add-result':\n            return new IpfsAddResultHandler();\n        case 'ipns-resolve-result':\n            return new IpnsResolveResultHandler();\n        case 'ipns-publish-result':\n            return new IpnsPublishResultHandler();\n        case 'ipfs-pins-result':\n            return new IpfsPinsResultHandler();\n        case 'ipfs-pin-ls-result':\n            return new IpfsPinLsResultHandler();\n\n        case 'rtc-dynamic-proxy':\n            return new DynamicProxyStepDefinition();\n        case 'echo-rtc':\n            return new EchoStepDefinition();\n        case 'close-rtc-connection':\n            return new CloseStepDefinition();\n        case 'wait-for-rtc-media':\n            return new WaitForMediaStepDefinition();\n        case 'wait-for-duration':\n            return new WaitForDurationStepDefinition(0);\n        case 'wait-for-rtc-data-channel':\n            return new WaitForChannelStepDefinition();\n        case 'wait-for-rtc-message':\n            return new WaitForMessageStepDefinition();\n        case 'create-rtc-data-channel':\n            return new CreateChannelStepDefinition('mock-channel');\n        case 'send-rtc-data-message':\n            return new SendStepDefinition(undefined, '');\n\n        default:\n            throw new UnreachableCheck(handlerKey);\n    }\n}\n\nexport const HandlerSelector = inject('rulesStore', 'accountStore')(observer((p: {\n    rulesStore?: RulesStore,\n    accountStore?: AccountStore,\n    ruleType: RuleType,\n    availableHandlers: Array<HandlerClass>,\n    value: Handler,\n    onChange: (handler: Handler) => void\n}) => {\n    let [ allowedHandlers, needProHandlers ] = _.partition(\n        p.availableHandlers,\n        (handlerClass) => p.accountStore!.isPaidUser || !isPaidHandlerClass(p.ruleType, handlerClass)\n    );\n\n    // Pull the breakpoint handlers to the top, since they're kind of separate\n    allowedHandlers = _.sortBy(allowedHandlers, h =>\n        getHandlerKey(h)!.includes('breakpoint') ? 0 : 1\n    );\n\n    return <HandlerSelect\n        value={getHandlerKey(p.value)}\n        onChange={(event) => {\n            const handlerKey = event.target.value as AvailableHandlerKey;\n            const handler = instantiateHandler(handlerKey, p.rulesStore!);\n            p.onChange(handler);\n        }}\n    >\n        <HandlerOptions handlers={allowedHandlers} />\n        { needProHandlers.length &&\n            <optgroup label='With HTTP Toolkit Pro:'>\n                <HandlerOptions handlers={needProHandlers} />\n            </optgroup>\n        }\n    </HandlerSelect>\n}));","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { action, observable, reaction, autorun, observe, runInAction, computed } from 'mobx';\nimport { observer, disposeOnUnmount, inject } from 'mobx-react';\nimport * as dedent from 'dedent';\n\nimport { Headers, RawHeaders } from '../../types';\nimport { css, styled } from '../../styles';\nimport { WarningIcon } from '../../icons';\nimport { uploadFile } from '../../util/ui';\nimport { asError, isErrorLike, unreachableCheck, UnreachableCheck } from '../../util/error';\nimport {\n    byteLength,\n    asBuffer,\n    isProbablyUtf8,\n    stringToBuffer,\n    bufferToString\n} from '../../util';\nimport {\n    getHeaderValue,\n    headersToRawHeaders,\n    rawHeadersToHeaders,\n    HEADER_NAME_REGEX,\n    setHeaderValue\n} from '../../util/headers';\n\nimport {\n    Handler,\n    RuleType,\n    getRulePartKey,\n    AvailableHandlerKey,\n    isHttpCompatibleType\n} from '../../model/rules/rules';\nimport {\n    StaticResponseHandler,\n    ForwardToHostHandler,\n    PassThroughHandler,\n    TransformingHandler,\n    RequestTransform,\n    ResponseTransform,\n    RequestBreakpointHandler,\n    ResponseBreakpointHandler,\n    RequestAndResponseBreakpointHandler,\n    TimeoutHandler,\n    CloseConnectionHandler,\n    ResetConnectionHandler,\n    FromFileResponseHandler\n} from '../../model/rules/definitions/http-rule-definitions';\nimport {\n    WebSocketPassThroughHandler,\n    EchoWebSocketHandlerDefinition,\n    RejectWebSocketHandlerDefinition,\n    ListenWebSocketHandlerDefinition,\n    WebSocketForwardToHostHandler\n} from '../../model/rules/definitions/websocket-rule-definitions';\nimport {\n    EthereumCallResultHandler,\n    EthereumNumberResultHandler,\n    EthereumHashResultHandler,\n    EthereumReceiptResultHandler,\n    EthereumBlockResultHandler,\n    EthereumErrorHandler\n} from '../../model/rules/definitions/ethereum-rule-definitions';\nimport {\n    IpfsCatTextHandler,\n    IpfsCatFileHandler,\n    IpfsAddResultHandler,\n    IpnsResolveResultHandler,\n    IpnsPublishResultHandler,\n    IpfsPinsResultHandler,\n    IpfsPinLsResultHandler\n} from '../../model/rules/definitions/ipfs-rule-definitions';\nimport {\n    DynamicProxyStepDefinition,\n    EchoStepDefinition,\n    CloseStepDefinition,\n    WaitForMediaStepDefinition,\n    WaitForDurationStepDefinition,\n    WaitForChannelStepDefinition,\n    WaitForMessageStepDefinition,\n    CreateChannelStepDefinition,\n    SendStepDefinition\n} from '../../model/rules/definitions/rtc-rule-definitions';\n\nimport { getStatusMessage } from '../../model/http/http-docs';\nimport { MethodName, MethodNames } from '../../model/http/methods';\nimport { NATIVE_ETH_TYPES } from '../../model/rules/definitions/ethereum-abi';\nimport {\n    getDefaultMimeType,\n    EditableContentType,\n    getEditableContentType\n} from '../../model/events/content-types';\nimport { RulesStore } from '../../model/rules/rules-store';\n\nimport { SelfSizedEditor } from '../editor/base-editor';\nimport { TextInput, Select, Button } from '../common/inputs';\nimport { EditableHeaders, EditableRawHeaders } from '../common/editable-headers';\nimport { EditableStatus } from '../common/editable-status';\nimport { FormatButton } from '../common/format-button';\nimport { EditablePairs, PairsArray } from '../common/editable-pairs';\nimport { ContentMonoValue } from '../common/text-content';\n\ntype HandlerConfigProps<H extends Handler> = {\n    ruleType: RuleType;\n    handler: H;\n    onChange: (handler: H) => void;\n    onInvalidState: () => void;\n};\n\nabstract class HandlerConfig<\n    H extends Handler,\n    P extends {} = {}\n> extends React.Component<HandlerConfigProps<H> & P> { }\n\nconst ConfigContainer = styled.div`\n    margin-top: 10px;\n    font-size: ${p => p.theme.textSize};\n`;\n\nconst ConfigExplanation = styled.p`\n    font-size: ${p => p.theme.textSize};\n    line-height: 1.3;\n    opacity: ${p => p.theme.lowlightTextOpacity};\n    font-style: italic;\n    overflow-wrap: break-word;\n\n    &:not(:first-child) {\n        margin-top: 10px;\n    }\n`;\n\nexport function HandlerConfiguration(props: {\n    ruleType: RuleType,\n    handler: Handler,\n    onChange: (handler: Handler) => void,\n    onInvalidState?: () => void // Currently unused - intended to improve invalid entry UX later on\n}) {\n    const { handler, onChange, onInvalidState } = props;\n\n    const configProps = {\n        ruleType: props.ruleType,\n        handler: handler as any,\n        onChange,\n        onInvalidState: onInvalidState || _.noop\n    };\n\n    const handlerKey = getRulePartKey(handler) as AvailableHandlerKey;\n\n    switch (handlerKey) {\n        case 'simple':\n            return <StaticResponseHandlerConfig {...configProps} />;\n        case 'file':\n            return <FromFileResponseHandlerConfig {...configProps} />;\n        case 'forward-to-host':\n        case 'ws-forward-to-host':\n            return <ForwardToHostHandlerConfig\n                {...configProps}\n                handlerKey={handlerKey}\n            />;\n        case 'passthrough':\n        case 'ws-passthrough':\n            return <PassThroughHandlerConfig {...configProps} />;\n        case 'req-res-transformer':\n            return <TransformingHandlerConfig {...configProps} />;\n        case 'request-breakpoint':\n            return <RequestBreakpointHandlerConfig {...configProps} />;\n        case 'response-breakpoint':\n            return <ResponseBreakpointHandlerConfig {...configProps} />;\n        case 'request-and-response-breakpoint':\n            return <RequestAndResponseBreakpointHandlerConfig {...configProps} />;\n        case 'timeout':\n            return <TimeoutHandlerConfig {...configProps} />;\n        case 'close-connection':\n            return <CloseConnectionHandlerConfig {...configProps} />;\n        case 'reset-connection':\n            return <ResetConnectionHandlerConfig {...configProps} />;\n\n        case 'ws-echo':\n            return <WebSocketEchoHandlerConfig {...configProps} />;\n        case 'ws-reject':\n            return <StaticResponseHandlerConfig {...configProps} />;\n        case 'ws-listen':\n            return <WebSocketListenHandlerConfig {...configProps} />;\n        case 'eth-call-result':\n            return <EthCallResultHandlerConfig {...configProps} />;\n        case 'eth-number-result':\n            return <EthNumberResultHandlerConfig {...configProps} />;\n        case 'eth-hash-result':\n            return <EthHashResultHandlerConfig {...configProps} />;\n        case 'eth-receipt-result':\n            return <EthReceiptResultHandlerConfig {...configProps} />;\n        case 'eth-block-result':\n            return <EthBlockResultHandlerConfig {...configProps} />;\n        case 'eth-error':\n            return <EthErrorHandlerConfig {...configProps} />;\n        case 'ipfs-cat-text':\n            return <IpfsCatTextHandlerConfig {...configProps} />;\n        case 'ipfs-cat-file':\n            return <IpfsCatFileHandlerConfig {...configProps} />;\n        case 'ipfs-add-result':\n            return <IpfsAddResultHandlerConfig {...configProps} />;\n        case 'ipns-resolve-result':\n            return <IpnsResolveResultHandlerConfig {...configProps} />;\n        case 'ipns-publish-result':\n            return <IpnsPublishResultHandlerConfig {...configProps} />;\n        case 'ipfs-pins-result':\n            return <IpfsPinsResultHandlerConfig {...configProps} />;\n        case 'ipfs-pin-ls-result':\n            return <IpfsPinLsResultHandlerConfig {...configProps} />;\n\n        case 'rtc-dynamic-proxy':\n            return <PassThroughHandlerConfig {...configProps} />;\n        case 'echo-rtc':\n            return <RTCEchoHandlerConfig {...configProps} />;\n        case 'close-rtc-connection':\n            return <RTCCloseHandlerConfig {...configProps} />;\n        case 'wait-for-rtc-media':\n            return <RTCWaitForMediaConfig {...configProps} />;\n        case 'wait-for-duration':\n            return <RTCWaitForDurationConfig {...configProps} />;\n        case 'wait-for-rtc-data-channel':\n            return <RTCWaitForChannelConfig {...configProps} />;\n        case 'wait-for-rtc-message':\n            return <RTCWaitForDataMessaageConfig {...configProps} />;\n        case 'create-rtc-data-channel':\n            return <RTCCreateChannelStepConfig {...configProps} />;\n        case 'send-rtc-data-message':\n            return <RTCSendMessageStepConfig {...configProps} />;\n\n        default:\n            throw new UnreachableCheck(handlerKey);\n    }\n}\n\nconst SectionLabel = styled.h2`\n    margin-bottom: 5px;\n    &:not(:first-child) {\n        margin-top: 10px;\n    }\n\n    text-transform: uppercase;\n    opacity: ${p => p.theme.lowlightTextOpacity};\n    width: 100%;\n`;\n\nconst ConfigSelect = styled(Select)`\n    font-size: ${p => p.theme.textSize};\n    width: auto;\n`;\n\nconst WideTextInput = styled(TextInput)`\n    width: 100%;\n    box-sizing: border-box;\n`;\n\nconst BodyHeader = styled.div`\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n\n    margin: 5px 0;\n\n    > ${SectionLabel} {\n        align-self: flex-end;\n        flex-grow: 1;\n        margin-bottom: 0;\n        margin: 0;\n    }\n\n    > button {\n        padding-top: 0;\n        padding-bottom: 0;\n    }\n`;\n\nconst BodyContainer = styled.div`\n    margin-top: 5px;\n\n    > div {\n        margin-top: 5px;\n        border-radius: 4px;\n        border: solid 1px ${p => p.theme.containerBorder};\n        padding: 1px;\n    }\n`;\n\n@observer\nclass StaticResponseHandlerConfig extends HandlerConfig<StaticResponseHandler | RejectWebSocketHandlerDefinition> {\n\n    @observable\n    statusCode: number | undefined = (this.props.handler instanceof StaticResponseHandler)\n        ? this.props.handler.status\n        : this.props.handler.statusCode;\n\n    @observable\n    statusMessage = this.props.handler.statusMessage;\n\n    // We have to model raw header data here (even though handlers use header objects) because want to mutate\n    // the headers (e.g. appending content-type) without losing object-unrepresentable (e.g. dupe key order) UI state.\n    @observable\n    rawHeaders = headersToRawHeaders(this.props.handler.headers || {});\n\n    @computed\n    get headers(): Headers {\n        return rawHeadersToHeaders(this.rawHeaders);\n    }\n    set headers(headers: Headers | undefined) {\n        if (_.isEqual(headers, this.headers)) return;\n        if (headers === undefined && Object.keys(this.headers).length === 0) return;\n        this.rawHeaders = headersToRawHeaders(headers || {});\n    }\n\n    @observable\n    contentType: EditableContentType = 'text';\n\n    @observable\n    body = asBuffer(this.props.handler instanceof StaticResponseHandler\n        ? this.props.handler.data\n        : this.props.handler.body\n    );\n\n    componentDidMount() {\n        // If any of our data fields change, rebuild & update the handler\n        disposeOnUnmount(this, reaction(() => {\n            return JSON.stringify(_.pick(this, ['statusCode', 'statusMessage', 'headers', 'body']));\n        }, () => this.updateHandler()));\n\n        // If the handler changes (or when its set initially), update our data fields\n        disposeOnUnmount(this, autorun(() => {\n            const { status, statusMessage } = this.props.handler instanceof StaticResponseHandler\n                ? this.props.handler\n                : { ...this.props.handler, status: this.props.handler.statusCode };\n\n            runInAction(() => {\n                this.statusCode = status;\n                this.statusMessage = statusMessage;\n            });\n        }));\n        disposeOnUnmount(this, autorun(() => {\n            const { data } = this.props.handler instanceof StaticResponseHandler\n                ? this.props.handler\n                : { data: this.props.handler.body };\n\n            runInAction(() => {\n                this.body = asBuffer(data); // Usually returns data directly, since we set it as a buffer anyway\n            });\n        }));\n        disposeOnUnmount(this, autorun(() => {\n            const { headers } = this.props.handler;\n\n            runInAction(() => {\n                this.headers = headers;\n            });\n        }));\n\n        // If you enter a relevant content-type header, consider updating the editor content type:\n        disposeOnUnmount(this, autorun(() => {\n            const detectedContentType = getEditableContentType(getHeaderValue(this.rawHeaders, 'content-type'));\n            if (detectedContentType) runInAction(() => {\n                this.contentType = detectedContentType;\n            });\n            // If not a known type, we leave the content type as whatever it currently is\n        }));\n\n        // If you set the editor content type, keep the content-type header up to date\n        disposeOnUnmount(this, observe(this, 'contentType', ({\n            oldValue: previousContentType,\n            newValue: newContentType\n        }) => {\n            const contentTypeHeader = getHeaderValue(this.rawHeaders, 'content-type');\n            const expectedContentType = getDefaultMimeType(newContentType);\n\n            if (!contentTypeHeader) {\n                // If you pick a body content type with no header set, we add one\n                runInAction(() => {\n                    this.rawHeaders.push(['content-type', expectedContentType]);\n                });\n            } else {\n                const headerContentType = getEditableContentType(contentTypeHeader);\n\n                // If the body type changes, and the old header matched the old type, update the header\n                if (previousContentType === headerContentType) {\n                    runInAction(() => {\n                        setHeaderValue(this.rawHeaders, 'content-type', expectedContentType);\n                    });\n                }\n                // If there is a header, but it didn't match the body, leave it as-is\n            }\n        }));\n\n        // If you change the body, and the content length _was_ correct, keep it up to date\n        disposeOnUnmount(this, observe(this, 'body', ({\n            oldValue: previousBody,\n            newValue: newBody\n        }) => {\n            const lengthHeader = getHeaderValue(this.rawHeaders, 'content-length');\n\n            if (!lengthHeader) return;\n\n            if (parseInt(lengthHeader || '', 10) === byteLength(previousBody)) {\n                runInAction(() => {\n                    // If the content-length was previously correct, keep it correct:\n                    runInAction(() => {\n                        setHeaderValue(this.rawHeaders, 'content-length', byteLength(newBody).toString());\n                    });\n                });\n            }\n        }));\n    }\n\n    @computed\n    private get textEncoding() {\n        // If we're handling text data, we want to show & edit it as UTF8.\n        // If it's binary, that's a lossy operation, so we use binary (latin1) instead.\n        return isProbablyUtf8(this.body)\n            ? 'utf8'\n            : 'binary';\n    }\n\n    render() {\n        const { statusCode, statusMessage, rawHeaders, body } = this;\n\n        const bodyAsString = body.toString(this.textEncoding);\n\n        return <ConfigContainer>\n            <SectionLabel>Status</SectionLabel>\n            <EditableStatus\n                httpVersion={1}\n                statusCode={statusCode}\n                statusMessage={statusMessage}\n                onChange={this.setStatus}\n            />\n\n            <SectionLabel>Headers</SectionLabel>\n            <EditableRawHeaders\n                headers={rawHeaders}\n                onChange={this.onHeadersChanged}\n            />\n\n            <BodyHeader>\n                <SectionLabel>Response body</SectionLabel>\n                <FormatButton\n                    format={this.contentType}\n                    content={body}\n                    onFormatted={this.setBody}\n                />\n                <ConfigSelect value={this.contentType} onChange={this.setContentType}>\n                    <option value=\"text\">Plain text</option>\n                    <option value=\"json\">JSON</option>\n                    <option value=\"xml\">XML</option>\n                    <option value=\"html\">HTML</option>\n                    <option value=\"css\">CSS</option>\n                    <option value=\"javascript\">JavaScript</option>\n                </ConfigSelect>\n            </BodyHeader>\n            <BodyContainer>\n                <SelfSizedEditor\n                    contentId={null}\n                    language={this.contentType}\n                    value={bodyAsString}\n                    onChange={this.setBody}\n                />\n            </BodyContainer>\n        </ConfigContainer>;\n    }\n\n    @action.bound\n    setStatus(statusCode: number | undefined, statusMessage: string | undefined) {\n        this.statusCode = statusCode;\n        this.statusMessage = statusMessage;\n    }\n\n    @action.bound\n    onHeadersChanged(rawHeaders: RawHeaders) {\n        this.rawHeaders = rawHeaders;\n    }\n\n    @action.bound\n    setContentType(event: React.ChangeEvent<HTMLSelectElement>) {\n        const value = event.target.value;\n        this.contentType = value as EditableContentType;\n    }\n\n    @action.bound\n    setBody(body: string) {\n        this.body = stringToBuffer(body, this.textEncoding);\n    }\n\n    updateHandler() {\n        if (\n            !this.statusCode ||\n            this.statusCode < 100 ||\n            this.statusCode >= 1000 ||\n            this.rawHeaders.some(([key]) => !key.match(HEADER_NAME_REGEX)) ||\n            this.rawHeaders.some(([_, value]) => !value)\n        ) return this.props.onInvalidState();\n\n        this.props.onChange(\n            this.props.ruleType === 'http'\n            ? new StaticResponseHandler(\n                this.statusCode,\n                this.statusMessage,\n                this.body,\n                this.headers\n            )\n            : new RejectWebSocketHandlerDefinition(\n                this.statusCode,\n                this.statusMessage ?? getStatusMessage(this.statusCode),\n                this.headers,\n                this.body\n            )\n        );\n    }\n}\n\nconst BodyFileContainer = styled.div`\n    margin-top: 1px;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n`;\n\nconst BodyFileButton = styled(Button)`\n    font-size: ${p => p.theme.textSize};\n    padding: 10px 24px;\n\n    flex-grow: 1;\n    white-space: nowrap;\n`;\n\nconst BodyFilePath = styled.div`\n    margin-left: 15px;\n    flex-shrink: 1;\n\n    font-family: ${p => p.theme.monoFontFamily};\n    word-break: break-word;\n`;\n\n@observer\nclass FromFileResponseHandlerConfig extends HandlerConfig<FromFileResponseHandler> {\n\n    @observable\n    statusCode: number | undefined = this.props.handler.status;\n\n    @observable\n    statusMessage = this.props.handler.statusMessage;\n\n    @observable\n    headers = this.props.handler.headers || {};\n\n    @observable\n    filePath = (this.props.handler.filePath || '').toString();\n\n    componentDidMount() {\n        // If any of our data fields change, rebuild & update the handler\n        disposeOnUnmount(this, reaction(() => (\n            JSON.stringify(_.pick(this, ['statusCode', 'statusMessage', 'headers', 'filePath']))\n        ), () => this.updateHandler()));\n\n        // If the handler changes (or when its set initially), update our data fields\n        disposeOnUnmount(this, autorun(() => {\n            const { status, statusMessage, headers, filePath } = this.props.handler;\n            runInAction(() => {\n                this.statusCode = status;\n                this.statusMessage = statusMessage;\n                this.headers = headers || {};\n                this.filePath = filePath;\n            });\n        }));\n    }\n\n    render() {\n        const { statusCode, statusMessage, headers } = this;\n\n        return <ConfigContainer>\n            <SectionLabel>Status</SectionLabel>\n            <EditableStatus\n                httpVersion={1}\n                statusCode={statusCode}\n                statusMessage={statusMessage}\n                onChange={this.setStatus}\n            />\n\n            <SectionLabel>Headers</SectionLabel>\n            <EditableHeaders\n                headers={headers}\n                convertToRawHeaders={headersToRawHeaders}\n                convertFromRawHeaders={rawHeadersToHeaders}\n                onChange={this.onHeadersChanged}\n            />\n\n            <SectionLabel>Response body</SectionLabel>\n            <BodyFileContainer>\n                <BodyFileButton onClick={this.selectFile}>\n                    { this.filePath\n                        ? 'Change file'\n                        : <>\n                            Select file <WarningIcon />\n                        </>\n                    }\n                </BodyFileButton>\n                { this.filePath && <BodyFilePath>\n                    { this.filePath }\n                </BodyFilePath> }\n            </BodyFileContainer>\n\n            <ConfigExplanation>\n                All matching requests will receive a { this.statusCode } response, with the response\n                body containing the contents of the selected file.\n            </ConfigExplanation>\n            <ConfigExplanation>\n                This file will be read fresh for each request, so future changes to the file will\n                immediately affect matching requests.\n            </ConfigExplanation>\n        </ConfigContainer>;\n    }\n\n    @action.bound\n    setStatus(statusCode: number | undefined, statusMessage: string | undefined) {\n        this.statusCode = statusCode;\n        this.statusMessage = statusMessage;\n    }\n\n    @action.bound\n    onHeadersChanged(headers: Headers) {\n        this.headers = headers;\n    }\n\n    selectFile = async () => {\n        const result = await uploadFile(\"path\", []);\n        if (result) {\n            runInAction(() => {\n                this.filePath = result;\n            });\n        }\n    }\n\n    updateHandler() {\n        if (\n            !this.statusCode ||\n            this.statusCode < 100 ||\n            this.statusCode >= 1000 ||\n            _.some(Object.keys(this.headers), (key) => !key.match(HEADER_NAME_REGEX))\n        ) return this.props.onInvalidState();\n\n        this.props.onChange(\n            new FromFileResponseHandler(\n                this.statusCode,\n                this.statusMessage,\n                this.filePath,\n                this.headers\n            )\n        );\n    }\n}\n\nconst UrlInput = styled(TextInput)`\n    margin-top: 5px;\n    width: 100%;\n    box-sizing: border-box;\n`;\n\n@inject('rulesStore')\n@observer\nclass ForwardToHostHandlerConfig extends HandlerConfig<\n    | ForwardToHostHandler\n    | WebSocketForwardToHostHandler,\n    {\n        rulesStore?: RulesStore,\n        handlerKey: 'forward-to-host' | 'ws-forward-to-host'\n    }\n> {\n\n    @observable\n    private error: Error | undefined;\n\n    @observable\n    private targetHost: string | undefined;\n\n    @observable\n    private updateHostHeader: true | false = true;\n\n    componentDidMount() {\n        disposeOnUnmount(this, autorun(() => {\n            const targetHost = this.props.handler ? this.props.handler.forwarding!.targetHost : '';\n            const updateHostHeader = this.props.handler ? this.props.handler.forwarding!.updateHostHeader : true;\n            runInAction(() => {\n                this.targetHost = targetHost\n                this.updateHostHeader = !!updateHostHeader;\n            });\n        }));\n    }\n\n    render() {\n        const {\n            targetHost,\n            updateHostHeader,\n            error,\n            onTargetChange,\n            onUpdateHeaderChange\n        } = this;\n        const { targetHost: savedTargetHost } = this.props.handler.forwarding!;\n\n        const messageType = this.props.handlerKey === 'ws-forward-to-host'\n            ? 'WebSocket'\n            : 'request';\n\n        return <ConfigContainer>\n            <SectionLabel>Replacement host</SectionLabel>\n            <UrlInput\n                value={targetHost || ''}\n                invalid={!!error}\n                spellCheck={false}\n                onChange={onTargetChange}\n            />\n\n            <SectionLabel>Host header</SectionLabel>\n            <ConfigSelect\n                value={updateHostHeader.toString()}\n                onChange={onUpdateHeaderChange}\n                title={dedent`\n                    Most servers will not accept ${messageType}s that arrive\n                    with the wrong host header, so it's typically useful\n                    to automatically change it to match the new host\n                `}\n            >\n                <option value={'true'}>Update the host header automatically (recommended)</option>\n                <option value={'false'}>Leave the host header untouched</option>\n            </ConfigSelect>\n            { savedTargetHost &&\n                <ConfigExplanation>\n                    All matching {messageType}s will be forwarded to {savedTargetHost},\n                    keeping their existing path{\n                        !savedTargetHost.includes('://') ? ', protocol,' : ''\n                    } and query string.{\n                        updateHostHeader\n                        ? ' Their host header will be automatically updated to match.'\n                        : ''\n                    }\n                </ConfigExplanation>\n            }\n        </ConfigContainer>;\n    }\n\n    updateHandler() {\n        try {\n            if (!this.targetHost) throw new Error('A target host is required');\n\n            let urlWithoutProtocol: string;\n\n            const protocolMatch = this.targetHost.match(/^(\\w+):\\/\\//);\n            if (protocolMatch) {\n                const validProtocols = this.props.handlerKey === 'ws-forward-to-host'\n                    ? ['ws', 'wss']\n                    : ['http', 'https'];\n\n                if (!validProtocols.includes(protocolMatch[1].toLowerCase())) {\n                    throw new Error(\n                        `The protocol must be either ${validProtocols[0]} or ${validProtocols[1]}`\n                    );\n                }\n\n                urlWithoutProtocol = this.targetHost.slice(protocolMatch[0].length);\n            } else {\n                urlWithoutProtocol = this.targetHost;\n            }\n\n            if (urlWithoutProtocol.includes('/')) {\n                throw new Error(\n                    'The replacement host shouldn\\'t include a path, since it won\\'t be used'\n                );\n            }\n            if (urlWithoutProtocol.includes('?')) {\n                throw new Error(\n                    'The replacement host shouldn\\'t include a query string, since it won\\'t be used'\n                );\n            }\n\n            const HandlerClass = this.props.handlerKey === 'ws-forward-to-host'\n                ? WebSocketForwardToHostHandler\n                : ForwardToHostHandler;\n\n            this.props.onChange(\n                new HandlerClass(\n                    this.targetHost,\n                    this.updateHostHeader,\n                    this.props.rulesStore!\n                )\n            );\n            this.error = undefined;\n        } catch (e) {\n            console.log(e);\n            this.error = asError(e);\n            if (this.props.onInvalidState) this.props.onInvalidState();\n            throw e;\n        }\n    }\n\n    @action.bound\n    onTargetChange(event: React.ChangeEvent<HTMLInputElement>) {\n        this.targetHost = event.target.value;\n\n        try {\n            this.updateHandler();\n            event.target.setCustomValidity('');\n        } catch (e) {\n            event.target.setCustomValidity(asError(e).message);\n        }\n        event.target.reportValidity();\n    }\n\n    @action.bound\n    onUpdateHeaderChange(event: React.ChangeEvent<HTMLSelectElement>) {\n        this.updateHostHeader = event.target.value === 'true';\n\n        try {\n            this.updateHandler();\n        } catch (e) {\n            // If there's an error, it must be in the host name, so it's reported elsewhere\n        }\n    }\n}\n\nconst TransformSectionLabel = styled(SectionLabel)`\n    margin-top: 10px;\n`;\n\nconst TransformSectionSeparator = styled.hr`\n    width: 100%;\n    box-sizing: border-box;\n    margin: 20px 0;\n    border: solid 1px ${p => p.theme.containerWatermark};\n`;\n\nconst TransformConfig = styled.div`\n    margin: 0 0 5px;\n\n    ${(p: { active: boolean }) => p.active && css`\n        border-left: solid 5px ${p => p.theme.containerWatermark};\n\n        &:focus-within {\n            border-left: solid 5px ${p => p.theme.primaryInputBackground};\n        }\n\n        padding-left: 5px;\n        margin: 10px 0 15px;\n    `}\n`;\n\nconst TransformDetails = styled.div`\n    > :first-child {\n        margin-top: 0;\n    }\n\n    padding-top: 5px;\n`;\n\nconst SelectTransform = styled(Select)`\n    margin: 0;\n\n    ${p => p.value === 'none' && css`\n        color: ${p => p.theme.mainColor};\n        background-color: ${p => p.theme.mainBackground};\n    `}\n`;\n\n@inject('rulesStore')\n@observer\nclass TransformingHandlerConfig extends HandlerConfig<TransformingHandler, { rulesStore?: RulesStore }> {\n\n    @observable\n    transformRequest = this.props.handler.transformRequest || {};\n\n    @observable\n    transformResponse = this.props.handler.transformResponse || {};\n\n    render() {\n        return <ConfigContainer>\n            <TransformSectionLabel>Request Transforms:</TransformSectionLabel>\n            <MethodTransformConfig\n                replacementMethod={this.transformRequest?.replaceMethod}\n                onChange={this.transformField('transformRequest')('replaceMethod')}\n            />\n            <HeadersTransformConfig\n                type='request'\n                transform={this.transformRequest}\n                onChange={this.transformField('transformRequest')}\n            />\n            <BodyTransformConfig\n                type='request'\n                transform={this.transformRequest}\n                onChange={this.transformField('transformRequest')}\n            />\n\n            <TransformSectionSeparator />\n\n            <TransformSectionLabel>Response Transforms:</TransformSectionLabel>\n            <StatusTransformConfig\n                replacementStatus={this.transformResponse?.replaceStatus}\n                onChange={this.transformField('transformResponse')('replaceStatus')}\n            />\n            <HeadersTransformConfig\n                type='response'\n                transform={this.transformResponse}\n                onChange={this.transformField('transformResponse')}\n            />\n            <BodyTransformConfig\n                type='response'\n                transform={this.transformResponse}\n                onChange={this.transformField('transformResponse')}\n            />\n        </ConfigContainer>;\n    }\n\n    transformField = <T extends keyof this>(\n        objName: T\n    ) => <K extends keyof this[T]>(\n        key: K\n    ) => action(\n        (value: this[T][K]) => {\n            this[objName] = {\n                ...this[objName],\n                [key]: value\n            };\n\n            this.updateHandler();\n        }\n    );\n\n    updateHandler() {\n        this.props.onChange(new TransformingHandler(\n            this.props.rulesStore!,\n            this.transformRequest,\n            this.transformResponse\n        ));\n    }\n}\n\nconst MethodTransformConfig = (props: {\n    replacementMethod: string | undefined,\n    onChange: (method: MethodName | undefined) => void\n}) => {\n    return <TransformConfig active={!!props.replacementMethod}>\n        <SelectTransform\n            value={props.replacementMethod ?? 'none'}\n            onChange={(event: React.ChangeEvent<HTMLSelectElement>) => {\n                const value = event.target.value as 'none' | MethodName;\n\n                if (value === 'none') {\n                    props.onChange(undefined);\n                } else {\n                    props.onChange(value);\n                }\n            }\n        }>\n            <option value='none'>Pass through the real request method</option>\n            {\n                MethodNames.map((name) =>\n                    <option key={name} value={name}>\n                        Replace the request method with { name }\n                    </option>\n                )\n            }\n        </SelectTransform>\n    </TransformConfig>;\n};\n\nconst StatusTransformConfig = (props: {\n    replacementStatus: number | undefined,\n    onChange: (status: number | undefined) => void\n}) => {\n    const selected = props.replacementStatus !== undefined\n        ? 'replace'\n        : 'none';\n\n    return <TransformConfig active={selected !== 'none'}>\n        <SelectTransform\n            value={selected ?? 'none'}\n            onChange={(event: React.ChangeEvent<HTMLSelectElement>) => {\n                const value = event.target.value as 'none' | 'replace';\n\n                if (value === 'none') {\n                    props.onChange(undefined);\n                } else {\n                    props.onChange(200);\n                }\n            }\n        }>\n            <option value='none'>Pass through the real response status</option>\n            <option value='replace'>Replace the response status</option>\n        </SelectTransform>\n        {\n            selected === 'replace' && <TransformDetails>\n                <EditableStatus\n                    statusCode={props.replacementStatus}\n                    onChange={props.onChange}\n                    // We don't bother supporting status message transforms:\n                    httpVersion={2}\n                    statusMessage={undefined}\n                />\n            </TransformDetails>\n        }\n    </TransformConfig>\n};\n\n@observer\nclass HeadersTransformConfig<T extends RequestTransform | ResponseTransform> extends React.Component<{\n    type: 'request' | 'response',\n    transform: T,\n    onChange: <K extends typeof HeadersTransformConfig.FIELDS[number]>(updatedField: K) => (updatedValue: T[K]) => void\n}> {\n\n    private static readonly FIELDS = [\n        'replaceHeaders',\n        'updateHeaders'\n    ] as const;\n\n    @computed\n    get selected() {\n        return _.find(HeadersTransformConfig.FIELDS, (field) =>\n            this.props.transform[field] !== undefined\n        ) ?? 'none';\n    }\n\n    @computed\n    get headers() {\n        if (this.selected === 'none') return {};\n        return this.props.transform[this.selected] || {};\n    }\n\n    render() {\n        const { type } = this.props;\n        const {\n            selected,\n            convertResultFromRawHeaders,\n            onTransformTypeChange,\n            setHeadersValue\n        } = this;\n\n        return <TransformConfig active={selected !== 'none'}>\n            <SelectTransform\n                value={selected}\n                onChange={onTransformTypeChange}\n            >\n                <option value='none'>Pass through the real { type } headers</option>\n                <option value='updateHeaders'>Update the { type } headers</option>\n                <option value='replaceHeaders'>Replace the { type } headers</option>\n            </SelectTransform>\n            {\n                selected !== 'none' && <TransformDetails>\n                    <EditableHeaders\n                        headers={this.headers}\n                        convertToRawHeaders={headersToRawHeaders}\n                        convertFromRawHeaders={convertResultFromRawHeaders}\n                        onChange={setHeadersValue}\n                        allowEmptyValues={selected === 'updateHeaders'}\n                    />\n                </TransformDetails>\n            }\n        </TransformConfig>;\n    }\n\n    convertResultFromRawHeaders = (headers: RawHeaders): Headers => {\n        if (this.selected === 'updateHeaders') {\n            return rawHeadersToHeaders(\n                headers.map(([key, value]) =>\n                    [key, value === '' ? undefined as any : value] // => undefined to explicitly remove headers\n            ));\n        } else {\n            return rawHeadersToHeaders(headers);\n        }\n    };\n\n    @action.bound\n    setHeadersValue(value: Headers) {\n        this.clearValues();\n        if (this.selected !== 'none') {\n            this.props.onChange(this.selected)(value);\n        }\n    }\n\n    @action.bound\n    onTransformTypeChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n        const value = event.currentTarget.value as 'none' | typeof HeadersTransformConfig.FIELDS[number];\n\n        this.clearValues();\n        if (value !== 'none') this.props.onChange(value)({});\n    };\n\n    @action.bound\n    clearValues() {\n        HeadersTransformConfig.FIELDS.forEach((field) =>\n            this.props.onChange(field)(undefined)\n        );\n    }\n};\n\n@observer\nclass BodyTransformConfig<T extends RequestTransform | ResponseTransform> extends React.Component<{\n    type: 'request' | 'response',\n    transform: T,\n    onChange: <K extends typeof BodyTransformConfig.FIELDS[number]>(updatedField: K) => (updatedValue: T[K]) => void\n}> {\n\n    private static readonly FIELDS = [\n        'replaceBody',\n        'replaceBodyFromFile',\n        'updateJsonBody'\n    ] as const;\n\n    @computed\n    get bodyReplacementBuffer() {\n        return asBuffer(this.props.transform.replaceBody);\n    }\n\n    render() {\n        const { type, transform } = this.props;\n        const {\n            bodyReplacementBuffer,\n            onTransformTypeChange,\n            setBodyReplacement,\n            selectBodyReplacementFile,\n            setJsonBodyUpdate\n        } = this;\n\n        const selected = _.find(BodyTransformConfig.FIELDS, (field) =>\n            transform[field] !== undefined\n        ) ?? 'none';\n\n        return <TransformConfig active={selected !== 'none'}>\n            <SelectTransform\n                value={selected}\n                onChange={onTransformTypeChange}>\n                <option value='none'>Pass through the real { type } body</option>\n                <option value='replaceBody'>Replace the { type } body with a fixed value</option>\n                <option value='replaceBodyFromFile'>Replace the { type } body with a file</option>\n                <option value='updateJsonBody'>Update values within a JSON { type } body</option>\n            </SelectTransform>\n            {\n                selected === 'replaceBody'\n                    ? <RawBodyTransfomConfig\n                        type={type}\n                        body={bodyReplacementBuffer}\n                        updateBody={setBodyReplacement}\n                    />\n                : selected === 'replaceBodyFromFile'\n                    ? <TransformDetails>\n                        <BodyFileContainer>\n                            <BodyFileButton onClick={selectBodyReplacementFile}>\n                                { transform.replaceBodyFromFile\n                                    ? 'Change file'\n                                    : <>\n                                        Select file <WarningIcon />\n                                    </>\n                                }\n                            </BodyFileButton>\n                            { transform.replaceBodyFromFile && <BodyFilePath>\n                                { transform.replaceBodyFromFile }\n                            </BodyFilePath> }\n                        </BodyFileContainer>\n                    </TransformDetails>\n                : selected === 'updateJsonBody'\n                    ? <JsonUpdateTransformConfig\n                        type={type}\n                        body={transform.updateJsonBody!}\n                        updateBody={setJsonBodyUpdate}\n                    />\n                : null\n            }\n        </TransformConfig>;\n    }\n\n    onTransformTypeChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n        const value = event.currentTarget.value as 'none' | typeof BodyTransformConfig.FIELDS[number];\n\n        this.clearValues();\n        if (value === 'updateJsonBody') {\n            this.props.onChange('updateJsonBody')({});\n        } else if (value === 'replaceBody') {\n            this.props.onChange('replaceBody')('');\n        } else if (value === 'replaceBodyFromFile') {\n            this.props.onChange('replaceBodyFromFile')('');\n        }\n    };\n\n    @action.bound\n    clearValues() {\n        BodyTransformConfig.FIELDS.forEach((field) =>\n            this.props.onChange(field)(undefined)\n        );\n    };\n\n    @action.bound\n    setBodyReplacement(body: string) {\n        this.clearValues();\n        this.props.onChange('replaceBody')(body);\n    };\n\n    selectBodyReplacementFile = async () => {\n        const result = await uploadFile(\"path\", []);\n        if (result) {\n            runInAction(() => {\n                this.clearValues();\n                this.props.onChange('replaceBodyFromFile')(result);\n            });\n        }\n    };\n\n    @action.bound\n    setJsonBodyUpdate(body: {}) {\n        this.clearValues();\n        this.props.onChange('updateJsonBody')(body);\n    };\n};\n\nconst RawBodyTransfomConfig = (props: {\n    type: 'request' | 'response',\n    body: Buffer,\n    updateBody: (body: string) => void\n}) => {\n    const [contentType, setContentType] = React.useState<EditableContentType>('text');\n    const onContentTypeChanged = (e: React.ChangeEvent<HTMLSelectElement>) =>\n        setContentType(e.target.value as EditableContentType);\n\n    return <TransformDetails>\n        <BodyHeader>\n            <SectionLabel>Replacement { props.type } body</SectionLabel>\n            <FormatButton\n                format={contentType}\n                content={props.body}\n                onFormatted={props.updateBody}\n            />\n            <ConfigSelect value={contentType} onChange={onContentTypeChanged}>\n                <option value=\"text\">Plain text</option>\n                <option value=\"json\">JSON</option>\n                <option value=\"xml\">XML</option>\n                <option value=\"html\">HTML</option>\n                <option value=\"css\">CSS</option>\n                <option value=\"javascript\">JavaScript</option>\n            </ConfigSelect>\n        </BodyHeader>\n        <BodyContainer>\n            <SelfSizedEditor\n                contentId={null}\n                language={contentType}\n                value={bufferToString(props.body)}\n                onChange={props.updateBody}\n            />\n        </BodyContainer>\n    </TransformDetails>;\n};\n\nconst StandaloneFormatButton = styled(FormatButton)`\n    padding-right: 0;\n`;\n\nconst JsonUpdateTransformConfig = (props: {\n    type: 'request' | 'response',\n    body: {},\n    updateBody: (body: {}) => void\n}) => {\n    const [error, setError] = React.useState<Error>();\n\n    const [bodyString, setBodyString] = React.useState<string>(\n        JSON.stringify(props.body, null, 2)\n    );\n\n    React.useEffect(() => {\n        try {\n            props.updateBody(JSON.parse(bodyString));\n            setError(undefined);\n        } catch (e) {\n            setError(asError(e));\n        }\n    }, [bodyString]);\n\n    return <TransformDetails>\n        <BodyHeader>\n            <SectionLabel>JSON { props.type } body patch</SectionLabel>\n            { error && <WarningIcon title={error.message} /> }\n\n            <StandaloneFormatButton\n                format='json'\n                content={asBuffer(bodyString)}\n                onFormatted={setBodyString}\n            />\n        </BodyHeader>\n        <BodyContainer>\n            <SelfSizedEditor\n                contentId={null}\n                language='json'\n                value={bodyString}\n                onChange={(content) => setBodyString(content)}\n            />\n        </BodyContainer>\n    </TransformDetails>;\n};\n\n@observer\nclass PassThroughHandlerConfig extends HandlerConfig<\n    | PassThroughHandler\n    | WebSocketPassThroughHandler\n    | DynamicProxyStepDefinition\n> {\n    render() {\n        return <ConfigContainer>\n            <ConfigExplanation>\n                All matching {\n                    isHttpCompatibleType(this.props.ruleType)\n                        ? 'requests'\n                    : this.props.ruleType === 'websocket'\n                        ? 'WebSockets'\n                    : this.props.ruleType === 'webrtc'\n                        ? 'data and media'\n                    : unreachableCheck(this.props.ruleType)\n                } will be transparently passed through to the upstream {\n                    this.props.ruleType === 'webrtc'\n                        ? 'RTC peer, once one is connected'\n                        : 'target host'\n                }.\n            </ConfigExplanation>\n        </ConfigContainer>;\n    }\n}\n\n@observer\nclass RequestBreakpointHandlerConfig extends HandlerConfig<RequestBreakpointHandler> {\n    render() {\n        return <ConfigContainer>\n            <ConfigExplanation>\n                All matching traffic will breakpoint when a request is sent.\n            </ConfigExplanation>\n            <ConfigExplanation>\n                Once a request is breakpointed, you can edit the request URL to redirect\n                the request elsewhere, edit the method, headers, or body before they are sent upstream,\n                or provide your own response manually so the request is never sent onwards at all.\n            </ConfigExplanation>\n        </ConfigContainer>;\n    }\n}\n\n@observer\nclass ResponseBreakpointHandlerConfig extends HandlerConfig<ResponseBreakpointHandler> {\n    render() {\n        return <ConfigContainer>\n            <ConfigExplanation>\n                All matching traffic will breakpoint when a response is received from the upstream server.\n            </ConfigExplanation>\n            <ConfigExplanation>\n                Once a response is breakpointed, you can rewrite the received message, to edit the status\n                code, headers or body before they're returned to the downstream HTTP client.\n            </ConfigExplanation>\n        </ConfigContainer>;\n    }\n}\n\n@observer\nclass RequestAndResponseBreakpointHandlerConfig extends HandlerConfig<RequestAndResponseBreakpointHandler> {\n    render() {\n        return <ConfigContainer>\n            <ConfigExplanation>\n                All matching traffic will breakpoint when a request is sent, and when a response\n                is received.\n            </ConfigExplanation>\n            <ConfigExplanation>\n                From a request breakpoint, you can edit the request URL to redirect\n                the request elsewhere, edit the method, headers, or body before they are sent upstream,\n                or provide your own response manually so the request is never sent onwards at all.\n            </ConfigExplanation>\n            <ConfigExplanation>\n                From a response breakpoint, you can rewrite a received response, to edit the status\n                code, headers or body before they're returned to the downstream HTTP client.\n            </ConfigExplanation>\n        </ConfigContainer>;\n    }\n}\n\n@observer\nclass TimeoutHandlerConfig extends HandlerConfig<TimeoutHandler> {\n    render() {\n        return <ConfigContainer>\n            <ConfigExplanation>\n                When a matching {\n                    isHttpCompatibleType(this.props.ruleType)\n                        ? 'request'\n                    : this.props.ruleType === 'websocket'\n                        ? 'WebSocket'\n                    : this.props.ruleType === 'webrtc'\n                        ? (() => { throw new Error('Not compatible with WebRTC rules') })\n                    : unreachableCheck(this.props.ruleType)\n                } is received, the server will keep the connection open but do nothing.\n                With no data or response, most clients will time out and abort the\n                request after sufficient time has passed.\n            </ConfigExplanation>\n        </ConfigContainer>;\n    }\n}\n\n@observer\nclass CloseConnectionHandlerConfig extends HandlerConfig<CloseConnectionHandler> {\n    render() {\n        return <ConfigContainer>\n            <ConfigExplanation>\n                As soon as a matching {\n                    isHttpCompatibleType(this.props.ruleType)\n                        ? 'request'\n                    : this.props.ruleType === 'websocket'\n                        ? 'WebSocket'\n                    : this.props.ruleType === 'webrtc'\n                        ? (() => { throw new Error('Not compatible with WebRTC rules') })\n                    : unreachableCheck(this.props.ruleType)\n                } is received, the connection will be cleanly closed, with no response.\n            </ConfigExplanation>\n        </ConfigContainer>;\n    }\n}\n\n@observer\nclass ResetConnectionHandlerConfig extends HandlerConfig<ResetConnectionHandler> {\n    render() {\n        return <ConfigContainer>\n            <ConfigExplanation>\n                As soon as a matching {\n                    isHttpCompatibleType(this.props.ruleType)\n                        ? 'request'\n                    : this.props.ruleType === 'websocket'\n                        ? 'WebSocket'\n                    : this.props.ruleType === 'webrtc'\n                        ? (() => { throw new Error('Not compatible with WebRTC rules') })\n                    : unreachableCheck(this.props.ruleType)\n                } is received, the connection will be killed with a TCP RST packet (or a\n                RST_STREAM frame, for HTTP/2 requests).\n            </ConfigExplanation>\n        </ConfigContainer>;\n    }\n}\n\n@observer\nclass WebSocketEchoHandlerConfig extends HandlerConfig<EchoWebSocketHandlerDefinition> {\n    render() {\n        return <ConfigContainer>\n            <ConfigExplanation>\n                The WebSocket will be opened successfully, but not forwarded upstream, and every\n                message that's sent will be echoed back to the client until the client closes\n                the connection.\n            </ConfigExplanation>\n        </ConfigContainer>;\n    }\n}\n\n@observer\nclass WebSocketListenHandlerConfig extends HandlerConfig<ListenWebSocketHandlerDefinition> {\n    render() {\n        return <ConfigContainer>\n            <ConfigExplanation>\n                The WebSocket will be opened successfully, but not forwarded upstream. All\n                messages from the client will be accepted, but no responses will be sent.\n            </ConfigExplanation>\n        </ConfigContainer>;\n    }\n}\n\nconst NATIVE_ETH_TYPES_PATTERN = `(${NATIVE_ETH_TYPES.join('|')})(\\\\[\\\\])?`;\n\n@observer\nclass EthCallResultHandlerConfig extends HandlerConfig<EthereumCallResultHandler> {\n\n    @observable\n    typeValuePairs: PairsArray = [];\n\n    @observable error: Error | undefined;\n\n    componentDidMount() {\n        // If the handler changes (or when its set initially), update our data fields\n        disposeOnUnmount(this, autorun(() => {\n            const { outputTypes, values } = this.props.handler;\n\n            const stringValues = values.map(v => {\n                if (Array.isArray(v)) return v.join(', ');\n                else return (v as any)?.toString();\n            });\n\n            runInAction(() => {\n                this.typeValuePairs = _.zip(outputTypes, stringValues)\n                    .map(([key, value]) => ({ key, value })) as PairsArray;\n            });\n        }));\n    }\n\n    render() {\n        const { typeValuePairs } = this;\n        const encodedData = this.props.handler.result.result;\n\n        return <ConfigContainer>\n            <SectionLabel>Eth_Call return values</SectionLabel>\n\n            <EditablePairs\n                pairs={typeValuePairs}\n                onChange={this.onChange}\n                keyPlaceholder='Return value type (e.g. string, int256, etc)'\n                keyPattern={NATIVE_ETH_TYPES_PATTERN}\n                valuePlaceholder='Return value'\n                allowEmptyValues={true}\n            />\n\n            { this.error\n                ? <>\n                    <ConfigExplanation>\n                        <WarningIcon /> Could not encode data. { this.error.message }\n                    </ConfigExplanation>\n                </>\n                : <>\n                    <ConfigExplanation>\n                        Encoded return value:\n                    </ConfigExplanation>\n                    <ContentMonoValue>\n                        { encodedData }\n                    </ContentMonoValue>\n                </>\n            }\n\n            <ConfigExplanation>\n                All matching Ethereum JSON-RPC calls will be intercepted, and the encoded output\n                above returned directly, without forwarding the call to the real Ethereum node.\n            </ConfigExplanation>\n        </ConfigContainer>;\n    }\n\n    @action.bound\n    onChange(newPairs: PairsArray) {\n        this.typeValuePairs = newPairs;\n\n        // Allow array values, separated by commas:\n        const parsedValues = this.typeValuePairs.map(({ key, value }) => {\n            if (key === 'string[]') {\n                return { key, value: value.split(/,\\s?/g) };\n            } else if (key.startsWith('bytes') || key.endsWith('[]')) {\n                return { key, value: value.split(/,\\s?/g).map(x => parseInt(x, 10)) };\n            } else {\n                return { key, value };\n            }\n        });\n\n        try {\n            this.props.onChange(\n                new EthereumCallResultHandler(\n                    parsedValues.map(({ key }) => key),\n                    parsedValues.map(({ value }) => value)\n                )\n            );\n            this.error = undefined;\n        } catch (err) {\n            if (!isErrorLike(err)) throw err;\n\n            if (err.code === 'INVALID_ARGUMENT') {\n                const { argument, value, reason } = err as {\n                    argument: string,\n                    value: string,\n                    reason: string\n                };\n\n                if (argument === 'type' || argument === 'param') {\n                    this.error = new Error(`Invalid type: ${value}`);\n                } else if (argument === 'value') {\n                    this.error = new Error(`Invalid value: '${value}' (${reason})`);\n                } else {\n                    this.error = err as Error;\n                }\n            } else {\n                this.error = err as Error;\n            }\n\n            this.props.onInvalidState();\n        }\n    }\n}\n\n@observer\nclass EthNumberResultHandlerConfig extends HandlerConfig<EthereumNumberResultHandler> {\n\n    @observable\n    value: number | '' = this.props.handler.value;\n\n    componentDidMount() {\n        // If the handler changes (or when its set initially), update our data fields\n        disposeOnUnmount(this, autorun(() => {\n            const { value } = this.props.handler;\n            runInAction(() => {\n                if (value === 0 && this.value === '') return; // Allows clearing the input, making it *implicitly* 0\n                this.value = value;\n            });\n        }));\n    }\n\n    render() {\n        const { value } = this;\n\n        return <ConfigContainer>\n            <SectionLabel>Return value</SectionLabel>\n\n            <WideTextInput\n                type='number'\n                min={0}\n                value={value}\n                onChange={this.onChange}\n            />\n\n            <ConfigExplanation>\n                All matching Ethereum JSON-RPC requests will be intercepted, and { this.value } will\n                be returned directly, without forwarding the call to the real Ethereum node.\n            </ConfigExplanation>\n        </ConfigContainer>;\n    }\n\n    @action.bound\n    onChange(event: React.ChangeEvent<HTMLInputElement>) {\n        const inputValue = event.target.value;\n\n        const newValue = (inputValue !== '')\n            ? parseInt(inputValue, 10)\n            : '';\n\n        if (_.isNaN(newValue)) return; // I.e. reject the edit\n\n        this.value = newValue;\n\n        this.props.onChange(\n            new EthereumNumberResultHandler(newValue || 0)\n        );\n    }\n}\n\n@observer\nclass EthHashResultHandlerConfig extends HandlerConfig<EthereumHashResultHandler> {\n\n    @observable\n    value = this.props.handler.value;\n\n    componentDidMount() {\n        // If the handler changes (or when its set initially), update our data fields\n        disposeOnUnmount(this, autorun(() => {\n            const { value } = this.props.handler;\n            runInAction(() => { this.value = value; });\n        }));\n    }\n\n    render() {\n        const { value } = this;\n\n        return <ConfigContainer>\n            <SectionLabel>Return hash value</SectionLabel>\n\n            <WideTextInput\n                type='text'\n                value={value}\n                onChange={this.onChange}\n            />\n\n            <ConfigExplanation>\n                All matching Ethereum JSON-RPC requests will be intercepted, and { this.value } will\n                be returned directly, without forwarding the call to the real Ethereum node.\n            </ConfigExplanation>\n\n            <ConfigExplanation>\n                <WarningIcon /> In most cases, you will also want to add a rule for transaction receipts\n                matching this value, to mock subsequent queries for the transaction's result.\n            </ConfigExplanation>\n        </ConfigContainer>;\n    }\n\n    @action.bound\n    onChange(event: React.ChangeEvent<HTMLInputElement>) {\n        const newValue = event.target.value;\n\n        if (!/^0x[0-9a-fA-F]*$/.test(newValue)) return; // Ignore anything that's not a valid hash\n\n        this.props.onChange(\n            new EthereumHashResultHandler(event.target.value)\n        );\n    }\n}\n\n// Base component, used to build the various \"JSON input into a JSON-wrapping handler\" configs\n@observer\nclass JsonBasedHandlerConfig<H extends Handler> extends HandlerConfig<H, {\n    name: string,\n    explanation: string[],\n    handlerFactory: (body: any) => H,\n    valueGetter: (handler: H) => unknown\n}> {\n\n    @observable\n    valueString: string = JSON.stringify(this.props.valueGetter(this.props.handler), null, 2);\n\n    @observable\n    error: Error | undefined;\n\n    componentDidMount() {\n        // If the handler changes (or when its set initially), update our data fields\n        disposeOnUnmount(this, reaction(\n            () => JSON.stringify(this.props.valueGetter(this.props.handler), null, 2),\n            (handlerStringValue) => {\n                let normalizedCurrentValue: {} | undefined;\n                try {\n                    normalizedCurrentValue = JSON.stringify(JSON.parse(this.valueString), null, 2);\n                } catch (err) { }\n\n                // If the handler value changes, and either it doesn't match the existing value here,\n                // or the existing value isn't parseable at all, we reset the editor value:\n                if (handlerStringValue !== normalizedCurrentValue) {\n                    runInAction(() => {\n                        this.valueString = handlerStringValue;\n                        this.error = undefined;\n                    });\n                }\n            }\n        ));\n    }\n\n    render() {\n        const { valueString, error } = this;\n        const { name, explanation } = this.props;\n\n        return <ConfigContainer>\n            <BodyHeader>\n                <SectionLabel>{ name }</SectionLabel>\n                { error && <WarningIcon title={error.message} /> }\n\n                <StandaloneFormatButton\n                    format='json'\n                    content={asBuffer(valueString)}\n                    onFormatted={this.onChange}\n                />\n            </BodyHeader>\n            <BodyContainer>\n                <SelfSizedEditor\n                    contentId={null}\n                    language='json'\n                    value={valueString}\n                    onChange={this.onChange}\n                />\n            </BodyContainer>\n\n            { explanation.map((explanationPart, i) =>\n                <ConfigExplanation key={i}>\n                    { explanationPart }\n                </ConfigExplanation>\n            ) }\n        </ConfigContainer>;\n    }\n\n    @action.bound\n    onChange(newContent: string) {\n        this.valueString = newContent;\n\n        try {\n            const newValue = JSON.parse(newContent);\n            this.props.onChange(\n                this.props.handlerFactory(newValue)\n            );\n            this.error = undefined;\n        } catch (e) {\n            if (!isErrorLike(e)) throw e;\n            this.error = e as Error;\n            this.props.onInvalidState();\n        }\n    }\n}\n\n@observer\nclass EthReceiptResultHandlerConfig extends HandlerConfig<EthereumReceiptResultHandler> {\n\n    render() {\n        return <JsonBasedHandlerConfig\n            name='Ethereum Transaction Receipt'\n            explanation={[\n                'All matching Ethereum JSON-RPC requests will be intercepted, and this transaction ' +\n                'receipt will returned directly, without forwarding the call to the real Ethereum node.'\n            ]}\n            handlerFactory={(data) => new EthereumReceiptResultHandler(data)}\n            valueGetter={handler => handler.receiptValue}\n            { ...this.props }\n        />;\n    }\n\n}\n\n@observer\nclass EthBlockResultHandlerConfig extends HandlerConfig<EthereumBlockResultHandler> {\n\n    render() {\n        return <JsonBasedHandlerConfig\n            name='Ethereum Block Data'\n            explanation={[\n                'All matching Ethereum JSON-RPC requests will be intercepted, and this fixed block data ' +\n                'will returned directly, without forwarding the call to the real Ethereum node.'\n            ]}\n            handlerFactory={(data) => new EthereumBlockResultHandler(data)}\n            valueGetter={handler => handler.blockValue}\n            { ...this.props }\n        />;\n    }\n\n}\n\n@observer\nclass EthErrorHandlerConfig extends HandlerConfig<EthereumErrorHandler> {\n\n    @observable\n    inputError: Error | undefined; // A form error - not error data for the handler, unlike the rest\n\n    @observable\n    errorMessage = this.props.handler.message;\n\n    @observable\n    errorCode: '' | number = this.props.handler.code || '';\n\n    @observable\n    errorData = this.props.handler.data;\n\n    @observable\n    errorName = this.props.handler.name;\n\n    componentDidMount() {\n        // If any of our data fields change, rebuild & update the handler\n        disposeOnUnmount(this, reaction(() => (\n            JSON.stringify(_.pick(this, ['errorMessage', 'errorCode', 'errorData', 'errorName']))\n        ), () => this.updateHandler()));\n\n        // If the handler changes (or when its set initially), update our data fields\n        disposeOnUnmount(this, autorun(() => {\n            const { message, code, data, name } = this.props.handler;\n\n            runInAction(() => {\n                this.errorMessage = message;\n                this.errorData = data;\n                this.errorName = name;\n\n                if (this.errorCode === '' && code === 0) {\n                    // Do nothing - this allows you to clear the field without fuss\n                } else {\n                    this.errorCode = code;\n                }\n            });\n        }));\n    }\n\n    render() {\n        const {\n            errorMessage,\n            errorCode,\n            errorData,\n            errorName\n        } = this;\n\n        return <ConfigContainer>\n            <SectionLabel>Error Message</SectionLabel>\n            <WideTextInput\n                type='text'\n                value={errorMessage}\n                onChange={this.onChangeMessage}\n            />\n\n            <SectionLabel>Error Code</SectionLabel>\n            <WideTextInput\n                type='number'\n                value={errorCode}\n                onChange={this.onChangeCode}\n            />\n\n            <SectionLabel>Error Data</SectionLabel>\n            <WideTextInput\n                type='text'\n                value={errorData}\n                onChange={this.onChangeData}\n            />\n\n            <SectionLabel>Error Name</SectionLabel>\n            <WideTextInput\n                type='text'\n                value={errorName || ''}\n                onChange={this.onChangeName}\n            />\n\n            <ConfigExplanation>\n                All matching Ethereum JSON-RPC requests will be intercepted, and this error response\n                will returned directly, without forwarding the call to the real Ethereum node.\n            </ConfigExplanation>\n        </ConfigContainer>;\n    }\n\n    @action.bound\n    onChangeMessage(event: React.ChangeEvent<HTMLInputElement>) {\n        this.errorMessage = event.target.value;\n    }\n\n    @action.bound\n    onChangeCode(event: React.ChangeEvent<HTMLInputElement>) {\n        const inputValue = event.target.value;\n        if (!inputValue) {\n            this.errorCode = '';\n            return;\n        }\n\n        const value = parseInt(inputValue, 10);\n        if (!_.isNaN(value)) {\n            this.errorCode = value;\n        }\n    }\n\n    @action.bound\n    onChangeData(event: React.ChangeEvent<HTMLInputElement>) {\n        this.errorData = event.target.value;\n    }\n\n    @action.bound\n    onChangeName(event: React.ChangeEvent<HTMLInputElement>) {\n        this.errorName = event.target.value;\n    }\n\n    updateHandler() {\n        this.props.onChange(\n            new EthereumErrorHandler(\n                this.errorMessage,\n                this.errorData,\n                this.errorCode || 0,\n                this.errorName\n            )\n        );\n    }\n}\n\n@observer\nclass IpfsCatTextHandlerConfig extends HandlerConfig<IpfsCatTextHandler> {\n\n    @observable\n    contentType: EditableContentType = 'text';\n\n    @observable\n    body = asBuffer(this.props.handler.data);\n\n    componentDidMount() {\n        // If the handler changes (or when its set initially), update our data fields\n        disposeOnUnmount(this, autorun(() => {\n            const { data } = this.props.handler;\n            runInAction(() => {\n                this.body = asBuffer(data);\n            });\n        }));\n    }\n\n    @computed\n    private get textEncoding() {\n        // If we're handling text data, we want to show & edit it as UTF8.\n        // If it's binary, that's a lossy operation, so we use binary (latin1) instead.\n        return isProbablyUtf8(this.body)\n            ? 'utf8'\n            : 'binary';\n    }\n\n    render() {\n        const { body } = this;\n\n        const bodyAsString = body.toString(this.textEncoding);\n\n        return <ConfigContainer>\n            <BodyHeader>\n                <SectionLabel>IPFS content</SectionLabel>\n                <FormatButton\n                    format={this.contentType}\n                    content={body}\n                    onFormatted={this.setBody}\n                />\n                <ConfigSelect value={this.contentType} onChange={this.setContentType}>\n                    <option value=\"text\">Plain text</option>\n                    <option value=\"json\">JSON</option>\n                    <option value=\"xml\">XML</option>\n                    <option value=\"html\">HTML</option>\n                    <option value=\"css\">CSS</option>\n                    <option value=\"javascript\">JavaScript</option>\n                </ConfigSelect>\n            </BodyHeader>\n            <BodyContainer>\n                <SelfSizedEditor\n                    contentId={null}\n                    language={this.contentType}\n                    value={bodyAsString}\n                    onChange={this.setBody}\n                />\n            </BodyContainer>\n        </ConfigContainer>;\n    }\n\n    @action.bound\n    setContentType(event: React.ChangeEvent<HTMLSelectElement>) {\n        const value = event.target.value;\n        this.contentType = value as EditableContentType;\n    }\n\n    @action.bound\n    setBody(body: string) {\n        this.body = stringToBuffer(body, this.textEncoding);\n        this.props.onChange(\n            new IpfsCatTextHandler(this.body)\n        );\n    }\n}\n\n\n@observer\nclass IpfsCatFileHandlerConfig extends HandlerConfig<FromFileResponseHandler> {\n\n    @observable\n    filePath = (this.props.handler.filePath || '').toString();\n\n    componentDidMount() {\n        // If the handler changes (or when its set initially), update our data fields\n        disposeOnUnmount(this, autorun(() => {\n            const { filePath } = this.props.handler;\n            runInAction(() => {\n                this.filePath = filePath;\n            });\n        }));\n    }\n\n    render() {\n        return <ConfigContainer>\n            <SectionLabel>IPFS content</SectionLabel>\n            <BodyFileContainer>\n                <BodyFileButton onClick={this.selectFile}>\n                    { this.filePath\n                        ? 'Change file'\n                        : <>\n                            Select file <WarningIcon />\n                        </>\n                    }\n                </BodyFileButton>\n                { this.filePath && <BodyFilePath>\n                    { this.filePath }\n                </BodyFilePath> }\n            </BodyFileContainer>\n\n            <ConfigExplanation>\n                All matching requests will receive a successful response containing the contents of the\n                selected file.\n            </ConfigExplanation>\n            <ConfigExplanation>\n                This file will be read fresh for each request, so future changes to the file will\n                immediately affect matching requests.\n            </ConfigExplanation>\n        </ConfigContainer>;\n    }\n\n    selectFile = async () => {\n        const result = await uploadFile(\"path\", []);\n        if (result) {\n            runInAction(() => {\n                this.filePath = result;\n            });\n\n            this.props.onChange(\n                new IpfsCatFileHandler(\n                    this.filePath\n                )\n            );\n        }\n    }\n}\n\n@observer\nclass IpfsAddResultHandlerConfig extends HandlerConfig<IpfsAddResultHandler> {\n\n    @observable\n    resultPairs: PairsArray = [];\n\n    componentDidMount() {\n        // If the handler changes (or when its set initially), update our data fields\n        disposeOnUnmount(this, autorun(() => {\n            const { result } = this.props.handler;\n\n            runInAction(() => {\n                this.resultPairs = result.map(({ Name, Hash }) => ({ key: Name, value: Hash }));\n            });\n        }));\n    }\n\n    render() {\n        const { resultPairs } = this;\n\n        return <ConfigContainer>\n            <SectionLabel>IPFS Add Results</SectionLabel>\n\n            <EditablePairs\n                pairs={resultPairs}\n                onChange={this.onChange}\n                keyPlaceholder='Name of the added file'\n                valuePlaceholder='Hash of the added file'\n            />\n            <ConfigExplanation>\n                All matching IPFS Add calls will be intercepted, and the above results will always\n                be returned directly, without forwarding the call to the real IPFS node.\n            </ConfigExplanation>\n        </ConfigContainer>;\n    }\n\n    @action.bound\n    onChange(newPairs: PairsArray) {\n        this.resultPairs = newPairs;\n\n        this.props.onChange(\n            new IpfsAddResultHandler(\n                this.resultPairs.map(({ key, value }) => ({ Name: key, Hash: value }))\n            )\n        );\n    }\n\n}\n\n@observer\nclass IpnsResolveResultHandlerConfig extends HandlerConfig<IpnsResolveResultHandler> {\n\n    render() {\n        return <JsonBasedHandlerConfig\n            name='IPNS Resolve Result'\n            explanation={[\n                'All matching requests will be receive this data as a successful IPNS resolution.'\n            ]}\n            handlerFactory={(data) => new IpnsResolveResultHandler(data)}\n            valueGetter={handler => handler.result}\n            { ...this.props }\n        />;\n    }\n\n}\n\n@observer\nclass IpnsPublishResultHandlerConfig extends HandlerConfig<IpnsPublishResultHandler> {\n\n    render() {\n        return <JsonBasedHandlerConfig\n            name='IPNS Publish Result'\n            explanation={[\n                'All matching requests will be receive this data as a successful IPNS publish result.'\n            ]}\n            handlerFactory={(data) => new IpnsPublishResultHandler(data)}\n            valueGetter={handler => handler.result}\n            { ...this.props }\n        />;\n    }\n\n}\n\n@observer\nclass IpfsPinsResultHandlerConfig extends HandlerConfig<IpfsPinsResultHandler> {\n\n    render() {\n        return <JsonBasedHandlerConfig\n            name='IPFS Pinning Result'\n            explanation={[\n                'All matching requests will be receive this data as a successful response.'\n            ]}\n            handlerFactory={(data) => new IpfsPinsResultHandler(data)}\n            valueGetter={handler => handler.result}\n            { ...this.props }\n        />;\n    }\n\n}\n\n@observer\nclass IpfsPinLsResultHandlerConfig extends HandlerConfig<IpfsPinLsResultHandler> {\n\n    @observable\n    resultPairs: PairsArray = [];\n\n    componentDidMount() {\n        // If the handler changes (or when its set initially), update our data fields\n        disposeOnUnmount(this, autorun(() => {\n            const { result } = this.props.handler;\n\n            runInAction(() => {\n                this.resultPairs = result.map(({ Type, Cid }) => ({ key: Type, value: Cid }));\n            });\n        }));\n    }\n\n    render() {\n        const { resultPairs } = this;\n\n        return <ConfigContainer>\n            <SectionLabel>IPFS Pin Ls Results</SectionLabel>\n\n            <EditablePairs\n                pairs={resultPairs}\n                onChange={this.onChange}\n                keyPlaceholder='Type of pin (recursive, direct, indirect)'\n                valuePlaceholder='CID of the pinned content'\n            />\n            <ConfigExplanation>\n                All matching IPFS Pin Ls calls will be intercepted, and the above results will always\n                be returned directly, without forwarding the call to the real IPFS node.\n            </ConfigExplanation>\n        </ConfigContainer>;\n    }\n\n    @action.bound\n    onChange(newPairs: PairsArray) {\n        this.resultPairs = newPairs;\n\n        this.props.onChange(\n            new IpfsPinLsResultHandler(\n                this.resultPairs.map(({ key, value }) => ({ Type: key, Cid: value }))\n            )\n        );\n    }\n\n}\n\n@observer\nclass RTCEchoHandlerConfig extends HandlerConfig<EchoStepDefinition> {\n\n    render() {\n        return <ConfigContainer>\n            <ConfigExplanation>\n                Echo all sent data messages and all streamed video and audio media\n                back to the intercepted peer wherever possible, until the connection is\n                closed. No data will be forwarded to any connected remote peer.\n            </ConfigExplanation>\n            <ConfigExplanation>\n                Note that in some cases echoing isn't possible - e.g. if the client opens\n                a one-way video stream - in which case that data will simply be dropped.\n            </ConfigExplanation>\n        </ConfigContainer>;\n    }\n\n}\n\n@observer\nclass RTCCloseHandlerConfig extends HandlerConfig<CloseStepDefinition> {\n\n    render() {\n        return <ConfigContainer>\n            <ConfigExplanation>\n                Immediately close the WebRTC connection, with no further response and no\n                data forwarded to any connected remote peer.\n            </ConfigExplanation>\n        </ConfigContainer>;\n    }\n\n}\n\n@observer\nclass RTCWaitForMediaConfig extends HandlerConfig<WaitForMediaStepDefinition> {\n\n    render() {\n        return <ConfigContainer>\n            <ConfigExplanation>\n                Wait until the next WebRTC media data is sent by the client.\n            </ConfigExplanation>\n        </ConfigContainer>\n    }\n\n}\n\n@observer\nclass RTCWaitForDurationConfig extends HandlerConfig<WaitForDurationStepDefinition> {\n\n    @observable\n    duration: number | '' = this.props.handler.durationMs;\n\n    componentDidMount() {\n        // If the handler changes (or when its set initially), update our data fields\n        disposeOnUnmount(this, autorun(() => {\n            const { durationMs } = this.props.handler;\n            runInAction(() => {\n                if (durationMs === 0 && this.duration === '') return; // Allows clearing the input, making it *implicitly* 0\n                this.duration = durationMs;\n            });\n        }));\n    }\n\n    render() {\n        const { duration } = this;\n\n        return <ConfigContainer>\n            Wait for <TextInput\n                type='number'\n                min='0'\n                placeholder='Duration (ms)'\n                value={duration}\n                onChange={this.onChange}\n            /> milliseconds.\n        </ConfigContainer>\n    }\n\n    @action.bound\n    onChange(event: React.ChangeEvent<HTMLInputElement>) {\n        const inputValue = event.target.value;\n\n        const newValue = inputValue === ''\n            ? ''\n            : parseInt(inputValue, 10);\n\n        if (_.isNaN(newValue)) return; // I.e. reject the edit\n\n        this.duration = newValue;\n        this.props.onChange(new WaitForDurationStepDefinition(newValue || 0));\n    }\n\n}\n\n@observer\nclass RTCWaitForChannelConfig extends HandlerConfig<WaitForChannelStepDefinition> {\n\n    render() {\n        const { channelLabel } = this.props.handler;\n\n        return <ConfigContainer>\n            <SectionLabel>Channel Label</SectionLabel>\n            <WideTextInput\n                placeholder='The channel to wait for, or nothing to wait for any channel'\n                value={channelLabel ?? ''}\n                onChange={this.onChange}\n            />\n            <ConfigExplanation>\n                Wait until the client opens a WebRTC data channel {\n                    channelLabel\n                        ? `with the label \"${channelLabel}\"`\n                        : 'with any label'\n                }.\n            </ConfigExplanation>\n        </ConfigContainer>\n    }\n\n    @action.bound\n    onChange(event: React.ChangeEvent<HTMLInputElement>) {\n        const inputValue = event.target.value;\n        this.props.onChange(\n            new WaitForChannelStepDefinition(inputValue || '')\n        );\n    }\n\n}\n\n@observer\nclass RTCWaitForDataMessaageConfig extends HandlerConfig<WaitForMessageStepDefinition> {\n\n    render() {\n        const { channelLabel } = this.props.handler;\n\n        return <ConfigContainer>\n            <SectionLabel>Channel Label</SectionLabel>\n            <WideTextInput\n                placeholder='The channel to watch for messages, or nothing to watch every channel'\n                value={channelLabel ?? ''}\n                onChange={this.onChange}\n            />\n            <ConfigExplanation>\n                Wait until the client sends a WebRTC data message {\n                    channelLabel\n                        ? `on a channel with the label \"${channelLabel}\"`\n                        : 'on any data channel'\n                }.\n            </ConfigExplanation>\n        </ConfigContainer>\n    }\n\n    @action.bound\n    onChange(event: React.ChangeEvent<HTMLInputElement>) {\n        const inputValue = event.target.value;\n        this.props.onChange(\n            new WaitForMessageStepDefinition(inputValue || '')\n        );\n    }\n\n}\n\n@observer\nclass RTCCreateChannelStepConfig extends HandlerConfig<CreateChannelStepDefinition> {\n\n    render() {\n        const { channelLabel } = this.props.handler;\n\n        return <ConfigContainer>\n            <SectionLabel>Channel Label</SectionLabel>\n            <WideTextInput\n                placeholder='A label for the channel that will be created'\n                value={channelLabel}\n                onChange={this.onChange}\n            />\n            <ConfigExplanation>\n                Create a data channel on the WebRTC connection labelled \"{\n                    channelLabel\n                }\".\n            </ConfigExplanation>\n        </ConfigContainer>\n    }\n\n    @action.bound\n    onChange(event: React.ChangeEvent<HTMLInputElement>) {\n        const inputValue = event.target.value;\n        this.props.onChange(new CreateChannelStepDefinition(inputValue));\n    }\n\n}\n\n@observer\nclass RTCSendMessageStepConfig extends HandlerConfig<SendStepDefinition> {\n\n    @observable\n    channelLabel: string | undefined = this.props.handler.channelLabel;\n\n    @observable\n    contentType: EditableContentType = 'text';\n\n    @observable\n    message = asBuffer(this.props.handler.message);\n\n    componentDidMount() {\n        // If the handler changes (or when its set initially), update our data fields\n        disposeOnUnmount(this, autorun(() => {\n            const { channelLabel, message } = this.props.handler;\n            runInAction(() => {\n                this.channelLabel = channelLabel;\n                this.message = asBuffer(message);\n            });\n        }));\n    }\n\n    @computed\n    private get textEncoding() {\n        // If we're handling text data, we want to show & edit it as UTF8.\n        // If it's binary, that's a lossy operation, so we use binary (latin1) instead.\n        return isProbablyUtf8(this.message)\n            ? 'utf8'\n            : 'binary';\n    }\n\n    render() {\n        const { channelLabel, message } = this;\n\n        const messageAsString = message.toString(this.textEncoding);\n\n        return <ConfigContainer>\n            <SectionLabel>Channel Label</SectionLabel>\n            <WideTextInput\n                placeholder='The channel to send the message to, or nothing to send on all open channels'\n                value={channelLabel ?? ''}\n                onChange={this.setChannelLabel}\n            />\n\n            <BodyHeader>\n                <SectionLabel>Message content</SectionLabel>\n                <FormatButton\n                    format={this.contentType}\n                    content={message}\n                    onFormatted={this.setMessage}\n                />\n                <ConfigSelect value={this.contentType} onChange={this.setContentType}>\n                    <option value=\"text\">Plain text</option>\n                    <option value=\"json\">JSON</option>\n                    <option value=\"xml\">XML</option>\n                </ConfigSelect>\n            </BodyHeader>\n            <BodyContainer>\n                <SelfSizedEditor\n                    contentId={null}\n                    language={this.contentType}\n                    value={messageAsString}\n                    onChange={this.setMessage}\n                />\n            </BodyContainer>\n\n            <ConfigExplanation>\n                Send {\n                    message.length === 0\n                        ? 'an empty'\n                        : 'the above'\n                } message on {\n                    channelLabel\n                        ? `any open channel with the label \"${channelLabel}\"`\n                        : 'every open data channel'\n                }.\n            </ConfigExplanation>\n        </ConfigContainer>\n    }\n\n    @action.bound\n    setContentType(event: React.ChangeEvent<HTMLSelectElement>) {\n        const value = event.target.value;\n        this.contentType = value as EditableContentType;\n    }\n\n    @action.bound\n    setChannelLabel(event: React.ChangeEvent<HTMLInputElement>) {\n        const inputValue = event.target.value;\n        this.channelLabel = inputValue || undefined;\n        this.updateHandler();\n    }\n\n    @action.bound\n    setMessage(message: string) {\n        this.message = stringToBuffer(message, this.textEncoding);\n        this.updateHandler();\n    }\n\n    updateHandler() {\n        this.props.onChange(\n            new SendStepDefinition(\n                this.channelLabel,\n                this.message.toString(this.textEncoding) // MockRTC currently (0.3.0) has a bug with sending buffer data\n            )\n        );\n    }\n\n\n}","import * as React from 'react';\n\nimport { styled } from '../../styles';\nimport { noPropagation } from '../component-utils';\n\nimport { TextInput } from '../common/inputs';\nimport { IconMenuButton } from './mock-item-menu';\n\nexport const RuleTitle = styled.h2`\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n\n    flex-basis: 100%;\n    width: 100%;\n    box-sizing: border-box;\n\n    /* Required to avoid overflow trimming hanging chars */\n    padding: 5px;\n    margin: -5px;\n\n    font-style: italic;\n`;\n\nconst EditableTitleContainer = styled.div`\n    flex-basis: 100%;\n    margin: -4px;\n`;\n\nconst TitleInput = styled(TextInput)`\n    width: 30%;\n    margin-right: 5px;\n    margin-bottom: 10px;\n`;\n\nconst TitleEditButton = styled(IconMenuButton)`\n    font-size: 1em;\n    padding: 0;\n    vertical-align: middle;\n`;\n\nexport const EditableRuleTitle = (p: {\n    value: string,\n    onEditTitle: (newValue: string) => void,\n    onSave: (event: React.UIEvent) => void,\n    onCancel?: () => void\n}) => {\n    const editTitle = (e: React.ChangeEvent<HTMLInputElement>) => {\n        p.onEditTitle(e.target.value)\n    };\n\n    return <EditableTitleContainer>\n        <TitleInput\n            autoFocus\n            value={p.value}\n            placeholder='A custom name for this rule'\n            onChange={editTitle}\n            onClick={(e) => e.stopPropagation()}\n            onKeyPress={(e) => {\n                if (e.key === 'Enter') p.onSave(e);\n            }}\n        />\n        <TitleEditButton\n            title=\"Reset changes to rule name\"\n            icon={['fas', 'undo']}\n            disabled={!p.onCancel}\n            onClick={noPropagation(p.onCancel ?? (() => {}))}\n        />\n    </EditableTitleContainer>;\n};","import * as _ from 'lodash';\nimport * as React from 'react';\nimport * as polished from 'polished';\nimport { observer, inject, disposeOnUnmount, Observer } from 'mobx-react';\nimport { action, observable, reaction } from 'mobx';\nimport { Method, matchers } from 'mockttp';\nimport {\n    Draggable,\n    DraggingStyle,\n    NotDraggingStyle,\n    DraggableStateSnapshot\n} from 'react-beautiful-dnd';\n\nimport { styled, css } from '../../styles';\nimport { Icon } from '../../icons';\nimport { UnreachableCheck } from '../../util/error';\n\nimport { getMethodColor, getSummaryColour } from '../../model/events/categorization';\nimport {\n    HtkMockRule,\n    Matcher,\n    Handler,\n    AvailableHandler,\n    isPaidHandler,\n    InitialMatcher,\n    getRuleTypeFromInitialMatcher,\n    isCompatibleHandler,\n    getAvailableAdditionalMatchers,\n    getAvailableHandlers,\n    RuleType,\n    HandlerStep,\n    isFinalHandler,\n    isStepPoweredRule\n} from '../../model/rules/rules';\nimport { ItemPath } from '../../model/rules/rules-structure';\nimport {\n    getRuleDefaultMatchers,\n    updateRuleAfterInitialMatcherChange\n} from '../../model/rules/rule-creation';\nimport {\n    summarizeMatcher,\n    summarizeHandler\n} from '../../model/rules/rule-descriptions';\nimport { AccountStore } from '../../model/account/account-store';\n\nimport { clickOnEnter, noPropagation } from '../component-utils';\nimport { GetProOverlay } from '../account/pro-placeholders';\nimport { LittleCard } from '../common/card';\nimport {\n    InitialMatcherRow,\n    ExistingMatcherRow,\n    NewMatcherRow\n} from './matcher-selection';\nimport { HandlerSelector } from './handler-selection';\nimport { HandlerConfiguration } from './handler-config';\nimport { DragHandle } from './mock-drag-handle';\nimport { IconMenu, IconMenuButton } from './mock-item-menu';\nimport { RuleTitle, EditableRuleTitle } from './mock-rule-title';\n\nconst RowContainer = styled(LittleCard)<{\n    deactivated?: boolean,\n    collapsed: boolean,\n    disabled: boolean,\n    borderColor: string,\n    depth: number\n}>`\n    margin-top: 10px;\n\n    width: calc(100% - ${p => p.depth * 40}px);\n    margin-left: ${p => p.depth * 40}px;\n\n    display: flex;\n    flex-wrap: wrap;\n    flex-direction: row;\n    align-items: center;\n    justify-content: space-between;\n\n    font-size: ${(p) => p.theme.headingSize};\n\n    overflow: initial;\n\n    ${(p) => p.collapsed && !p.disabled\n        ? css`\n            user-select: none;\n\n            &:hover {\n                ${IconMenu} {\n                    display: flex;\n                }\n\n                ${DragHandle} {\n                    opacity: 0.5;\n                }\n            }\n\n            ${p.deactivated && 'opacity: 0.6;'}\n        `\n        : !p.collapsed\n            ? css`\n                ${IconMenu} {\n                    display: flex;\n                }\n            `\n        : ''\n    }\n\n    border-left: 5px solid ${(p) => p.borderColor};\n\n    &:focus {\n        outline: none;\n        box-shadow: 0 0 1px 2px ${p =>\n            polished.rgba(p.theme.popColor, 0.5)\n        };\n        background-color: ${p => p.theme.mainBackground};\n    }\n`;\n\nexport const AddRuleRow = styled((p: {\n    onAdd: () => void,\n    disabled: boolean\n} & React.HTMLAttributes<HTMLDivElement>) =>\n    <RowContainer\n        collapsed={true}\n        borderColor='transparent'\n        {..._.omit(p, 'onAdd')}\n\n        tabIndex={0}\n        depth={0}\n        onClick={p.onAdd}\n        onKeyPress={clickOnEnter}\n    >\n        <Icon icon={['fas', 'plus']} />\n        Add a new rule to rewrite requests or responses\n    </RowContainer>\n)`\n    > svg {\n        margin: 0 5px;\n    }\n\n    margin-top: 20px;\n\n    justify-content: center;\n    background-color: ${p =>\n        polished.rgba(p.theme.mainBackground, 0.4)\n    };\n    box-shadow: 0 0 4px 0 rgba(0,0,0,0.2);\n`;\n\nconst MatcherOrHandler = styled.section`\n    align-self: stretch;\n    flex-grow: 1;\n    flex-basis: 0;\n    max-width: calc(50% - 30px);\n`;\n\nconst Summary = styled.h1`\n    ${(p: { collapsed: boolean }) => !p.collapsed && css`\n        opacity: 0.3;\n    `}\n\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n\n    /* Required to avoid overflow trimming hanging chars */\n    padding: 5px;\n    margin: -5px;\n`;\n\nconst ArrowIcon = styled(Icon).attrs(() => ({\n    icon: ['fas', 'arrow-left']\n}))`\n    transform: rotate(180deg);\n    padding: 0 15px;\n`;\n\nconst Details = styled.div`\n    display: flex;\n    flex-direction: column;\n    text-align: left;\n`;\n\nconst DetailsHeader = styled.div`\n    margin-top: 20px;\n    margin-bottom: 20px;\n`;\n\n\nconst RuleMenuContainer = styled(IconMenu)`\n    background-image: radial-gradient(\n        ${p => polished.rgba(p.theme.mainBackground, 0.9)} 50%,\n        transparent 100%\n    );\n    z-index: 1;\n`;\n\nconst RuleMenu = (p: {\n    isCollapsed: boolean,\n    isNewRule: boolean,\n    hasUnsavedChanges: boolean,\n    isEditingTitle: boolean,\n    onSetCustomTitle: (event: React.UIEvent) => void,\n    onToggleCollapse: (event: React.UIEvent) => void,\n    onSave: (event: React.UIEvent) => void,\n    onReset: (event: React.UIEvent) => void,\n    onClone: (event: React.UIEvent) => void,\n    toggleState: boolean,\n    onToggleActivation: (event: React.UIEvent) => void,\n    onDelete: (event: React.UIEvent) => void,\n}) => <RuleMenuContainer topOffset={7}>\n        <IconMenuButton\n            title='Delete this rule'\n            icon={['far', 'trash-alt']}\n            onClick={p.onDelete}\n        />\n        <IconMenuButton\n            title='Clone this rule'\n            icon={['far', 'clone']}\n            onClick={p.onClone}\n        />\n        <IconMenuButton\n            title={p.toggleState ? 'Deactivate this rule' : 'Activate this rule'}\n            icon={['fas', p.toggleState ? 'toggle-on' : 'toggle-off']}\n            onClick={p.onToggleActivation}\n        />\n        <IconMenuButton\n            title='Give this rule a custom name'\n            icon={['fas', 'edit']}\n            disabled={p.isEditingTitle}\n            onClick={p.onSetCustomTitle}\n        />\n        <IconMenuButton\n            title='Revert this rule to the last saved version'\n            icon={['fas', 'undo']}\n            disabled={!p.hasUnsavedChanges || p.isNewRule}\n            onClick={p.onReset}\n        />\n        <IconMenuButton\n            icon={['fas',\n                p.hasUnsavedChanges\n                    ? 'save'\n                : p.isCollapsed\n                    ? 'chevron-down'\n                : 'chevron-up']}\n            title={\n                p.hasUnsavedChanges\n                    ? 'Save changes to this rule'\n                : p.isCollapsed\n                    ? 'Show rule details'\n                : 'Hide rule details'}\n            onClick={p.hasUnsavedChanges ? p.onSave : p.onToggleCollapse}\n        />\n    </RuleMenuContainer>;\n\nconst extendRowDraggableStyles = (\n    style: DraggingStyle | NotDraggingStyle | undefined,\n    snapshot: DraggableStateSnapshot\n) => {\n    const overrideStyles: _.Dictionary<string> = { };\n\n    if (style && style.transition) {\n        overrideStyles.transition = style.transition.replace(\n            /transform [\\d.]+s/,\n            'transform 100ms'\n        );\n    }\n\n    if (snapshot.combineWith && snapshot.combineWith.endsWith('-tail')) {\n        overrideStyles.opacity = '1';\n    }\n\n    return {\n        ...style,\n        ...overrideStyles\n    };\n};\n\n@inject('accountStore')\n@observer\nexport class RuleRow extends React.Component<{\n    accountStore?: AccountStore,\n\n    index: number;\n    path: ItemPath;\n    rule: HtkMockRule;\n    isNewRule: boolean;\n    hasUnsavedChanges: boolean;\n    collapsed: boolean;\n    disabled: boolean;\n\n    toggleRuleCollapsed: (ruleId: string) => void;\n\n    saveRule: (path: ItemPath) => void;\n    resetRule: (path: ItemPath) => void;\n    deleteRule: (path: ItemPath) => void;\n    cloneRule: (path: ItemPath) => void;\n\n    getRuleDefaultHandler: (type: RuleType) => Handler;\n}> {\n\n    initialMatcherSelect = React.createRef<HTMLSelectElement>();\n    containerRef: HTMLElement | null = null;\n\n    @observable\n    private titleEditState: undefined | { originalTitle?: string };\n\n    render() {\n        const {\n            index,\n            rule,\n            path,\n            isNewRule,\n            hasUnsavedChanges,\n            collapsed,\n            disabled\n        } = this.props;\n        const {\n            isPaidUser,\n            getPro\n        } = this.props.accountStore!;\n\n        const ruleType = rule.type;\n        const initialMatcher = rule.matchers.length ? rule.matchers[0] : undefined;\n\n        let ruleColour: string;\n        if (ruleType === 'http') {\n            if (initialMatcher instanceof matchers.MethodMatcher) {\n                ruleColour = getMethodColor(Method[initialMatcher.method]);\n            } else if (initialMatcher !== undefined) {\n                ruleColour = getMethodColor('unknown');\n            } else {\n                ruleColour = 'transparent';\n            }\n        } else if (ruleType === 'websocket') {\n            ruleColour = getSummaryColour('websocket');\n        } else if (ruleType === 'ethereum') {\n            ruleColour = getSummaryColour('mutative');\n        } else if (ruleType === 'ipfs') {\n            ruleColour = getSummaryColour('html');\n        } else if (ruleType === 'webrtc') {\n            ruleColour = getSummaryColour('rtc-data');\n        } else {\n            throw new UnreachableCheck(ruleType);\n        }\n\n        const availableMatchers = getAvailableAdditionalMatchers(ruleType);\n        const availableHandlers = getAvailableHandlers(ruleType, initialMatcher);\n\n        const ruleHandlers = 'handler' in rule\n            ? [rule.handler]\n            : rule.steps;\n\n        // We show the summary by default, but if you set a custom title, we only show it when expanded:\n        const shouldShowSummary = !collapsed || (!rule.title && !this.titleEditState);\n        const isEditingTitle = !!this.titleEditState && !collapsed;\n\n        return <Draggable\n            draggableId={rule.id}\n            index={index}\n            isDragDisabled={!collapsed}\n        >{ (provided, snapshot) => <Observer>{ () =>\n            <RowContainer\n                {...provided.draggableProps}\n                borderColor={ruleColour}\n                ref={(ref: HTMLElement | null) => {\n                    provided.innerRef(ref);\n                    this.containerRef = ref;\n                }}\n                collapsed={collapsed}\n                deactivated={!rule.activated}\n                disabled={disabled}\n                tabIndex={collapsed ? 0 : undefined}\n                onClick={collapsed ? this.toggleCollapse : undefined}\n                onKeyPress={clickOnEnter}\n                depth={path.length - 1}\n                style={extendRowDraggableStyles(provided.draggableProps.style, snapshot)}\n            >\n                <RuleMenu\n                    isCollapsed={collapsed}\n                    isNewRule={isNewRule}\n                    hasUnsavedChanges={hasUnsavedChanges}\n                    onToggleCollapse={this.toggleCollapse}\n                    onSave={this.saveRule}\n                    onReset={this.resetRule}\n                    toggleState={rule.activated}\n                    onToggleActivation={this.toggleActivation}\n                    onClone={this.cloneRule}\n                    onDelete={this.deleteRule}\n                    isEditingTitle={isEditingTitle}\n                    onSetCustomTitle={this.startEnteringCustomTitle}\n                />\n                <DragHandle {...provided.dragHandleProps} />\n\n                { rule.title && !isEditingTitle &&\n                    <RuleTitle>\n                        { rule.title }\n                    </RuleTitle>\n                }\n\n                { isEditingTitle &&\n                    <EditableRuleTitle\n                        value={rule.title || ''}\n                        onEditTitle={this.editTitle}\n                        onSave={this.saveRule}\n                        onCancel={\n                            this.titleEditState!.originalTitle !== this.props.rule.title\n                            ? this.cancelEditingTitle\n                            : undefined\n                        }\n                    />\n                }\n\n                <MatcherOrHandler>\n                    { shouldShowSummary &&\n                        <Summary collapsed={collapsed} title={summarizeMatcher(rule)}>\n                            { summarizeMatcher(rule) }\n                        </Summary>\n                    }\n\n                    {\n                        !collapsed && <Details>\n                            <DetailsHeader>Match:</DetailsHeader>\n\n                            <ul>\n                                <InitialMatcherRow\n                                    ref={this.initialMatcherSelect}\n                                    matcher={initialMatcher}\n                                    onChange={this.setInitialMatcher}\n                                />\n\n                                { rule.matchers.slice(1).map((matcher, i) =>\n                                    <ExistingMatcherRow\n                                        key={`${i}/${rule.matchers.length}`}\n                                        matcher={matcher}\n                                        matcherIndex={i}\n                                        onChange={(...ms) => this.updateMatcher(i + 1, ...ms)}\n                                        onDelete={() => this.deleteMatcher(matcher)}\n                                    />\n                                )}\n\n                                { rule.matchers.length > 0 &&\n                                    <NewMatcherRow\n                                        key={rule.type} // Reset when type changes\n                                        availableMatchers={availableMatchers}\n                                        existingMatchers={rule.matchers}\n                                        onAdd={this.addMatcher}\n                                    />\n                                }\n                            </ul>\n                        </Details>\n                    }\n                </MatcherOrHandler>\n\n\n                { shouldShowSummary &&\n                    <ArrowIcon />\n                }\n\n                <MatcherOrHandler>\n                    { shouldShowSummary &&\n                        <Summary collapsed={collapsed} title={ summarizeHandler(rule) }>\n                            { summarizeHandler(rule) }\n                        </Summary>\n                    }\n\n                    {\n                        !collapsed && <Details>\n                            <DetailsHeader>Then:</DetailsHeader>\n\n                            { ruleHandlers.map((ruleHandler, i) =>\n                                <HandlerStepSection\n                                    key={i}\n\n                                    handler={ruleHandler}\n                                    handlerIndex={i}\n\n                                    isPaidUser={isPaidUser}\n                                    getPro={getPro}\n                                    ruleType={ruleType}\n                                    availableHandlers={availableHandlers}\n                                    updateHandler={this.updateHandler}\n                                />\n                            )}\n                        </Details>\n                    }\n                </MatcherOrHandler>\n            </RowContainer>\n        }</Observer>}</Draggable>;\n    }\n\n    saveRule = noPropagation(() => {\n        this.stopEditingTitle();\n        this.props.saveRule(this.props.path);\n    });\n    resetRule = noPropagation(() => {\n        this.stopEditingTitle();\n        this.props.resetRule(this.props.path);\n    });\n    deleteRule = noPropagation(() => this.props.deleteRule(this.props.path));\n    cloneRule = noPropagation(() => this.props.cloneRule(this.props.path));\n\n    @action.bound\n    toggleActivation(event: React.UIEvent) {\n        const { rule } = this.props;\n        rule.activated = !rule.activated;\n        event.stopPropagation();\n    }\n\n    toggleCollapse = noPropagation(() => {\n        // Scroll the row into view, after giving it a moment to rerender\n        requestAnimationFrame(() => {\n            if (this.containerRef) {\n                this.containerRef.scrollIntoView({\n                    block: 'nearest',\n                    behavior: 'smooth'\n                });\n            }\n            if (this.initialMatcherSelect.current) {\n                this.initialMatcherSelect.current.focus();\n                // Clear selection too (sometimes clicking fast selects the rule title)\n                getSelection()?.empty();\n            }\n        });\n\n        this.props.toggleRuleCollapsed(this.props.rule.id);\n        this.stopEditingTitle();\n    });\n\n    @action.bound\n    setInitialMatcher(matcher: InitialMatcher) {\n        const currentRuleType = this.props.rule.type;\n        const newRuleType = getRuleTypeFromInitialMatcher(matcher);\n\n        if (currentRuleType === newRuleType) {\n            this.props.rule.matchers[0] = matcher;\n        } else {\n            this.props.rule.type = newRuleType;\n\n            this.props.rule.matchers = getRuleDefaultMatchers(\n                newRuleType,\n                matcher,\n                this.props.rule.matchers // Update from the old matchers\n            ) as any[];\n        }\n\n        // Reset the rule handler/steps, if incompatible:\n        const handlerResetRequired = 'handler' in this.props.rule\n            ? !isCompatibleHandler(this.props.rule.handler, matcher)\n            : !this.props.rule.steps.every(step => isCompatibleHandler(step, matcher));\n\n        if (handlerResetRequired) {\n            const newHandler = this.props.getRuleDefaultHandler(newRuleType);\n            if (isStepPoweredRule(this.props.rule)) {\n                (this.props.rule as { steps: HandlerStep[] }).steps = [newHandler as HandlerStep];\n                delete (this.props.rule as any).handler;\n            } else {\n                (this.props.rule as { handler: Handler }).handler = newHandler;\n                delete (this.props.rule as any).steps;\n            }\n        }\n\n        updateRuleAfterInitialMatcherChange(this.props.rule);\n    }\n\n    @action.bound\n    addMatcher(matcher: Matcher) {\n        // TS struggles with complex union types here, so we cast more generally:\n        const rule = this.props.rule as { matchers: Matcher[] };\n        rule.matchers.push(matcher);\n    }\n\n    @action.bound\n    updateMatcher(index: number, ...matchers: Matcher[]) {\n        // TS struggles with complex union types here, so we cast more generally:\n        const rule = this.props.rule as { matchers: Matcher[] };\n        rule.matchers.splice(index, 1, ...matchers);\n    }\n\n    @action.bound\n    deleteMatcher(matcher: Matcher) {\n        // TS struggles with complex union types here, so we cast more generally:\n        const rule = this.props.rule as { matchers: Matcher[] };\n        rule.matchers = rule.matchers.filter(m => m !== matcher);\n    }\n\n    @action.bound\n    updateHandler(handlerIndex: number, handler: Handler) {\n        // TS struggles with complex union types here, so we cast more generally:\n        const rule = this.props.rule as\n            | { handler: Handler }\n            | { steps: HandlerStep[] };\n\n        if ('handler' in rule) {\n            if (handlerIndex !== 0) throw new Error('Single-handler rules cannot have additional steps');\n            rule.handler = handler;\n        } else {\n            rule.steps[handlerIndex] = handler as HandlerStep;\n\n            if (isFinalHandler(handler)) {\n                // If this is final, slice off anything after this step, it's all invalid\n                rule.steps = rule.steps.slice(0, handlerIndex + 1);\n            } else {\n                // If at any point you change the last step to be a non-final step, we append a default\n                // (must be final) step to allow continuing the rule:\n                if (handlerIndex === rule.steps.length - 1) {\n                    rule.steps.push(this.props.getRuleDefaultHandler(this.props.rule.type) as HandlerStep);\n                }\n            }\n        }\n    }\n\n    @action.bound\n    startEnteringCustomTitle(event: React.UIEvent) {\n        this.titleEditState = { originalTitle: this.props.rule.title };\n        // We expand the row, but not with toggleCollapsed, because we don't want\n        // to auto-focus the matcher like normal:\n        if (this.props.collapsed) this.props.toggleRuleCollapsed(this.props.rule.id);\n        event.stopPropagation();\n    }\n\n    @action.bound\n    editTitle(newTitle: string | undefined) {\n        this.props.rule.title = newTitle || undefined;\n    }\n\n    @action.bound\n    cancelEditingTitle() {\n        if (!this.titleEditState) return;\n        this.editTitle(this.titleEditState.originalTitle);\n        this.titleEditState = undefined;\n    }\n\n    @action.bound\n    stopEditingTitle() {\n        if (!this.titleEditState) return;\n\n        // Trim titles on save, so that e.g. space-only titles are dropped:\n        if (this.props.rule.title !== this.titleEditState.originalTitle) {\n            this.props.rule.title = this.props.rule.title?.trim() || undefined;\n        }\n\n        this.titleEditState = undefined;\n    }\n\n}\n\n@observer\nclass HandlerStepSection extends React.Component<{\n    isPaidUser: boolean;\n    getPro: (source: string) => void;\n    ruleType: RuleType;\n    handlerIndex: number;\n    handler: Handler;\n\n    availableHandlers: AvailableHandler[];\n    updateHandler: (handlerIndex: number, handler: Handler) => void;\n}> {\n\n    @observable\n    private demoHandler: Handler | undefined;\n\n    componentDidMount() {\n        // If the actual handler ever changes, dump our demo handler state:\n        disposeOnUnmount(this, reaction(\n            () => this.props.handler,\n            () => { this.demoHandler = undefined; }\n        ));\n    }\n\n    render() {\n        const {\n            isPaidUser,\n            getPro,\n            ruleType,\n            availableHandlers,\n            handler\n        } = this.props;\n\n        const shownHandler = this.demoHandler ?? handler;\n\n        const isHandlerDemo = !isPaidUser &&\n            shownHandler &&\n            isPaidHandler(ruleType, shownHandler);\n\n        return <>\n            <HandlerSelector\n                value={shownHandler}\n                ruleType={ruleType}\n                onChange={this.updateHandler}\n                availableHandlers={availableHandlers}\n            />\n\n            { isHandlerDemo\n                // If you select a paid handler with an unpaid account,\n                // show a handler demo with a 'Get Pro' overlay:\n                ? <GetProOverlay getPro={getPro} source={`rule-${handler.type}`}>\n                    <HandlerConfiguration\n                        ruleType={ruleType}\n                        handler={shownHandler}\n                        onChange={_.noop}\n                    />\n                </GetProOverlay>\n                : <HandlerConfiguration\n                    ruleType={ruleType}\n                    handler={shownHandler}\n                    onChange={this.updateHandler}\n                />\n            }\n        </>;\n    }\n\n    @action.bound\n    updateHandler(handler: Handler) {\n        const { isPaidUser, handlerIndex, ruleType, updateHandler } = this.props;\n\n        // You can never update a paid handler if you're not a paid user\n        if (!isPaidUser && isPaidHandler(ruleType, handler)) {\n            this.demoHandler = handler;\n        } else {\n            updateHandler(handlerIndex, handler);\n        }\n    }\n\n}","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { observable, action } from 'mobx';\nimport { observer, Observer } from 'mobx-react'\nimport { Droppable, DragDropContext, BeforeCapture, DropResult } from 'react-beautiful-dnd';\n\nimport { styled } from '../../styles';\n\nimport {\n    areItemsEqual,\n    HtkMockRuleGroup,\n    ItemPath,\n    findItemPath,\n    HtkMockRuleRoot,\n    getItemParentByPath,\n    isRuleGroup,\n    comparePaths,\n    getItemAtPath,\n    findItem,\n} from '../../model/rules/rules-structure';\nimport { Handler, HandlerStep, HtkMockRule, RuleType } from '../../model/rules/rules';\n\nimport { GroupHeader, GroupTail } from './mock-rule-group';\nimport { AddRuleRow, RuleRow } from './mock-rule-row';\n\nconst MockRuleListContainer = styled.ol`\n    padding: 0 40px 20px;\n    min-height: calc(100% - 40px);\n`;\n\nfunction getDragTarget(\n    indexMapping: Array<ItemPath>,\n    rules: HtkMockRuleRoot,\n    sourceIndex: number,\n    destinationIndex: number\n) {\n    const sourcePath = indexMapping[sourceIndex];\n    const displacedItemPath = indexMapping[destinationIndex];\n\n    const pathComparison = comparePaths(sourcePath, displacedItemPath);\n\n    const displacedItemParent = getItemParentByPath(rules, displacedItemPath);\n    const displacedItemIndex = _.last(displacedItemPath)!;\n\n    // Avoid reading off the end of the children (for group tail elements),\n    // to stop mobx complaining at us.\n    const displacedItem = displacedItemParent.items.length > displacedItemIndex\n        ? getItemAtPath(rules, displacedItemPath)\n        : undefined;\n\n    const sourceParentPath = sourcePath.slice(0, -1);\n    const targetParentPath = displacedItemPath.slice(0, -1);\n\n    if (\n        displacedItem &&\n        isRuleGroup(displacedItem) &&\n        !displacedItem.collapsed &&\n        pathComparison > 0\n    ) {\n        // If you displace an expanded group header below you from above, then\n        // you're actually entering the top of the group\n        return { sourcePath, targetPath: displacedItemPath.concat(0) };\n    }\n\n    if (displacedItem === undefined && pathComparison > 0) {\n        // If you displace the empty space at the end of a group from above,\n        // then you actually want to be just after the outside of the group\n\n        // If the group (tail's parent) has the same parent we do, then removing\n        // this node will update it's index, so we need to avoid overshooting\n        const targetParentParentPath = targetParentPath.slice(0, -1);\n        const offset = _.isEqual(sourceParentPath, targetParentParentPath)\n            ? 0\n            : 1;\n\n        return {\n            sourcePath,\n            targetPath: displacedItemPath\n                .slice(0, -2) // Without the tail or parent group index\n                .concat(displacedItemPath[displacedItemPath.length - 2] + offset) // _After_ the parent group\n        }\n    }\n\n    if (!_.isEqual(sourceParentPath, targetParentPath)) {\n        // Moving in/out of a group, displacing an item there. This means we can't\n        // do a simple move, because the displaced target won't move as we expect\n        // (when we remove the source element, the targets index won't change).\n        const targetIndex = _.last(displacedItemPath)!;\n\n        return {\n            sourcePath,\n            targetPath: pathComparison < 0\n                // The item to displace is above the source item (going upwards)\n                ? targetParentPath.concat(targetIndex)\n                // The item to displace is below the source item (going downwards)\n                // We know its not equal, due to the outer equal parent check\n                : targetParentPath.concat(targetIndex + 1)\n        };\n    }\n\n    return { sourcePath, targetPath: displacedItemPath };\n}\n\n@observer\nexport class MockRuleList extends React.Component<{\n    draftRules: HtkMockRuleRoot,\n    activeRules: HtkMockRuleRoot,\n\n    addRule: () => void,\n    saveRule: (path: ItemPath) => void,\n    resetRule: (path: ItemPath) => void,\n    cloneItem: (path: ItemPath) => void,\n    deleteItem: (path: ItemPath) => void,\n    toggleRuleCollapsed: (id: string) => void,\n    updateGroupTitle: (groupId: string, title: string) => void,\n    getRuleDefaultHandler: (ruleType: RuleType) => Handler,\n\n    moveRule: (currentPath: ItemPath, targetPath: ItemPath) => void,\n    combineRulesAsGroup: (sourcePath: ItemPath, targetPath: ItemPath) => void,\n\n    collapsedRulesMap: { [id: string]: boolean }\n}> {\n\n    @observable currentlyDraggingRuleId: string | undefined;\n\n    private wasGroupOpenBeforeDrag: boolean | undefined;\n\n    @action.bound\n    beforeDrag({ draggableId }: BeforeCapture) {\n        this.currentlyDraggingRuleId = draggableId;\n\n        const item = findItem(this.props.draftRules, { id: draggableId });\n        if (item && isRuleGroup(item)) {\n            this.wasGroupOpenBeforeDrag = !item.collapsed;\n            item.collapsed = true;\n        } else {\n            this.wasGroupOpenBeforeDrag = undefined;\n        }\n    }\n\n    buildDragEndListener = (indexMapping: Array<ItemPath>, rules: HtkMockRuleRoot) =>\n        action(({ source, destination, combine }: DropResult) => {\n            this.currentlyDraggingRuleId = undefined;\n\n            const { draftRules } = this.props;\n\n            if (combine) {\n                const sourcePath = indexMapping[source.index];\n                const isTail = combine.draggableId.endsWith('-tail');\n                const targetId = isTail ? combine.draggableId.slice(0, -5) : combine.draggableId;\n\n                const targetPath = findItemPath(draftRules, { id: targetId })!;\n                const targetItem = getItemAtPath(draftRules, targetPath);\n\n                if (isRuleGroup(targetItem)) {\n                    this.props.moveRule(\n                        sourcePath,\n                        targetPath.concat(isTail ? targetItem.items.length : 0)\n                    );\n                } else {\n                    this.props.combineRulesAsGroup(\n                        sourcePath,\n                        targetPath\n                    );\n                }\n\n                return;\n            }\n\n            if (!destination) {\n                if (this.wasGroupOpenBeforeDrag) {\n                    const path = indexMapping[source.index];\n                    const item = getItemAtPath(draftRules, path) as HtkMockRuleGroup;\n                    item.collapsed = false;\n                }\n\n                return;\n            }\n\n            const { sourcePath, targetPath } = getDragTarget(\n                indexMapping,\n                rules,\n                source.index,\n                destination.index\n            );\n\n            this.props.moveRule(\n                sourcePath,\n                targetPath\n            );\n\n            if (this.wasGroupOpenBeforeDrag) {\n                const item = getItemAtPath(draftRules, targetPath) as HtkMockRuleGroup;\n                item.collapsed = false;\n            }\n        });\n\n    render() {\n        const {\n            draftRules,\n            activeRules,\n\n            addRule,\n            saveRule,\n            resetRule,\n            deleteItem,\n            cloneItem,\n            toggleRuleCollapsed,\n            updateGroupTitle,\n            getRuleDefaultHandler,\n\n            collapsedRulesMap\n        } = this.props;\n        const {\n            beforeDrag,\n            buildDragEndListener,\n            currentlyDraggingRuleId,\n        } = this;\n\n\n        const { ruleRows, indexMapping } = buildRuleRows(\n            draftRules,\n            activeRules,\n            collapsedRulesMap,\n            currentlyDraggingRuleId,\n            toggleRuleCollapsed,\n            saveRule,\n            resetRule,\n            cloneItem,\n            deleteItem,\n            updateGroupTitle,\n            getRuleDefaultHandler\n        );\n\n        return <DragDropContext\n            onBeforeCapture={beforeDrag}\n            onDragEnd={buildDragEndListener(indexMapping, draftRules)}\n        >\n            <Droppable\n                isCombineEnabled={true}\n                droppableId='mock-rule-list'\n            >{(provided) => <Observer>{() =>\n                <MockRuleListContainer\n                    ref={provided.innerRef}\n                    {...provided.droppableProps}\n                >\n                    <AddRuleRow\n                        onAdd={addRule}\n                        disabled={currentlyDraggingRuleId !== undefined}\n                    />\n\n                    { ruleRows }\n\n                    { provided.placeholder }\n                </MockRuleListContainer>\n            }</Observer>}</Droppable>\n        </DragDropContext>\n    };\n}\n\ntype RuleRowsData = { indexMapping: Array<ItemPath>, ruleRows: Array<React.ReactNode> };\n\nfunction buildRuleRows(\n    allDraftRules: HtkMockRuleRoot,\n    allActiveRules: HtkMockRuleRoot,\n    collapsedRulesMap: { [id: string]: boolean },\n    currentlyDraggingRuleId: string | undefined,\n\n    toggleRuleCollapsed: (ruleId: string) => void,\n    saveRule: (path: ItemPath) => void,\n    resetRule: (path: ItemPath) => void,\n    cloneItem: (path: ItemPath) => void,\n    deleteItem: (path: ItemPath) => void,\n    updateGroupTitle: (groupId: string, title: string) => void,\n    getRuleDefaultHandler: (ruleType: RuleType) => Handler,\n\n    ruleGroup: HtkMockRuleGroup = allDraftRules,\n    ruleGroupPath: ItemPath = [],\n    overallStartIndex = 0,\n): RuleRowsData {\n    const rowEventHandlers = {\n        toggleRuleCollapsed,\n        saveRule,\n        resetRule,\n        cloneRule: cloneItem,\n        deleteRule: deleteItem,\n        getRuleDefaultHandler\n    };\n\n    return ruleGroup.items.reduce<RuleRowsData>((result, item, index) => {\n        const itemPath = ruleGroupPath.concat(index);\n\n        if (isRuleGroup(item)) {\n            result.ruleRows.push(\n                <GroupHeader\n                    key={item.id}\n                    group={item}\n                    path={itemPath}\n                    index={overallStartIndex + result.indexMapping.length}\n                    collapsed={!!item.collapsed}\n                    updateGroupTitle={updateGroupTitle}\n                    cloneGroup={cloneItem}\n                    deleteGroup={deleteItem}\n                />\n            );\n            result.indexMapping.push(itemPath);\n\n            // We skip the children & tail of collapsed groups\n            if (item.collapsed) return result;\n\n            const subResult = buildRuleRows(\n                allDraftRules,\n                allActiveRules,\n                collapsedRulesMap,\n                currentlyDraggingRuleId,\n\n                toggleRuleCollapsed,\n                saveRule,\n                resetRule,\n                cloneItem,\n                deleteItem,\n                updateGroupTitle,\n                getRuleDefaultHandler,\n\n                item,\n                itemPath,\n                overallStartIndex + result.indexMapping.length\n            );\n\n            result.ruleRows.push(...subResult.ruleRows);\n            result.indexMapping.push(...subResult.indexMapping);\n\n            result.ruleRows.push(\n                <GroupTail\n                    key={item.id + '-tail'}\n                    group={item}\n                    index={overallStartIndex + result.indexMapping.length}\n                />\n            );\n            // The tail element maps to the empty space after the end of the group\n            result.indexMapping.push(itemPath.concat(item.items.length));\n        } else {\n            const isCollapsed = collapsedRulesMap[item.id];\n            const changed = getChangedState(item, itemPath, allDraftRules, allActiveRules);\n\n            result.ruleRows.push(<RuleRow\n                key={item.id}\n                index={overallStartIndex + result.indexMapping.length}\n\n                path={itemPath}\n                rule={item}\n\n                isNewRule={changed === 'new'}\n                hasUnsavedChanges={!!changed}\n\n                collapsed={isCollapsed}\n                disabled={\n                    // When dragging, disable all other rules\n                    currentlyDraggingRuleId !== undefined &&\n                    currentlyDraggingRuleId !== item.id\n                }\n\n                {...rowEventHandlers}\n            />);\n\n            result.indexMapping.push(itemPath);\n        }\n\n        return result;\n    }, { indexMapping: [], ruleRows: [] });\n}\n\nfunction getChangedState(\n    draftRule: HtkMockRule,\n    draftPath: ItemPath,\n    draftRules: HtkMockRuleRoot,\n    activeRules: HtkMockRuleRoot\n): 'changed' | 'new' | false {\n    const activePath = findItemPath(activeRules, { id: draftRule.id });\n    if (!activePath) return 'new';\n\n    const draftParent = getItemParentByPath(draftRules, draftPath);\n    const activeParent = getItemParentByPath(activeRules, activePath);\n    const activeRule = activeParent.items[_.last(activePath)!];\n\n    if (activeParent.id !== draftParent.id) {\n        // Changed group\n        return 'changed';\n    }\n\n    const activeCommonSiblings = _.intersectionBy(activeParent.items, draftParent.items, 'id');\n    const draftCommonSiblings = _.intersectionBy(draftParent.items, activeParent.items, 'id');\n\n    if (activeCommonSiblings.indexOf(activeRule) !== draftCommonSiblings.indexOf(draftRule)) {\n        // Changed order within group\n        return 'changed';\n    }\n\n    if (!_.isEqualWith(activeRule, draftRule, areItemsEqual)) {\n        // Rule content changed\n        return 'changed';\n    }\n\n    return false;\n}","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { action, observable, autorun, runInAction } from 'mobx';\nimport { observer, inject, disposeOnUnmount } from 'mobx-react';\nimport * as dateFns from 'date-fns';\n\nimport { styled } from '../../styles';\nimport { WithInjected } from '../../types';\nimport { Icon } from '../../icons';\nimport { logError } from '../../errors';\nimport { uploadFile, saveFile } from '../../util/ui';\n\nimport { RulesStore } from '../../model/rules/rules-store';\nimport { AccountStore } from '../../model/account/account-store';\n\nimport { RuleType } from '../../model/rules/rules';\nimport { getNewRule, getRuleDefaultHandler } from '../../model/rules/rule-creation';\nimport {\n    cloneItem,\n    getItemAtPath,\n    isRuleGroup,\n    ItemPath,\n    mapRules\n} from '../../model/rules/rules-structure';\nimport { SERIALIZED_RULES_MIME_TYPE, serializeRules } from '../../model/rules/rule-serialization';\n\nimport { clickOnEnter } from '../component-utils';\nimport { Button, SecondaryButton } from '../common/inputs';\nimport { MockRuleList } from './mock-rule-list';\n\ninterface MockPageProps {\n    className?: string;\n    rulesStore: RulesStore;\n    accountStore: AccountStore;\n\n    navigate: (path: string) => void;\n    initialRuleId?: string;\n}\n\nconst MockPageContainer = styled.section`\n    box-sizing: border-box;\n    height: 100%;\n    width: 100%;\n    display: flex;\n    flex-flow: column;\n    align-items: stretch;\n`;\n\nconst MockPageScrollContainer = styled.div`\n    overflow-y: scroll;\n    flex-grow: 1;\n`;\n\nconst MockPageHeader = styled.header`\n    box-sizing: border-box;\n    width: 100%;\n    padding: 20px calc(40px + 16px) 20px 40px; /* ~16px to match scrollbar below */\n    background-color: ${p => p.theme.containerBackground};\n    border-bottom: 1px solid rgba(0,0,0,0.12);\n    box-sizing: border-box;\n\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n`;\n\nconst MockHeading = styled.h1`\n    font-size: ${p => p.theme.loudHeadingSize};\n    font-weight: bold;\n    flex-grow: 1;\n`;\n\nconst SaveButton = styled(Button)`\n    font-size: ${p => p.theme.textSize};\n    font-weight: bold;\n    padding: 10px 24px;\n    margin-left: 20px;\n\n    svg {\n        margin-right: 5px;\n    }\n`;\nconst OtherButton = styled(SecondaryButton)`\n    border: none;\n    font-size: 1.2em;\n    padding: 5px 10px;\n    margin-left: 10px;\n`;\n\n@inject('rulesStore')\n@inject('accountStore')\n@observer\nclass MockPage extends React.Component<MockPageProps> {\n\n    containerRef = React.createRef<HTMLDivElement>();\n\n    // Map from rule id -> collapsed (true/false)\n    @observable\n    collapsedRulesMap = _.fromPairs(\n        mapRules(this.props.rulesStore.draftRules, (rule) =>\n            [\n                rule.id,\n                rule.id !== this.props.initialRuleId // We might start with a rule expanded\n            ] as [string, boolean]\n        )\n    );\n\n    componentDidMount() {\n        // If the list of rules ever changes, update the collapsed list accordingly.\n        // Drop now-unnecessary ids, and add new rules (defaulting to collapsed)\n        disposeOnUnmount(this, autorun(() => {\n            const ruleIds = mapRules(this.props.rulesStore.draftRules, r => r.id);\n            const ruleMapIds = _.keys(this.collapsedRulesMap);\n\n            const extraIds = _.difference(ruleMapIds, ruleIds);\n            const missingIds = _.difference(ruleIds, ruleMapIds);\n\n            runInAction(() => {\n                extraIds.forEach((extraId) => {\n                    delete this.collapsedRulesMap[extraId];\n                });\n\n                missingIds.forEach((missingId) => {\n                    this.collapsedRulesMap[missingId] = true;\n                });\n            });\n        }));\n\n        // If a rule was initially selected, scroll to it.\n        const { initialRuleId } = this.props;\n        const container = this.containerRef.current;\n        if (initialRuleId && container) {\n            const ruleElement = container.querySelector(\n                `[data-rbd-draggable-id=\"${initialRuleId}\"]`\n            );\n\n            // Leave a little time for e.g. Monaco to render, then hop to it.\n            requestAnimationFrame(() => ruleElement?.scrollIntoView());\n        }\n    }\n\n    render(): JSX.Element {\n        const {\n            rules,\n            draftRules,\n            areSomeRulesUnsaved,\n            areSomeRulesNonDefault,\n            deleteDraftItem,\n            moveDraftRule,\n            updateGroupTitle,\n            combineDraftRulesAsGroup\n        } = this.props.rulesStore;\n        const { isPaidUser } = this.props.accountStore;\n\n        return <MockPageContainer ref={this.containerRef}>\n            <MockPageHeader>\n                <MockHeading>Mock & Rewrite HTTP</MockHeading>\n\n                <OtherButton\n                    disabled={!areSomeRulesNonDefault}\n                    onClick={this.resetToDefaults}\n                    onKeyPress={clickOnEnter}\n                    title=\"Reset rules to default\"\n                >\n                    <Icon icon={['far', 'trash-alt']} />\n                </OtherButton>\n                <OtherButton\n                    disabled={!isPaidUser}\n                    onClick={this.importRules}\n                    onKeyPress={clickOnEnter}\n                    title={\n                        isPaidUser\n                            ? 'Import a saved set of rules'\n                            : (\n                                'With Pro: Import a set of saved rules, so you can build your ' +\n                                'own ready-to-use collections of predefined rules'\n                            )\n                    }\n                >\n                    <Icon icon={['fas', 'folder-open']} />\n                </OtherButton>\n                <OtherButton\n                    disabled={!isPaidUser || !areSomeRulesNonDefault || draftRules.items.length === 0}\n                    onClick={this.exportRules}\n                    onKeyPress={clickOnEnter}\n                    title={\n                        isPaidUser\n                            ? 'Export these rules'\n                            : 'With Pro: Export these rules, to save them for quick reuse later'\n                    }\n                >\n                    <Icon icon={['fas', 'download']} />\n                </OtherButton>\n                <OtherButton\n                    disabled={!areSomeRulesUnsaved}\n                    onClick={this.resetRuleDrafts}\n                    onKeyPress={clickOnEnter}\n                    title=\"Revert changes since the last save\"\n                >\n                    <Icon icon={['fas', 'undo']} />\n                </OtherButton>\n                <SaveButton\n                    disabled={!areSomeRulesUnsaved}\n                    onClick={this.saveAll}\n                    onKeyPress={clickOnEnter}\n                    title=\"Save all rule changes\"\n                >\n                    <Icon icon={['fas', 'save']} /> Save changes\n                </SaveButton>\n            </MockPageHeader>\n\n            <MockPageScrollContainer>\n                <MockRuleList\n                    activeRules={rules}\n                    draftRules={draftRules}\n                    collapsedRulesMap={this.collapsedRulesMap}\n\n                    addRule={this.addRule}\n                    saveRule={this.saveRule}\n                    resetRule={this.resetRule}\n                    cloneItem={this.cloneItem}\n                    deleteItem={deleteDraftItem}\n                    toggleRuleCollapsed={this.toggleRuleCollapsed}\n                    updateGroupTitle={updateGroupTitle}\n                    getRuleDefaultHandler={this.getRuleDefaultHandler}\n\n                    moveRule={moveDraftRule}\n                    combineRulesAsGroup={combineDraftRulesAsGroup}\n                />\n            </MockPageScrollContainer>\n        </MockPageContainer>\n    }\n\n    @action.bound\n    collapseAll() {\n        Object.keys(this.collapsedRulesMap).forEach((ruleId) => {\n            this.collapsedRulesMap[ruleId] = true;\n        });\n    }\n\n    @action.bound\n    saveRule(path: ItemPath) {\n        const savedRule = this.props.rulesStore.saveItem(path);\n        this.collapsedRulesMap[savedRule.id] = true;\n    }\n\n    @action.bound\n    resetRule(path: ItemPath) {\n        this.props.rulesStore.resetRule(path);\n    }\n\n    @action.bound\n    cloneItem(path: ItemPath) {\n        const rules = this.props.rulesStore.draftRules;\n\n        const clonedItem = cloneItem(getItemAtPath(rules, path));\n\n        if (isRuleGroup(clonedItem)) {\n            clonedItem.collapsed = true;\n        } else {\n            this.collapsedRulesMap[clonedItem.id] = true;\n        }\n\n        const existingChildIndex = _.last(path)!;\n\n        this.props.rulesStore.addDraftItem(\n            clonedItem,\n            // Place the cloned rule directly after the existing rule\n            [...path.slice(0, -1), existingChildIndex + 1]\n        );\n    }\n\n    @action.bound\n    saveAll() {\n        this.props.rulesStore.saveRules();\n        this.collapseAll();\n    }\n\n    @action.bound\n    resetToDefaults() {\n        const confirmResult = confirm(\"Reset all rules?\");\n        if (!confirmResult) return;\n\n        this.props.rulesStore.resetRulesToDefault();\n        this.collapseAll();\n    }\n\n    @action.bound\n    resetRuleDrafts() {\n        this.props.rulesStore.resetRuleDrafts();\n        this.collapseAll();\n    }\n\n    @action.bound\n    addRule() {\n        const newRule = getNewRule(this.props.rulesStore);\n        // When you explicitly add a new rule, start it off expanded.\n        this.collapsedRulesMap[newRule.id] = false;\n        this.props.rulesStore.addDraftItem(newRule);\n\n        // Wait briefly for the new rule to appear, then focus its first dropdown\n        setTimeout(() => {\n            const container = this.containerRef.current;\n            if (!container) return;\n\n            const dropdown = container.querySelector(\n                'ol > section:nth-child(2) select'\n            ) as HTMLSelectElement | undefined;\n            if (dropdown) dropdown.focus();\n            // If there's a race, this will just do nothing\n        }, 100);\n    }\n\n    @action.bound\n    toggleRuleCollapsed(ruleId: string) {\n        this.collapsedRulesMap[ruleId] = !this.collapsedRulesMap[ruleId];\n    }\n\n    getRuleDefaultHandler = (type: RuleType) => {\n        return getRuleDefaultHandler(type, this.props.rulesStore);\n    };\n\n    readonly importRules = async () => {\n        const uploadedFile = await uploadFile('text', [\n            '.htkrules',\n            'application/json',\n            'application/htkrules+json'\n        ]);\n        if (uploadedFile) {\n            try {\n                this.props.rulesStore.loadSavedRules(\n                    JSON.parse(uploadedFile)\n                );\n            } catch (e) {\n                logError(e);\n                alert(`Rules could not be imported: ${e}`);\n            }\n        }\n    }\n\n    readonly exportRules = async () => {\n        const rulesetContent = JSON.stringify(\n            serializeRules(this.props.rulesStore.draftRules)\n        );\n\n        const filename = `HTTPToolkit_${\n            dateFns.format(Date.now(), 'YYYY-MM-DD_HH-mm')\n        }.htkrules`;\n\n        saveFile(filename, SERIALIZED_RULES_MIME_TYPE, rulesetContent);\n    }\n}\n\n// Exclude stores etc from the external props, as they're injected\nconst InjectedMockPage = MockPage as unknown as WithInjected<\n    typeof MockPage,\n    'rulesStore' | 'accountStore' | 'navigate'\n>;\nexport { InjectedMockPage as MockPage };","import * as React from 'react';\nimport { observer } from 'mobx-react';\n\nimport { styled } from '../../styles';\nimport { RawHeaders } from '../../types';\n\nimport {\n    CollapsibleCardHeading,\n    ExpandableCardProps\n} from '../common/card';\nimport {\n    SendCardSection\n} from './send-card-section';\nimport { EditableRawHeaders } from '../common/editable-headers';\nimport { ExpandShrinkButton } from '../common/expand-shrink-button';\nimport { CollapsingButtons } from '../common/collapsing-buttons';\n\nexport interface SendRequestHeadersProps extends ExpandableCardProps {\n    headers: RawHeaders;\n    updateHeaders: (headers: RawHeaders) => void;\n}\n\nconst HeaderFieldsContainer = styled.div`\n    overflow-y: auto;\n\n    flex-grow: 1;\n    flex-shrink: 1;\n\n    margin: 0 -20px -20px -20px;\n    padding: 0 20px 20px 20px;\n`;\n\nexport const SendRequestHeadersCard = observer(({\n    headers,\n    updateHeaders,\n    ...cardProps\n}: SendRequestHeadersProps) => {\n    return <SendCardSection\n        {...cardProps}\n        headerAlignment='left'\n    >\n        <header>\n            <CollapsingButtons>\n                <ExpandShrinkButton\n                    expanded={cardProps.expanded}\n                    onClick={cardProps.onExpandToggled}\n                />\n            </CollapsingButtons>\n            <CollapsibleCardHeading onCollapseToggled={cardProps.onCollapseToggled}>\n                Request Headers\n            </CollapsibleCardHeading>\n        </header>\n        <HeaderFieldsContainer>\n            <EditableRawHeaders\n                headers={headers}\n                onChange={updateHeaders}\n            />\n        </HeaderFieldsContainer>\n    </SendCardSection>;\n});","import * as React from 'react';\nimport { action, computed, observable } from 'mobx';\nimport { observer } from 'mobx-react';\nimport * as portals from 'react-reverse-portal';\n\nimport { bufferToString, isProbablyUtf8, stringToBuffer } from '../../util';\n\nimport { EditableContentType, EditableContentTypes } from '../../model/events/content-types';\n\nimport { ExpandableCardProps } from '../common/card';\nimport { SendBodyCardSection } from './send-card-section';\nimport { ContainerSizedEditor } from '../editor/base-editor';\nimport {\n    EditableBodyCardHeader,\n    ContainerSizedEditorCardContent\n} from '../editor/body-card-components';\n\nexport interface SendRequestBodyProps extends ExpandableCardProps {\n    body: Buffer;\n    onBodyUpdated: (body: Buffer) => void;\n    editorNode: portals.HtmlPortalNode<typeof ContainerSizedEditor>;\n}\n\n@observer\nexport class SendRequestBodyCard extends React.Component<SendRequestBodyProps> {\n\n    @observable\n    private contentType: EditableContentType = 'text';\n\n    @action.bound\n    onChangeContentType(value: string) {\n        this.contentType = value as EditableContentType;\n    }\n\n    @computed\n    get textEncoding() {\n        return isProbablyUtf8(this.props.body)\n            ? 'utf8'\n            : 'binary';\n    }\n\n    updateBody = (input: string) => {\n        this.props.onBodyUpdated(\n            stringToBuffer(input, this.textEncoding)\n        );\n    }\n\n    render() {\n        const {\n            editorNode,\n            expanded,\n            onExpandToggled,\n            onCollapseToggled,\n            body\n        } = this.props;\n\n        const bodyString = bufferToString(body, this.textEncoding);\n\n        return <SendBodyCardSection\n            {...this.props}\n            headerAlignment='left'\n        >\n            <header>\n                <EditableBodyCardHeader\n                    body={body}\n                    onBodyFormatted={this.updateBody}\n\n                    title='Request body'\n                    expanded={expanded}\n                    onExpandToggled={onExpandToggled}\n                    onCollapseToggled={onCollapseToggled}\n\n                    selectedContentType={this.contentType}\n                    contentTypeOptions={EditableContentTypes}\n                    onChangeContentType={this.onChangeContentType}\n                />\n            </header>\n            <ContainerSizedEditorCardContent>\n                <portals.OutPortal<typeof ContainerSizedEditor>\n                    node={editorNode}\n\n                    contentId='request'\n                    language={this.contentType}\n                    value={bodyString}\n                    onChange={this.updateBody}\n                />\n            </ContainerSizedEditorCardContent>\n        </SendBodyCardSection>;\n    }\n}","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { action, computed } from 'mobx';\nimport { inject, observer } from 'mobx-react';\nimport * as portals from 'react-reverse-portal';\nimport { Method } from 'mockttp';\n\nimport { RawHeaders } from '../../types';\nimport { css, styled } from '../../styles';\nimport { Icon } from '../../icons';\n\nimport { RulesStore } from '../../model/rules/rules-store';\nimport { UiStore } from '../../model/ui/ui-store';\nimport { RequestInput } from '../../model/send/send-request-model';\n\nimport { Button, Select, TextInput } from '../common/inputs';\nimport { ContainerSizedEditor } from '../editor/base-editor';\nimport { SendRequestHeadersCard } from './send-request-headers-card';\nimport { SendRequestBodyCard } from './send-request-body-card';\n\nconst RequestPaneContainer = styled.section<{\n    hasExpandedChild: boolean\n}>`\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n\n    ${p => p.hasExpandedChild && css`\n        > * {\n            /* CollapsibleCard applies its own display property to override this for the expanded card */\n            display: none;\n        }\n    `}\n`;\n\n// Layout here is tricky. Current setup seems to work (flex hrink everywhere, grow bodies,\n// card basis: auto, and min-height: 0, with editor 50% + min-height, and then\n// overflow-y: auto and basis: auto on the card contents too).\n//\n// It's worth reiterating the UI goals here explicitly for reference\n// - When multiple areas are open & full+, the area is split even-ish with scrolling\n//   in any areas required\n// - When areas are closed, body areas expand to the space, otherwise it collapses upwards\n// - When multiple areas are open, if there is spare space (e.g. few headers), the\n//   other areas that need it (body editor) expand and use the space.\n\ntype MethodName = keyof typeof Method;\nconst validMethods = Object.values(Method)\n    .filter(\n        value => typeof value === 'string'\n    ) as Array<MethodName>;\n\nconst MethodSelect = styled(Select)`\n    font-size: ${p => p.theme.textSize};\n    display: inline-block;\n    width: auto;\n`;\n\nconst UrlInput = styled(TextInput)`\n`;\n\n@inject('rulesStore')\n@inject('uiStore')\n@observer\nexport class RequestPane extends React.Component<{\n    rulesStore?: RulesStore,\n    uiStore?: UiStore,\n\n    editorNode: portals.HtmlPortalNode<typeof ContainerSizedEditor>,\n\n    requestInput: RequestInput,\n    sendRequest: (requestInput: RequestInput) => void\n}> {\n\n    get cardProps() {\n        return this.props.uiStore!.sendCardProps;\n    }\n\n    render() {\n        const { requestInput, editorNode, uiStore } = this.props;\n\n        return <RequestPaneContainer hasExpandedChild={!!uiStore?.expandedSendRequestCard}>\n            <MethodSelect value={requestInput.method} onChange={this.updateMethod}>\n                { validMethods.map((methodOption) =>\n                    <option\n                        key={methodOption}\n                        value={methodOption}\n                    >\n                        { methodOption }\n                    </option>\n                ) }\n            </MethodSelect>\n            <UrlInput\n                placeholder='https://example.com/hello?name=world'\n                value={requestInput.url}\n                onChange={this.updateUrl}\n            />\n            <Button\n                onClick={this.sendRequest}\n            >\n                Send <Icon icon={['far', 'paper-plane']} />\n            </Button>\n            <SendRequestHeadersCard\n                {...this.cardProps.requestHeaders}\n                headers={requestInput.headers}\n                updateHeaders={this.updateHeaders}\n            />\n            <SendRequestBodyCard\n                {...this.cardProps.requestBody}\n                body={requestInput.rawBody}\n                onBodyUpdated={this.updateBody}\n                editorNode={editorNode}\n            />\n        </RequestPaneContainer>;\n    }\n\n    @action.bound\n    updateMethod(event: React.ChangeEvent<HTMLSelectElement>) {\n        const { requestInput } = this.props;\n        requestInput.method = event.target.value;\n    }\n\n    @action.bound\n    updateUrl(changeEvent: React.ChangeEvent<HTMLInputElement>) {\n        const { requestInput } = this.props;\n        requestInput.url = changeEvent.target.value;\n    }\n\n    @action.bound\n    updateHeaders(headers: RawHeaders) {\n        const { requestInput } = this.props;\n        requestInput.headers = headers;\n    }\n\n    @action.bound\n    updateBody(input: Buffer) {\n        const { requestInput } = this.props;\n        requestInput.rawBody = input;\n    }\n\n    @action.bound\n    async sendRequest() {\n        this.props.sendRequest(this.props.requestInput);\n    }\n\n}","import * as React from 'react';\n\nimport { Theme } from '../../styles';\n\nimport { getStatusColor } from '../../model/events/categorization';\nimport { getStatusMessage } from '../../model/http/http-docs';\nimport { getReadableSize } from '../../model/events/bodies';\nimport { SuccessfulExchange } from '../../model/http/exchange';\n\nimport { SendCardSection } from './send-card-section';\nimport { Pill } from '../common/pill';\nimport { DurationPill } from '../common/duration-pill';\n\nexport const ResponseStatusSection = (props: {\n    exchange: SuccessfulExchange,\n    theme: Theme\n}) => {\n    const response = props.exchange.response;\n\n    return <SendCardSection\n        collapsed={false}\n    >\n        <header>\n            <Pill\n                color={getStatusColor(response.statusCode, props.theme)}\n            >\n                { response.statusCode }: { response.statusMessage || getStatusMessage(response.statusCode) }\n            </Pill>\n            <Pill title=\"The size of the raw encoded response body\">\n                { getReadableSize(response.body.encoded.byteLength) }\n            </Pill>\n            <DurationPill timingEvents={props.exchange.timingEvents} />\n        </header>\n    </SendCardSection>;\n}","import * as React from 'react';\n\nimport { RawHeaders } from '../../types';\n\nimport {\n    CollapsibleCardHeading,\n    ExpandableCardProps\n} from '../common/card';\n\nimport { HeaderDetails } from '../view/http/header-details';\nimport { SendCardSection } from './send-card-section';\nimport { CollapsingButtons } from '../common/collapsing-buttons';\nimport { ExpandShrinkButton } from '../common/expand-shrink-button';\n\nexport interface ResponseHeaderSectionProps extends ExpandableCardProps {\n    requestUrl: URL;\n    headers: RawHeaders;\n}\n\nexport const SentResponseHeaderSection = ({\n    requestUrl,\n    headers,\n    ...cardProps\n}: ResponseHeaderSectionProps) => {\n    return <SendCardSection {...cardProps}>\n        <header>\n            <CollapsingButtons>\n                <ExpandShrinkButton\n                    expanded={cardProps.expanded}\n                    onClick={cardProps.onExpandToggled}\n                />\n            </CollapsingButtons>\n            <CollapsibleCardHeading onCollapseToggled={cardProps.onCollapseToggled}>\n                Response Headers\n            </CollapsibleCardHeading>\n        </header>\n        <HeaderDetails\n            requestUrl={requestUrl}\n            headers={headers}\n        />\n    </SendCardSection>;\n};","import * as React from \"react\";\nimport { inject, observer } from \"mobx-react\";\nimport * as portals from 'react-reverse-portal';\n\nimport { css, styled } from '../../styles';\nimport { HttpExchange } from \"../../types\";\n\nimport { UiStore } from '../../model/ui/ui-store';\nimport { AccountStore } from '../../model/account/account-store';\nimport { SuccessfulExchange } from \"../../model/http/exchange\";\n\nimport { ContainerSizedEditor } from '../editor/base-editor';\nimport { LoadingCard } from '../common/loading-card';\nimport { HttpAbortedResponseCard } from '../view/http/http-aborted-card';\n\nimport { ResponseStatusSection } from './sent-response-status';\nimport { SentResponseHeaderSection } from './sent-response-headers';\nimport { SentResponseBodyCard } from './sent-response-body';\n\nconst ResponsePaneContainer = styled.section<{\n    hasExpandedChild: boolean\n}>`\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n\n    ${p => p.hasExpandedChild && css`\n        > * {\n            /* CollapsibleCard applies its own display property to override this for the expanded card */\n            display: none;\n        }\n    `}\n`;\n\n@inject('uiStore')\n@inject('accountStore')\n@observer\nexport class ResponsePane extends React.Component<{\n    uiStore?: UiStore,\n    accountStore?: AccountStore,\n\n    exchange: HttpExchange | undefined,\n    editorNode: portals.HtmlPortalNode<typeof ContainerSizedEditor>\n}> {\n\n    get cardProps() {\n        return this.props.uiStore!.sendCardProps;\n    }\n\n    render() {\n        const { exchange, uiStore } = this.props;\n        if (!exchange) return null;\n\n        return <ResponsePaneContainer hasExpandedChild={!!uiStore?.expandedSentResponseCard}>\n            {\n                exchange.isSuccessfulExchange()\n                    ? this.renderSuccessfulResponse(exchange)\n                : exchange.isCompletedExchange()\n                    ? this.renderAbortedResponse(exchange)\n                : this.renderInProgressResponse()\n            }\n        </ResponsePaneContainer>;\n    }\n\n    renderSuccessfulResponse(exchange: SuccessfulExchange) {\n        const { uiStore, editorNode } = this.props;\n        const response = exchange.response;\n\n        return <>\n            <ResponseStatusSection\n                exchange={exchange}\n                theme={uiStore!.theme}\n            />\n            <SentResponseHeaderSection\n                {...this.cardProps.responseHeaders}\n                requestUrl={exchange.request.parsedUrl}\n                headers={response.rawHeaders}\n            />\n            <SentResponseBodyCard\n                {...this.cardProps.responseBody}\n                isPaidUser={this.props.accountStore!.isPaidUser}\n                url={exchange.request.url}\n                message={response}\n                editorNode={editorNode}\n            />\n        </>;\n\n    }\n\n    renderAbortedResponse(exchange: HttpExchange) {\n        return <HttpAbortedResponseCard\n            cardProps={this.cardProps.responseHeaders}\n            exchange={exchange}\n        />;\n    }\n\n    renderInProgressResponse() {\n        return <LoadingCard {...this.cardProps.responseHeaders}>\n            <header>\n                <h1>Response...</h1>\n            </header>\n        </LoadingCard>;\n    }\n\n}","import * as React from 'react';\nimport { inject, observer } from 'mobx-react';\nimport * as portals from 'react-reverse-portal';\n\nimport { styled } from '../../styles';\n\nimport { SendStore } from '../../model/send/send-store';\n\nimport { ContainerSizedEditor } from '../editor/base-editor';\n\nimport { SplitPane } from '../split-pane';\nimport { RequestPane } from './request-pane';\nimport { ResponsePane } from './response-pane';\n\nconst SendPageContainer = styled.div`\n    height: 100vh;\n    position: relative;\n`;\n\n@inject('sendStore')\n@observer\nexport class SendPage extends React.Component<{\n    sendStore?: SendStore\n}> {\n\n    private requestEditorNode = portals.createHtmlPortalNode<typeof ContainerSizedEditor>({\n        attributes: { 'style': 'height: 100%' }\n    });\n    private responseEditorNode = portals.createHtmlPortalNode<typeof ContainerSizedEditor>({\n        attributes: { 'style': 'height: 100%' }\n    });\n\n    render() {\n        const {\n            requestInput,\n            sendRequest,\n            sentExchange\n        } = this.props.sendStore!;\n\n        return <SendPageContainer>\n            <SplitPane\n                split='vertical'\n                primary='second'\n                defaultSize='50%'\n                minSize={300}\n                maxSize={-300}\n            >\n                <RequestPane\n                    requestInput={requestInput}\n                    sendRequest={sendRequest}\n                    editorNode={this.requestEditorNode}\n                />\n                <ResponsePane\n                    exchange={sentExchange}\n                    editorNode={this.responseEditorNode}\n                />\n            </SplitPane>\n\n            <portals.InPortal node={this.requestEditorNode}>\n                <ContainerSizedEditor contentId={null} />\n            </portals.InPortal>\n            <portals.InPortal node={this.responseEditorNode}>\n                <ContainerSizedEditor contentId={null} />\n            </portals.InPortal>\n        </SendPageContainer>;\n    }\n\n}","import * as React from 'react';\n\nimport { Icon, IconProp } from '../../icons';\nimport { styled, css } from '../../styles';\nimport { omit } from 'lodash';\nimport { UnstyledButton } from './inputs';\n\nexport const TabbedOptionsContainer = styled.div`\n    display: flex;\n    flex-direction: row;\n`;\n\ninterface TabClickEvent extends React.MouseEvent {\n    tabValue?: any;\n}\n\nexport const TabsContainer = styled((p: {\n    onClick: (tabValue: any) => void,\n    isSelected: (value: any) => boolean,\n    children: Array<React.ReactElement<any, typeof Tab>>\n}) => <nav\n    {...omit(p, 'isSelected')}\n    onClick={(event: TabClickEvent) => {\n        if (event.tabValue) p.onClick(event.tabValue);\n    }}\n>\n    {\n        p.children.map((tab) =>\n            React.cloneElement(tab, {\n                key: tab.props.value,\n                selected: p.isSelected(tab.props.value)\n            })\n        )\n    }\n</nav>)`\n    width: 80px;\n    border-right: solid 2px ${p => p.theme.containerBackground};\n\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: flex-start;\n`;\n\nexport const Tab = styled((p: {\n    className?: string,\n    selected?: boolean,\n    icon: IconProp,\n    value: any,\n    children: React.ReactNode\n}) =>\n    <UnstyledButton\n        className={p.className}\n        onClick={(event: TabClickEvent) => {\n            // Attach our value to the event before it bubbles to the container\n            event.tabValue = p.value;\n        }}\n    >\n        <Icon icon={p.icon} size='2x' />\n        { p.children }\n    </UnstyledButton>\n)`\n    display: flex;\n    flex-direction: column;\n    text-align: center;\n    align-items: center;\n\n    width: 100%;\n    font-size: ${p => p.theme.textSize};\n    box-sizing: border-box;\n\n    padding: 10px 20px 10px 0;\n\n    user-select: none;\n    &:hover, &:focus {\n        outline: none;\n        color: ${p => p.theme.popColor};\n    }\n\n    opacity: 0.6;\n    ${p => p.selected && css`\n        opacity: 1;\n        font-weight: bold;\n        border-right: solid 3px ${p.theme.popColor};\n        padding-right: 22px;\n        position: relative;\n        right: -2px;\n    `}\n\n    > svg {\n        margin-bottom: 10px;\n    }\n`;","import { styled, css } from '../../styles';\n\nimport { Button, ButtonLink } from '../common/inputs';\nimport { ContentLabel } from '../common/text-content';\n\nconst SettingsButtonCss = css`\n    font-size: ${p => p.theme.textSize};\n    padding: 6px 16px;\n\n    ${(p: { highlight?: boolean }) => p.highlight && css`\n        &:not(:disabled) {\n            background-color: ${p => p.theme.popColor};\n        }\n    `}\n`;\n\nexport const SettingsButton = styled(Button)`${SettingsButtonCss}`;\nexport const SettingsButtonLink = styled(ButtonLink)<{\n    highlight?: boolean\n}>`${SettingsButtonCss}`;\n\nexport const SettingsExplanation = styled.p`\n    font-style: italic;\n    line-height: 1.3;\n`;\n\nexport const SettingsSubheading = styled(ContentLabel)`\n    &:not(header + &) {\n        margin-top: 40px;\n    }\n`;","import * as React from 'react';\nimport { observable, action, computed } from 'mobx';\nimport { observer } from 'mobx-react';\n\nimport { styled } from '../../styles';\nimport { Icon } from '../../icons';\nimport { isValidHost } from '../../model/network';\n\nimport { inputValidation } from '../component-utils';\nimport { TextInput } from '../common/inputs';\nimport { SettingsButton } from './settings-components';\n\nconst StringListContainer = styled.div`\n    width: 100%;\n\n    display: grid;\n    grid-template-columns: auto min-content;\n    grid-gap: 10px;\n    margin: 10px 0;\n\n    align-items: baseline;\n\n    ${TextInput} {\n        align-self: stretch;\n    }\n`;\n\nexport const ConfigValueRow = styled.div`\n    min-width: 300px;\n    font-family: ${p => p.theme.monoFontFamily};\n`;\n\n@observer\nexport class StringSettingsList extends React.Component<{\n    values: string[],\n    onDelete: (value: string) => void,\n    onAdd: (value: string) => void,\n    placeholder: string,\n\n    validationFn: (input: HTMLInputElement) => void\n}> {\n\n    @observable\n    inputValue = '';\n\n    render() {\n        const {\n            values,\n            onDelete,\n            placeholder\n        } = this.props;\n\n        return <StringListContainer>\n            { values.map((value) => [\n                <ConfigValueRow key={`value-${value}`}>\n                    { value }\n                </ConfigValueRow>,\n                <SettingsButton\n                    key={`delete-${value}`}\n                    onClick={() => onDelete(value)}\n                >\n                    <Icon icon={['far', 'trash-alt']} />\n                </SettingsButton>\n            ]) }\n\n            <TextInput\n                placeholder={placeholder}\n                value={this.inputValue}\n                onChange={this.changeInput}\n            />\n            <SettingsButton\n                disabled={\n                    !isValidHost(this.inputValue) ||\n                    values.includes(this.inputValue)\n                }\n                onClick={this.addHost}\n            >\n                <Icon icon={['fas', 'plus']} />\n            </SettingsButton>\n        </StringListContainer>;\n    }\n\n    @action.bound\n    addHost(e: React.MouseEvent<HTMLButtonElement>) {\n        this.props.onAdd(this.inputValue);\n        this.inputValue = '';\n    }\n\n    @action.bound\n    changeInput(e: React.ChangeEvent<HTMLInputElement>) {\n        this.inputValue = e.target.value;\n        this.props.validationFn(e.target);\n    }\n}","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { observable, action, computed } from 'mobx';\nimport { observer, inject } from \"mobx-react\";\n\nimport { styled } from '../../styles';\nimport { WarningIcon, Icon } from '../../icons';\n\nimport { isValidPortConfiguration, ProxyStore } from '../../model/proxy-store';\nimport { isValidHostname } from '../../model/network';\nimport {\n    serverVersion,\n    versionSatisfies,\n    INITIAL_HTTP2_RANGE,\n    TLS_PASSTHROUGH_SUPPORTED\n} from '../../services/service-versions';\n\nimport { inputValidation } from '../component-utils';\nimport {\n    CollapsibleCardProps,\n    CollapsibleCard,\n    CollapsibleCardHeading\n} from '../common/card';\nimport { ContentLabel } from '../common/text-content';\nimport { Select } from '../common/inputs';\nimport {\n    SettingsButton,\n    SettingsExplanation,\n    SettingsSubheading\n} from './settings-components';\nimport { StringSettingsList } from './string-settings-list';\n\nconst RestartApp = styled(SettingsButton).attrs(() => ({\n    children: 'Restart app to activate',\n    onClick: () => window.location.reload()\n}))`\n    position: absolute;\n    top: 18px;\n    left: 20px;\n    font-weight: bold;\n\n    &:not(:disabled) {\n        background-color: ${p => p.theme.popColor};\n    }\n\n    ${(p: { visible: boolean }) => !p.visible && 'display: none;'}\n`;\n\nconst UnsavedIcon = styled(Icon).attrs(() => ({\n    icon: ['fas', 'save'],\n}))`\n    margin-left: 10px;\n    color: ${p => p.theme.warningColor};\n`;\n\nconst ProxyPortsContainer = styled.div`\n    display: grid;\n    grid-template-columns: fit-content(45%) fit-content(45%) fit-content(10%);\n    align-items: baseline;\n\n    grid-gap: 10px;\n    margin-bottom: 10px;\n\n    input {\n        padding: 5px 10px;\n        border-radius: 4px;\n        border: solid 1px ${p => p.theme.containerBorder};\n\n        & + ${WarningIcon} {\n            visibility: hidden;\n            align-self: center;\n        }\n\n        &:invalid {\n            border-color: ${p => p.theme.warningColor};\n            background-color: ${p => p.theme.warningBackground};\n            color: ${p => p.theme.mainColor};\n\n            & + ${WarningIcon} {\n                visibility: visible;\n            }\n        }\n    }\n`;\n\nconst ProxyPortStateExplanation = styled.p`\n    margin-bottom: 10px;\n`;\n\nconst Http2Select = styled(Select)`\n    display: inline-block;\n    margin-top: 10px;\n    width: auto;\n    font-size: ${p => p.theme.textSize};\n    padding: 3px;\n`;\n\nconst hostnameValidation = inputValidation(isValidHostname, \"Should be a valid hostname\");\n\n@inject('proxyStore')\n@observer\nexport class ProxySettingsCard extends React.Component<\n    CollapsibleCardProps & {\n        proxyStore?: ProxyStore\n    }\n> {\n\n    @observable\n    minPortValue = (this.props.proxyStore!.portConfig?.startPort || 8000).toString();\n\n    @observable\n    maxPortValue = (this.props.proxyStore!.portConfig?.endPort || 65535).toString();\n\n    @action.bound\n    onMinPortChange({ target: { value } }: React.ChangeEvent<HTMLInputElement>) {\n        this.minPortValue = value;\n        this.updatePortConfig();\n    }\n\n    @action.bound\n    onMaxPortChange({ target: { value } }: React.ChangeEvent<HTMLInputElement>) {\n        this.maxPortValue = value;\n        this.updatePortConfig();\n    }\n\n    @computed\n    get isCurrentPortInRange() {\n        const { httpProxyPort, portConfig } = this.props.proxyStore!;\n\n        if (!portConfig) {\n            return httpProxyPort >= 8000;\n        } else {\n            return httpProxyPort >= portConfig.startPort && httpProxyPort <= portConfig.endPort;\n        }\n    }\n\n    @computed\n    get portConfig() {\n        return {\n            startPort: parseInt(this.minPortValue, 10),\n            endPort: parseInt(this.maxPortValue, 10)\n        };\n    }\n\n    @computed\n    get isCurrentPortConfigValid() {\n        return isValidPortConfiguration(this.portConfig);\n    }\n\n    updatePortConfig() {\n        if (!this.isCurrentPortConfigValid) return;\n        else this.props.proxyStore!.setPortConfig(this.portConfig);\n    }\n\n    @action.bound\n    addTlsPassthroughHostname(hostname: string) {\n        const { tlsPassthroughConfig } = this.props.proxyStore!;\n        tlsPassthroughConfig.push({ hostname });\n    }\n\n    @action.bound\n    removeTlsPassthroughHostname(hostname: string) {\n        const { tlsPassthroughConfig } = this.props.proxyStore!;\n        const hostnameIndex = _.findIndex(tlsPassthroughConfig, (passthroughItem) =>\n            passthroughItem.hostname === hostname\n        );\n\n        if (hostnameIndex === -1) return;\n\n        tlsPassthroughConfig.splice(hostnameIndex, 1);\n    }\n\n    render() {\n        const { proxyStore, ...cardProps } = this.props;\n        const {\n            httpProxyPort,\n\n            http2Enabled,\n            http2CurrentlyEnabled,\n\n            tlsPassthroughConfig,\n            currentTlsPassthroughConfig\n        } = proxyStore!;\n\n        return <CollapsibleCard {...cardProps}>\n            <header>\n                <CollapsibleCardHeading onCollapseToggled={\n                    cardProps.onCollapseToggled\n                }>\n                    Proxy Settings\n                </CollapsibleCardHeading>\n            </header>\n            <RestartApp\n                visible={\n                    (this.isCurrentPortConfigValid && !this.isCurrentPortInRange) ||\n                    http2Enabled !== http2CurrentlyEnabled ||\n                    !_.isEqual(tlsPassthroughConfig, currentTlsPassthroughConfig)\n                }\n            />\n\n            <ProxyPortsContainer>\n                <ContentLabel>\n                    Minimum port\n                </ContentLabel>\n                <input\n                    type=\"number\"\n                    required\n                    min=\"1\"\n                    max=\"65535\"\n                    value={this.minPortValue}\n                    onChange={this.onMinPortChange}\n                />\n                <WarningIcon />\n\n                <ContentLabel>\n                    Maximum port\n                </ContentLabel>\n                <input\n                    type=\"number\"\n                    required\n                    min={this.minPortValue}\n                    max=\"65535\"\n                    value={this.maxPortValue}\n                    onChange={this.onMaxPortChange}\n                />\n                <WarningIcon />\n            </ProxyPortsContainer>\n            <ProxyPortStateExplanation>\n                The proxy is currently using port <strong>\n                    { httpProxyPort }\n                </strong>{\n                    (this.isCurrentPortConfigValid && !this.isCurrentPortInRange)\n                    ? ', outside this range. Restart the app now to use this configuration.'\n                    : '.'\n                }\n            </ProxyPortStateExplanation>\n            <SettingsExplanation>\n                When opening HTTP Toolkit, it will start the proxy on the first port in\n                this range that is available. If all ports in the range are in use, the\n                first free port above 8000 will be used instead.\n            </SettingsExplanation>\n\n            {\n                versionSatisfies(serverVersion.value, TLS_PASSTHROUGH_SUPPORTED) && <>\n                    <SettingsSubheading>\n                        TLS Passthrough { !_.isEqual(tlsPassthroughConfig, currentTlsPassthroughConfig) &&\n                            <UnsavedIcon />\n                        }\n                    </SettingsSubheading>\n\n                    <StringSettingsList\n                        values={tlsPassthroughConfig.map(c => c.hostname)}\n                        onAdd={this.addTlsPassthroughHostname}\n                        onDelete={this.removeTlsPassthroughHostname}\n                        placeholder='A hostname whose TLS connections should not be intercepted'\n                        validationFn={hostnameValidation}\n                    />\n\n                    <SettingsExplanation>\n                        Incoming TLS connections to these hostnames will bypass HTTP Toolkit, and will\n                        be forwarded upstream untouched instead of being intercepted. Clients will not see\n                        HTTP Toolkit's certificate, which may solve some connection issues, but traffic\n                        within these TLS connections will not be accessible.\n                    </SettingsExplanation>\n                </>\n            }\n\n            {\n                versionSatisfies(serverVersion.value, INITIAL_HTTP2_RANGE) && <>\n                    <SettingsSubheading>\n                        HTTP/2 Support { http2Enabled !== http2CurrentlyEnabled &&\n                            <UnsavedIcon />\n                        }\n                    </SettingsSubheading>\n\n                    <Http2Select\n                        value={JSON.stringify(http2Enabled)}\n                        onChange={action((event: React.ChangeEvent<HTMLSelectElement>) => {\n                            const value = event.currentTarget.value;\n                            if (value) {\n                                proxyStore!.http2Enabled = JSON.parse(value);\n                            }\n                        })}\n                    >\n                        <option value={'true'}>Enabled for all clients</option>\n                        <option value={'\"fallback\"'}>Enabled only for HTTP/2-only clients</option>\n                        <option value={'false'}>Disabled for all clients</option>\n                    </Http2Select>\n                </>\n            }\n        </CollapsibleCard>\n    }\n\n}","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { observable, action, flow } from 'mobx';\nimport { observer, inject } from \"mobx-react\";\n\nimport { styled } from '../../styles';\nimport { WarningIcon, Icon } from '../../icons';\nimport { trackEvent } from '../../metrics';\n\nimport { uploadFile } from '../../util/ui';\nimport { UnreachableCheck, asError, unreachableCheck } from '../../util/error';\n\nimport { UpstreamProxyType, RulesStore } from '../../model/rules/rules-store';\nimport { ParsedCertificate, ValidationResult } from '../../model/crypto';\nimport { isValidHost } from '../../model/network';\nimport { parseCert, validatePKCS } from '../../services/ui-worker-api';\nimport {\n    serverVersion,\n    versionSatisfies,\n    CLIENT_CERT_SERVER_RANGE,\n    PROXY_CONFIG_RANGE,\n    CUSTOM_CA_TRUST_RANGE\n} from '../../services/service-versions';\n\nimport { inputValidation } from '../component-utils';\nimport {\n    CollapsibleCardProps,\n    CollapsibleCard,\n    CollapsibleCardHeading\n} from '../common/card';\nimport { Select, TextInput } from '../common/inputs';\nimport {\n    SettingsSubheading,\n    SettingsButton,\n    SettingsExplanation\n} from './settings-components';\nimport { StringSettingsList, ConfigValueRow } from './string-settings-list';\n\n\nconst UpstreamProxySettings = styled.div`\n    margin-top: 10px;\n\n    display: flex;\n    flex-direction: row;\n    flex-wrap: wrap;\n\n    > ${SettingsSubheading}, > ${SettingsExplanation} {\n        flex-basis: 100%;\n    }\n\n    > ${WarningIcon} {\n        align-self: center;\n    }\n\n    > ${TextInput} {\n        flex-grow: 1;\n    }\n\n    > ${SettingsButton} {\n        margin-left: 10px;\n    }\n`;\n\nconst UpstreamProxyDropdown = styled(Select)`\n    width: auto;\n    font-size: ${p => p.theme.textSize};\n    padding: 3px;\n\n    margin-right: 10px;\n`;\n\nconst validateHost = inputValidation(isValidHost,\n    \"Should be a plain hostname, optionally with a specific port\"\n);\n\nconst isValidProxyHost = (host: string | undefined): boolean =>\n    !!host?.match(/^([^/@]*@)?[A-Za-z0-9\\-.]+(:\\d+)?$/);\nconst validateProxyHost = inputValidation(isValidProxyHost,\n    \"Should be a plain hostname, optionally with a specific port and/or username:password\"\n);\n\n@observer\nclass UpstreamProxyConfig extends React.Component<{ rulesStore: RulesStore }> {\n\n    @observable\n    private proxyType: UpstreamProxyType = this.props.rulesStore.upstreamProxyType;\n\n    @action.bound\n    setProxyType(event: React.ChangeEvent<HTMLSelectElement>) {\n        const value = event.currentTarget.value;\n        this.proxyType = value as UpstreamProxyType;\n\n        trackEvent({ category: \"Config\", action: \"Set Proxy\", value: this.proxyType });\n\n        if (value === 'direct' || value === 'system') {\n            // Only update immediately when switching to a type that doesn't need a host input.\n            // For other types, we update when we set a host, in setUpstreamProxyHost\n            const rulesStore = this.props.rulesStore;\n            rulesStore.upstreamProxyType = this.proxyType;\n        }\n    }\n\n    @observable\n    private proxyHostInput = this.props.rulesStore.upstreamProxyHost || '';\n\n    @action.bound\n    setProxyHostInput(event: React.ChangeEvent<HTMLInputElement>) {\n        validateProxyHost(event.target);\n        this.proxyHostInput = event.target.value;\n    }\n\n    @action.bound\n    saveProxyHost() {\n        if (this.proxyType === 'direct' || this.proxyType === 'system') {\n            throw new Error(`Can't save proxy host for ${this.proxyType} proxy`);\n        }\n\n        // We update the rules store proxy type only at the point where we save the host:\n        const rulesStore = this.props.rulesStore;\n        rulesStore.upstreamProxyType = this.proxyType;\n        rulesStore.upstreamProxyHost = this.proxyHostInput;\n    }\n\n    @action.bound\n    addNoProxyHost(hostname: string) {\n        const { rulesStore } = this.props;\n        rulesStore.upstreamNoProxyHosts = [...rulesStore.upstreamNoProxyHosts, hostname];\n    }\n\n    @action.bound\n    removeNoProxyHost(hostname: string) {\n        const { rulesStore } = this.props;\n        rulesStore.upstreamNoProxyHosts = _.without(rulesStore.upstreamNoProxyHosts, hostname);\n    }\n\n    render() {\n        const {\n            effectiveSystemProxyConfig,\n            upstreamProxyType: savedProxyType,\n            upstreamProxyHost: savedProxyHost,\n            upstreamNoProxyHosts: noProxyHosts\n        } = this.props.rulesStore;\n\n        const {\n            proxyType,\n            proxyHostInput,\n\n            setProxyType,\n            setProxyHostInput,\n            saveProxyHost,\n            addNoProxyHost,\n            removeNoProxyHost\n        } = this;\n\n        return <>\n            <SettingsSubheading>Upstream Proxy</SettingsSubheading>\n\n            <UpstreamProxySettings>\n                <UpstreamProxyDropdown\n                    value={proxyType}\n                    onChange={setProxyType}\n                >\n                    <option value={'system'}>Use system settings</option>\n                    <option value={'direct'}>Connect directly</option>\n                    <option value={'http'}>Use an HTTP proxy</option>\n                    <option value={'https'}>Use an HTTPS proxy</option>\n                    <option value={'socks4'}>Use a SOCKS 4 proxy</option>\n                    <option value={'socks4a'}>Use a SOCKS 4a proxy</option>\n                    <option value={'socks5'}>Use a SOCKS 5 proxy</option>\n                    <option value={'socks5h'}>Use a SOCKS 5h proxy</option>\n                </UpstreamProxyDropdown>\n\n                { proxyType === 'system' && (\n                        effectiveSystemProxyConfig === 'ignored' ||\n                        effectiveSystemProxyConfig === 'unparseable'\n                    ) &&\n                    <WarningIcon />\n                }\n\n                { proxyType === 'system' && effectiveSystemProxyConfig &&\n                    <SettingsExplanation>{\n                        effectiveSystemProxyConfig === 'ignored'\n                            ? <>\n                                The system is configured with a localhost proxy.\n                                To avoid issues with recursive proxy loops, this will be ignored\n                                and requests will be sent directly. Localhost proxies must be\n                                manually configured.\n                            </>\n                        : effectiveSystemProxyConfig === 'unparseable'\n                            ? <>\n                                The system proxy settings could not be\n                                parsed, so requests will be sent directly.\n                            </>\n                        : <>\n                            The configured system proxy is {\n                                effectiveSystemProxyConfig.proxyUrl\n                            }.\n                        </>\n                    }</SettingsExplanation>\n                }\n\n                { proxyType !== 'direct' && proxyType !== 'system' && <>\n                    <TextInput\n                        placeholder={`The ${proxyType} proxy host details, e.g. example.com or user:pwd@example.com:8080`}\n                        value={proxyHostInput}\n                        onChange={setProxyHostInput}\n                    />\n                    <SettingsButton\n                        disabled={\n                            !isValidProxyHost(proxyHostInput) ||\n                            (proxyHostInput === savedProxyHost && proxyType === savedProxyType)\n                        }\n                        onClick={saveProxyHost}\n                    >\n                        <Icon icon={['fas', 'save']} />\n                    </SettingsButton>\n                </> }\n            </UpstreamProxySettings>\n\n            { proxyType !== 'direct' && proxyType !== 'system' && <>\n                <SettingsSubheading>\n                    Non-proxied hosts\n                </SettingsSubheading>\n\n                <StringSettingsList\n                    placeholder='A host whose traffic should not be sent via the proxy'\n                    onAdd={addNoProxyHost}\n                    onDelete={removeNoProxyHost}\n                    values={noProxyHosts}\n                    validationFn={validateHost}\n                />\n                <SettingsExplanation>\n                    Requests to these hosts will always be sent directly, not via the configured proxy.\n                </SettingsExplanation>\n            </> }\n        </>;\n    }\n};\n\nconst ClientCertificatesList = styled.div`\n    display: grid;\n    grid-template-columns: 1fr 1fr min-content;\n    grid-gap: 10px;\n    margin: 10px 0;\n\n    align-items: baseline;\n\n    ${TextInput} {\n        align-self: stretch;\n    }\n\n    input[type=file] {\n        display: none;\n    }\n`;\n\nconst CertificateFilename = styled.div`\n    font-style: italic;\n`;\n\nconst DecryptionInput = styled.div`\n    display: flex;\n    flex-direction: row;\n    align-items: baseline;\n\n    > :first-child {\n        flex: 1 1;\n    }\n\n    > button {\n        margin-left: 10px;\n    }\n\n    > svg {\n        flex: 1 1 100%;\n        text-align: center;\n    }\n`;\n\nconst DecryptionSpinner = styled(Icon).attrs(() => ({\n    icon: ['fas', 'spinner'],\n    spin: true\n}))`\n    margin: 0 auto;\n`;\n\n@observer\nclass ClientCertificateConfig extends React.Component<{ rulesStore: RulesStore }> {\n\n    @observable\n    clientCertHostInput = '';\n\n    readonly certFileInputRef = React.createRef<HTMLInputElement>();\n\n    @action.bound\n    removeClientCertificate(host: string) {\n        const { clientCertificateHostMap } = this.props.rulesStore!;\n        delete clientCertificateHostMap[host];\n    }\n\n    @action.bound\n    addClientCertificate() {\n        const { clientCertificateHostMap } = this.props.rulesStore!;\n        clientCertificateHostMap[this.clientCertHostInput] = this.clientCertData!;\n\n        trackEvent({ category: \"Config\", action: \"Add Client Cert\" });\n\n        this.clientCertHostInput = '';\n        this.clientCertData = undefined;\n        this.clientCertState = undefined;\n    }\n\n    @observable\n    clientCertData: undefined | { pfx: ArrayBuffer, filename: string, passphrase?: string };\n\n    @observable\n    clientCertState: undefined | 'encrypted' | 'processing' | 'error' | 'decrypted';\n\n    @observable\n    clientCertError: string | undefined;\n\n    @action.bound\n    onClientCertSelected(event: React.ChangeEvent<HTMLInputElement>) {\n        const input = event.target;\n        if (!input.files || !input.files.length) return;\n\n        const file = input.files[0];\n        const fileReader = new FileReader();\n        fileReader.readAsArrayBuffer(file);\n\n        this.clientCertState = 'processing';\n        this.clientCertError = undefined;\n\n        const thisConfig = this; // fileReader events set 'this'\n        fileReader.addEventListener('load', flow(function * () {\n            thisConfig.clientCertData = {\n                pfx: fileReader.result as ArrayBuffer,\n                filename: file.name\n            };\n\n            let result: ValidationResult;\n\n            result = yield validatePKCS(thisConfig.clientCertData.pfx, undefined);\n\n            if (result === 'invalid-passphrase') {\n                // If it fails, try again with an empty key, since that is sometimes used for 'no passphrase'\n                result = yield validatePKCS(thisConfig.clientCertData.pfx, '');\n\n                if (result === 'valid') {\n                    thisConfig.clientCertData.passphrase = '';\n                }\n\n                thisConfig.handleClientCertValidationResult(result);\n            } else {\n                thisConfig.handleClientCertValidationResult(result);\n            }\n        }));\n\n        fileReader.addEventListener('error', () => {\n            thisConfig.clientCertState = 'error';\n        });\n    }\n\n    readonly decryptClientCertData = flow(function * (this: ClientCertificateConfig) {\n        const { pfx, passphrase } = this.clientCertData!;\n\n        this.clientCertState = 'processing';\n        this.clientCertError = undefined;\n\n        const result = yield validatePKCS(pfx, passphrase);\n        this.handleClientCertValidationResult(result);\n    });\n\n    handleClientCertValidationResult(result: ValidationResult) {\n        this.clientCertError = undefined;\n\n        if (result === 'valid') {\n            this.clientCertState = 'decrypted';\n        } else if (result === 'invalid-passphrase') {\n            this.clientCertState = 'encrypted';\n        } else if (result === 'invalid-format') {\n            this.clientCertState = 'error';\n            this.clientCertError = 'Parsing failed';\n        } else if (result === 'missing-key') {\n            this.clientCertState = 'error';\n            this.clientCertError = 'No private key found';\n        } else if (result === 'missing-cert') {\n            this.clientCertState = 'error';\n            this.clientCertError = 'No certificate found';\n        } else unreachableCheck(result);\n    }\n\n    @action.bound\n    dropClientCertData() {\n        this.clientCertData = undefined;\n        this.clientCertState = undefined;\n    }\n\n    render() {\n        const { clientCertificateHostMap } = this.props.rulesStore!;\n\n        return <>\n            <SettingsSubheading>\n                Client Certificates\n            </SettingsSubheading>\n            <ClientCertificatesList>\n                { Object.entries(clientCertificateHostMap).map(([host, cert]) => [\n                    <ConfigValueRow key={`host-${host}`}>\n                        { host }\n                    </ConfigValueRow>,\n\n                    <CertificateFilename key={`filename-${host}`}>\n                        { cert.filename }\n                    </CertificateFilename>,\n\n                    <SettingsButton\n                        key={`delete-${host}`}\n                        onClick={() => this.removeClientCertificate(host)}\n                    >\n                        <Icon icon={['far', 'trash-alt']} />\n                    </SettingsButton>\n                ]) }\n\n                <TextInput\n                    placeholder='A host where the certificate should be used'\n                    value={this.clientCertHostInput}\n                    onChange={action((e: React.ChangeEvent<HTMLInputElement>) => {\n                        this.clientCertHostInput = e.target.value;\n                        validateHost(e.target);\n                    })}\n                />\n                { this.clientCertState === undefined\n                    ? <>\n                        <SettingsButton onClick={() => this.certFileInputRef.current!.click()}>\n                            Load a client certificate\n                        </SettingsButton>\n                        <input\n                            ref={this.certFileInputRef}\n                            type=\"file\"\n                            accept='.pfx,.p12,application/x-pkcs12'\n                            onChange={this.onClientCertSelected}\n                        />\n                    </>\n                    : this.clientCertState === 'processing'\n                        ? <DecryptionSpinner />\n                    : this.clientCertState === 'decrypted'\n                        ? <DecryptionInput>\n                            <CertificateFilename>{ this.clientCertData!.filename }</CertificateFilename>\n                            <SettingsButton onClick={this.dropClientCertData}>\n                                <Icon icon={['fas', 'undo']} title='Deselect this certificate' />\n                            </SettingsButton>\n                        </DecryptionInput>\n                    : this.clientCertState === 'encrypted'\n                        ? <DecryptionInput>\n                            <TextInput\n                                placeholder={`The passphrase for ${this.clientCertData!.filename}`}\n                                value={this.clientCertData!.passphrase || ''}\n                                onChange={action((e: React.ChangeEvent<HTMLInputElement>) => {\n                                    this.clientCertData!.passphrase = e.target.value;\n                                })}\n                            />\n                            <SettingsButton onClick={() => this.decryptClientCertData()}>\n                                <Icon icon={['fas', 'unlock']} title='Decrypt with this passphrase' />\n                            </SettingsButton>\n                            <SettingsButton onClick={this.dropClientCertData}>\n                                <Icon icon={['fas', 'undo']} title='Deselect this certificate' />\n                            </SettingsButton>\n                        </DecryptionInput>\n                    : this.clientCertState === 'error'\n                        ? <DecryptionInput>\n                            <p><WarningIcon /> {this.clientCertError || 'Invalid certificate'}</p>\n                            <SettingsButton onClick={this.dropClientCertData}>\n                                <Icon icon={['fas', 'undo']} title='Deselect this certificate' />\n                            </SettingsButton>\n                        </DecryptionInput>\n                    : unreachableCheck(this.clientCertState)\n                }\n                <SettingsButton\n                    disabled={\n                        !isValidHost(this.clientCertHostInput) ||\n                        this.clientCertState !== 'decrypted' || // Not decrypted yet, or\n                        !!clientCertificateHostMap[this.clientCertHostInput] // Duplicate host\n                    }\n                    onClick={this.addClientCertificate}\n                >\n                    <Icon icon={['fas', 'plus']} />\n                </SettingsButton>\n            </ClientCertificatesList>\n            <SettingsExplanation>\n                These certificates will be used for client TLS authentication, if requested by the server, when\n                connecting to their corresponding hostname.\n            </SettingsExplanation>\n        </>;\n    }\n}\n\nconst AdditionalCertificateList = styled.div`\n    display: grid;\n    grid-template-columns: 1fr min-content;\n    grid-gap: 10px;\n    margin: 10px 0;\n\n    align-items: baseline;\n\n    input[type=file] {\n        display: none;\n    }\n`;\n\nconst CertificateDescription = styled.div`\n    font-style: italic;\n`;\n\nconst AddCertificateButton = styled(SettingsButton)`\n    grid-column: 1 / span 2;\n`;\n\n@observer\nclass AdditionalCAConfig extends React.Component<{ rulesStore: RulesStore }> {\n\n    readonly certFileButtonRef = React.createRef<HTMLButtonElement>();\n\n    addCertificate = flow(function * (this: AdditionalCAConfig) {\n        const { rulesStore } = this.props;\n\n        const button = this.certFileButtonRef.current!;\n\n        try {\n            const rawData: ArrayBuffer = yield uploadFile('arraybuffer', [\n                '.pem',\n                '.crt',\n                '.cert',\n                '.der',\n                'application/x-pem-file',\n                'application/x-x509-ca-cert'\n            ]);\n\n            const certificate: ParsedCertificate = yield parseCert(rawData);\n\n            if (rulesStore.additionalCaCertificates.some(({ rawPEM }) => rawPEM === certificate.rawPEM)) {\n                button.setCustomValidity(`This CA is already trusted.`);\n                button.reportValidity();\n                return;\n            }\n\n            rulesStore.additionalCaCertificates.push(certificate);\n        } catch (error) {\n            console.warn(error);\n\n            const errorMessage = asError(error).message;\n\n            button.setCustomValidity(`Could not load certificate: ${\n                errorMessage\n            }${\n                errorMessage.endsWith('.') ? '' : '.'\n            } File must be a PEM or DER-formatted CA certificate.`);\n            button.reportValidity();\n        }\n    }.bind(this));\n\n    @action.bound\n    removeCertificate(certificate: ParsedCertificate) {\n        const { rulesStore } = this.props;\n        _.pull(rulesStore.additionalCaCertificates, certificate);\n    }\n\n    render() {\n        const { additionalCaCertificates } = this.props.rulesStore;\n\n        return <>\n            <SettingsSubheading>\n                Trusted CA Certificates\n            </SettingsSubheading>\n            <AdditionalCertificateList>\n                { additionalCaCertificates.map((cert) => {\n                    const { subject: { org, name }, serial } = cert;\n\n                    return [\n                        <CertificateDescription key={serial}>{\n                            [\n                                org && (!name || name.length <= 5)\n                                    ? org\n                                    : undefined,\n                                name,\n                                serial\n                                    ? `(serial ${serial})`\n                                    : undefined\n                            ].filter(x => !!x).join(' ')\n                        }</CertificateDescription>,\n\n                        <SettingsButton\n                            key={`delete-${serial}`}\n                            onClick={() => this.removeCertificate(cert)}\n                        >\n                            <Icon icon={['far', 'trash-alt']} />\n                        </SettingsButton>\n                    ]\n                }) }\n                <AddCertificateButton\n                    onClick={this.addCertificate}\n                    type='submit' // Ensures we can show validation messages here\n                    ref={this.certFileButtonRef}\n                >\n                    Load a CA certificate\n                </AddCertificateButton>\n            </AdditionalCertificateList>\n            <SettingsExplanation>\n                These Certificate Authority (CA) certificates will be considered as trusted certificate\n                roots for all HTTPS requests, in addition to the existing set of built-in trusted CAs.\n            </SettingsExplanation>\n        </>;\n    }\n\n}\n\n@inject('rulesStore')\n@observer\nexport class ConnectionSettingsCard extends React.Component<\n    CollapsibleCardProps & {\n        rulesStore?: RulesStore\n    }\n> {\n\n    @action.bound\n    unwhitelistHost(host: string) {\n        const { whitelistedCertificateHosts } = this.props.rulesStore!;\n        const hostIndex = whitelistedCertificateHosts.indexOf(host);\n        if (hostIndex > -1) {\n            whitelistedCertificateHosts.splice(hostIndex, 1);\n        }\n    }\n\n    @action.bound\n    addHostToWhitelist(hostname: string) {\n        this.props.rulesStore!.whitelistedCertificateHosts.push(hostname);\n        trackEvent({ category: \"Config\", action: \"Whitelist Host\" });\n    }\n\n    render() {\n        const { rulesStore, ...cardProps } = this.props;\n        const { whitelistedCertificateHosts } = rulesStore!;\n\n        return <CollapsibleCard {...cardProps}>\n            <header>\n                <CollapsibleCardHeading onCollapseToggled={\n                    cardProps.onCollapseToggled\n                }>\n                    Connection Settings\n                </CollapsibleCardHeading>\n            </header>\n\n            {\n                _.isString(serverVersion.value) &&\n                versionSatisfies(serverVersion.value, PROXY_CONFIG_RANGE) &&\n                    <UpstreamProxyConfig\n                        rulesStore={rulesStore!}\n                    />\n            }\n\n            {\n                _.isString(serverVersion.value) &&\n                versionSatisfies(serverVersion.value, CUSTOM_CA_TRUST_RANGE) &&\n                <AdditionalCAConfig\n                    rulesStore={rulesStore!}\n                />\n            }\n\n            {\n                _.isString(serverVersion.value) &&\n                versionSatisfies(serverVersion.value, CLIENT_CERT_SERVER_RANGE) && <>\n                <ClientCertificateConfig\n                    rulesStore={rulesStore!}\n                />\n            </> }\n\n            <SettingsSubheading>\n                Host HTTPS Whitelist\n            </SettingsSubheading>\n\n            <StringSettingsList\n                placeholder='A host to exclude from strict HTTPS checks'\n                onAdd={this.addHostToWhitelist}\n                onDelete={this.unwhitelistHost}\n                values={whitelistedCertificateHosts}\n\n                validationFn={validateHost}\n            />\n            <SettingsExplanation>\n                Requests to these hosts will skip certificate validation and accept some older\n                TLS configurations. These requests will be successful regardless of any self-signed,\n                expired or otherwise invalid HTTPS configurations.\n            </SettingsExplanation>\n        </CollapsibleCard>\n    }\n}","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { action, flow, observable } from 'mobx';\nimport { observer, inject } from \"mobx-react\";\nimport type { OpenAPIObject } from 'openapi-directory';\nimport * as semver from 'semver';\nimport * as yaml from 'yaml';\nimport * as swagger2OpenApi from 'swagger2openapi';\n\nimport { styled } from '../../styles';\nimport { Icon } from '../../icons';\nimport { uploadFile } from '../../util/ui';\nimport { attempt } from '../../util/promise';\nimport { asError } from '../../util/error';\nimport { trackEvent } from '../../metrics';\n\nimport { buildApiMetadataAsync } from '../../services/ui-worker-api';\n\nimport {\n    CollapsibleCard,\n    CollapsibleCardHeading,\n    CollapsibleCardProps\n} from \"../common/card\";\nimport { SettingsButton, SettingsExplanation } from './settings-components';\nimport { TextInput } from '../common/inputs';\nimport { ApiStore } from '../../model/api/api-store';\nimport { ContentLabel } from '../common/text-content';\nimport { ApiMetadata } from '../../model/api/api-interfaces';\n\nconst UploadSpecButton = styled(SettingsButton).attrs(() => ({\n    type: 'submit'\n}))`\n    grid-column: 1 / span 3;\n`;\n\nconst BaseUrlInput = styled(TextInput)`\n    align-self: stretch;\n`;\n\nconst SavedBaseUrl = styled.div`\n    font-family: ${p => p.theme.monoFontFamily};\n`;\n\nconst Spec = styled.div`\n    grid-column: 2;\n    font-style: italic;\n\n    display: flex;\n    align-items: baseline;\n`;\n\nconst UndoButton = styled(SettingsButton)`\n    margin-left: auto;\n`;\n\nconst AddButton = styled(SettingsButton)``;\n\nconst DeleteButton = styled(SettingsButton)``;\n\nconst ApiRows = styled.div`\n    display: grid;\n    grid-template-columns: 1fr 1fr min-content;\n    grid-gap: 10px;\n    margin: 10px 0;\n    align-items: baseline;\n`;\n\nfunction updateValidationMessage(element: HTMLInputElement | HTMLButtonElement, message?: string) {\n    element.setCustomValidity(message || '');\n    element.reportValidity();\n}\n\n@inject('apiStore')\n@observer\nexport class ApiSettingsCard extends React.Component<\n    CollapsibleCardProps & {\n        apiStore?: ApiStore\n    }\n> {\n\n    @observable.ref\n    private selectedSpec: OpenAPIObject | undefined;\n    private uploadSpecButtonRef = React.createRef<HTMLButtonElement>();\n\n    @observable\n    private specProcessingInProgress = false;\n\n    @observable\n    private enteredBaseUrl = \"\";\n    private baseUrlInputRef = React.createRef<HTMLInputElement>();\n\n    @observable\n    private baseUrlError: Error | undefined;\n\n    render() {\n        const { apiStore, ...cardProps } = this.props;\n\n        return <CollapsibleCard {...cardProps}>\n            <header>\n                <CollapsibleCardHeading onCollapseToggled={\n                    cardProps.onCollapseToggled\n                }>\n                    API Settings\n                </CollapsibleCardHeading>\n            </header>\n\n            <ContentLabel>\n                OpenAPI specifications\n            </ContentLabel>\n\n            <ApiRows>\n                {\n                    _.map(apiStore!.customOpenApiInfo, (spec, baseUrl) =>\n                        <React.Fragment key={baseUrl}>\n                            <SavedBaseUrl>\n                                { baseUrl }\n                            </SavedBaseUrl>\n                            <Spec>\n                                { spec.info.title }\n                            </Spec>\n                            <DeleteButton onClick={() => this.deleteApi(baseUrl)}>\n                                <Icon icon={['far', 'trash-alt']} />\n                            </DeleteButton>\n                        </React.Fragment>\n                    )\n                }\n\n                { !this.selectedSpec\n                    ? <UploadSpecButton\n                        type='submit' // Ensures we can show validation messages here\n                        onClick={this.specProcessingInProgress ? undefined : this.uploadSpec}\n                        ref={this.uploadSpecButtonRef}\n                    >\n                        { this.specProcessingInProgress\n                            ? <Icon icon={['fas', 'spinner']} spin />\n                            : \"Load an OpenAPI or Swagger spec\"\n                        }\n                    </UploadSpecButton>\n                    : <>\n                        <BaseUrlInput\n                            placeholder=\"Base URL for requests to match against this spec\"\n                            value={this.enteredBaseUrl}\n                            onChange={(e) => this.onBaseUrl(e.target.value)}\n                            ref={this.baseUrlInputRef}\n                        />\n                        <Spec>\n                            { this.selectedSpec.info.title }\n                            <UndoButton onClick={this.resetApiInputs}>\n                                <Icon icon={['fas', 'undo']} />\n                            </UndoButton>\n                        </Spec>\n                        <AddButton\n                            disabled={!this.selectedSpec || !this.enteredBaseUrl || !!this.baseUrlError}\n                            onClick={this.saveApi}\n                        >\n                            <Icon icon={['fas', 'save']} />\n                        </AddButton>\n                    </>\n                }\n            </ApiRows>\n\n            <SettingsExplanation>\n                APIs added here will provide documentation and validation for all matching\n                requests within their base URL.\n            </SettingsExplanation>\n            <SettingsExplanation>\n                HTTP Toolkit also includes built-in specifications for 2600+ popular public APIs.\n            </SettingsExplanation>\n        </CollapsibleCard>\n    }\n\n    uploadSpec = flow(function * (this: ApiSettingsCard) {\n        updateValidationMessage(this.uploadSpecButtonRef.current!);\n\n        try {\n            const file: string = yield uploadFile('text', ['.json', '.yaml']);\n            if (!file) return;\n\n            this.specProcessingInProgress = true;\n            let content: any = yield attempt(() =>\n                JSON.parse(file)\n            ).catch(() =>\n                yaml.parse(file)\n            ).catch((e) => {\n                console.warn('OpenAPI spec parsing error:', e);\n                throw new Error('File could not be parsed as either YAML or JSON')\n            });\n\n            let openApiSpec: OpenAPIObject;\n\n            if (content.swagger === \"2.0\") {\n                openApiSpec = yield new Promise((resolve, reject) => {\n                    swagger2OpenApi.convertObj(content, {\n                        patch: true,\n                        resolve: false\n                    }, (error, result) => {\n                        if (error) return reject(error);\n\n                        if (result.warnings && result.warnings.length) {\n                            console.warn(\"Some issues found whilst parsing spec:\");\n                            result.warnings.forEach(w => console.warn(w));\n                        }\n\n                        resolve(result.openapi);\n                    });\n                });\n            } else if (content.openapi && semver.satisfies(content.openapi, '^3')) {\n                openApiSpec = content;\n            } else {\n                throw new Error(\"This file doesn't contain an OpenAPI v3 or Swagger v2 specification\");\n            }\n\n            // Build the API just to test that we *can* (we'll rebuild with the base URL later)\n            yield buildApiMetadataAsync(openApiSpec, [\n                'api.build.example' // Need a default base here in case the spec has no servers\n            ]);\n\n            this.selectedSpec = openApiSpec;\n\n            const { servers } = openApiSpec;\n            if (servers && servers.length >= 1) {\n                let { url, variables } = servers[0];\n\n                if (variables) {\n                    Object.entries(variables).forEach(([variableName, variable]) => {\n                        url = url.replace(`{${variableName}}`, variable.default.toString());\n                    });\n                }\n\n                // Delay because we need the input to appear so that the ref() is set\n                requestAnimationFrame(() => this.onBaseUrl(url));\n            }\n        } catch (e) {\n            console.log(e);\n            updateValidationMessage(this.uploadSpecButtonRef.current!, asError(e).message);\n        } finally {\n            this.specProcessingInProgress = false;\n        }\n    }).bind(this);\n\n    validateBaseUrl(baseUrl: string) {\n        if (baseUrl.startsWith('/')) throw new Error(\"Base URLs must specify a host\");\n\n        if (!baseUrl.startsWith('http://') && !baseUrl.startsWith('https://')) {\n            // We allow users to include a protocol (though we'll ignore it and drop it later)\n            baseUrl = 'https://' + baseUrl;\n        }\n\n        const url = new URL(baseUrl);\n\n        // If you do include a protocol though, it better be HTTP(S)\n        if (!['http:', 'https:'].includes(url.protocol)) throw new Error(\"Base URLs must be HTTP or HTTPS\");\n\n        if (url.search) throw new Error(\"Base URLs can't contain query parameters\");\n        if (url.hash) throw new Error(\"Base URLs can't contain hash fragments\");\n\n        // Verify we don't have the same URL already, or the same URL without a protocol:\n        const existingBaseUrls = Object.keys(this.props.apiStore!.customOpenApiInfo);\n        const protocollessUrl = baseUrl.replace(/^https?:\\/\\//, '');\n        if (existingBaseUrls.includes(protocollessUrl)) {\n            throw new Error(\"This URL is already mapped to an API\");\n        }\n    }\n\n    @action.bound\n    onBaseUrl(baseUrl: string) {\n        this.enteredBaseUrl = baseUrl;\n\n        const input = this.baseUrlInputRef.current!;\n        try {\n            this.validateBaseUrl(baseUrl);\n            this.baseUrlError = undefined;\n            updateValidationMessage(input);\n        } catch (e) {\n            this.baseUrlError = asError(e);\n            updateValidationMessage(input,\n                e instanceof TypeError\n                    ? \"Not a valid URL\"\n                    : asError(e).message\n            );\n        }\n    }\n\n    saveApi = flow(function * (this: ApiSettingsCard) {\n        const baseUrl = this.enteredBaseUrl.replace(/https?:\\/\\//, '');\n\n        const api: ApiMetadata = yield buildApiMetadataAsync(\n            this.selectedSpec!,\n            ['http://' + baseUrl, 'https://' + baseUrl]\n        );\n        this.props.apiStore!.addCustomApi(baseUrl, api);\n        trackEvent({ category: \"Config\", action: \"Add API spec\" });\n\n        this.enteredBaseUrl = \"\";\n        this.selectedSpec = undefined;\n    }).bind(this);\n\n    @action.bound\n    resetApiInputs() {\n        this.enteredBaseUrl = \"\";\n        this.baseUrlError = undefined;\n        this.selectedSpec = undefined;\n    }\n\n    @action.bound\n    deleteApi(baseUrl: string) {\n        this.props.apiStore!.deleteCustomApi(baseUrl);\n    }\n}","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { observer, inject } from \"mobx-react\";\nimport * as dedent from 'dedent';\nimport {\n    distanceInWordsStrict, distanceInWordsToNow, format\n} from 'date-fns';\nimport { SubscriptionPlans } from '@httptoolkit/accounts';\n\nimport { WithInjected } from '../../types';\nimport { styled, Theme, ThemeName } from '../../styles';\nimport { Icon, WarningIcon } from '../../icons';\n\nimport { AccountStore } from '../../model/account/account-store';\nimport { UiStore } from '../../model/ui/ui-store';\nimport { serverVersion, versionSatisfies, PORT_RANGE_SERVER_RANGE } from '../../services/service-versions';\n\nimport { CollapsibleCard, CollapsibleCardHeading } from '../common/card';\nimport { ContentLabel, ContentValue } from '../common/text-content';\nimport { Button } from '../common/inputs';\nimport { TabbedOptionsContainer, Tab, TabsContainer } from '../common/tabbed-options';\nimport { ContainerSizedEditor } from '../editor/base-editor';\n\nimport * as amIUsingHtml from '../../amiusing.html';\n\nimport { ProxySettingsCard } from './proxy-settings-card';\nimport { ConnectionSettingsCard } from './connection-settings-card';\nimport { SettingsButton, SettingsButtonLink } from './settings-components';\nimport { ApiSettingsCard } from './api-settings-card';\n\ninterface SettingsPageProps {\n    accountStore: AccountStore;\n    uiStore: UiStore;\n}\n\nconst SettingsPagePlaceholder = styled.section`\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    height: 100%;\n`;\n\nconst SettingsPageScrollContainer = styled.div`\n    height: 100%;\n    width: 100%;\n    overflow-y: auto;\n`;\n\nconst SettingPageContainer = styled.section`\n    margin: 0px auto 20px;\n    padding: 40px;\n    max-width: 800px;\n    position: relative;\n\n    * {\n        transition: background-color 0.3s, margin-bottom 0.1s;\n    }\n`;\n\nconst SettingsHeading = styled.h1`\n    font-size: ${p => p.theme.loudHeadingSize};\n    font-weight: bold;\n    margin-bottom: 40px;\n`;\n\nconst AccountDetailsContainer = styled.div`\n    display: grid;\n    grid-template-columns: fit-content(40%) 1fr;\n    grid-gap: 10px;\n`;\n\nconst AccountControls = styled.div`\n    margin-top: 30px;\n\n    display: flex;\n    flex-direction: row;\n    flex-wrap: wrap;\n    gap: 10px;\n`;\n\nconst AccountContactFooter = styled.div`\n    margin-top: 30px;\n\n    strong {\n        user-select: all;\n    }\n`;\n\nconst ThemeColors = styled.div`\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    border: 3px solid #999;\n    margin: auto 20px;\n`;\n\nconst ThemeColorBlock = styled.div<{ themeColor: keyof Theme }>`\n    width: 60px;\n    height: 60px;\n    background-color: ${p => p.theme[p.themeColor]};\n`;\n\nconst EditorContainer = styled.div`\n    border: 3px solid #999;\n    height: 300px;\n    flex-grow: 1;\n    margin: auto 0;\n`;\n\nconst AccountUpdateSpinner = styled(Icon).attrs(() => ({\n    icon: ['fas', 'spinner'],\n    spin: true\n}))`\n    margin: 0 0 0 10px;\n`;\n\n@inject('accountStore')\n@inject('uiStore')\n@observer\nclass SettingsPage extends React.Component<SettingsPageProps> {\n\n    render() {\n        const { uiStore } = this.props;\n        const {\n            isPaidUser,\n            isPastDueUser,\n            userEmail,\n            userSubscription,\n            subscriptionPlans,\n            isAccountUpdateInProcess,\n            getPro,\n            canManageSubscription,\n            logOut\n        } = this.props.accountStore;\n\n        const cardProps = uiStore.settingsCardProps;\n\n        if (!isPaidUser && !isPastDueUser) {\n            // Can only happen if you log out whilst on this page.\n            return <SettingsPagePlaceholder>\n                <Button onClick={() => getPro('settings-page')}>Get Pro</Button>\n            </SettingsPagePlaceholder>;\n        }\n\n        // ! because we know this is set, as we have a paid user\n        const sub = userSubscription!;\n\n        return <SettingsPageScrollContainer>\n            <SettingPageContainer>\n                <SettingsHeading>Settings</SettingsHeading>\n\n                <CollapsibleCard {...cardProps.account}>\n                    <header>\n                        <CollapsibleCardHeading onCollapseToggled={\n                            cardProps.account.onCollapseToggled\n                        }>\n                            Account\n                        </CollapsibleCardHeading>\n                    </header>\n                    <AccountDetailsContainer>\n                        <ContentLabel>\n                            Account email\n                        </ContentLabel>\n                        <ContentValue>\n                            { userEmail }\n                        </ContentValue>\n\n                        <ContentLabel>\n                            Subscription status\n                        </ContentLabel>\n                        <ContentValue>\n                            {\n                                ({\n                                    'active': 'Active',\n                                    'trialing': 'Active (trial)',\n                                    'past_due': <strong\n                                        title={dedent`\n                                            Your subscription payment failed, and will be reattempted.\n                                            If retried payments fail your subscription will be cancelled.\n                                        `}\n                                    >Past due <WarningIcon /></strong>,\n                                    'deleted': 'Cancelled'\n                                }[sub.status]) || 'Unknown'\n                            }\n                            { isAccountUpdateInProcess &&\n                                <AccountUpdateSpinner />\n                            }\n                        </ContentValue>\n\n                        <ContentLabel>\n                            Subscription plan\n                        </ContentLabel>\n                        <ContentValue>\n                            {\n                                subscriptionPlans.state === 'fulfilled'\n                                ? (subscriptionPlans.value as SubscriptionPlans)[sub.plan]?.name\n                                // If the accounts API is unavailable for plan metadata for some reason, we can just\n                                // format the raw SKU to get something workable, no worries:\n                                : _.startCase(sub.plan)\n                            }\n                        </ContentValue>\n\n                        <ContentLabel>\n                            {\n                                ({\n                                    'active': 'Next renews',\n                                    'trialing': 'Renews',\n                                    'past_due': 'Next payment attempt',\n                                    'deleted': 'Ends',\n                                }[sub.status]) || 'Current period ends'\n                            }\n                        </ContentLabel>\n                        <ContentValue>\n                            {\n                                distanceInWordsStrict(new Date(), sub.expiry, {\n                                    addSuffix: true,\n                                    partialMethod: 'round'\n                                })\n                            } ({\n                                format(sub.expiry.toString(), 'Do [of] MMMM YYYY')\n                            })\n                        </ContentValue>\n                    </AccountDetailsContainer>\n\n                    <AccountControls>\n                        { sub.lastReceiptUrl &&\n                            <SettingsButtonLink\n                                href={ sub.lastReceiptUrl }\n                                target='_blank'\n                                rel='noreferrer noopener'\n                            >\n                                View latest invoice\n                            </SettingsButtonLink>\n                        }\n                        { canManageSubscription && <>\n                            { sub.updateBillingDetailsUrl &&\n                                <SettingsButtonLink\n                                    href={sub.updateBillingDetailsUrl}\n                                    target='_blank'\n                                    rel='noreferrer noopener'\n                                    highlight={sub.status === 'past_due'}\n                                >\n                                    Update billing details\n                                </SettingsButtonLink>\n                            }\n                            <SettingsButton\n                                onClick={this.confirmSubscriptionCancellation}\n                                disabled={isAccountUpdateInProcess}\n                            >\n                                Cancel subscription\n                                { isAccountUpdateInProcess &&\n                                    <AccountUpdateSpinner />\n                                }\n                            </SettingsButton>\n                        </> }\n                        <SettingsButton onClick={logOut}>Log out</SettingsButton>\n                    </AccountControls>\n\n                    <AccountContactFooter>\n                        Questions? Email <strong>billing@httptoolkit.com</strong>\n                    </AccountContactFooter>\n                </CollapsibleCard>\n\n                {/*\n                    The above shows for both active paid users, and recently paid users whose most recent\n                    payments failed. For those users, we drop other Pro features, but keep the settings\n                    UI so they can easily log out, update billing details or cancel fully.\n\n                    The rest is active paid users only:\n                 */}\n\n                { isPaidUser && <>\n                    {\n                        _.isString(serverVersion.value) &&\n                        versionSatisfies(serverVersion.value, PORT_RANGE_SERVER_RANGE) && <>\n                            <ProxySettingsCard {...cardProps.proxy} />\n                            <ConnectionSettingsCard {...cardProps.connection} />\n                        </>\n                    }\n\n                    <ApiSettingsCard {...cardProps.api} />\n\n                    <CollapsibleCard {...cardProps.themes}>\n                        <header>\n                            <CollapsibleCardHeading onCollapseToggled={\n                                cardProps.themes.onCollapseToggled\n                            }>\n                                Themes\n                            </CollapsibleCardHeading>\n                        </header>\n                        <TabbedOptionsContainer>\n                            <TabsContainer\n                                onClick={(value: ThemeName | 'automatic' | Theme) => uiStore.setTheme(value)}\n                                isSelected={(value: ThemeName | 'automatic' | Theme) => {\n                                    if (typeof value === 'string') {\n                                        return uiStore.themeName === value;\n                                    } else {\n                                        return _.isEqual(value, uiStore.theme);\n                                    }\n                                }}\n                            >\n                                <Tab\n                                    icon={['fas', 'magic']}\n                                    value='automatic'\n                                >\n                                    Automatic\n                                </Tab>\n                                <Tab\n                                    icon={['fas', 'sun']}\n                                    value='light'\n                                >\n                                    Light\n                                </Tab>\n                                <Tab\n                                    icon={['fas', 'moon']}\n                                    value='dark'\n                                >\n                                    Dark\n                                </Tab>\n                                <Tab\n                                    icon={['fas', 'adjust']}\n                                    value='high-contrast'\n                                >\n                                    High Contrast\n                                </Tab>\n                            </TabsContainer>\n                            <ThemeColors>\n                                <ThemeColorBlock themeColor='mainColor' />\n                                <ThemeColorBlock themeColor='mainBackground' />\n                                <ThemeColorBlock themeColor='highlightColor' />\n                                <ThemeColorBlock themeColor='highlightBackground' />\n                                <ThemeColorBlock themeColor='primaryInputColor' />\n                                <ThemeColorBlock themeColor='primaryInputBackground' />\n                                <ThemeColorBlock themeColor='containerWatermark' />\n                                <ThemeColorBlock themeColor='containerBorder' />\n                                <ThemeColorBlock themeColor='mainLowlightBackground' />\n                                <ThemeColorBlock themeColor='containerBackground' />\n                            </ThemeColors>\n\n                            <EditorContainer>\n                                <ContainerSizedEditor\n                                    contentId={null}\n                                    language='html'\n                                    defaultValue={amIUsingHtml}\n                                />\n                            </EditorContainer>\n                        </TabbedOptionsContainer>\n                    </CollapsibleCard>\n                </> }\n            </SettingPageContainer>\n        </SettingsPageScrollContainer>;\n    }\n\n    confirmSubscriptionCancellation = () => {\n        const subscription = this.props.accountStore.userSubscription;\n        if (!subscription) {\n            throw new Error(\"Can't cancel without a subscription\");\n        }\n\n        const planName = SubscriptionPlans[subscription.plan].name;\n\n        let cancelEffect: string;\n\n        if (subscription.status === 'active') {\n            cancelEffect = `It will remain usable until it expires in ${\n                distanceInWordsToNow(subscription.expiry)\n            } but will not renew.`;\n        } else if (subscription.status === 'past_due') {\n            cancelEffect = 'No more renewals will be attempted and it will deactivate immediately.';\n        } else {\n            throw new Error(`Cannot cancel subscription with status ${subscription.status}`);\n        }\n\n        const confirmed = confirm([\n            `This will cancel your HTTP Toolkit ${planName} subscription.`,\n            cancelEffect,\n            \"Are you sure?\"\n        ].join('\\n\\n'));\n\n        if (!confirmed) return;\n\n        this.props.accountStore.cancelSubscription().catch((e) => {\n            alert(e.message);\n        });\n    };\n}\n\n// Annoying cast required to handle the store prop nicely in our types\nconst InjectedSettingsPage = SettingsPage as unknown as WithInjected<\n    typeof SettingsPage,\n    'accountStore' | 'uiStore'\n>;\nexport { InjectedSettingsPage as SettingsPage };","import { styled } from \"../../styles\";\nimport { SecondaryButton } from '../common/inputs';\n\nexport const ModalOverlay = styled.div<{ opacity?: number }>`\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n\n    background: ${p => p.theme.modalGradient};\n\n    z-index: 10;\n    opacity: ${p => p.opacity || 0.9};\n`;\n\nexport const ModalButton = styled(SecondaryButton)`\n    padding: 5px 20px;\n    margin: 20px auto;\n\n    &:not([disabled]) {\n        color: ${p => p.theme.mainBackground};\n        border-color: ${p => p.theme.mainBackground};\n    }\n\n    border-color: rgba(255, 255, 255, 0.6);\n    font-size: ${p => p.theme.textSize};\n`;","import * as _ from \"lodash\";\nimport * as React from \"react\";\nimport { observer } from \"mobx-react\";\nimport { observable, action, computed } from \"mobx\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\n\nimport type { SKU, SubscriptionPlans } from \"@httptoolkit/accounts\";\n\nimport { styled, css } from \"../../styles\";\nimport { Icon } from \"../../icons\";\nimport { ObservablePromise } from \"../../util/observable\";\n\nimport { Button, UnstyledButton, ButtonLink, SecondaryButton } from \"../common/inputs\";\nimport { ModalButton } from \"./modal-overlay\";\n\nconst PlanPickerModal = styled.dialog`\n    position: absolute;\n\n    top: 50%;\n    left: 50%;\n\n    /* There's default styling for dialog, so undo it: */\n    bottom: auto;\n    right: auto;\n\n    transform: translate(-50%, -50%);\n    z-index: 99;\n\n    display: flex;\n    flex-direction: row;\n    color: ${p => p.theme.mainBackground};\n\n    background-color: transparent;\n    border: none;\n\n    min-width: 850px;\n    max-width: 980px;\n    width: 90%;\n`;\n\nconst PlanPickerDetails = styled.section`\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n\n    padding-right: 20px;\n    max-width: 400px;\n`;\n\nconst PlanPickerHeading = styled.h1`\n    font-size: ${p => p.theme.loudHeadingSize};\n    font-weight: bold;\n    letter-spacing: -1px;\n    text-align: center;\n`;\n\nconst PlanCycleToggle = styled(UnstyledButton)`\n    background: none;\n    border: none;\n\n    margin: 10px auto;\n    padding: 10px 10px;\n\n    font-family: ${p => p.theme.fontFamily};\n    font-size: ${p => p.theme.headingSize};\n    color: ${p => p.theme.mainColor};\n\n    display: flex;\n    align-items: center;\n    flex-direction: row;\n\n    > svg {\n        margin: 0 10px;\n        z-index: 1;\n    }\n`;\n\nconst PlanCycle = styled.span<{selected: boolean}>`\n    padding: 10px 15px;\n    border-radius: 8px;\n\n    &:first-child {\n        padding-right: 40px;\n        margin-right: -40px;\n    }\n\n    &:last-child {\n        padding-left: 40px;\n        margin-left: -40px;\n    }\n\n    ${p => p.selected && css`\n        background-color: ${p => p.theme.mainBackground};\n        border-bottom: 3px solid ${p => p.theme.containerBorder};\n        box-shadow: 0 4px 10px 0 rgba(0,0,0,0.1);\n    `}\n\n    ${p => !p.selected && css`\n        color: ${p => p.theme.mainBackground};\n        opacity: 0.7;\n    `}\n`;\n\nconst PlanPickerButtons = styled.div`\n    display: flex;\n    flex-direction: column;\n    justify-content: space-evenly;\n\n    width: 300px;\n    margin: 50px auto 0;\n\n    > p {\n        margin-bottom: 10px;\n        text-align: center;\n        word-break: break-word;\n    }\n`;\n\nconst PlanSecondaryButton = styled(SecondaryButton)`\n    &:not(:last-child) {\n        margin-bottom: 10px;\n    }\n\n    &:not([disabled]) {\n        color: ${p => p.theme.mainBackground};\n        border-color: ${p => p.theme.mainBackground};\n    }\n`;\n\nconst Nowrap = styled.span`\n    white-space: nowrap;\n`;\n\nconst PricingTable = styled.div`\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n    color: ${p => p.theme.mainColor};\n    max-width: 830px;\n`;\n\nconst PricingTier = styled.section<{ highlighted?: boolean }>`\n    display: flex;\n    flex-direction: column;\n    box-shadow: 0 4px 10px 0 rgba(0,0,0,0.1);\n    border-radius: 4px;\n    border: 1px solid ${p => p.theme.containerBorder};\n\n    > * {\n        padding: 0 20px;\n    }\n\n    flex: 1 1;\n\n    ${p => p.highlighted ? css`\n        background-color: ${p => p.theme.mainBackground};\n        color: ${p => p.theme.mainColor};\n\n        z-index: 1;\n        margin: -15px -5px -15px 0;\n\n        flex-basis: 1%;\n\n        > ${TierHeader} {\n            padding: 37.5px 0;\n        }\n    ` : css`\n        background-color: ${p => p.theme.mainLowlightBackground};\n        opacity: 0.9;\n    `}\n`;\n\nconst TierHeader = styled.div`\n    width: 100%;\n    padding: 30px 0;\n    color: ${p => p.theme.popColor};\n    text-align: center;\n    font-weight: bold;\n    font-size: ${p => p.theme.loudHeadingSize};\n`;\n\nconst TierPriceBlock = styled.div`\n    text-align: center;\n    color: ${p => p.theme.mainColor};\n    margin: 0 20px;\n`;\n\nconst TierPrice = styled.div`\n    font-size: ${p => p.theme.largeHeadingSize};\n    color: ${p => p.theme.mainColor};\n    font-weight: bold;\n`;\n\nconst TierPriceCaveats = styled.small`\n    display: block;\n    font-size: 80%;\n    opacity: 0.8;\n`;\n\nconst TierLicense = styled.div`\n    display: block;\n    margin-top: 10px;\n    font-size: ${p => p.theme.headingSize};\n`;\n\nconst TierFeatures = styled.ul`\n    padding: 40px 20px 30px;\n    font-size: ${p => p.theme.textSize};\n    line-height: 1.2;\n`;\n\nconst FeatureHeading = styled.li`\n    margin-top: 20px;\n    margin-left: 0;\n    list-style-type: none;\n\n    &:first-child {\n        margin-top: 0;\n    }\n`;\n\nconst Feature = styled.li`\n    &:not(:first-child) {\n        margin-top: 20px;\n    }\n\n    strong {\n        color: ${p => p.theme.popColor};\n    }\n`;\n\nconst SubFeature = styled(Feature)`\n    list-style: circle;\n    margin-left: 20px;\n`;\n\nconst SubFeatures = styled.ul`\n    margin-top: 15px;\n\n    > ${SubFeature} {\n        margin-top: 4px;\n    }\n`;\n\nconst PricingCTA = styled.div`\n    margin-top: 0;\n    margin-bottom: 20px;\n    font-weight: bold;\n\n    > ${Button} {\n        text-align: center;\n        width: 100%\n    }\n`;\n\nconst PlanSmallPrint = styled.div`\n    color: ${p => p.theme.mainBackground};\n    font-size: ${p => p.theme.textSize};\n\n    margin-top: 10px;\n    text-align: center;\n    line-height: 1.2;\n\n    strong {\n        font-weight: bold;\n    }\n\n    a {\n        color: ${p => p.theme.mainBackground};\n    }\n\n    p {\n        margin-top: 10px;\n    }\n`;\n\nconst SpinnerModal = styled.div`\n    position: absolute;\n\n    top: 50%;\n    left: 50%;\n\n    transform: translate(-50%, -50%) scale(2);\n    z-index: 99;\n\n    display: flex;\n    flex-direction: column;\n    text-align: center;\n\n    > p {\n        max-width: 500px;\n        line-height: 1.2;\n    }\n\n    > p, > svg {\n        color: #fff;\n        margin: 20px auto;\n    }\n\n    a[href] {\n        color: #6e8ff4;\n    }\n`;\n\ntype PlanCycle = 'monthly' | 'annual';\n\ninterface PlanPickerProps {\n    email?: string;\n    plans: ObservablePromise<SubscriptionPlans>;\n    onPlanPicked: (sku: SKU | undefined) => void;\n    logOut: () => void;\n    logIn: () => void;\n}\n\n@observer\nexport class PlanPicker extends React.Component<PlanPickerProps> {\n\n    @observable\n    planCycle: PlanCycle = 'monthly';\n\n    render() {\n        const {\n            isPricingAvailable,\n            planCycle,\n            toggleCycle,\n            buyPlan,\n            closePicker,\n            getPlanMonthlyPrice\n        } = this;\n        const { email, logOut, logIn } = this.props;\n\n        if (!isPricingAvailable) {\n            return <SpinnerModal>\n                <p>\n                    Unable to connect to HTTP Toolkit account servers...\n                </p>\n                <p>\n                    Having problems? Open an issue <a\n                        href=\"https://github.com/httptoolkit/httptoolkit/issues/new/choose\"\n                    >on GitHub</a> or email <strong>billing@httptoolkit.com</strong> to ask for help.\n                </p>\n                <Icon\n                    icon={['fac', 'spinner-arc']}\n                    spin\n                    size='10x'\n                />\n                <ModalButton onClick={closePicker}>\n                    Cancel\n                </ModalButton>\n            </SpinnerModal>\n        }\n\n        return <PlanPickerModal open>\n            <PlanPickerDetails>\n                <PlanPickerHeading>Choose your Plan</PlanPickerHeading>\n                <PlanCycleToggle onClick={toggleCycle}>\n                    <PlanCycle selected={planCycle === 'monthly'}>Monthly</PlanCycle>\n\n                    <FontAwesomeIcon icon={['fas', planCycle === 'annual' ? 'toggle-on' : 'toggle-off']} />\n\n                    <PlanCycle selected={planCycle === 'annual'}>Annual</PlanCycle>\n                </PlanCycleToggle>\n\n                <PlanSmallPrint>\n                    <p>\n                        <strong>Cancel in two clicks, anytime</strong>. <br/>Have questions? <strong><a\n                            href=\"https://httptoolkit.com/docs/guides/subscription-faq\"\n                        >Read the FAQ</a></strong> or email billing@httptoolkit.com.\n                    </p>\n                    <p>\n                        By subscribing to a paid plan, you accept <Nowrap>\n                            <a href=\"https://httptoolkit.com/terms-of-service\">\n                                the HTTP Toolkit Terms of Service\n                            </a>\n                        </Nowrap>.\n                    </p>\n                </PlanSmallPrint>\n\n                <PlanPickerButtons>\n                    { email && <p>\n                        Logged in as <Nowrap>{ email }</Nowrap>.\n                    </p> }\n                    {\n                        email\n                            ? <PlanSecondaryButton onClick={logOut}>Log out</PlanSecondaryButton>\n                            : <PlanSecondaryButton onClick={logIn}>Log into existing account</PlanSecondaryButton>\n                    }\n                    <PlanSecondaryButton onClick={closePicker}>Cancel</PlanSecondaryButton>\n                </PlanPickerButtons>\n            </PlanPickerDetails>\n\n            <PricingTable>\n                <PricingTier highlighted={true}>\n                    <TierHeader>\n                        Professional\n                    </TierHeader>\n                    <TierPriceBlock>\n                        <TierPrice>{getPlanMonthlyPrice('pro')} / month</TierPrice>\n                        <TierPriceCaveats>\n                            plus local tax, paid {this.planCycle === 'annual' ? 'annually' : 'monthly'}\n                        </TierPriceCaveats>\n                        <TierLicense title='Licensed for a specific individual. See the terms of service for full details.'>\n                            Personal user account\n                        </TierLicense>\n                    </TierPriceBlock>\n                    <TierFeatures>\n                        <Feature>\n                            <strong>Automated HTTP mocking & rewriting</strong>, including traffic redirection, mock responses, and errors & timeouts.\n                        </Feature>\n                        <Feature>\n                            <strong>Reusable mock rules</strong>. Persistent by default, plus\n                            import/export so you can store, reuse & share them later.\n                        </Feature>\n                        <Feature>\n                            <strong>Import/export for collected traffic</strong>, as either <a\n                                href=\"https://en.wikipedia.org/wiki/HAR_(file_format)\"\n                                target=\"_blank\"\n                                rel=\"noopener noreferrer\"\n                            >\n                                HARs\n                            </a> or ready-to-use code for 20+ tools.\n                        </Feature>\n                        <Feature>\n                            <strong>Advanced HTTP debugging & inspection tools</strong>, including compression & caching performance analysis.\n                        </Feature>\n                        <Feature>\n                            <strong>Validation &amp; API documentation for 2600+ built-in APIs</strong>,\n                            from AWS to GitHub to Stripe, plus your own custom <a\n                                href=\"https://swagger.io/docs/specification/about/\"\n                                target=\"_blank\"\n                                rel=\"noopener noreferrer\"\n                            >OpenAPI</a> specs.\n                        </Feature>\n                        <Feature>\n                            <strong>Advanced customization</strong>, including UI themes,\n                            whitelisted & client certificates, ports, and upstream proxies.\n                        </Feature>\n                        <Feature>\n                            <strong>Support ongoing development!</strong>\n                        </Feature>\n                    </TierFeatures>\n                    <PricingCTA>\n                        <Button onClick={() => buyPlan('pro')}>\n                            Get Pro Now\n                        </Button>\n                    </PricingCTA>\n                </PricingTier>\n\n                <PricingTier>\n                    <TierHeader>\n                        Team\n                    </TierHeader>\n                    <TierPriceBlock>\n                        <TierPrice>{getPlanMonthlyPrice('team')} / user / month</TierPrice>\n                        <TierPriceCaveats>\n                            plus local tax, paid {this.planCycle === 'annual' ? 'annually' : 'monthly'}\n                        </TierPriceCaveats>\n                        <TierLicense title='One team license, linked to many individuals, who can be added and removed. See the terms of service for details.'>\n                            Team account\n                        </TierLicense>\n                    </TierPriceBlock>\n                    <TierFeatures>\n                        <FeatureHeading>\n                            <em>All Professional features, and:</em>\n                        </FeatureHeading>\n                        <Feature>\n                            <strong>Centralized billing</strong> to simplify payment for your team\n                        </Feature>\n                        <Feature>Licensed to your team, rather than individuals</Feature>\n                        <Feature><strong>Centralized control</strong> to easily manage your team members and subscription</Feature>\n                        <Feature>\n                            <strong>Team workspaces</strong> for low-friction collaboration <Nowrap>\n                                (<em>coming soon</em>)\n                            </Nowrap>\n                        </Feature>\n                        <FeatureHeading>\n                            Options available on request:\n                        </FeatureHeading>\n                        <SubFeatures>\n                            <SubFeature>Self-hosted infrastructure</SubFeature>\n                            <SubFeature>Private support</SubFeature>\n                            <SubFeature>Training & consultancy</SubFeature>\n                            <SubFeature>Bulk discounts</SubFeature>\n                        </SubFeatures>\n                    </TierFeatures>\n                    <PricingCTA>\n                        <ButtonLink href='https://httptoolkit.com/contact'>\n                            Get in touch\n                        </ButtonLink>\n                    </PricingCTA>\n                </PricingTier>\n            </PricingTable>\n        </PlanPickerModal>\n    }\n\n    @action.bound\n    toggleCycle() {\n        this.planCycle = this.planCycle === 'annual' ? 'monthly' : 'annual';\n    }\n\n    @computed\n    get isPricingAvailable() {\n        const plans = this.props.plans;\n        return plans.state === 'fulfilled';\n    }\n\n    getPlanMonthlyPrice = (tierCode: string): string => {\n        if (!this.isPricingAvailable) throw new Error(\"Can't query prices if pricing is not available\");\n        const plans = this.props.plans.value as SubscriptionPlans; // Always true once pricing is available\n\n        const sku = this.getSKU(tierCode);\n        const plan = plans[sku];\n        if (plan.prices === 'priceless') throw new Error(\"Can't show price for non-priced plan\");\n        return plan.prices!.monthly;\n    };\n\n    getSKU = (tierCode: string) => {\n        return `${tierCode}-${this.planCycle}` as SKU;\n    }\n\n    buyPlan = (tierCode: string) => {\n        this.props.onPlanPicked(this.getSKU(tierCode));\n    }\n\n    closePicker = () => {\n        this.props.onPlanPicked(undefined);\n    }\n\n}","import * as React from 'react';\n\nimport { styled } from '../../styles';\n\nimport { Icon } from '../../icons';\nimport { ModalButton } from './modal-overlay';\n\nexport const CheckoutSpinner = styled((p: { className?: string, onCancel: () => void }) => (\n    <div className={p.className}>\n        <p>\n            The checkout has been opened in your browser.\n            <br/>\n            Please follow the steps there to complete your subscription.\n        </p>\n        <p>\n            Have questions? Take a look at <a\n                href=\"https://httptoolkit.com/docs/guides/subscription-faq\"\n            >the FAQ</a> or email <strong>billing@httptoolkit.com</strong>.\n        </p>\n        <Icon\n            icon={['fac', 'spinner-arc']}\n            spin\n            size='10x'\n        />\n        <ModalButton onClick={p.onCancel}>\n            Cancel checkout\n        </ModalButton>\n    </div>\n))`\n    > p {\n        max-width: 500px;\n        line-height: 1.2;\n    }\n\n    > p, > svg {\n        color: #fff;\n        margin: 20px auto;\n    }\n\n    a[href] {\n        color: #6e8ff4;\n    }\n\n    text-align: center;\n\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%) scale(2);\n    z-index: 100;\n`;","import * as React from 'react';\nimport { autorun } from 'mobx';\nimport { disposeOnUnmount, observer } from 'mobx-react';\n\nimport {\n    Menu,\n    Submenu,\n    Separator,\n    Item,\n    contextMenu\n} from 'react-contexify';\n\nimport { styled } from '../styles';\n\nimport { UnreachableCheck } from '../util/error';\n\nimport { ContextMenuItem, ContextMenuState } from '../model/ui/context-menu';\n\n@observer\nexport class HtmlContextMenu<T> extends React.Component<{\n    menuState: ContextMenuState<T>,\n    onHidden: () => void\n}> {\n\n    componentDidMount() {\n        // Automatically show the menu when this is rendered:\n        disposeOnUnmount(this, autorun(() => {\n            const menuState = this.props.menuState;\n\n            // Annoyingly, the menu is not listening immediately after the component\n            // is mounted, so we have to delay this slightly:\n            setTimeout(() => {\n                contextMenu.show({\n                    id: 'menu',\n                    event: menuState.event\n                });\n            }, 10);\n        }));\n    }\n\n    render() {\n        return <ThemedMenu\n            id='menu'\n            onVisibilityChange={this.onVisibilityChange}\n        >\n            { this.props.menuState.items.map(this.renderItem) }\n        </ThemedMenu>\n    }\n\n    renderItem = (item: ContextMenuItem<T>, i: number) => {\n        if (item.type === 'separator') {\n            return <Separator key={i} />;\n        } else if (item.type === 'option') {\n            return <Item\n                key={i}\n                onClick={() => item.callback(this.props.menuState.data)}\n                disabled={item.enabled === false}\n            >\n                { item.label }\n            </Item>\n        } else if (item.type === 'submenu') {\n            return <Submenu\n                key={i}\n                label={item.label}\n                disabled={item.enabled === false}\n            >\n                { item.items.map(this.renderItem) }\n            </Submenu>\n        } else throw new UnreachableCheck(item, i => i.type);\n    }\n\n    onVisibilityChange = (visible: boolean) => {\n        if (!visible) this.props.onHidden();\n    };\n\n}\n\nconst ThemedMenu = styled(Menu)`\n    --contexify-menu-bgColor: ${p => p.theme.mainLowlightBackground};\n    --contexify-item-color: ${p => p.theme.mainColor};\n    --contexify-separator-color: ${p => p.theme.containerBorder};\n\n    --contexify-rightSlot-color: ${p => p.theme.containerWatermark};\n    --contexify-activeRightSlot-color: ${p => p.theme.mainColor};\n\n    --contexify-arrow-color: ${p => p.theme.containerWatermark};\n    --contexify-activeArrow-color: ${p => p.theme.mainColor};\n\n    --contexify-activeItem-color: #fff;\n    --contexify-activeItem-bgColor: #3498db;\n`;","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { computed } from 'mobx';\nimport { observer, inject, disposeOnUnmount } from 'mobx-react';\nimport {\n    Router,\n    RouteComponentProps,\n    Redirect,\n    LocationProvider\n} from '@reach/router';\n\nimport { styled } from '../styles';\nimport { WithInjected } from '../types';\nimport { trackPage } from '../metrics';\nimport { appHistory } from '../routing';\nimport { useHotkeys, Ctrl } from '../util/ui';\n\nimport { AccountStore } from '../model/account/account-store';\nimport { UiStore } from '../model/ui/ui-store';\nimport {\n    serverVersion,\n    versionSatisfies,\n    MOCK_SERVER_RANGE,\n    SERVER_SEND_API_SUPPORTED\n} from '../services/service-versions';\n\nimport { Sidebar, SidebarItem, SIDEBAR_WIDTH } from './sidebar';\nimport { InterceptPage } from './intercept/intercept-page';\nimport { ViewPage } from './view/view-page';\nimport { MockPage } from './mock/mock-page';\nimport { SendPage } from './send/send-page';\nimport { SettingsPage } from './settings/settings-page';\n\nimport { PlanPicker } from './account/plan-picker';\nimport { ModalOverlay } from './account/modal-overlay';\nimport { CheckoutSpinner } from './account/checkout-spinner';\nimport { HtmlContextMenu } from './html-context-menu';\n\nconst AppContainer = styled.div<{ inert?: boolean }>`\n    display: flex;\n    height: 100%;\n\n    > :not(:first-child) {\n        flex: 1 1;\n        width: calc(100% - ${SIDEBAR_WIDTH});\n    }\n`;\n\ninterface ExtendProps extends React.PropsWithChildren<any> {\n\tpageComponent: React.ComponentType<{}>;\n}\n\nconst Route = ({ children, ...props }: ExtendProps & RouteComponentProps): React.ReactElement => {\n\tconst { pageComponent, ...otherProps } = props;\n\treturn (\n\t\t<props.pageComponent {...otherProps}>\n\t\t\t{children}\n\t\t</props.pageComponent>\n\t)\n};\n\nconst AppKeyboardShortcuts = (props: {\n    navigate: (path: string) => void,\n    canVisitSettings: boolean\n}) => {\n    useHotkeys('Ctrl+1,Cmd+1', (e) => {\n        props.navigate('/intercept');\n        e.preventDefault();\n    }, [props.navigate]);\n    useHotkeys('Ctrl+2,Cmd+2', (e) => {\n        props.navigate('/view');\n        e.preventDefault();\n    }, [props.navigate]);\n    useHotkeys('Ctrl+3,Cmd+3', (e) => {\n        props.navigate('/mock');\n        e.preventDefault();\n    }, [props.navigate]);\n    useHotkeys('Ctrl+9,Cmd+9', (e) => {\n        if (props.canVisitSettings) props.navigate('/settings');\n        e.preventDefault();\n    }, [props.navigate, props.canVisitSettings]);\n\n    return null;\n};\n\n@inject('accountStore')\n@inject('uiStore')\n@observer\nclass App extends React.Component<{\n    accountStore: AccountStore,\n    uiStore: UiStore\n}> {\n\n    @computed\n    get canVisitSettings() {\n        return this.props.accountStore.isPaidUser || this.props.accountStore.isPastDueUser;\n    }\n\n    @computed\n    get canVisitSend() {\n        return this.props.accountStore.featureFlags.includes('send') && (\n            // Hide Send option if the server is too old for proper support.\n            // We show by default to avoid flicker in the most common case\n            serverVersion.state !== 'fulfilled' ||\n            versionSatisfies(serverVersion.value as string, SERVER_SEND_API_SUPPORTED)\n        );\n    }\n\n    @computed\n    get menuItems() {\n        return [\n            {\n                name: 'Intercept',\n                title: `Connect clients to HTTP Toolkit (${Ctrl}+1)`,\n                icon: ['fas', 'plug'],\n                position: 'top',\n                type: 'router',\n                url: '/intercept'\n            },\n            {\n                name: 'View',\n                title: `View intercepted HTTP traffic (${Ctrl}+2)`,\n                icon: ['fas', 'search'],\n                position: 'top',\n                type: 'router',\n                url: '/view'\n            },\n\n            ...(\n                (\n                    // Hide Mock option if the server is too old for proper support.\n                    // We show by default to avoid flicker in the most common case\n                    serverVersion.state !== 'fulfilled' ||\n                    versionSatisfies(serverVersion.value as string, MOCK_SERVER_RANGE)\n                )\n                ? [{\n                    name: 'Mock',\n                    title: `Add rules to mock & rewrite HTTP traffic (${Ctrl}+3)`,\n                    icon: ['fas', 'theater-masks'],\n                    position: 'top',\n                    type: 'router',\n                    url: '/mock'\n                }]\n                : []\n            ),\n\n            ...(this.canVisitSend\n                ? [{\n                    name: 'Send',\n                    title: `Send HTTP requests directly (${Ctrl}+4)`,\n                    icon: ['far', 'paper-plane'],\n                    position: 'top',\n                    type: 'router',\n                    url: '/send'\n                }]\n                : []\n            ),\n\n            (this.canVisitSettings\n                ? {\n                    name: 'Settings',\n                    title: `Reconfigure HTTP Toolkit and manage your account (${Ctrl}+9)`,\n                    icon: ['fas', 'cog'],\n                    position: 'bottom',\n                    type: 'router',\n                    url: '/settings'\n                }\n                : {\n                    name: 'Get Pro',\n                    title: \"Sign up for HTTP Toolkit Pro\",\n                    icon: ['far', 'star'],\n                    position: 'bottom',\n                    type: 'callback',\n                    onClick: () => this.props.accountStore.getPro('sidebar')\n                }\n            ),\n\n            {\n                name: 'Give feedback',\n                title: \"Suggest features or report issues\",\n                icon: ['far', 'comment'],\n                position: 'bottom',\n                highlight: true,\n                type: 'web',\n                url: 'https://github.com/httptoolkit/httptoolkit/issues/new/choose'\n            }\n        ] as SidebarItem[];\n    }\n\n    componentDidMount() {\n        disposeOnUnmount(this, appHistory.listen(\n            ({ location }) => trackPage(location)\n        ));\n    }\n\n    render() {\n        const {\n            modal,\n            setSelectedPlan,\n            subscriptionPlans,\n            userEmail,\n            logIn,\n            logOut,\n            cancelCheckout\n        } = this.props.accountStore;\n\n        const {\n            contextMenuState,\n            clearHtmlContextMenu\n        } = this.props.uiStore;\n\n        return <LocationProvider history={appHistory}>\n            <AppKeyboardShortcuts\n                navigate={appHistory.navigate}\n                canVisitSettings={this.canVisitSettings}\n            />\n            <AppContainer\n                aria-hidden={!!modal}\n                inert={!!modal}\n                // 'inert' doesn't actually work - it's non-standard, so we need this:\n                ref={node => node && (!!modal ?\n                    node.setAttribute('inert', '') : node.removeAttribute('inert')\n                )}\n            >\n                <Sidebar items={this.menuItems} />\n\n                <Router>\n                    <Redirect noThrow from=\"/\" to={'/intercept'} />\n                    <Route path={'/intercept'} pageComponent={InterceptPage} />\n                    <Route path={'/view'} pageComponent={ViewPage} />\n                    <Route path={'/view/:eventId'} pageComponent={ViewPage} />\n                    <Route path={'/mock'} pageComponent={MockPage} />\n                    <Route path={'/mock/:initialRuleId'} pageComponent={MockPage} />\n                    <Route path={'/send'} pageComponent={SendPage} />\n                    <Route path={'/settings'} pageComponent={SettingsPage} />\n                </Router>\n            </AppContainer>\n\n            { !!modal && <ModalOverlay /> }\n\n            { modal === 'pick-a-plan' &&\n                <PlanPicker\n                    email={userEmail}\n                    onPlanPicked={setSelectedPlan}\n                    logOut={logOut}\n                    logIn={logIn}\n                    plans={subscriptionPlans}\n                />\n            }\n\n            { modal === 'post-checkout' &&\n                <CheckoutSpinner\n                    onCancel={cancelCheckout}\n                />\n            }\n\n            {\n                contextMenuState &&\n                    <HtmlContextMenu\n                        menuState={contextMenuState}\n                        onHidden={clearHtmlContextMenu}\n                    />\n            }\n        </LocationProvider>;\n    }\n}\n\n// Annoying cast required to handle the store prop nicely in our types\nconst AppWithStoreInjected = (\n    App as unknown as WithInjected<typeof App, 'accountStore' | 'uiStore'>\n);\n\nexport { AppWithStoreInjected as App };","import * as React from 'react';\nimport { inject, observer } from 'mobx-react';\n\nimport { ThemeProvider } from '../styles';\nimport { WithInjected } from '../types';\n\nimport { UiStore } from '../model/ui/ui-store';\n\nconst StorePoweredThemeProvider = inject('uiStore')(observer((p: {\n    uiStore: UiStore,\n    children: JSX.Element\n}) => {\n    return <ThemeProvider theme={p.uiStore.theme}>\n        { p.children }\n    </ThemeProvider>\n}));\n\nconst InjectedStorePoweredThemeProvider = StorePoweredThemeProvider as unknown as WithInjected<\n    typeof StorePoweredThemeProvider,\n    'uiStore'\n>;\nexport { InjectedStorePoweredThemeProvider as StorePoweredThemeProvider };","import * as React from 'react';\nimport { observer } from 'mobx-react';\nimport { observable, action } from 'mobx';\n\nimport { styled } from '../styles';\nimport { Sentry, isSentryInitialized } from '../errors';\nimport { trackEvent } from '../metrics';\n\nconst ErrorOverlay = styled((props: {\n    className?: string,\n    children: React.ReactNode\n}) =>\n    <section className={props.className}>\n        { props.children }\n    </section>\n)`\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n\n    color: ${p => p.theme.mainColor};\n\n    h1 {\n        font-size: 300px;\n        font-weight: bold;\n        line-height: 230px;\n        margin-bottom: 50px;\n    }\n\n    p {\n        font-size: 50px;\n        margin-bottom: 50px;\n    }\n\n    button {\n        display: block;\n        margin: 0 auto 40px;\n\n        color: ${p => p.theme.mainColor};\n        background-color: ${p => p.theme.mainBackground};\n        box-shadow: 0 2px 10px 0 rgba(0,0,0,0.2);\n        border-radius: 4px;\n        border: none;\n\n        padding: 20px;\n\n        font-size: 50px;\n        font-weight: bolder;\n\n        &:not(:disabled) {\n            cursor: pointer;\n\n            &:hover {\n                color: ${p => p.theme.popColor};\n            }\n        }\n    }\n`;\n\n@observer\nexport class ErrorBoundary extends React.Component {\n\n    @observable\n    private error: Error | undefined;\n\n    @observable\n    private feedbackSent: boolean = false;\n\n    @action\n    componentDidCatch(error: Error, errorInfo: any) {\n        this.error = error;\n\n        Sentry.withScope(scope => {\n            Object.keys(errorInfo).forEach(key => {\n                scope.setExtra(key, errorInfo[key]);\n            });\n            Sentry.captureException(error);\n        });\n\n        trackEvent({\n            category: 'Error',\n            action: 'UI crashed'\n        });\n    }\n\n    render() {\n        return this.error ? (\n            <ErrorOverlay>\n                <h1>\n                    Oh no!\n                </h1>\n                <p>\n                    Sorry, it's all gone wrong.\n                </p>\n                <div>\n                    { isSentryInitialized() &&\n                        <button disabled={this.feedbackSent} onClick={this.sendFeedback}>\n                            Tell us what happened\n                        </button>\n                    }\n                    <button onClick={() => window.location.reload()}>\n                        Reload HTTP Toolkit\n                    </button>\n                </div>\n            </ErrorOverlay>\n        ) : this.props.children;\n    }\n\n    @action.bound\n    sendFeedback() {\n        Sentry.showReportDialog();\n        this.feedbackSent = true;\n    }\n}","document.dispatchEvent(new Event('load:executing'));\n\nimport * as localForage from 'localforage';\nlocalForage.config({ name: \"httptoolkit\", version: 1 });\n\nconst urlParams = new URLSearchParams(window.location.search);\nconst authToken = urlParams.get('authToken');\nlocalForage.setItem('latest-auth-token', authToken);\n\nimport { initSentry, logError } from './errors';\ninitSentry(process.env.SENTRY_DSN);\n\nimport * as _ from 'lodash';\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport * as mobx from 'mobx';\nimport { Provider } from 'mobx-react';\n\nimport { GlobalStyles } from './styles';\nimport { delay } from './util/promise';\nimport { initMetrics } from './metrics';\nimport { appHistory } from './routing';\n\nimport { HttpExchange } from './types';\n\nimport { UiStore } from './model/ui/ui-store';\nimport { AccountStore } from './model/account/account-store';\nimport { ProxyStore } from './model/proxy-store';\nimport { EventsStore } from './model/events/events-store';\nimport { RulesStore } from './model/rules/rules-store';\nimport { InterceptorStore } from './model/interception/interceptor-store';\nimport { ApiStore } from './model/api/api-store';\nimport { SendStore } from './model/send/send-store';\n\nimport { serverVersion, lastServerVersion, UI_VERSION } from './services/service-versions';\nimport {\n    attemptServerUpdate,\n    checkForOutdatedComponents,\n    runBackgroundUpdates\n} from './services/update-management';\n\nimport { App } from './components/app';\nimport { StorePoweredThemeProvider } from './components/store-powered-theme-provider';\nimport { ErrorBoundary } from './components/error-boundary';\n\nconsole.log(`Initialising UI (version ${UI_VERSION})`);\n\nconst APP_ELEMENT_SELECTOR = '#app';\n\nmobx.configure({ enforceActions: 'observed' });\n\n// Begin checking for updates and pre-caching UI components we might need, to support\n// background updates & instant offline startup. We slightly delay this to avoid\n// competing for bandwidth/CPU/etc with startup on slow connections.\ndelay(5000).then(runBackgroundUpdates);\ncheckForOutdatedComponents();\n\nconst accountStore = new AccountStore(\n    () => appHistory.navigate('/settings')\n);\nconst apiStore = new ApiStore(accountStore);\nconst uiStore = new UiStore(accountStore);\nconst proxyStore = new ProxyStore(accountStore);\nconst interceptorStore = new InterceptorStore(proxyStore, accountStore);\n\n// Some non-trivial interactions between rules & events stores here. Rules need to use events to\n// handle breakpoints (where rule logic reads from received event data), while events need to use\n// rules to store metadata about the rule that a received event says it matched with:\nconst rulesStore = new RulesStore(accountStore, proxyStore,\n    async function jumpToExchange(exchangeId: string) {\n        await eventsStore.initialized;\n\n        let exchange: HttpExchange;\n        await mobx.when(() => {\n            exchange = _.find(eventsStore.exchanges, { id: exchangeId })!;\n            // Completed -> doesn't fire for initial requests -> no completed/initial req race\n            return !!exchange && exchange.isCompletedRequest();\n        });\n\n        appHistory.navigate(`/view/${exchangeId}`);\n        return exchange!;\n    }\n);\nconst eventsStore = new EventsStore(proxyStore, apiStore, rulesStore);\nconst sendStore = new SendStore(eventsStore, rulesStore);\n\nconst stores = {\n    accountStore,\n    apiStore,\n    uiStore,\n    proxyStore,\n    eventsStore,\n    interceptorStore,\n    rulesStore,\n    sendStore\n};\n\nconst appStartupPromise = Promise.all(\n    Object.values(stores).map(store => store.initialized)\n);\ninitMetrics();\n\n// Once the app is loaded, show the app\nappStartupPromise.then(() => {\n    // We now know that the server is running - tell it to check for updates\n    attemptServerUpdate();\n\n    console.log('App started, rendering');\n\n    document.dispatchEvent(new Event('load:rendering'));\n    ReactDOM.render(\n        <Provider {...stores}>\n            <StorePoweredThemeProvider>\n                <ErrorBoundary>\n                    <GlobalStyles />\n                    <App />\n                </ErrorBoundary>\n            </StorePoweredThemeProvider>\n        </Provider>\n    , document.querySelector(APP_ELEMENT_SELECTOR))\n});\n\nconst STARTUP_TIMEOUT = 10000;\n\n// If loading fails, or we hit a timeout, show an error (but if we timeout,\n// don't stop trying to load in the background anyway). If we do eventually\n// succeed later on, the above render() will still happen and hide the error.\nPromise.race([\n    appStartupPromise,\n    delay(STARTUP_TIMEOUT).then(async () => {\n        console.log('Previous server version was', await lastServerVersion);\n\n        throw Object.assign(\n            new Error('Failed to initialize application'),\n            { isTimeout: true }\n        );\n    })\n]).catch((e) => {\n    const failureEvent = Object.assign(\n        new Event('load:failed'),\n        { error: e }\n    );\n    document.dispatchEvent(failureEvent);\n    logError(e);\n\n    appStartupPromise.then(() => {\n        serverVersion.then(async (currentVersion) => {\n            console.log('Server version was', await lastServerVersion, 'now started late with', currentVersion);\n            logError('Successfully initialized application, but after timeout');\n        });\n    });\n});","import { StyledComponent } from \"styled-components\";\nimport { styled, Theme, css } from \"../../styles\";\n\nexport const interactiveMouseoverStyles = css`\n    &[disabled] {\n        cursor: default;\n    }\n\n    &:not([disabled]) {\n        cursor: pointer;\n        &:hover {\n            background-image: linear-gradient(transparent, rgba(0,0,0,.05) 40%, rgba(0,0,0,.1));\n        }\n\n        &:active {\n            background-image: linear-gradient(rgba(0,0,0,.1), rgba(0,0,0,.05) 40%, transparent);\n        }\n    }\n`;\n\nexport const UnstyledButton = styled.button.attrs(() => ({\n    // 'submit' is the default, which makes 'enter' behaviour super wacky:\n    'type': 'button'\n}))`\n    /* Reset styles that get broken because <button> overrides them: */\n    border: none;\n    background: none;\n    font-family: inherit;\n    font-size: inherit;\n    color: inherit;\n\n    &[disabled] {\n        cursor: default;\n    }\n\n    &:not([disabled]) {\n        cursor: pointer;\n    }\n` as StyledComponent<\"button\", Theme>;\nexport const UnstyledButtonLink = UnstyledButton.withComponent('a');\n\nconst BaseButtonStyles = css`\n    -webkit-appearance: none;\n    cursor: pointer;\n    padding: 15px 36px;\n    border-radius: 4px;\n    border: none;\n\n    font-family: ${p => p.theme.fontFamily};\n    font-size: ${p => p.theme.headingSize};\n\n    display: block;\n    text-decoration: none;\n    text-align: center;\n    font-weight: inherit;\n    line-height: normal;\n\n    ${interactiveMouseoverStyles}\n`;\n\nexport const Button = styled.button`\n    ${BaseButtonStyles}\n\n    /*\n     * Need both to ensure link button colours have higher\n     * specificity than the a:visited default.\n     */\n    &, &:visited {\n        color: ${p => p.theme.primaryInputColor};\n    }\n\n    &[disabled] {\n        background-color: ${p => p.theme.containerWatermark};\n    }\n\n    &:not([disabled]) {\n        background-color: ${p => p.theme.primaryInputBackground};\n    }\n`;\n// 'submit' is the default, which makes 'enter' behaviour super wacky:\nButton.defaultProps = { type: \"button\" };\n\nexport const ButtonLink = Button.withComponent('a');\n\nexport const SecondaryButton = styled.button.attrs(() => ({\n    // 'submit' is the default, which makes 'enter' behaviour super wacky:\n    'type': 'button'\n}))`\n    ${BaseButtonStyles}\n\n    background-color: transparent;\n\n    &, &:visited {\n        color: ${p => p.theme.secondaryInputColor};\n    }\n\n    border-width: 2px;\n    border-style: solid;\n\n    &[disabled] {\n        color: ${p => p.theme.containerWatermark};\n        border-color: ${p => p.theme.containerWatermark};\n    }\n\n    &:not([disabled]) {\n        border-color: ${p => p.theme.secondaryInputBorder};\n    }\n`;\n\nconst invalidTextCss = css`\n    border-color: ${p => p.theme.warningColor};\n    background-color: ${p => p.theme.warningBackground};\n    color: ${p => p.theme.mainColor};\n`;\n\ntype TextInputProps = React.InputHTMLAttributes<HTMLInputElement> & {\n    invalid?: boolean\n}\n\nexport const TextInput = styled.input.attrs((p: { type?: string }) => ({\n    type: p.type || \"text\"\n}))`\n    font-size: ${p => p.theme.textInputFontSize};\n    padding: 5px 10px;\n    border-radius: 4px;\n    border: solid 1px ${p => p.theme.containerBorder};\n\n    min-width: 20px; /* Without this, editable headers especially refuse to shrink */\n\n    background-color: ${p => p.theme.textInputBackground};\n    color: ${p => p.theme.textInputColor};\n\n    &:disabled {\n        opacity: 0.6;\n    }\n\n    &:invalid {\n        ${invalidTextCss}\n    }\n\n    &:read-only {\n        cursor: default;\n        outline: none;\n    }\n\n    ${(p: TextInputProps) => p.invalid && invalidTextCss}\n` as StyledComponent<'input', Theme, TextInputProps>;\n\nexport const Select = styled.select`\n    ${interactiveMouseoverStyles}\n\n    font-size: ${p => p.theme.headingSize};\n    font-family: ${p => p.theme.fontFamily};\n\n    width: 100%;\n    border-radius: 4px;\n`;","import { Method } from 'mockttp';\n\nexport type MethodName = keyof typeof Method;\nexport const MethodNames = Object.values(Method)\n    .filter(\n        value => typeof value === 'string'\n    ) as Array<MethodName>;\n","import * as _ from 'lodash';\nimport * as uuid from 'uuid/v4'\nimport { observable } from 'mobx';\n\nimport { HtkMockRule } from './rules';\n\nexport type HtkMockItem =\n    | HtkMockRule\n    | HtkMockRuleGroup\n    | HtkMockRuleRoot;\n\nexport type HtkMockRuleGroup = {\n    id: string;\n    title: string;\n    items: HtkMockItem[];\n    collapsed?: boolean;\n};\n\nexport interface HtkMockRuleRoot extends HtkMockRuleGroup {\n    id: 'root';\n    title: 'HTTP Toolkit Rules';\n    isRoot: true;\n    items: HtkMockItem[];\n}\n\nexport type ItemPath = number[];\n\nexport function isRuleGroup(item: HtkMockItem | undefined): item is HtkMockRuleGroup {\n    return _.isObject(item) && 'items' in (item || {});\n};\n\nexport function isRuleRoot(item: HtkMockItem): item is HtkMockRuleRoot {\n    return isRuleGroup(item) && 'isRoot' in item && item.isRoot === true;\n}\n\n// 0 means equal, positive means a < b, negative means b < a\nexport function comparePaths(pathA: ItemPath, pathB: ItemPath): number {\n    let index = 0;\n\n    while (pathA[index] !== undefined && pathB[index] !== undefined) {\n        const diff = pathB[index] - pathA[index];\n        if (diff !== 0) return diff;\n        index += 1;\n    }\n\n    if (pathA[index] !== undefined) {\n        return -1; // B shorter than A, so comes first\n    }\n\n    if (pathB[index] !== undefined) {\n        return 1; // A shorter than B, so comes first\n    }\n\n    // Same length, same values, equal\n    return 0;\n}\n\nexport function getItemParentByPath(rules: HtkMockRuleGroup, path: ItemPath) {\n    return getItemAtPath(rules, path.slice(0, -1)) as HtkMockRuleGroup;\n}\n\nexport function getItemAtPath(rules: HtkMockRuleGroup, path: ItemPath): HtkMockItem {\n    return path.reduce<HtkMockItem>((result, step, index) => {\n        if (!isRuleGroup(result)) {\n            throw new Error(`Invalid path ${path} at step #${index}, found ${result}`);\n        }\n        return result.items[step];\n    }, rules);\n};\n\nexport function updateItemAtPath(\n    rules: HtkMockRuleGroup,\n    path: ItemPath,\n    newItem: HtkMockItem\n) {\n    const parentPath = path.slice(0, -1);\n    const childIndex = _.last(path)!;\n\n    const parentItems = parentPath.length\n        ? getItemAtPath(rules, parentPath) as HtkMockRuleGroup\n        : rules;\n\n    parentItems.items[childIndex] = newItem;\n    return parentItems;\n};\n\nexport function deleteItemAtPath(\n    rules: HtkMockRuleGroup,\n    path: ItemPath\n) {\n    const parent = getItemParentByPath(rules, path);\n    const itemIndex = _.last(path)!;\n    parent.items.splice(itemIndex, 1);\n\n    // If the parent is empty, delete them too (recursively, but not the root)\n    if (parent.items.length === 0 && !isRuleRoot(parent)) {\n        deleteItemAtPath(rules, path.slice(0, -1));\n    }\n}\n\nexport function findItem(\n    rules: HtkMockRuleGroup,\n    match: ((value: HtkMockItem) => boolean) | Partial<HtkMockItem>\n): HtkMockItem | undefined {\n    if (_.isMatch(rules, match)) return rules;\n\n    return _.reduce(rules.items, (result: HtkMockItem | undefined, item: HtkMockItem) => {\n        if (result) return result;\n\n        if (isRuleGroup(item)) {\n            return findItem(item, match);\n        } else if (_.isMatch(item, match)) {\n            return item;\n        }\n    }, undefined);\n};\n\nexport function findItemPath(\n    rules: HtkMockRuleGroup,\n    match: ((value: HtkMockItem) => boolean) | Partial<HtkMockItem>,\n    currentPath: ItemPath = []\n): ItemPath | undefined {\n    if (_.isMatch(rules, match)) return currentPath;\n\n    return _.reduce(rules.items, (result: ItemPath | undefined, item: HtkMockItem, index: number) => {\n        if (result) return result;\n\n        if (isRuleGroup(item)) {\n            return findItemPath(item, match, currentPath.concat(index));\n        } else if (_.isMatch(item, match)) {\n            return currentPath.concat(index) as ItemPath;\n        }\n    }, undefined);\n};\n\nexport const flattenRules = (rules: HtkMockRuleGroup) => mapRules(rules, r => r);\n\nexport function mapRules<R>(\n    rules: HtkMockRuleGroup,\n    fn: (rule: HtkMockRule, path: ItemPath, index: number) => R,\n    currentPath: number[] = [],\n    currentIndex = 0\n): Array<R> {\n    return rules.items.reduce<R[]>((result, item, index: number) => {\n        const totalIndex = currentIndex + index;\n        if (isRuleGroup(item)) {\n            return result.concat(\n                mapRules(item, fn, currentPath.concat(index), totalIndex)\n            );\n        } else {\n            return result.concat(\n                [fn(item, currentPath.concat(index) as ItemPath, totalIndex)]\n            );\n        }\n    }, []);\n};\n\nexport function cloneItem<I extends HtkMockRuleGroup | HtkMockRule>(item: I): I {\n    if (isRuleGroup(item)) {\n        return cloneRuleGroup<I & HtkMockRuleGroup>(item);\n    } else {\n        return cloneRule(item as I & HtkMockRule);\n    }\n}\n\nexport function cloneRule<R extends HtkMockRule>(rule: R): R {\n    return observable({\n        ...rule, // All handler/matcher/checker state is immutable\n        matchers: [...rule.matchers], // Except the matcher array itself\n        id: uuid() // And we need a different rule id\n    });\n};\n\nexport function cloneRuleGroup<G extends HtkMockRuleGroup>(group: HtkMockRuleGroup): G {\n    return {\n        ...group,\n        items: group.items.map(i => cloneItem(i)),\n        collapsed: true,\n        id: uuid()\n    } as G;\n}\n\nexport const areItemsEqual = (a: HtkMockItem | undefined, b: HtkMockItem | undefined) => {\n    if (isRuleGroup(a)) {\n        if (isRuleGroup(b)) {\n            return areGroupsEqual(a, b);\n        } else {\n            return false;\n        }\n    } else {\n        if (isRuleGroup(b)) {\n            return false;\n        } else {\n            return areRulesEqual(a, b);\n        }\n    }\n};\n\nconst areGroupsEqual = (a: HtkMockRuleGroup, b: HtkMockRuleGroup) => {\n    return a.id === b.id &&\n        a.title === b.title &&\n        _.isEqualWith(a.items, b.items, areItemsEqual);\n};\n\n// Rules, or any components within them, can use this to override equality checks at\n// a certain point in the tree. Useful e.g. in transforms, where undefined values are\n// meaningful differences, so we need different logic.\nexport const CUSTOM_RULE_EQUALS = Symbol('custom-rule-is-equals');\n\n// A more flexible _.isEqual check. Considers source-equal functions to be\n// equal, and treats undefined properties as missing.\nconst areRulesEqual = (a: any, b: any): boolean | undefined => {\n    if (a && b && a[CUSTOM_RULE_EQUALS] && a[CUSTOM_RULE_EQUALS] === b[CUSTOM_RULE_EQUALS]) {\n        const isEqual = a[CUSTOM_RULE_EQUALS];\n        return isEqual(a, b);\n    }\n\n    // Assume that all function props (e.g. beforeRequest, callbacks)\n    // are equivalent if they're source-equivalent.\n    // Not a 100% safe guarantee, but should usually be true.\n    if (_.isFunction(a) && _.isFunction(b)) {\n        return a.toString() === b.toString();\n    }\n\n    // For objects with undefined props, pretend those props don't exist:\n    if (\n        _.isObject(a) && _.isObject(b) && (\n            Object.values(a).includes(undefined) ||\n            Object.values(b).includes(undefined)\n        )\n    ) {\n        return _.isEqualWith(\n            _.omitBy(a, (value) => value === undefined),\n            _.omitBy(b, (value) => value === undefined),\n            areRulesEqual\n        );\n    }\n\n    // Return undefined -> use standard rules\n}","import * as _ from 'lodash';\nimport {\n    RequestRuleData,\n    Method,\n    matchers as httpMatchers,\n    requestHandlerDefinitions as httpHandlers,\n    completionCheckers\n} from 'mockttp';\nimport * as serializr from 'serializr';\n\nimport { MockttpSerializedBuffer } from '../../../types';\nimport { byteLength, isSerializedBuffer } from '../../../util';\n\nimport { MethodName, MethodNames } from '../../http/methods';\nimport { serializeAsTag, serializeBuffer, serializeWithUndefineds } from '../../serialization';\nimport { RulesStore } from '../rules-store';\nimport { CUSTOM_RULE_EQUALS } from '../rules-structure';\n\n// Create per-method classes (that all serialize to the same MethodMatcher class + param)\n// for each supported HTTP method, as a methodName -> methodClass lookup object.\nexport const MethodMatchers = _.reduce<MethodName, {\n    [K in MethodName]: { new(): TypedMethodMatcher<K> }\n}>(\n    MethodNames,\n    (result, method) => {\n        result[method] = class SpecificMethodMatcher extends httpMatchers.MethodMatcher {\n\n            readonly uiType = method;\n\n            constructor() {\n                super(Method[method]);\n            }\n\n            explain() {\n                return `${Method[this.method]} requests`;\n            }\n        } as any; // Difficult to get TS to infer or accept TypedMethodMatcher<typeof method>\n        return result;\n    },\n    {} as any\n);\n\n// Tiny interface to let us make the METHOD -> methodMatcher{ uiType: METHOD } mapping explicit\ninterface TypedMethodMatcher<R extends MethodName> extends httpMatchers.MethodMatcher {\n    readonly uiType: R;\n}\n\n// Override various specific & actions, so we can inject our own specific\n// explanations for certain cases\n\nexport class WildcardMatcher extends httpMatchers.WildcardMatcher {\n    explain() {\n        return 'Any requests';\n    }\n}\n\nexport class DefaultWildcardMatcher extends httpMatchers.WildcardMatcher {\n\n    readonly uiType = 'default-wildcard';\n\n    explain() {\n        return 'Any other requests';\n    }\n}\n\nexport class AmIUsingMatcher extends httpMatchers.RegexPathMatcher {\n\n    readonly uiType = 'am-i-using';\n\n    constructor() {\n        // Optional slash is for backward compat: for server 0.1.18+ it's always present\n        super(/^https?:\\/\\/amiusing\\.httptoolkit\\.tech\\/?$/);\n    }\n\n    explain() {\n        return 'for amiusing.httptoolkit.tech';\n    }\n}\n\nexport class StaticResponseHandler extends httpHandlers.SimpleHandlerDefinition {\n    explain() {\n        return `respond with status ${this.status}${\n            byteLength(this.data) ? ' and static content' : ''\n        }`;\n    }\n}\n\n// Ensure that JSON-ified buffers deserialize as real buffers\nserializr.createModelSchema(StaticResponseHandler, {\n    data: serializr.custom(\n        (data: StaticResponseHandler['data']): string | MockttpSerializedBuffer | undefined => {\n            if (!data || typeof data === 'string' || isSerializedBuffer(data)) {\n                return data;\n            } else {\n                return { type: 'Buffer', data: [...data] };\n            }\n        },\n        (serializedData: string | MockttpSerializedBuffer | undefined) => {\n            if (!serializedData) {\n                return undefined;\n            } else if (typeof serializedData === 'string') {\n                return serializedData;\n            } else {\n                return Buffer.from(serializedData.data);\n            }\n        },\n    ),\n    '*': Object.assign(\n        serializr.custom(\n            (x) => x,\n            (x) => x\n        ),\n        { pattern: { test: (key: string) => key !== 'data' } }\n    )\n}, () => new StaticResponseHandler(200));\n\n\nexport class FromFileResponseHandler extends httpHandlers.FileHandlerDefinition {\n    explain() {\n        return `respond with status ${this.status} and content from ${this.filePath || 'a file'}`;\n    }\n}\n\nexport class PassThroughHandler extends httpHandlers.PassThroughHandlerDefinition {\n\n    constructor(rulesStore: RulesStore) {\n        super(rulesStore.activePassthroughOptions);\n    }\n\n}\n\nserializr.createModelSchema(PassThroughHandler, {\n    type: serializr.primitive()\n}, (context) => new PassThroughHandler(context.args.rulesStore));\n\nexport class ForwardToHostHandler extends httpHandlers.PassThroughHandlerDefinition {\n\n    readonly uiType = 'forward-to-host';\n\n    constructor(forwardToLocation: string, updateHostHeader: boolean, rulesStore: RulesStore) {\n        super({\n            ...rulesStore.activePassthroughOptions,\n            forwarding: {\n                targetHost: forwardToLocation,\n                updateHostHeader: updateHostHeader\n            }\n        });\n    }\n\n}\n\nserializr.createModelSchema(ForwardToHostHandler, {\n    uiType: serializeAsTag(() => 'forward-to-host'),\n    type: serializr.primitive(),\n    forwarding: serializr.map(serializr.primitive())\n}, (context) => {\n    const data = context.json;\n    return new ForwardToHostHandler(\n        data.forwarding.targetHost,\n        data.forwarding.updateHostHeader,\n        context.args.rulesStore\n    );\n});\n\nexport type RequestTransform = httpHandlers.RequestTransform;\nexport type ResponseTransform = httpHandlers.ResponseTransform;\n\nexport class TransformingHandler extends httpHandlers.PassThroughHandlerDefinition {\n\n    readonly uiType = 'req-res-transformer';\n\n    constructor(\n        rulesStore: RulesStore,\n        transformRequest: RequestTransform,\n        transformResponse: ResponseTransform\n    ) {\n        super({\n            ...rulesStore.activePassthroughOptions,\n            transformRequest,\n            transformResponse\n        });\n    }\n\n    explain() {\n        const activeRequestTransforms = _.pickBy(this.transformRequest || {}, (v) => v !== undefined);\n        const activeResponseTransforms = _.pickBy(this.transformResponse || {}, (v) => v !== undefined);\n\n        if (_.isEmpty(activeRequestTransforms) && _.isEmpty(activeResponseTransforms)) {\n            return super.explain();\n        } else if (!_.isEmpty(activeRequestTransforms) && !_.isEmpty(activeResponseTransforms)) {\n            return \"automatically transform the request and response\";\n        } else if (!_.isEmpty(activeRequestTransforms)) {\n            return \"automatically transform the request then pass it through to the target host\";\n        } else { // Must be response only\n            return \"automatically transform the response from the target host\";\n        }\n    }\n\n    // We override rule equality checks, to simplify them to treat undefined and missing\n    // properties as different, because that matters for various transform properties.\n    [CUSTOM_RULE_EQUALS](handlerA: TransformingHandler, handlerB: TransformingHandler): boolean {\n        return _.isEqual(handlerA.transformRequest, handlerB.transformRequest) &&\n            _.isEqual(handlerA.transformResponse, handlerB.transformResponse);\n    }\n\n}\n\nserializr.createModelSchema(TransformingHandler, {\n    uiType: serializeAsTag(() => 'req-res-transformer'),\n    transformRequest: serializr.object(\n        serializr.createSimpleSchema({\n            updateHeaders: serializeWithUndefineds,\n            updateJsonBody: serializeWithUndefineds,\n            replaceBody: serializeBuffer,\n            '*': Object.assign(serializr.raw(), { pattern: { test: () => true } })\n        })\n    ),\n    transformResponse: serializr.object(\n        serializr.createSimpleSchema({\n            updateHeaders: serializeWithUndefineds,\n            updateJsonBody: serializeWithUndefineds,\n            replaceBody: serializeBuffer,\n            '*': Object.assign(serializr.raw(), { pattern: { test: () => true } })\n        })\n    )\n}, (context) => {\n    const data = context.json;\n    return new TransformingHandler(\n        context.args.rulesStore,\n        data.transformRequest,\n        data.transformResponse\n    );\n});\n\nexport class RequestBreakpointHandler extends httpHandlers.PassThroughHandlerDefinition {\n\n    readonly uiType = 'request-breakpoint';\n\n    constructor(rulesStore: RulesStore) {\n        super({\n            ...rulesStore.activePassthroughOptions,\n            beforeRequest: rulesStore.triggerRequestBreakpoint\n        });\n    }\n\n    explain() {\n        return \"manually rewrite the request before it's forwarded\";\n    }\n}\n\nserializr.createModelSchema(RequestBreakpointHandler, {\n    uiType: serializeAsTag(() => 'request-breakpoint'),\n    type: serializr.primitive()\n}, (context) => new RequestBreakpointHandler(context.args.rulesStore));\n\nexport class ResponseBreakpointHandler extends httpHandlers.PassThroughHandlerDefinition {\n\n    readonly uiType = 'response-breakpoint';\n\n    constructor(rulesStore: RulesStore) {\n        super({\n            ...rulesStore.activePassthroughOptions,\n            beforeResponse: rulesStore.triggerResponseBreakpoint\n        });\n    }\n\n    explain() {\n        return \"manually rewrite the response before it's returned\";\n    }\n}\n\nserializr.createModelSchema(ResponseBreakpointHandler, {\n    uiType: serializeAsTag(() => 'response-breakpoint'),\n    type: serializr.primitive()\n}, (context) => new ResponseBreakpointHandler(context.args.rulesStore));\n\n\nexport class RequestAndResponseBreakpointHandler extends httpHandlers.PassThroughHandlerDefinition {\n\n    readonly uiType = 'request-and-response-breakpoint';\n\n    constructor(rulesStore: RulesStore) {\n        super({\n            ...rulesStore.activePassthroughOptions,\n            beforeRequest: rulesStore.triggerRequestBreakpoint,\n            beforeResponse: rulesStore.triggerResponseBreakpoint\n        });\n    }\n\n    explain() {\n        return \"manually rewrite the request and response\";\n    }\n}\n\nserializr.createModelSchema(RequestAndResponseBreakpointHandler, {\n    uiType: serializeAsTag(() => 'request-and-response-breakpoint'),\n    type: serializr.primitive()\n}, (context) => new RequestAndResponseBreakpointHandler(context.args.rulesStore));\n\nexport type TimeoutHandler = httpHandlers.TimeoutHandlerDefinition;\nexport const TimeoutHandler = httpHandlers.TimeoutHandlerDefinition;\nexport type CloseConnectionHandler = httpHandlers.CloseConnectionHandlerDefinition;\nexport const CloseConnectionHandler = httpHandlers.CloseConnectionHandlerDefinition;\nexport type ResetConnectionHandler = httpHandlers.ResetConnectionHandlerDefinition;\nexport const ResetConnectionHandler = httpHandlers.ResetConnectionHandlerDefinition;\n\nexport const HttpMatcherLookup = {\n    ..._.omit(httpMatchers.MatcherLookup, ['method']), // We skip method to use per-method matchers instead\n    ...MethodMatchers,\n\n    // Replace the built-in wildcard matcher with our own:\n    'wildcard': WildcardMatcher,\n    // Add special types for our built-in matcher explanation overrides:\n    'default-wildcard': DefaultWildcardMatcher,\n    'am-i-using': AmIUsingMatcher\n};\n\nexport const HttpInitialMatcherClasses = [\n    WildcardMatcher,\n    ...Object.values(MethodMatchers)\n];\n\nexport const HttpHandlerLookup = {\n    ...httpHandlers.HandlerDefinitionLookup,\n    'passthrough': PassThroughHandler,\n    'simple': StaticResponseHandler,\n    'file': FromFileResponseHandler,\n    'forward-to-host': ForwardToHostHandler,\n    'req-res-transformer': TransformingHandler,\n    'request-breakpoint': RequestBreakpointHandler,\n    'response-breakpoint': ResponseBreakpointHandler,\n    'request-and-response-breakpoint': RequestAndResponseBreakpointHandler\n};\n\ntype HttpMatcherClass = typeof HttpMatcherLookup[keyof typeof HttpMatcherLookup];\nexport type HttpMatcher = InstanceType<HttpMatcherClass>;\nexport type HttpInitialMatcher = InstanceType<typeof HttpInitialMatcherClasses[number]>;\n\ntype HttpHandlerClass = typeof HttpHandlerLookup[keyof typeof HttpHandlerLookup];\ntype HttpHandler = InstanceType<HttpHandlerClass>;\n\nexport interface HttpMockRule extends Omit<RequestRuleData, 'matchers'> {\n    id: string;\n    type: 'http';\n    activated: boolean;\n    matchers: Array<HttpMatcher> & { 0?: HttpInitialMatcher };\n    handler: HttpHandler;\n    completionChecker: completionCheckers.Always; // HTK rules all *always* match\n};","import * as _ from 'lodash';\nimport { Headers, RawHeaders } from '../types';\n\n// Based RFC7230, 3.2.6:\nexport const HEADER_NAME_PATTERN = '^[!#$%&\\'*+\\\\-.^_`\\\\|~A-Za-z0-9]+$';\n    // The \\\\| is required here because in 'v' flag regexes (used in HTML patterns by default) the |\n    // character seems to be disallowed unescaped in classes like this.\nexport const HEADER_NAME_REGEX = new RegExp(HEADER_NAME_PATTERN);\n\n// Conversion between headers (map of key to string or string array, used in lots of older/simpler APIs)\n// and raw headers (array of [string, string] pairs, full representation of header reality).\n\nexport const headersToRawHeaders = (headers: Headers): RawHeaders =>\n    Object.entries(headers || {}).reduce(\n        (acc: RawHeaders, [key, value]) => {\n            if (Array.isArray(value)) {\n                acc = acc.concat(value.map(value => [ key, value ]))\n            } else {\n                acc.push([ key, value || '' ]);\n            }\n            return acc;\n        }, []\n    );\n\nexport const rawHeadersToHeaders = (headers: RawHeaders): Headers =>\n    headers.reduce((headersObj: { [k: string]: string | string[] }, [key, value]) => {\n        const headerName = key.toLowerCase();\n\n        const existingValue = headersObj[headerName];\n        if (existingValue === undefined) {\n            headersObj[headerName] = value;\n        } else if (typeof existingValue === 'string') {\n            headersObj[headerName] = [existingValue, value];\n        } else {\n            existingValue.push(value);\n        }\n        return headersObj;\n    }, {});\n\n/**\n * Get the header value for the given header key. Case insensitive. If there are multiple values,\n * this will return the last value. If there are no values this returns undefined.\n */\nexport const getHeaderValue = (headers: Headers | RawHeaders, headerKey: string): string | undefined => {\n    if (Array.isArray(headers)) {\n        headerKey = headerKey.toLowerCase();\n        const headerPair = _.findLast(headers, ([key]) => key.toLowerCase() === headerKey);\n        return headerPair?.[1];\n    } else {\n        const headerValue = headers[headerKey];\n\n        if (Array.isArray(headerValue)) {\n            return headerValue[headerValue.length - 1];\n        } else {\n            return headerValue;\n        }\n    }\n}\n\n/**\n * Get all header values for the given header key. Case insensitive.\n * If there are no values this returns an empty list.\n */\nexport const getHeaderValues = (headers: Headers | RawHeaders, headerKey: string): string[] => {\n    if (Array.isArray(headers)) {\n        headerKey = headerKey.toLowerCase();\n        return headers.filter(([key]) => key.toLowerCase() === headerKey).map(([_, value]) => value);\n    } else {\n        const headerValue = headers[headerKey];\n\n        if (Array.isArray(headerValue)) {\n            return headerValue;\n        } else if (headerValue !== undefined) {\n            return [headerValue];\n        } else {\n            return [];\n        }\n    }\n}\n\n/**\n * Set the value of a given header, overwriting it if present or otherwise adding it as a new header.\n *\n * For header objects, this overwrites all values. For raw headers, this overwrites the last value, so\n * if multiple values are present others may remain. In general you probably don't want to use this\n * for headers that could legally have multiple values present.\n */\nexport const setHeaderValue = (headers: Headers | RawHeaders, headerKey: string, headerValue: string) => {\n    const lowercaseHeaderKey = headerKey.toLowerCase();\n\n    if (Array.isArray(headers)) {\n        const headerPair = _.findLast(headers, ([key]) => key.toLowerCase() === lowercaseHeaderKey);\n        if (headerPair) {\n            headerPair[1] = headerValue;\n        } else {\n            headers.push([headerKey, headerValue]);\n        }\n    } else {\n        const existingKey = Object.keys(headers).find(k => k.toLowerCase() === lowercaseHeaderKey);\n        headers[existingKey || headerKey] = headerValue;\n    }\n}\n\n/**\n * Returns a clone of the header input, with the value of the given headers set, overwriting values if\n * present or otherwise adding it as a new header (but not mutating the input itself).\n *\n * For header objects, this overwrites all values. For raw headers, this overwrites the first value, so\n * if multiple values are present others may remain. In general you probably don't want to use this\n * for headers that could legally have multiple values present.\n */\nexport const withHeaderValue = <T extends Headers | RawHeaders>(headers: T, headerAdditions: Record<string, string>): T => {\n    headers = _.cloneDeep(headers);\n    Object.entries(headerAdditions).forEach(([key, value]) =>\n        setHeaderValue(headers, key, value)\n    );\n    return headers;\n}\n\n// This fairly meaningless override combo seems to be\n// required to make it ok to use this when T = X | undefined.\nexport function lastHeader<T>(val: T | T[]): T;\nexport function lastHeader<T>(val: T | T[] | undefined): T | undefined;\nexport function lastHeader<T>(val: T | T[] | undefined): T | undefined {\n    if (Array.isArray(val)) return val[val.length - 1];\n    else return val;\n}\n\nexport function asHeaderArray(val: string | string[] | undefined, sep = ','): string[] {\n    if (Array.isArray(val)) {\n        // Split individual values, as multiple headers can still have multiple values\n        return _.flatMap(val, header =>\n            header.split(sep).map(value => value.trim())\n        );\n    } else if (!val) {\n        return [];\n    } else {\n        return val.split(sep).map(value => value.trim());\n    }\n}\n\nexport type FlatHeaders = { [key: string]: string };\n\n/**\n * Flatten headers, i.e. combine any duplicates into comma-separated values. Required for some APIs\n * that don't accept duplicate headers.\n */\nexport function headersToFlatHeaders(headers: Headers): FlatHeaders {\n    return _.mapValues(\n        _.pickBy(headers, (key, value) => key && value),\n        (value) =>\n            _.isArray(value)\n                ? value.join(', ')\n                : value! // We know this is set because of filter above\n    );\n}","import * as styledComponents from 'styled-components';\nimport * as polished from 'polished';\nimport type { ThemeProps } from 'styled-components';\nimport type * as monacoTypes from 'monaco-editor';\n\nimport reset from 'styled-reset';\n\nconst fontSizes = {\n    textInputFontSize: '13px',\n    textSize: '15px',\n    subHeadingSize: '18px',\n    headingSize: '20px',\n    largeHeadingSize: '24px',\n    loudHeadingSize: '38px',\n};\nimport \"react-contexify/dist/ReactContexify.css\";\n\nexport const NARROW_LAYOUT_BREAKPOINT = 1100;\n\nexport const warningColor = '#f1971f';\nexport const popColor = '#e1421f';\n\nexport const lightTheme = {\n    fontFamily: 'Lato, Arial, sans-serif',\n    monoFontFamily: \"'Fira Mono', monospace\",\n\n    mainBackground: '#fafafa',\n    mainLowlightBackground: '#eaeaea',\n    mainColor: '#222',\n\n    lowlightTextOpacity: 0.65,\n    pillContrast: 0.8,\n\n    primaryInputBackground: '#1076b9',\n    primaryInputColor: '#fafafa',\n\n    secondaryInputBorder: '#7ab2e2',\n    secondaryInputColor: '#1665af',\n\n    textInputBackground: '#fafafa',\n    textInputColor: '#222222',\n\n    highlightBackground: '#ffffff',\n    highlightColor: '#222',\n\n    popColor,\n\n    warningColor,\n    warningBackground: '#f1971f40',\n\n    containerBackground: '#d8e2e6',\n    containerWatermark: '#a0afaf',\n    containerBorder: '#888',\n\n    // These are the same as the standard defaults\n    linkColor: '#0000EE',\n    visitedLinkColor: '#551A8B',\n\n    monacoTheme: 'vs-custom',\n\n    modalGradient: 'radial-gradient(#40404b, #111118)',\n\n    ...fontSizes,\n\n    globalCss: ''\n};\n\nexport const darkTheme = {\n    fontFamily: 'Lato, Arial, sans-serif',\n    monoFontFamily: \"'Fira Mono', monospace\",\n\n    mainBackground: '#222222',\n    mainLowlightBackground: '#303030',\n    mainColor: '#efefef',\n\n    lowlightTextOpacity: 0.6,\n    pillContrast: 0.8,\n\n    primaryInputBackground: '#0868c1',\n    primaryInputColor: '#fafafa',\n\n    secondaryInputBorder: '#1b5b96',\n    secondaryInputColor: '#6babe6',\n\n    textInputBackground: '#fafafa',\n    textInputColor: '#222222',\n\n    highlightBackground: '#111111',\n    highlightColor: '#efefef',\n\n    popColor,\n\n    warningColor,\n    warningBackground: '#f1971f40',\n\n    containerBackground: '#3c3c41',\n    containerWatermark: '#757580',\n    containerBorder: '#000000',\n\n    linkColor: '#8699ff',\n    visitedLinkColor: '#ac7ada',\n\n    monacoTheme: 'vs-dark-custom',\n\n    modalGradient: 'radial-gradient(#ffffff,#9c9c9c)',\n\n    ...fontSizes,\n\n    /* In dark theme, we need to override the scrollbars or they stick out like a sore thumb */\n    globalCss: styledComponents.css`\n        ::-webkit-scrollbar {\n            background-color: ${p => polished.darken(0.2, p.theme.containerBackground)};\n        }\n\n        ::-webkit-scrollbar-thumb {\n            background-color: ${p => polished.lighten(0.2, p.theme.containerBackground)};\n        }\n\n        /* Standard, but poorly supported: */\n        scrollbar-color: dark;\n    `\n};\n\nexport const highContrastTheme = {\n    fontFamily: 'Lato, Arial, sans-serif',\n    monoFontFamily: \"'Fira Mono', monospace\",\n\n    mainBackground: '#000000',\n    mainLowlightBackground: '#262626',\n    mainColor: '#ffffff',\n\n    lowlightTextOpacity: 0.8,\n    pillContrast: 0.95,\n\n    primaryInputBackground: '#0868c1',\n    primaryInputColor: '#ffffff',\n\n    secondaryInputBorder: '#ffffff',\n    secondaryInputColor: '#ffffff',\n\n    textInputBackground: '#ffffff',\n    textInputColor: '#000000',\n\n    highlightBackground: '#ffffff',\n    highlightColor: '#000',\n\n    popColor,\n\n    warningColor,\n    warningBackground: '#f1971f40',\n\n    containerBackground: '#404045',\n    containerWatermark: '#a0a0b0',\n    containerBorder: '#000000',\n\n    linkColor: '#8699ff',\n    visitedLinkColor: '#ac7ada',\n\n    monacoTheme: 'hc-black-custom',\n\n    modalGradient: '#c0c0c0',\n\n    ...fontSizes,\n\n    globalCss: ``\n};\n\nexport const Themes = {\n    'light': lightTheme,\n    'dark': darkTheme,\n    'high-contrast': highContrastTheme\n};\n\nexport type ThemeName = keyof typeof Themes;\nexport type Theme = typeof Themes[ThemeName];\n\nconst monacoColorOverrides = {\n    'editorWarning.foreground': '#ff0000',\n};\n\nconst monacoThemes = ['vs', 'vs-dark', 'hc-black'] as const;\n\nexport function defineMonacoThemes(monaco: typeof monacoTypes) {\n    monacoThemes.forEach((themeName) => {\n        monaco.editor.defineTheme(`${themeName}-custom`, {\n            base: themeName,\n            inherit: true,\n            rules: [],\n            colors: monacoColorOverrides\n        });\n    });\n}\n\nconst {\n    default: styled,\n    css,\n    createGlobalStyle,\n    keyframes,\n    ThemeProvider,\n} = styledComponents as unknown as styledComponents.ThemedStyledComponentsModule<Theme>;\n\nexport {\n    styled,\n    css,\n    createGlobalStyle,\n    keyframes,\n    ThemeProvider,\n    ThemeProps\n};\n\nexport const GlobalStyles = createGlobalStyle`\n    ${reset};\n\n    body {\n        font-family: ${p => p.theme.fontFamily};\n        color: ${p => p.theme.mainColor};\n        background-color: ${p => p.theme.containerBackground};\n    }\n\n    input {\n        font-family: ${p => p.theme.fontFamily};\n    }\n\n    em {\n        font-style: italic;\n    }\n\n    strong {\n        font-weight: bold;\n    }\n\n    :active {\n        outline: none;\n    }\n\n    .slow-spin {\n        animation: fa-spin 5s infinite linear;\n    }\n\n    /* Override Auth0's style choices to match the rest of the UI */\n    .auth0-lock {\n        font-family: ${p => p.theme.fontFamily} !important;\n\n        .auth0-lock-overlay {\n            display: none; /* We have our own overlay we'll use instead */\n        }\n\n        .auth0-lock-widget {\n            box-shadow: 0 2px 10px 0 rgba(0,0,0,0.2) !important;\n            overflow: visible !important;\n        }\n\n        .auth0-lock-form {\n            .auth0-lock-name {\n                font-size: ${fontSizes.headingSize} !important;\n            }\n\n            p, .auth0-lock-social-button-text {\n                font-size: ${fontSizes.textSize} !important;\n            }\n        }\n    }\n\n    /* Override some Monaco CSS internals */\n    .monaco-editor {\n        /* Our editors don't have real filenames, so hide that from error popups: */\n        .zone-widget .filename {\n            display: none;\n        }\n    }\n\n    ${p => p.theme.globalCss}\n`;","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { observer } from 'mobx-react';\n\nimport { styled, Theme, ThemeProps, css } from '../../styles';\nimport { Icon } from '../../icons';\n\ninterface CollapseIconProps extends ThemeProps<Theme> {\n    className?: string;\n    onClick: () => void;\n    collapsed: boolean;\n    headerAlignment: 'left' | 'right';\n}\n\nconst CollapseIcon = styled((props: CollapseIconProps) =>\n    <Icon\n        className={props.className}\n        icon={['fas', props.collapsed ? 'chevron-down' : 'chevron-up']}\n        onClick={props.onClick}\n    />\n)`\n    cursor: pointer;\n    user-select: none;\n\n    padding: 4px 10px;\n\n    ${p => p.headerAlignment === 'right'\n        ? 'margin: 0 -10px 0 -3px;'\n        : 'margin: 0 -3px 0 -10px;'\n    }\n\n    &:hover {\n        color: ${p => p.theme.popColor};\n    }\n`;\n\ninterface CardProps extends React.HTMLAttributes<HTMLElement> {\n    className?: string;\n    disabled?: boolean;\n\n    // The header alignment - defaults to right if not set\n    headerAlignment?: 'left' | 'right';\n}\n\nconst Card = styled.section.attrs((p: CardProps) => ({\n    onClick: !p.disabled ? p.onClick : undefined,\n    onKeyDown: !p.disabled ? p.onKeyDown : undefined,\n    tabIndex: !p.disabled ? p.tabIndex : undefined,\n    headerAlignment: p.headerAlignment ?? 'right'\n}))`\n    box-sizing: border-box;\n\n    ${(p: CardProps) => p.disabled && `\n        opacity: 0.5;\n    `}\n\n    ${(p: CardProps) => !p.disabled && p.onClick && `\n        cursor: pointer;\n\n        &:hover {\n            box-shadow: 0 2px 20px 0 rgba(0,0,0,0.3);\n        }\n\n        &:active {\n            box-shadow: unset;\n        }\n    `}\n\n    background-color: ${p => p.theme.mainBackground};\n    border-radius: 4px;\n    box-shadow: 0 2px 10px 0 rgba(0,0,0,0.2);\n\n    position: relative;\n\n    > header h1, > h1 {\n        font-size: ${p => p.theme.headingSize};\n        font-weight: bold;\n    }\n\n    > header {\n        display: flex;\n        align-items: center;\n        justify-content: flex-end;\n\n        ${p => p.headerAlignment === 'left' && `\n            flex-direction: row-reverse;\n        `}\n\n        gap: 8px;\n    }\n`;\n\n// Card-like buttons, e.g. mock rule rows & intercept buttons\nexport const LittleCard = styled(Card)`\n    padding: 15px;\n\n    > header:not(:last-child), > h1:not(:last-child) {\n        margin-bottom: 15px;\n    }\n`;\n\n// Normal card size\nexport const MediumCard = styled(Card)`\n    padding: 20px;\n    margin-bottom: 20px;\n\n    > header, > h1 {\n        text-transform: uppercase;\n        text-align: right;\n        color: ${p => p.theme.containerWatermark};\n\n        &:not(:last-child) {\n            margin-bottom: 20px;\n        }\n    }\n`;\n\n// Oversized cards for extra info - used for Connected Sources UI\nexport const BigCard = styled(MediumCard)`\n    padding: 30px;\n\n    > header:not(:last-child), > h1:not(:last-child) {\n        margin-bottom: 30px;\n    }\n`;\n\n// Starting is a very brief temporary state, used to show a card as expanded but\n// apply a brief animation, when expansion is first triggered\nexport type ExpandState = boolean | 'starting';\n\nexport interface CollapsibleCardProps {\n    collapsed: boolean;\n    expanded?: ExpandState;\n\n    // The highlighted content direction - shows a border on the\n    // left or right of the whole card to indicate up/downstream\n    direction?: 'left' | 'right';\n\n    // The header alignment - defaults to right if not set\n    headerAlignment?: 'left' | 'right';\n\n    className?: string;\n\n    onCollapseToggled?: () => void;\n}\n\n// A convenient type for always-expandable cards, where relevant properties are strictly required:\nexport interface ExpandableCardProps extends CollapsibleCardProps {\n    expanded: ExpandState;\n    onExpandToggled: () => void;\n}\n\n@observer\nexport class CollapsibleCard extends React.Component<\n    CollapsibleCardProps & React.HTMLAttributes<HTMLDivElement>\n> {\n\n    private cardRef = React.createRef<HTMLElement>();\n\n    render() {\n        return <CollapsibleCardContainer\n            className={this.props.className}\n            collapsed={this.props.collapsed}\n            expanded={this.props.expanded ?? false}\n            direction={this.props.direction}\n            headerAlignment={this.props.headerAlignment ?? 'right'}\n\n            tabIndex={0}\n            ref={this.cardRef}\n            onKeyDown={this.onKeyDown}\n        >{\n            this.renderChildren()\n        }</CollapsibleCardContainer>;\n    }\n\n    renderChildren() {\n        const { children, collapsed, headerAlignment } = this.props;\n\n        const showCollapseIcon = !!this.props.onCollapseToggled;\n\n        return React.Children.map(children as React.ReactElement<any>[], (child, i) => {\n            if (i !== 0) {\n                if (collapsed) return null; // When collapsed, we drop all but the first child\n                else return child;\n            }\n\n            if (!showCollapseIcon) return child;\n\n            // Otherwise: it's the first child and we want to inject a collapse icon.\n\n            if (child.type !== 'header') {\n                throw new Error(`First child of collapsible card must be a header but was ${\n                    typeof child.type === 'string'\n                    ? child.type\n                    : child.type.name\n                }`);\n            }\n\n            // If we have a collapse handler, inject a collapse button as the\n            // last child of our first child:\n            return  React.cloneElement(child, { },\n                React.Children.toArray(child.props.children).concat(\n                    <CollapseIcon\n                        key='collapse-icon'\n                        collapsed={collapsed}\n                        onClick={this.toggleCollapse}\n                        headerAlignment={headerAlignment ?? 'right'}\n                    />\n                )\n            );\n\n        });\n    }\n\n    toggleCollapse = () => {\n        // Should never happen, but guard against it just in case:\n        if (!this.props.onCollapseToggled) return;\n\n        // Scroll the element into view, after giving it a moment to rerender\n        requestAnimationFrame(() => {\n            if (!this.cardRef.current) return;\n\n            this.cardRef.current.scrollIntoView({\n                block: 'nearest',\n                behavior: 'smooth'\n            })\n        });\n\n        this.props.onCollapseToggled();\n    }\n\n    onKeyDown = (event: React.KeyboardEvent) => {\n        if (event.target !== this.cardRef.current) {\n            return;\n        }\n\n        if (event.key === 'Enter') {\n            this.toggleCollapse();\n        }\n    }\n\n}\n\n// Bit of redundancy here, but just because the TS styled plugin\n// gets super confused if you use variables in property names.\nconst cardDirectionCss = (direction?: string) =>\n    direction === 'right' ? css`\n        padding-right: 15px;\n        border-right: solid 5px ${p => p.theme.containerBorder};\n    ` :\n    direction === 'left' ? css`\n        padding-left: 15px;\n        border-left: solid 5px ${p => p.theme.containerBorder};\n    ` : '';\n\nconst CollapsibleCardContainer = styled(MediumCard)<{\n    collapsed: boolean;\n    expanded: ExpandState;\n    direction?: 'left' | 'right';\n}>`\n    display: flex;\n    flex-direction: column;\n\n    transition: margin-bottom 0.1s;\n\n    ${p => p.collapsed && css`\n        :not(:last-child) {\n            margin-bottom: -16px;\n        }\n    `}\n\n    ${p => p.expanded && css`\n        /* Override the Send container setting this to 'none', which hides non-expanded parts: */\n        display: flex !important;\n\n        height: 100%;\n        width: 100%;\n        border-radius: 0;\n        margin: 0;\n\n        flex-shrink: 1;\n        min-height: 0;\n\n        ${p.expanded === 'starting'\n            ? `\n                padding-top: 40px;\n                padding-bottom: 40px;\n            `\n            : 'transition: padding 0.1s;'\n        }\n    `}\n\n    &:focus {\n        ${CollapseIcon} {\n            color: ${p => p.theme.popColor};\n        }\n    }\n\n    &:focus-within {\n        header h1 {\n            color: ${p => p.theme.popColor};\n        }\n\n        outline: none;\n        border-color: ${p => p.theme.popColor};\n    }\n\n    ${p => cardDirectionCss(p.direction)};\n`;\n\nexport const CollapsibleCardHeading = styled((p: {\n    className?: string,\n    onCollapseToggled?: () => void,\n    children: React.ReactNode\n}) => <h1 className={p.className} onClick={p.onCollapseToggled}>\n    { p.children }\n</h1>)`\n    cursor: pointer;\n    user-select: none;\n`;","import * as _ from 'lodash';\nimport { MockttpSerializedBuffer } from '../types';\n\n// Before imports to avoid circular import with server-api\nexport const RUNNING_IN_WORKER = typeof window === 'undefined';\n\nexport type Empty = _.Dictionary<undefined>;\nexport function empty(): Empty {\n    return {};\n}\n\ntype Case<R> = [() => boolean, R | undefined];\n\nexport function firstMatch<R>(...tests: Array<Case<R> | R | undefined>): R | undefined {\n    for (let test of tests) {\n        if (_.isArray(test) && _.isFunction(test[0])) {\n            const [matcher, result] = test;\n            if (matcher() && result) return result;\n        } else {\n            if (test) return <R>test;\n        }\n    }\n}\n\nexport function longestPrefix(baseString: string, ...strings: string[]) {\n    let prefix = \"\";\n    const shortestLength = Math.min(\n        baseString.length,\n        ...strings.map(s => s.length)\n    );\n\n    for (let i = 0; i < shortestLength; i++) {\n        const char = baseString[i];\n        if (!strings.every(s => s[i] === char)) break;\n        prefix += char;\n    }\n\n    return prefix;\n}\n\n// In some places, we need a Buffer in theory, but we know for sure that it'll never\n// be read, we just need to know its size (e.g. calculating compression stats).\n// For those cases, it can be useful to *carefully* provide this fake buffer instead.\n// Could actually allocate an empty buffer, but that's much more expensive if the\n// buffer is large, and probably a waste.\nexport function fakeBuffer(byteLength: number): FakeBuffer {\n    return { byteLength: byteLength };\n}\nexport type FakeBuffer = { byteLength: number };\n\nconst encoder = new TextEncoder();\n\nconst strictDecoder = new TextDecoder('utf8', { fatal: true });\nconst laxDecoder = new TextDecoder('utf8', { fatal: false });\nconst binaryLaxDecoder = new TextDecoder('latin1', { fatal: false });\n\n// Not a perfect or full check, but a quick test to see if the data in a buffer\n// is valid UTF8 (so we should treat it as text) or not (so we should treat it as\n// raw binary data). For viewing content as text we don't care (we just always show\n// as UTF8) but for _editing_ binary data we need a lossless encoding, not utf8.\n// (Monaco isn't perfectly lossless editing binary anyway, but we can try).\nexport function isProbablyUtf8(buffer: Buffer) {\n    try {\n        // Just check the first 1kb, in case it's a huge file\n        const dataToCheck = buffer.slice(0, 1024);\n        strictDecoder.decode(dataToCheck);\n        return true; // Decoded OK, probably safe\n    } catch (e) {\n        return false; // Decoding failed, definitely not valid UTF8\n    }\n}\n\nexport function stringToBuffer(input: string, encoding: 'utf8' | 'binary' = 'utf8') {\n    if (encoding === 'utf8') {\n        return Buffer.from(encoder.encode(input)); // ~4x faster than Buffer.from(input, 'utf8')\n    } else if (encoding === 'binary') {\n        return Buffer.from(input, encoding); // Slower, but we have no option as TextEncoder is UTF8 only\n    } else {\n        throw new Error(`Cannot decode string from unrecogized encoding: ${encoding}`);\n    }\n}\n\nexport function bufferToString(input: Buffer, encoding: 'utf8' | 'binary' = 'utf8') {\n    if (encoding === 'utf8') {\n        return laxDecoder.decode(input); // ~5x faster than buffer.toString('utf8')\n    } else if (encoding === 'binary') {\n        return binaryLaxDecoder.decode(input);\n    } else {\n        throw new Error(`Cannot convert buffer to unrecogized encoding: ${encoding}`);\n    }\n}\n\nexport function isSerializedBuffer(obj: any): obj is MockttpSerializedBuffer {\n    return obj && obj.type === 'Buffer' && !!obj.data;\n}\n\nexport function asBuffer(data: string | Buffer | Uint8Array | MockttpSerializedBuffer | undefined): Buffer {\n    if (!data) {\n        return Buffer.from([]);\n    } else if (Buffer.isBuffer(data)) {\n        return data;\n    } else if (typeof data === 'string') {\n        return stringToBuffer(data);\n    } else if (isSerializedBuffer(data)) {\n        return Buffer.from(data.data);\n    } else {\n        // Extract internal data from uint8array (arrayview):\n        return Buffer.from(data.buffer, data.byteOffset, data.byteLength);\n    }\n}\n\n// Get the length of the given data in bytes, not characters.\n// If that's a buffer, the length is used raw, but if it's a string\n// it returns the length when encoded as UTF8.\nexport function byteLength(input: string | Buffer | MockttpSerializedBuffer | Uint8Array | undefined) {\n    if (!input) {\n        return 0;\n    } else if (typeof input === 'string') {\n        return new Blob([input]).size;\n    } else if (isSerializedBuffer(input)) {\n        return input.data.length;\n    } else {\n        return input.length;\n    }\n}\n\nexport function tryParseJson(input: string): object | undefined {\n    try {\n        return JSON.parse(input);\n    } catch (e) {\n        return undefined;\n    }\n}\n\nexport function recursiveMapValues(\n    input: unknown,\n    fn: (value: unknown, key?: string) => unknown,\n    key: string | undefined = undefined\n): unknown {\n    if (_.isArray(input)) {\n        return input.map((innerObj) => recursiveMapValues(innerObj, fn));\n    } else if (_.isPlainObject(input)) {\n        return _.mapValues(input as {}, (val, key) => recursiveMapValues(val, fn, key));\n    } else {\n        return fn(input, key);\n    }\n}","import * as React from 'react';\nimport { useHotkeys as rawUseHotkeys } from \"react-hotkeys-hook\";\nimport { action, observable } from 'mobx';\n\nimport { desktopVersion } from '../services/service-versions';\nimport { getDeferred, delay } from './promise';\nimport { logError } from '../errors';\n\nexport function isReactElement(node: any): node is React.ReactElement {\n    return node && !!node.$$typeof;\n}\n\nexport const windowSize = observable({\n    height: window.innerHeight,\n    width: window.innerWidth\n});\nwindow.addEventListener('resize', action(() => {\n    windowSize.height = window.innerHeight;\n    windowSize.width = window.innerWidth;\n}));\n\nexport const Ctrl = navigator.platform.startsWith('Mac')\n    ? '⌘'\n    : 'Ctrl';\n\nexport function isCmdCtrlPressed(event: React.KeyboardEvent<unknown>) {\n    return navigator.platform.startsWith('Mac')\n        ? event.metaKey\n        : event.ctrlKey;\n}\n\n// Is the element an editable field, for which we shouldn't add keyboard shortcuts?\n// We don't worry about readonly, because that might still be surprising.\nexport const isEditable = (target: EventTarget | null) => {\n    if (!target) return false;\n    const element = target as HTMLElement;\n    const tagName = element.tagName;\n    return element.isContentEditable ||\n        tagName === 'TEXTAREA' ||\n        tagName === 'INPUT' ||\n        tagName === 'SELECT';\n}\n\nexport const useHotkeys = (keys: string, callback: (event: KeyboardEvent) => void, deps: any[]) =>\n    rawUseHotkeys(keys, callback, { filter: () => true }, deps);\n\nexport function saveFile(\n    filename: string,\n    mimeType: string,\n    content: string | Buffer\n): void {\n    const element = document.createElement('a');\n\n    const data = new Blob([content], { type: mimeType });\n\n    const objectUrl = window.URL.createObjectURL(data);\n    element.setAttribute('href', objectUrl);\n    element.setAttribute('download', filename);\n\n    element.style.display = 'none';\n\n    document.body.appendChild(element);\n    element.click();\n    document.body.removeChild(element);\n\n    // Stop persisting the data. In theory we could do this immediately, as the spec says\n    // existing requests will be fine, but let's wait a few seconds to make sure the\n    // request has definitely fired properly:\n    setTimeout(() => window.URL.revokeObjectURL(objectUrl), 10000);\n}\n\ntype FileReaderType = 'text' | 'arraybuffer' | 'path';\n\n// Ask the user for a file of one of the given types, and get the raw arraybuffer data\nexport function uploadFile(type: 'arraybuffer', acceptedMimeTypes?: string[]): Promise<ArrayBuffer | null>\n// Ask the user for a file of one of the given types, and get the utf8 text data\nexport function uploadFile(type: 'text', acceptedMimeTypes?: string[]): Promise<string | null>;\n// Ask the user for a file of one of the given types, and get the file path itself (electron only)\nexport function uploadFile(type: 'path', acceptedMimeTypes?: string[]): Promise<string | null>;\n// Note that in general, in most cases this will not resolve when the picker is cancelled (instead,\n// it'll only resolve as null after a 10 minute time out) so handle accordingly!\nexport function uploadFile(\n    type: FileReaderType = 'arraybuffer',\n    acceptedMimeTypes: string[] = []\n): Promise<ArrayBuffer | string | null> {\n    if (type === 'path' && !desktopVersion.value) {\n        try {\n            const promptResult = window.prompt(\n                \"Path selection can only be used from Electron. Please enter a path manually:\"\n            )\n            return Promise.resolve(promptResult);\n        } catch (e) {\n            if ((e as Error)?.message?.includes(\"prompt() is and will not be supported\")) {\n                // Somehow we've tried to trigger prompt() in Electron - presumably we haven't\n                // detected the desktop app info yet for some reason. Never mind though, in\n                // this case its safe to swallow this, continue, and do Electron things anyway.\n                console.warn(\"Unexpected Electron prompt() error\");\n            } else {\n                return Promise.reject(e);\n            }\n        }\n    }\n\n    const fileInput = document.createElement('input');\n    fileInput.setAttribute('type', 'file');\n    if (acceptedMimeTypes.length > 0) {\n        fileInput.setAttribute('accept', acceptedMimeTypes.join(','));\n    }\n\n    const result = getDeferred<ArrayBuffer | string | null>();\n\n    fileInput.addEventListener('change', () => {\n        if (!fileInput.files || !fileInput.files.length) {\n            // This remains as a backup for cases where this could happen (unclear) but\n            // in modern browsers it seems we don't get a change event at all for cancel,\n            // and there are no reliable workarounds (monitoring focus doesn't help -\n            // pickers are seemingly no longer modal). Assume cancel never resolves.\n            return result.resolve(null);\n        }\n\n        const file = fileInput.files[0];\n\n        if (type === 'path') {\n            // file.path is an Electron-only extra property:\n            // https://github.com/electron/electron/blob/master/docs/api/file-object.md\n            result.resolve((file as unknown as { path: string }).path);\n        } else {\n            const fileReader = new FileReader();\n\n            fileReader.addEventListener('load', () => {\n                result.resolve(fileReader.result);\n            });\n\n            fileReader.addEventListener('error', (error: any) => {\n                result.reject(error);\n            });\n\n            if (type === 'text') {\n                fileReader.readAsText(file);\n            } else {\n                fileReader.readAsArrayBuffer(file);\n            }\n        }\n    });\n\n    fileInput.click();\n\n    // Hack to avoid unexpected GC of file inputs, so far as possible.\n    // See similar issue at https://stackoverflow.com/questions/52103269.\n    // Can't use answer there, as we can't reliably detect 'cancel'.\n    // Hold a reference until we get the data or 10 minutes passes (for cancel)\n    Promise.race([result.promise, delay(1000 * 60 * 10)])\n        .catch(() => {})\n        .then(() => fileInput.remove());\n\n    return result.promise;\n}\n\nexport function useSize(ref: React.RefObject<HTMLElement>, defaultValue: number) {\n    const [spaceAvailable, setSpaceAvailable] = React.useState(defaultValue);\n\n    React.useEffect(() => {\n        const resizeObserver = new ResizeObserver(() => {\n            const container = ref.current;\n\n            if (container) {\n                setSpaceAvailable(container.clientWidth);\n            } else {\n                logError(\"Element resized, but no ref available\");\n            }\n        });\n\n        if (ref.current) {\n            resizeObserver.observe(ref.current);\n        } else {\n            logError(\"No element to observe for resizing!\");\n        }\n\n        return () => resizeObserver.disconnect();\n    }, []);\n\n    return spaceAvailable;\n}\n\nexport async function copyToClipboard(textToCopy: string) {\n    if (navigator.clipboard) {\n        // This will be available on secure domains in supported browsers. It requires\n        // permissions, but not during Electron usage. We ignore permissions here -\n        // if this fails (on secure web usage outside Electron) we'll use the fallback.\n        try {\n            await navigator.clipboard.writeText(textToCopy);\n            return; // If this succeeds, we're done\n        } catch (e) {\n            console.warn('Copy to clipboard with navigator.clipboard failed', e);\n            // Didn't succeed - keep going\n        }\n    }\n\n    // This should work everywhere, as long as this method is called from an\n    // event handler:\n    const textArea = document.createElement(\"textarea\");\n    try {\n        textArea.value = textToCopy;\n        textArea.style.position = \"absolute\";\n        textArea.style.left = \"-9999px\";\n\n        document.body.prepend(textArea);\n        textArea.select();\n        document.execCommand('copy');\n    } catch (e) {\n        console.warn('Copy to clipboard fallback failed', e);\n        throw e;\n    } finally {\n        textArea.remove();\n    }\n}","export type ErrorLike = Partial<Error> & {\n    // Various properties we might want to look for on errors:\n    code?: string;\n    cmd?: string;\n    signal?: string;\n    statusCode?: number;\n    statusMessage?: string;\n};\n\n// Useful to easily cast and then examine errors that are otherwise 'unknown':\nexport function isErrorLike(error: any): error is ErrorLike {\n    return typeof error === 'object' && (\n        error instanceof Error ||\n        error.message ||\n        error.code ||\n        error.stack\n    )\n}\n\nexport function asError(error: any): Error {\n    if (isErrorLike(error)) return error as Error;\n    else {\n        return new Error(error.message || error.toString());\n    }\n}\n\nexport class UnreachableCheck extends Error {\n\n    // getValue is used to allow logging properties (e.g. v.type) on expected-unreachable\n    // values, instead of just logging [object Object].\n    constructor(value: never, getValue: (v: any) => any = (x => x)) {\n        super(`Unhandled case value: ${getValue(value)}`);\n    }\n\n}\n\n// Sometimes useful when you need an expression (when you can't use a 'throws' statement):\nexport const unreachableCheck = (value: never, getValue: (v: any) => any = (x => x)): never => {\n    throw new UnreachableCheck(value, getValue);\n}","import { computed, observable } from 'mobx';\n\nimport { InputStreamMessage } from \"../../types\";\nimport { asBuffer } from '../../util';\n\nexport class StreamMessage {\n\n    @observable\n    private inputMessage: InputStreamMessage;\n\n    public readonly cache = observable.map(new Map<symbol, unknown>(), { deep: false });\n\n    constructor(\n        inputMessage: InputStreamMessage,\n        public readonly messageIndex: number\n    ) {\n        this.inputMessage = inputMessage;\n    }\n\n    /**\n     * The direction the message travelled.\n     *\n     * Note that this may seem reversed! msg.direction is from the perspective\n     * of Mockttp, not the client.\n     *\n     * I.e. 'received' means the client sent it and the proxy received it. Sent\n     * means Mockttp sent it to the client (which typically means an upstream\n     * server sent it to Mockttp, but it depends on the rule setup).\n     */\n    get direction() {\n        return this.inputMessage.direction;\n    }\n\n    @computed\n    get content() {\n        return asBuffer(this.inputMessage.content);\n    }\n\n    get isBinary() {\n        return this.inputMessage.isBinary;\n    }\n\n    get contentType() {\n        if (this.inputMessage.isBinary) return 'raw';\n\n        // prefix+JSON is very common, so we try to parse anything JSON-ish optimistically:\n        const startOfMessage = this.content.slice(0, 10).toString('utf-8');\n        if (startOfMessage.includes('{') || startOfMessage.includes('[')) return 'json';\n        else return 'text';\n    }\n\n    get timestamp() {\n        return this.inputMessage.eventTimestamp;\n    }\n\n    cleanup() {\n        // As with Exchange & WebSocketStream - in some cases, browsers can keep references to\n        // these messages, which causes issues with releasing memory, so we aggressively drop\n        // internal references to potentially large data to compensate.\n        this.inputMessage.content = Buffer.from([]);\n        this.cache.clear();\n    }\n\n}","/*\n * SPDX-FileCopyrightText: 2022 Tim Perry <tim@httptoolkit.com>\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport * as _ from 'lodash';\nimport { defaultAbiCoder } from '@ethersproject/abi';\n\nexport const encodeAbi = defaultAbiCoder.encode.bind(defaultAbiCoder);\n\nexport const NATIVE_ETH_TYPES = [\n    'bool',\n    'int',\n    'uint',\n    ...(_.flatMap(_.range(8, 257, 8), (bits) => [\n        `int${bits}`,\n        `uint${bits}`\n    ])),\n    'address',\n    'string',\n    'bytes',\n    ...(_.range(1, 33).map((n) => `bytes${n}`))\n];","import * as _ from 'lodash';\nimport { get } from 'typesafe-get';\n\nimport type {\n    OpenAPIObject,\n    PathObject,\n    OperationObject,\n    ParameterObject,\n    ResponseObject,\n    RequestBodyObject,\n    SchemaObject\n} from 'openapi-directory';\nimport Ajv from 'ajv';\nimport addFormats from 'ajv-formats';\n\nimport {\n    HttpExchange,\n    ExchangeMessage,\n    HtkRequest,\n    HtkResponse,\n    Html\n} from \"../../types\";\nimport { firstMatch, empty } from '../../util';\nimport { lastHeader } from '../../util/headers';\nimport { formatAjvError } from '../../util/json-schema';\n\nimport {\n    ApiExchange,\n    ApiService,\n    ApiOperation,\n    ApiRequest,\n    ApiResponse,\n    ApiParameter\n} from './api-interfaces';\nimport { OpenApiMetadata } from './build-api-metadata';\nimport { fromMarkdown } from '../ui/markdown';\n\nconst paramValidator = new Ajv({\n    coerceTypes: 'array',\n    strict: false,\n    strictSchema: false,\n    formats: new Proxy({}, {\n        // Return 'true' (ignore) for all undefined formats:\n        get(target: any, name: string) {\n            if (name in target) return target[name];\n            else return true;\n        }\n    })\n});\naddFormats(paramValidator);\n\nfunction getPath(api: OpenApiMetadata, request: HtkRequest): {\n    pathSpec: PathObject,\n    path: string\n} | undefined {\n    const { parsedUrl } = request;\n\n    // Request URL without query params\n    const url = `${parsedUrl.protocol}//${parsedUrl.host}${parsedUrl.pathname}`;\n\n    // Test the base server up front, just to keep things quick\n    if (!api.serverMatcher.exec(url)) return;\n\n    for (let matcher of api.requestMatchers.keys()) {\n        // Check the path matches\n        if (!matcher.pathMatcher.exec(url)) continue;\n\n        // Check the query fragment matches (if there is one)\n        if (!_.every(matcher.queryMatcher, (expectedValue, query) => {\n            const queryValues = parsedUrl.searchParams.getAll(query);\n            if (!expectedValue) {\n                return queryValues.length > 0;\n            } else if (typeof expectedValue === 'string') {\n                return _.includes(queryValues, expectedValue);\n            } else {\n                return _.intersection(queryValues, expectedValue).length === expectedValue.length;\n            }\n        })) continue;\n\n        // First match is the right one (we sort in build-api to\n        // guarantee more specific matches always come first).\n        return api.requestMatchers.get(matcher)!;\n    }\n}\n\nexport function getParameters(\n    path: string,\n    parameters: ParameterObject[],\n    request: HtkRequest\n): ApiParameter[] {\n    if (!parameters) return [];\n\n    const query = request.parsedUrl.searchParams;\n\n    // Need the cast because TS doesn't know we've already dereferenced this\n    return _.uniqBy(<ParameterObject[]>parameters, (param) =>\n        `${param.name}::${param.in}`\n    )\n        .map((param) => {\n            const schema = param.schema as SchemaObject | undefined;\n\n            const commonFields = {\n                specParam: param,\n                name: param.name,\n                in: param.in,\n                description: fromMarkdown(param.description),\n                required: param.required || param.in === 'path',\n                type: schema && schema.type,\n                defaultValue: schema && schema.default,\n                enum: schema && (schema.enum || (schema.items && (schema.items as SchemaObject).enum)),\n                deprecated: param.deprecated || false,\n                warnings: <string[]>[]\n            }\n\n            switch (param.in) {\n                case 'query':\n                    let values: Array<string | boolean> = query.getAll(param.name);\n\n                    // For a boolean field, empty-but-set (?myParam) means true\n                    if (commonFields.type && commonFields.type === 'boolean' && param.allowEmptyValue) {\n                        values = values.map((v) => v === '' ? true : v);\n                    }\n\n                    return {\n                        ...commonFields,\n                        value: firstMatch<Array<string | boolean> | string | boolean | undefined>(\n                            [() => values.length > 1, values],\n                            [() => values.length === 1, values[0]]\n                        )\n                    };\n\n                case 'path':\n                    // If we had regex named groups, we could do this up front\n                    // with one single regex... Alas, not widespread yet.\n                    const paramMatcher = new RegExp(\n                        path\n                            // Add a capturing group for this param\n                            .replace(`{${param.name}}`, '([^/]+)')\n                            // Add a non-capturing group for every other param\n                            .replace(/\\{[^\\}]+\\}/g, '[^/]+')\n                        + '$', // Matched path must be a complete suffix.\n                        'i' // Match paths ignoring case (matters in theory, never in practice)\n                    );\n\n                    const match = paramMatcher.exec(request.parsedUrl.pathname);\n                    return {\n                        ...commonFields,\n                        value: match ? match[1] : undefined\n                    };\n\n                case 'header':\n                    return {\n                        ...commonFields,\n                        value: request.headers[param.name.toLowerCase()]\n                    }\n\n                // TODO: Match in:cookie too (but currently no example in the specs)\n                default:\n                    return {\n                        ...commonFields,\n                        value: undefined\n                    }\n            }\n        })\n        .map((param) => {\n            const { specParam } = param;\n\n            const serializationStyle = specParam.style || ({\n                query: 'form',\n                path: 'simple',\n                header: 'simple',\n                cookie: 'form'\n            }[specParam.in]);\n\n            if (param.type === 'array') {\n                if (\n                    serializationStyle === 'simple' ||\n                    (serializationStyle === 'form' && specParam.explode === false)\n                ) {\n                    param.value = _.isString(param.value) ? param.value.split(',') : param.value;\n                }\n                if (serializationStyle === 'spaceDelimited') {\n                    param.value = _.isString(param.value) ? param.value.split(' ') : param.value;\n                }\n                if (serializationStyle === 'pipeDelimited') {\n                    param.value = _.isString(param.value) ? param.value.split('|') : param.value;\n                }\n            }\n\n            if (param.required && param.value === undefined && param.defaultValue === undefined) {\n                param.warnings.push(\n                    `The '${param.name}' ${specParam.in} parameter is required.`\n                );\n            }\n\n            if (param.deprecated && param.value !== undefined) {\n                param.warnings.push(\n                    `The '${param.name}' ${specParam.in} parameter is deprecated.`\n                );\n            }\n\n            if (specParam.schema && param.value !== undefined) {\n                // Validate against the schema. We wrap the value in an object\n                // so that ajv can mutate the input to coerce to the right type.\n                const valueWrapper = { value: param.value };\n                const validated = paramValidator.validate({\n                    \"type\": \"object\",\n                    \"properties\": {\n                        \"value\": specParam.schema\n                    }\n                }, valueWrapper);\n\n                if (!validated && paramValidator.errors) {\n                    param.warnings.push(\n                        ...paramValidator.errors.map(e =>\n                            formatAjvError(valueWrapper, e, (path) => path.replace(/^\\/value/, param.name))\n                        )\n                    );\n                }\n\n                param.value = valueWrapper.value;\n            }\n\n            return {\n                ...param,\n                warnings: param.warnings.map(e => stripTags(e))\n            };\n        });\n}\n\nexport function getBodySchema(\n    spec: OpenAPIObject,\n    bodyDefinition: RequestBodyObject | ResponseObject | undefined,\n    message: ExchangeMessage | 'aborted' | undefined\n): SchemaObject {\n    if (!bodyDefinition || !message || message === 'aborted') return {};\n\n    const contentType = lastHeader(message.headers['content-type']) || '*/*';\n\n    const schemasByType = bodyDefinition.content;\n    if (!schemasByType) return {};\n\n    // Sort the keys by the number of *'s present\n    const mediaTypeKeys = _.sortBy(Object.keys(schemasByType),\n        (key) => _.sumBy(key, (c: string) => c === '*' ? 1 : 0)\n    );\n\n    const schemaKey = _.find<string>(mediaTypeKeys, (key) =>\n        new RegExp('^' + // Must match at the start\n            key.replace(/\\*/g, '.*') // Wildcards to regex wildcard\n                .replace(/;.*/g, '') // Ignore charset etc\n        ).exec(contentType) !== null\n    );\n\n    if (!schemaKey) return {};\n\n    return Object.assign(\n        {\n            description: bodyDefinition.description,\n            components: spec.components\n        },\n        schemasByType[schemaKey].schema\n    );\n}\n\nfunction getDummyPath(api: OpenApiMetadata, request: HtkRequest): string {\n    const { parsedUrl } = request;\n    const url = `${parsedUrl.protocol}//${parsedUrl.hostname}${parsedUrl.pathname}`;\n    const serverMatch = api.serverMatcher.exec(url);\n\n    if (!serverMatch) {\n        return parsedUrl.pathname;\n    }\n\n    // Everything after the server is our API path\n    return url.slice(serverMatch[0].length);\n}\n\n// Rough but effective HTML stripping regex. This is _not_ designed to produce HTML-safe\n// input, it's just designed to turn formatted text into simple text.\nfunction stripTags(input: string): string;\nfunction stripTags(input: undefined): undefined;\nfunction stripTags(input: string | undefined): string | undefined {\n    if (!input) return input;\n    return input.replace(/(<([^>]+)>)/ig, '');\n}\n\nexport class OpenApiExchange implements ApiExchange {\n    constructor(api: OpenApiMetadata, exchange: HttpExchange) {\n        this.isBuiltInApi = api.spec.info['x-httptoolkit-builtin-api'] === true;\n\n        const { request } = exchange;\n        this.service = new OpenApiService(api.spec);\n\n        this._spec = api.spec;\n        this._opSpec = matchOpenApiOperation(api, request);\n\n        this.operation = new OpenApiOperation(this._opSpec);\n        this.request = new OpenApiRequest(api.spec, this._opSpec, request);\n\n        if (exchange.response) {\n            this.updateWithResponse(exchange.response);\n        }\n    }\n\n    private _spec: OpenAPIObject;\n    private _opSpec: MatchedOperation;\n\n    public readonly isBuiltInApi: boolean;\n\n    public readonly service: ApiService;\n    public readonly operation: ApiOperation;\n    public readonly request: ApiRequest;\n\n    public response: ApiResponse | undefined;\n\n    updateWithResponse(response: HtkResponse | 'aborted' | undefined): void {\n        if (response === 'aborted' || response === undefined) return;\n        this.response = new OpenApiResponse(this._spec, this._opSpec, response);\n    }\n\n    matchedOperation() {\n        return this._opSpec.matched;\n    }\n}\n\nclass OpenApiService implements ApiService {\n    constructor(spec: OpenAPIObject) {\n        const { info: service } = spec;\n\n        this.name = service.title;\n        this.shortName = service['x-httptoolkit-short-name']\n            ?? this.name.split(' ')[0];\n\n        this.logoUrl = service['x-logo']?.url;\n        this.description = fromMarkdown(service.description);\n        this.docsUrl = spec?.externalDocs?.url;\n    }\n\n    public readonly shortName: string;\n    public readonly name: string;\n    public readonly logoUrl?: string;\n    public readonly description?: Html;\n    public readonly docsUrl?: string;\n}\n\nexport function matchOpenApiOperation(api: OpenApiMetadata, request: HtkRequest) {\n    const matchingPath = getPath(api, request);\n\n    const { pathSpec, path } = matchingPath || {\n        pathSpec: empty(), path: getDummyPath(api, request)\n    }\n\n    const method = (\n        lastHeader(request.headers['x-http-method-override']) || request.method\n    ).toLowerCase();\n\n    let operation: OperationObject | undefined = get(pathSpec, method);\n    if (!operation && method === 'head') operation = get(pathSpec, 'get');\n\n    return {\n        method,\n        path,\n        pathSpec,\n        spec: operation || empty(),\n        matched: operation !== undefined\n    };\n}\n\ntype MatchedOperation = ReturnType<typeof matchOpenApiOperation>;\n\nclass OpenApiOperation implements ApiOperation {\n    constructor(\n        op: MatchedOperation\n    ) {\n        this.name = stripTags(fromMarkdown(\n            firstMatch<string>(\n                [\n                    () => (get(op.spec, 'summary', 'length') || Infinity) < 40, op.spec.summary!\n                ],\n                get(op.spec, 'operationId'),\n                [\n                    () => (get(op.spec, 'description', 'length') || Infinity) < 40, op.spec.description!\n                ],\n                op.pathSpec.summary\n            ) || `${op.method.toUpperCase()} ${op.path}`\n        ).__html);\n\n        this.description = fromMarkdown(firstMatch<string>(\n            [() => get(op.spec, 'description') !== this.name, get(op.spec, 'description')],\n            [() => get(op.spec, 'summary') !== this.name, get(op.spec, 'summary')],\n            op.pathSpec.description\n        ));\n\n        if (!op.matched) this.warnings.push(\n            `Unknown operation '${this.name}'.`\n        );\n\n        if (op.spec.deprecated) this.warnings.push(\n            `The '${this.name}' operation is deprecated.`\n        );\n\n        this.docsUrl = get(op.spec, 'externalDocs', 'url');\n\n        this.warnings = this.warnings.map(e => stripTags(e));\n    }\n\n    name: string;\n    description?: Html;\n    docsUrl?: string;\n\n    warnings: string[] = [];\n}\n\nclass OpenApiRequest implements ApiRequest {\n    constructor(\n        spec: OpenAPIObject,\n        op: MatchedOperation,\n        request: HtkRequest\n    ) {\n        this.parameters = getParameters(\n            op.path,\n            (op.pathSpec.parameters || []).concat(op.spec.parameters || []),\n            request\n        );\n\n        this.bodySchema = getBodySchema(\n            spec,\n            op.spec.requestBody as RequestBodyObject | undefined,\n            request\n        );\n    }\n\n    parameters: ApiParameter[];\n    bodySchema?: SchemaObject;\n}\n\nclass OpenApiResponse implements ApiResponse {\n    constructor(\n        spec: OpenAPIObject,\n        op: MatchedOperation,\n        response: HtkResponse\n    ) {\n        const bodySpec: RequestBodyObject | undefined = op.spec.responses\n            ? (\n                op.spec.responses[response.statusCode.toString()] ||\n                op.spec.responses.default\n            )\n            : undefined;\n\n        this.description = bodySpec && bodySpec.description !== response.statusMessage\n            ? fromMarkdown(bodySpec.description)\n            : undefined;\n        this.bodySchema = getBodySchema(spec, bodySpec, response);\n    }\n\n    description?: Html;\n    bodySchema?: SchemaObject;\n}","import * as _ from 'lodash';\nimport * as traverse from 'traverse';\nimport * as Ajv from 'ajv';\n\nimport { joinAnd, truncate } from './text';\n\ntype Ref = { $ref: string };\n\nfunction isRef(node: any): node is Ref {\n    return typeof node === 'object' &&\n        node !== null &&\n        // $ref can be { type: ... } if it's a real $ref-named field, as in the github API\n        typeof node['$ref'] === 'string';\n}\n\nfunction derefRef(root: any, node: Ref) {\n    const ref = node.$ref;\n\n    if (!ref.startsWith('#')) {\n        throw new Error(`Cannot resolve external reference ${ref}`);\n    }\n\n    let refParts = ref.slice(1).split('/').filter(p => p.length);\n    let refTarget: any = root;\n\n    while (refParts.length) {\n        const nextPart = refParts.shift()!\n            // Handle JSON pointer escape chars:\n            .replace(/~1/g, '/')\n            .replace(/~0/g, '~');\n        refTarget = refTarget[nextPart];\n        if (!refTarget) {\n            throw new Error(`Could not follow ref ${ref}, failed at ${nextPart}`);\n        }\n    }\n\n    return refTarget;\n}\n/**\n * Removes almost all $refs from the given JS object. Mutates the input,\n * and returns it as well, just for convenience.\n *\n * This doesn't worry about where $ref is legal - treats it as a reference when\n * found anywhere. That could go wrong in theory, but in practice it's unlikely,\n * and easy for now.\n *\n * If this causes problems later, we need to build an OpenAPI-specific deref,\n * which understands where in OpenAPIv3 a $ref is legal, and only uses those.\n * For now though, we ignore all that for drastic simplification.\n */\nexport function dereference<T extends object>(root: T): T {\n    traverse.forEach(root, function (this: traverse.TraverseContext, node) {\n        let wasRef = false;\n\n        while (isRef(node)) {\n            wasRef = true;\n            node = derefRef(root, node);\n        }\n\n        // No need to traverse into refs:\n        const stopHere = wasRef;\n        this.update(node, stopHere);\n    });\n    return root;\n}\n\nconst getValue = (root: any, path: string[]): any => {\n    if (path.length === 0) return root;\n    return getValue(root[path[0]], path.slice(1));\n};\n\nexport function formatAjvError(\n    data: any,\n    e: Ajv.ErrorObject,\n    pathTransform: (path: string) => string = _.identity\n) {\n    const value = e.instancePath?.length\n        ? getValue(data, e.instancePath.slice(1).split('/'))\n        : data;\n\n    return (pathTransform(e.instancePath) || 'Document') + ` (${\n        truncate(JSON.stringify(value), 50)\n    }) ${e.message!}${\n        e.keyword === 'enum' ?\n            ` (${joinAnd(\n                (e.params as any).allowedValues, ', ', ', or ')\n            })` :\n        ''\n    }.`\n}","module.exports = \"<!DOCTYPE html>\\n<html>\\n<head>\\n  <meta charset=\\\"UTF-8\\\">\\n  <link rel='shortcut icon' type='image/x-icon' href='/favicon.ico' />\\n  <script type=\\\"application/json\\\" id=\\\"amiusing\\\">\\n    { \\\"amiusing\\\": true }\\n  </script>\\n  <title>\\n    Are you using HTTP Toolkit? Yes!\\n  </title>\\n  <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1, shrink-to-fit=no\\\">\\n  <style>\\n    html {\\n      height: 100%;\\n    }\\n\\n    body {\\n      min-height: 100%;\\n      box-sizing: border-box;\\n      margin: 0;\\n      padding: 8px;\\n\\n      background-color: #d8e2e6;\\n      font-family: Lato;\\n      line-height: 1.3;\\n      display: flex;\\n      flex-direction: column;\\n      align-items: center;\\n      justify-content: center;\\n    }\\n\\n    .content {\\n      max-width: 600px;\\n    }\\n\\n    h1 {\\n      font-size: 36pt;\\n    }\\n\\n    p {\\n      font-size: 18pt;\\n    }\\n\\n    .logo {\\n      display: block;\\n      margin: 40px auto;\\n      height: 200px;\\n      width: 200px;\\n    }\\n  </style>\\n</head>\\n<body>\\n  <div class=\\\"content\\\">\\n    <h1>You're being intercepted by HTTP Toolkit</h1>\\n    <p>\\n      This response came from HTTP Toolkit, which is currently intercepting this connection.\\n    </p>\\n    <p>\\n      All requests made by this browser will be recorded by HTTP Toolkit.\\n      Take a look at the 'View' tab there now to see the request & response\\n      that brought you this page, or start browsing elsewhere to collect more data.\\n    </p>\\n  </div>\\n  <link href=\\\"https://fonts.googleapis.com/css?family=Lato&display=block\\\" rel=\\\"stylesheet\\\" />\\n</body>\\n</html>\"","import * as _ from 'lodash';\nimport * as dedent from 'dedent';\n\nimport { isRuleGroup } from './rules-structure';\nimport { buildDefaultGroupWrapper } from './rule-creation';\n\n// Take some raw serialized rule data, exported from any version of the app since HTTP Mock was\n// launched, and convert it into raw modern rule data, ready to be deserialized.\nexport function migrateRuleData(data: any) {\n    if (!data) return data;\n\n    // Right now all rule data is unversioned, but with this check we can safely\n    // start versioning as soon as it's necessary\n    if (data.version === undefined) {\n        if (data.rules) {\n            data.id = 'root';\n            data.title = \"HTTP Toolkit Rules\";\n            data.isRoot = true;\n\n            const [defaultRules, otherRules] = _.partition(data.rules, (r) => r.id.startsWith('default-'));\n\n            if (defaultRules.length) {\n                data.items = [\n                    ...otherRules,\n                    buildDefaultGroupWrapper(defaultRules)\n                ];\n            } else {\n                data.items = otherRules;\n            }\n            delete data.rules;\n        }\n\n        data.items = data.items.map(migrateRuleItem);\n    } else {\n        throw new Error(dedent`\n            Could not migrate rules from unknown format (${data.version}).\n            Please restart HTTP Toolkit to update.\n        `);\n    }\n\n    return data;\n}\n\nfunction migrateRuleItem(item: any) {\n    if (isRuleGroup(item)) {\n        item.items = item.items.map(migrateRuleItem);\n    } else {\n        item = migrateRule(item);\n    }\n\n    return item;\n}\n\nfunction migrateRule(rule: any) {\n    // Migrate rules from the HTTP-only days into a world with rules for other protocols:\n    if (rule.type === undefined) rule.type = 'http';\n\n    const { handler } = rule;\n\n    if (handler?.type === 'passthrough') {\n        // Handle the targetHost -> forwarding object change from Mockttp 0.18.1:\n        if (handler.forwardToLocation && !handler.forwarding) {\n            handler.forwarding = { targetHost: handler.forwardToLocation, updateHostHeader: true };\n        }\n    }\n\n    return rule;\n}","export function byteStreamToLines(stream: ReadableStream<Uint8Array>) {\n    const newlineMatcher = /\\r?\\n/;\n    const decoder = new TextDecoder();\n\n    let reader: ReadableStreamDefaultReader<Uint8Array>;\n    let currentLine = '';\n\n    return new ReadableStream<string>({\n        start() {\n            reader = stream.getReader();\n        },\n        async pull(controller) {\n            const { done, value } = await reader.read();\n\n            if (done) {\n                // If the stream closes cleanly, all data up to the end\n                // (if there is any) is our final line:\n                if (currentLine.length > 0) {\n                    controller.enqueue(currentLine);\n                }\n                controller.close();\n            }\n\n            const chunk = decoder.decode(value, { stream: true });\n            currentLine += chunk;\n\n            const parts = currentLine.split(newlineMatcher);\n\n            // The last part is incomplete, so becomes our current line:\n            currentLine = parts.pop() ?? '';\n\n            // Every other part is a complete line:\n            for (const part of parts) controller.enqueue(part);\n        },\n        cancel(reason) {\n            reader.cancel(reason);\n        }\n    });\n}\n\nexport function parseJsonLinesStream<T = unknown>(stream: ReadableStream<string>) {\n    let reader: ReadableStreamDefaultReader<string>;\n\n    return new ReadableStream<T>({\n        start() {\n            reader = stream.getReader();\n        },\n        async pull(controller) {\n            const { done, value } = await reader.read();\n\n            if (done) return controller.close();\n            else controller.enqueue(JSON.parse(value));\n        },\n        cancel(reason) {\n            reader.cancel(reason);\n        }\n    });\n}\n\nexport const emptyStream = () => new ReadableStream({\n    start(controller) {\n        controller.close();\n    }\n});","import * as _ from 'lodash';\nimport { computed, observable, action, runInAction, reaction } from 'mobx';\n\nimport { BreakpointBody } from '../../types';\nimport { logError } from \"../../errors\";\nimport { asHeaderArray } from \"../../util/headers\";\nimport { observablePromise, ObservablePromise } from '../../util/observable';\n\nimport { encodeBody } from \"../../services/ui-worker-api\";\n\nexport class EditableBody implements BreakpointBody {\n\n    @observable.ref\n    private _decodedBody: Buffer;\n\n    @observable.ref\n    private _encodedBody: Buffer | undefined;\n\n    @observable.ref\n    private _encodingPromise!: ObservablePromise<Buffer>;\n\n    constructor(\n        initialDecodedBody: Buffer,\n        initialEncodedBody: Buffer | undefined,\n        private getContentEncodingHeader: () => string | string[] | undefined\n    ) {\n        this._decodedBody = initialDecodedBody;\n\n        if (initialEncodedBody) {\n            this._encodedBody = initialEncodedBody;\n            this._encodingPromise = observablePromise(Promise.resolve(initialEncodedBody));\n        } else {\n            this._encodedBody = undefined;\n            this.updateEncodedBody();\n        }\n\n        reaction(() => this._decodedBody, () => this.updateEncodedBody());\n        reaction(() => this.contentEncodings, () => this.updateEncodedBody());\n    }\n\n    @action\n    updateDecodedBody(newBody: Buffer) {\n        this._decodedBody = newBody;\n    }\n\n    @computed.struct\n    private get contentEncodings() {\n        return asHeaderArray(this.getContentEncodingHeader());\n    }\n\n    private updateEncodedBody = _.throttle(() => {\n        const encodeBodyPromise = observablePromise((async () => {\n            const encodings = this.contentEncodings;\n\n            const encodedBody = await encodeBody(this._decodedBody, encodings)\n                .catch((e) => {\n                    logError(e, { encodings });\n                    return this._decodedBody; // If encoding fails, we send raw data instead\n                });\n\n            runInAction(() => {\n                // Update the encoded body, only if we're the latest encoding request\n                if (this._encodingPromise === encodeBodyPromise) {\n                    this._encodedBody = encodedBody;\n                }\n            });\n\n            return encodedBody;\n        })());\n\n        this._encodingPromise = encodeBodyPromise;\n    }, 500, { leading: true, trailing: true });\n\n    @computed\n    get contentLength() {\n        return this._encodedBody?.byteLength || 0;\n    }\n\n    get encoded() {\n        return this._encodingPromise;\n    }\n\n    get decoded() {\n        return this._decodedBody;\n    }\n\n}","import * as _ from 'lodash';\nimport { observable, action, reaction, observe } from \"mobx\";\nimport dedent from 'dedent';\n\nimport {\n    Headers,\n    MockttpBreakpointedRequest,\n    MockttpBreakpointedResponse,\n    MockttpBreakpointRequestResult,\n    BreakpointRequestResult,\n    BreakpointResponseResult,\n    BreakpointBody,\n    MockttpBreakpointResponseResult,\n} from \"../../types\";\nimport { logError } from \"../../errors\";\n\nimport { stringToBuffer } from '../../util';\nimport { getDeferred, Deferred } from \"../../util/promise\";\nimport {\n    asHeaderArray,\n    withHeaderValue,\n    getHeaderValue,\n    headersToRawHeaders,\n    rawHeadersToHeaders\n} from '../../util/headers';\n\nimport {\n    RAW_BODY_SUPPORTED,\n    serverVersion,\n    versionSatisfies\n} from '../../services/service-versions';\nimport { decodeBody } from \"../../services/ui-worker-api\";\nimport { EditableBody } from './editable-body';\nimport { getStatusMessage } from \"./http-docs\";\n\nfunction getBody(message: MockttpBreakpointedRequest | MockttpBreakpointedResponse) {\n    return decodeBody(\n        message.body.buffer,\n        asHeaderArray(message.headers['content-encoding'])\n    ).catch((e) => {\n        logError(e);\n        const error = dedent`\n            HTTP TOOLKIT ERROR: Could not decode body, \\\n            check content-encoding\n        `;\n        return {\n            encoded: stringToBuffer(error),\n            decoded: stringToBuffer(error)\n        };\n    });\n}\n\nconst omitPsuedoHeaders = (headers: Headers) =>\n    _.omitBy(headers, (_v, key) => key.startsWith(':')) as Headers;\n\nexport async function getRequestBreakpoint(request: MockttpBreakpointedRequest) {\n    const { encoded, decoded } = await getBody(request);\n\n    const headers = observable(request.headers);\n\n    return new RequestBreakpoint(\n        {\n            method: request.method,\n            url: request.url,\n            rawHeaders: request.rawHeaders ?? headersToRawHeaders(request.headers)\n        },\n        decoded,\n        encoded\n    );\n}\n\nexport function getDummyResponseBreakpoint(httpVersion: 1 | 2) {\n    const breakpoint = new ResponseBreakpoint(\n        {\n            statusCode: 200,\n            statusMessage: undefined,\n            rawHeaders: httpVersion === 2 ? [[':status', '200']] : [],\n        },\n        stringToBuffer(''),\n        stringToBuffer('')\n    );\n\n    return breakpoint;\n}\n\nexport async function getResponseBreakpoint(response: MockttpBreakpointedResponse) {\n    const expectedStatusMessage = getStatusMessage(response.statusCode)\n    const statusMessage = expectedStatusMessage === response.statusMessage\n        ? undefined\n        : response.statusMessage;\n    const { encoded, decoded } = await getBody(response);\n\n    return new ResponseBreakpoint(\n        {\n            statusCode: response.statusCode,\n            statusMessage: statusMessage,\n            rawHeaders: response.rawHeaders ?? headersToRawHeaders(response.headers)\n        },\n        decoded,\n        encoded\n    );\n}\n\ntype BreakpointInProgress = BreakpointRequestResult | BreakpointResponseResult;\n\ntype BreakpointMetadata = Omit<BreakpointInProgress, 'body' | 'rawBody'>;\n\ntype BreakpointResumeType<T extends BreakpointInProgress> =\n    T extends BreakpointRequestResult\n        ? MockttpBreakpointRequestResult\n        : MockttpBreakpointResponseResult;\n\n\nexport abstract class Breakpoint<T extends BreakpointInProgress> {\n\n    protected readonly deferred: Deferred<BreakpointResumeType<T>>;\n\n    @observable.shallow\n    private resultMetadata: Omit<T, 'body' | 'rawBody'>;\n    private readonly editableBody: EditableBody;\n\n    constructor(\n        result: Omit<T, 'body' | 'rawBody'>,\n        decodedBody: Buffer,\n        encodedBody: Buffer | undefined\n    ) {\n        this.deferred = getDeferred();\n        this.resultMetadata = result;\n        this.editableBody = new EditableBody(\n            decodedBody,\n            encodedBody,\n            () => getHeaderValue(this.resultMetadata.rawHeaders, 'Content-Encoding')\n        );\n\n        // Update the content-length when necessary, if it was previously correct\n        observe(this.editableBody, 'contentLength', ({\n            oldValue: previousEncodedLength,\n            newValue: newEncodedLength\n        }) => {\n            const { rawHeaders } = this.resultMetadata;\n            const previousContentLength = parseInt(getHeaderValue(rawHeaders, 'Content-Length') || '', 10);\n\n            // If the content-length was previously correct, keep it correct:\n            if (previousContentLength === previousEncodedLength) {\n                this.updateMetadata({\n                    rawHeaders: withHeaderValue(rawHeaders, {\n                        'Content-Length': newEncodedLength.toString()\n                    })\n                });\n            }\n        });\n\n        // When content-length is first added, default to the correct value\n        let oldContentLength = getHeaderValue(this.resultMetadata.rawHeaders, 'Content-Length');\n        reaction(() => getHeaderValue(this.resultMetadata.rawHeaders, 'Content-Length'), (newContentLength) => {\n            if (oldContentLength === undefined && newContentLength === \"\") {\n                const { rawHeaders } = this.resultMetadata;\n                this.updateMetadata({\n                    rawHeaders: withHeaderValue(rawHeaders, {\n                        'Content-Length': this.editableBody.contentLength.toString()\n                    })\n                });\n            }\n\n            oldContentLength = newContentLength;\n        });\n    }\n\n    get inProgressResult(): T {\n        return Object.assign(\n            {\n                body: this.editableBody as BreakpointBody\n            },\n            this.resultMetadata,\n        ) as T;\n    }\n\n    @action.bound\n    updateMetadata(update: Partial<BreakpointMetadata>) {\n        this.resultMetadata = {\n            ...this.resultMetadata,\n            ..._.omit(update, 'body', 'rawBody')\n        };\n    }\n\n    @action.bound\n    updateBody(body: Buffer) {\n        this.editableBody.updateDecodedBody(body);\n    }\n\n    waitForCompletedResult() {\n        return this.deferred.promise;\n    }\n\n    readonly resume = async () => {\n        this.deferred.resolve({\n            ...this.resultMetadata,\n\n            ...(versionSatisfies(await serverVersion, RAW_BODY_SUPPORTED)\n                // Mockttp v3+ skips auto-encoding only if you use rawBody:\n                ? { rawBody: await this.editableBody.encoded }\n                // Old Mockttp doesn't support rawBody, never auto-encodes:\n                : { body: await this.editableBody.encoded }\n            ),\n\n            // Psuedo-headers those will be generated automatically from the other,\n            // fields, as part of the rest of the request process.\n            headers: omitPsuedoHeaders(rawHeadersToHeaders(this.resultMetadata.rawHeaders))\n        } as unknown as BreakpointResumeType<T>);\n    }\n\n    abstract close(): void;\n\n    reject(error: Error) {\n        this.deferred.reject(error);\n    }\n}\n\nclass RequestBreakpoint extends Breakpoint<BreakpointRequestResult> {\n    respondDirectly(result: MockttpBreakpointResponseResult) {\n        this.deferred.resolve({ response: result });\n    }\n\n    close = () => {\n        this.deferred.resolve({ response: 'close' });\n    }\n}\n\nclass ResponseBreakpoint extends Breakpoint<BreakpointResponseResult> {\n    close = () => {\n        this.deferred.resolve('close');\n    }\n}\n\ntype RequestBreakpointType = RequestBreakpoint;\ntype ResponseBreakpointType = ResponseBreakpoint\n\nexport {\n    RequestBreakpointType as RequestBreakpoint,\n    ResponseBreakpointType as ResponseBreakpoint\n};","import * as Sentry from '@sentry/browser';\nimport * as uuid from 'uuid/v4';\n\nimport { UI_VERSION, serverVersion, desktopVersion } from './services/service-versions';\nimport { ApiError } from './services/server-api-types';\n\nlet sentryInitialized = false;\n\nexport function isSentryInitialized() {\n    return sentryInitialized;\n}\n\nexport { Sentry };\n\nexport function initSentry(dsn: string | undefined) {\n    if (!dsn) return;\n\n    Sentry.init({\n        dsn: dsn,\n        release: UI_VERSION,\n        ignoreErrors: [\n            'ResizeObserver loop limit exceeded', // No visible effect: https://stackoverflow.com/a/50387233/68051\n        ],\n        beforeSend: function (event, hint) {\n            const exception = hint?.originalException;\n            if (exception instanceof ApiError) {\n                event.fingerprint = [\n                    \"{{ default }}\",\n                    exception.operationName,\n                    ...(exception.errorCode\n                        ? [exception.errorCode.toString()]\n                        : []\n                    )\n                ];\n            }\n            return event;\n        }\n    });\n    sentryInitialized = true;\n\n    serverVersion.then((version) => addErrorTag('version:server', version));\n    desktopVersion.then((version) => addErrorTag('version:desktop', version));\n\n    // If we're running in the main window (not the SW),\n    // stop reporting errors after the page starts unloading\n    if (typeof window !== 'undefined') {\n        window.addEventListener('beforeunload', () => {\n            Sentry.getCurrentHub().getClient().getOptions().enabled = false;\n            sentryInitialized = false;\n        });\n    }\n\n    Sentry.configureScope((scope) => {\n        // We use a random id to distinguish between many errors in one session vs\n        // one error in many sessions. This isn't persisted and can't be used to\n        // identify anybody between sessions.\n        const randomId = uuid();\n        scope.setUser({\n            id: randomId,\n            username: `anon-${randomId}`\n        });\n    });\n}\n\nexport function logErrorsAsUser(email: string | undefined) {\n    if (!sentryInitialized) return;\n\n    Sentry.configureScope((scope) => {\n        scope.setUser({\n            id: email,\n            email: email\n        });\n    });\n}\n\nfunction addErrorTag(key: string, value: string) {\n    if (!sentryInitialized) return;\n\n    Sentry.configureScope((scope) => {\n        scope.setTag(key, value);\n    });\n}\n\nexport function logError(error: Error | string | unknown, metadata: object = {}) {\n    console.log('Reporting error:', error, metadata);\n    if (!sentryInitialized) return;\n\n    Sentry.withScope((scope) => {\n        Object.entries(metadata).forEach(([key, value]) => {\n            scope.setExtra(key, value);\n        });\n\n        if (typeof error === 'string') {\n            Sentry.captureMessage(error);\n        } else if (error instanceof Error) {\n            Sentry.captureException(error);\n        } else {\n            console.warn('Reporting non-error', error);\n            Sentry.captureMessage(`Non-error thrown: ${error}`);\n        }\n    });\n}","import * as _ from 'lodash';\nimport * as React from 'react';\nimport * as polished from 'polished';\n\nimport { styled, Theme, css } from '../../styles';\nimport { UnstyledButton, interactiveMouseoverStyles } from './inputs';\n\n// Given a base colour, returns a constrasting (but related hue) text colour\nfunction getTextColor(baseColor: string, theme: Theme) {\n    // Effective BG colour (as it's very transparent - assume on a main-ish bg)\n    const bgColor = polished.mix(0.3, baseColor, theme.mainBackground);\n\n    const lightOption = polished.setLightness(theme.pillContrast, baseColor);\n    const darkOption = polished.setLightness(1 - theme.pillContrast, baseColor);\n\n    return polished.rgba(polished.readableColor(\n        bgColor,\n        darkOption,\n        lightOption,\n    ), theme.pillContrast);\n}\n\n// Given a base colour, returns a semi-transparent background\nfunction getBackgroundColor(baseColor: string) {\n    return polished.rgba(baseColor, 0.3);\n}\n\nfunction getNonTransparentBackground(baseColor: string, theme: Theme) {\n    return polished.mix(0.3, baseColor, theme.mainBackground);\n}\n\nfunction getDefaultColor(theme: Theme) {\n    if (polished.getLuminance(theme.mainBackground) > 0.5) {\n        return polished.darken(0.4, theme.mainBackground);\n    } else {\n        return polished.lighten(0.4, theme.mainBackground);\n    }\n}\n\nconst pillStyles = css`\n    display: inline-block;\n    border-radius: 4px;\n    padding: 4px 8px;\n\n    text-align: center;\n    text-transform: none;\n    font-weight: bold;\n    word-spacing: 3px;\n\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n\n    color: ${(p: { color?: string, theme?: Theme }) =>\n        getTextColor(p.color || getDefaultColor(p.theme!), p.theme!)\n    };\n\n    background-color: ${(p: { color?: string, theme?: Theme }) =>\n        getBackgroundColor(p.color || getDefaultColor(p.theme!))\n    };\n`;\n\nexport const Pill = styled.span`\n    ${pillStyles}\n`;\n\nexport const PillButton = styled(UnstyledButton)`\n    ${pillStyles}\n    ${interactiveMouseoverStyles}\n\n    line-height: 1;\n\n    &[disabled] {\n        opacity: 0.5;\n    }\n`;\n\nconst Select = styled(Pill.withComponent('select'))`\n    text-align: left;\n    border: none;\n\n    height: 24px;\n    padding: 0 4px 3px 8px;\n\n    font-size: ${p => p.theme.textSize};\n    font-family: ${p => p.theme.fontFamily};\n\n    ${interactiveMouseoverStyles}\n\n    * {\n        background-color: ${(p: { color?: string, theme?: Theme }) =>\n            getNonTransparentBackground(\n                p.color || getDefaultColor(p.theme!),\n                p.theme!\n            )\n        };\n    }\n`;\n\nexport const PillSelector = <\n    T extends {},\n    K extends string = T extends string ? T : string\n>(props: {\n    value: T,\n    onChange: (optionKey: K) => void\n    nameFormatter?: (key: T) => string,\n    keyFormatter?: (key: T) => K,\n} & ({ options: readonly T[] } | { optGroups: { [groupName: string]: T[] } })\n) => {\n    const asKey = props.keyFormatter || ((k: T) => k.toString() as K);\n    const asName = props.nameFormatter || ((k: T) => k.toString());\n\n    return <Select\n        onChange={(e) => props.onChange(e.target.value as K)}\n        value={asKey(props.value)}\n    >\n        {'options' in props\n            ? props.options.map((option: T) =>\n                <option key={asKey(option)} value={asKey(option)}>\n                    { asName(option) }\n                </option>\n            )\n            : _.map(props.optGroups, (options: T[], groupName: string) =>\n                <optgroup key={groupName} label={groupName}>{\n                    options.map((option: T) =>\n                        <option key={asKey(option)} value={asKey(option)}>\n                            { asName(option) }\n                        </option>\n                    )\n                }</optgroup>\n            )\n        }\n    </Select>\n};","import * as _ from 'lodash';\nimport {\n    serverVersion as serverVersionObservable,\n    versionSatisfies,\n    BODY_MATCHING_RANGE,\n    HOST_MATCHER_SERVER_RANGE,\n    FROM_FILE_HANDLER_SERVER_RANGE,\n    PASSTHROUGH_TRANSFORMS_RANGE,\n    WEBSOCKET_MESSAGING_RULES_SUPPORTED,\n    JSONRPC_RESPONSE_RULE_SUPPORTED,\n    RTC_RULES_SUPPORTED,\n    CONNECTION_RESET_SUPPORTED\n} from '../../services/service-versions';\n\nimport {\n    StaticResponseHandler,\n    ForwardToHostHandler,\n    TimeoutHandler,\n    CloseConnectionHandler,\n    ResetConnectionHandler,\n    FromFileResponseHandler,\n    TransformingHandler,\n    HttpMatcherLookup,\n    HttpHandlerLookup,\n    HttpMockRule,\n    HttpInitialMatcherClasses\n} from './definitions/http-rule-definitions';\n\nimport {\n    WebSocketMatcherLookup,\n    WebSocketHandlerLookup,\n    WebSocketMockRule,\n    WebSocketInitialMatcherClasses,\n    EchoWebSocketHandlerDefinition,\n    RejectWebSocketHandlerDefinition,\n    ListenWebSocketHandlerDefinition\n} from './definitions/websocket-rule-definitions';\n\nimport {\n    EthereumMatcherLookup,\n    EthereumHandlerLookup,\n    EthereumInitialMatcherClasses,\n    EthereumMockRule,\n    EthereumMethodMatcher\n} from './definitions/ethereum-rule-definitions';\n\nimport {\n    IpfsMockRule,\n    IpfsMatcherLookup,\n    IpfsInitialMatcherClasses,\n    IpfsHandlerLookup,\n    IpfsInteractionMatcher\n} from './definitions/ipfs-rule-definitions';\n\nimport {\n    RTCMatcherLookup,\n    RTCStepLookup,\n    RTCMockRule,\n    RTCInitialMatcherClasses\n} from './definitions/rtc-rule-definitions';\n\n/// --- Part-generic logic ---\n\nexport const getRulePartKey = (part: {\n    type: string,\n    uiType?: string\n})=>\n    // Mockttp and friends define a 'type' field that's used for (de)serialization.\n    // In addition, we define a uiType, for more specific representations of the\n    // same rule part in some cases, which takes precedence.\n    (part.uiType ?? part.type) as\n        keyof typeof MatcherLookup | keyof typeof HandlerLookup;\n\nconst PartVersionRequirements: {\n    [PartType in keyof typeof MatcherLookup | keyof typeof HandlerLookup]?: string\n} = {\n    // Matchers:\n    'host': HOST_MATCHER_SERVER_RANGE,\n    'raw-body': BODY_MATCHING_RANGE,\n    'raw-body-regexp': BODY_MATCHING_RANGE,\n    'raw-body-includes': BODY_MATCHING_RANGE,\n    'json-body': BODY_MATCHING_RANGE,\n    'json-body-matching': BODY_MATCHING_RANGE,\n\n    'eth-method': JSONRPC_RESPONSE_RULE_SUPPORTED, // Usable without, but a bit pointless\n    'rtc-wildcard': RTC_RULES_SUPPORTED,\n\n    // Handlers:\n    'file': FROM_FILE_HANDLER_SERVER_RANGE,\n    'req-res-transformer': PASSTHROUGH_TRANSFORMS_RANGE,\n    'ws-echo': WEBSOCKET_MESSAGING_RULES_SUPPORTED,\n    'ws-listen': WEBSOCKET_MESSAGING_RULES_SUPPORTED,\n    'ws-reject': WEBSOCKET_MESSAGING_RULES_SUPPORTED,\n    'reset-connection': CONNECTION_RESET_SUPPORTED\n};\n\nconst serverSupports = (versionRequirement: string | undefined) => {\n    if (!versionRequirement || versionRequirement === '*') return true;\n\n    // If we haven't got the server version yet, assume it doesn't support this\n    if (serverVersionObservable.state !== 'fulfilled') return false;\n\n    const version = serverVersionObservable.value as string; // Fulfilled -> string value\n    return versionSatisfies(version, versionRequirement);\n}\n\n/// --- Matchers ---\n\nconst MatchersByType = {\n    'http': HttpMatcherLookup,\n    'websocket': WebSocketMatcherLookup,\n    'ethereum': EthereumMatcherLookup,\n    'ipfs': IpfsMatcherLookup,\n    'webrtc': RTCMatcherLookup\n};\n\n// Define maps to/from matcher keys to matcher classes, and\n// types for the matchers & classes themselves; both the built-in\n// ones and our own extra additions & overrides.\nexport const MatcherLookup = {\n    // These are kept as references to MatchersByType, so the content is always the same:\n    ...MatchersByType['http'],\n    ...MatchersByType['websocket'],\n    ...MatchersByType['ethereum'],\n    ...MatchersByType['ipfs'],\n    ...MatchersByType['webrtc']\n};\n\n// This const isn't used, but the assignment conveniently and clearly checks if\n// any handlers are created without the correct + readonly type/uiType values.\nconst __MATCHER_KEY_CHECK__: {\n    // Enforce that keys match .type or uiType for each matcher class:\n    [K in keyof typeof MatcherLookup]: new (...args: any[]) => { type: K } | { uiType: K }\n} = MatcherLookup;\n\nexport type MatcherClassKey = keyof typeof MatcherLookup;\nexport type MatcherClass = typeof MatcherLookup[MatcherClassKey];\nexport type Matcher = InstanceType<MatcherClass>;\n\nexport const isCompatibleMatcher = (matcher: Matcher, type: RuleType) => {\n    const matcherKey = getRulePartKey(matcher);\n    return !!(MatchersByType[type] as _.Dictionary<MatcherClass>)[matcherKey];\n};\n\n// A runtime map from class to the 'uiType'/'type' key that will be\n// present on constructed instances.\nexport const MatcherClassKeyLookup = new Map<MatcherClass, MatcherClassKey>(\n    Object.entries(MatcherLookup)\n    .map(\n        ([key, matcher]) => [matcher, key]\n    ) as Array<[MatcherClass, MatcherClassKey]>\n);\n\n/// --- Handlers ---\n\nexport const HandlersByType = {\n    'http': HttpHandlerLookup,\n    'websocket': WebSocketHandlerLookup,\n    'ethereum': EthereumHandlerLookup,\n    'ipfs': IpfsHandlerLookup,\n    'webrtc': RTCStepLookup\n};\n\n// Define maps to/from handler keys to handler classes, and\n// types for the handlers & classes themselves; both the built-in\n// ones and our own extra additions & overrides.\nexport const HandlerLookup = {\n    // These are kept as references to HandlersByType, so the content is always the same:\n    ...HandlersByType['http'],\n    ...HandlersByType['websocket'],\n    ...HandlersByType['ethereum'],\n    ...HandlersByType['ipfs'],\n    ...HandlersByType['webrtc']\n};\n\n// This const isn't used, but the assignment conveniently and clearly checks if\n// any handlers are created without the correct + readonly type/uiType values.\nconst __HANDLER_KEY_CHECK__: {\n    // Enforce that keys match .type or uiType for each handler class:\n    [K in keyof typeof HandlerLookup]: new (...args: any[]) => { type: K } | { uiType: K }\n} = HandlerLookup;\n\nexport type HandlerClassKey = keyof typeof HandlerLookup;\nexport type HandlerClass = typeof HandlerLookup[HandlerClassKey];\nexport type Handler = InstanceType<HandlerClass>;\n\n// Steps are a subset of handlers which are allowed to appear in 'steps' arrays on rules, for rule types\n// that support defining a series of steps to execute.\nconst HandlerSteps = {\n    ...RTCStepLookup\n};\nexport type HandlerStepClass = typeof HandlerSteps[keyof typeof HandlerSteps];\nexport type HandlerStep = InstanceType<HandlerStepClass>;\n\nexport const HandlerClassKeyLookup = new Map<HandlerClass, HandlerClassKey>(\n    Object.entries(HandlerLookup)\n    .map(\n        ([key, handler]) => [handler, key]\n    ) as Array<[HandlerClass, HandlerClassKey]>\n);\n\nexport const isCompatibleHandler = (handler: Handler, initialMatcher: InitialMatcher) => {\n    const handlerKey = getRulePartKey(handler) as HandlerClassKey;\n\n    const ruleType = getRuleTypeFromInitialMatcher(initialMatcher);\n    const handlersForType = HandlersByType[ruleType] as _.Dictionary<HandlerClass>\n    const equivalentHandler = handlersForType[handlerKey];\n\n    // Some handlers require a specific initial matcher, or they're not available.\n    // In those cases, we check the initial matcher is valid:\n    const matcherCheck = MatcherLimitedHandlers[handlerKey];\n    if (matcherCheck !== undefined && !matcherCheck(initialMatcher)) return false;\n\n    return equivalentHandler !== undefined;\n};\n\n/// --- Matcher/handler special categories ---\n\nconst InitialMatcherClasses = [\n    ...HttpInitialMatcherClasses,\n    ...WebSocketInitialMatcherClasses,\n    ...EthereumInitialMatcherClasses,\n    ...IpfsInitialMatcherClasses,\n    ...RTCInitialMatcherClasses\n];\n\nexport const getInitialMatchers = () => InitialMatcherClasses.filter((matcherCls) => {\n    const matcherKey = MatcherClassKeyLookup.get(matcherCls)!;\n    return serverSupports(PartVersionRequirements[matcherKey]);\n});\n\nexport type InitialMatcherClass = typeof InitialMatcherClasses[number];\nexport type InitialMatcher = InstanceType<InitialMatcherClass>;\nexport type InitialMatcherKey = {\n    [K in MatcherClassKey]: typeof MatcherLookup[K] extends InitialMatcherClass ? K : never\n}[MatcherClassKey];\n\nexport const getRuleTypeFromInitialMatcher = (matcher: InitialMatcher | MatcherClassKey): RuleType => {\n    const matcherClass = _.isString(matcher)\n        ? MatcherLookup[matcher]\n        : matcher.constructor as any;\n\n    if (HttpInitialMatcherClasses.includes(matcherClass)) {\n        return 'http';\n    } else if (WebSocketInitialMatcherClasses.includes(matcherClass)) {\n        return 'websocket';\n    } else if (EthereumInitialMatcherClasses.includes(matcherClass)) {\n        return 'ethereum';\n    } else if (IpfsInitialMatcherClasses.includes(matcherClass)) {\n        return 'ipfs';\n    } else if (RTCInitialMatcherClasses.includes(matcherClass)) {\n        return 'webrtc';\n    } else {\n        throw new Error(`Unknown type for initial matcher class: ${matcherClass.name}`);\n    }\n}\n\n// Some real matchers aren't shown in the selection dropdowns, either because they're not suitable\n// for use here, or because we just don't support them yet:\nconst HiddenMatchers = [\n    'callback',\n    'am-i-using',\n    'default-wildcard',\n    'default-ws-wildcard',\n    'multipart-form-data',\n    'raw-body-regexp',\n    'hostname',\n    'port',\n    'protocol',\n    'form-data',\n    'cookie',\n\n    'rtc-page-hostname',\n    'rtc-page-regex',\n    'rtc-user-agent-regex'\n] as const;\n\ntype HiddenMatcherKey = typeof HiddenMatchers[number];\n\nexport type AdditionalMatcherKey = Exclude<MatcherClassKey, HiddenMatcherKey | InitialMatcherKey>;\ntype AdditionalMatcher = typeof MatcherLookup[AdditionalMatcherKey];\n\n// The set of non-initial matchers a user can pick for a given rule.\nexport const getAvailableAdditionalMatchers = (ruleType: RuleType): AdditionalMatcher[] => {\n    return Object.values(MatchersByType[ruleType])\n        .filter((matcher: MatcherClass) => {\n            const matcherKey = MatcherClassKeyLookup.get(matcher)!;\n\n            if (HiddenMatchers.includes(matcherKey as HiddenMatcherKey)) return false;\n            if (InitialMatcherClasses.includes(matcher as any)) return false;\n\n            return serverSupports(PartVersionRequirements[matcherKey]);\n        });\n};\n\nexport const isHiddenMatcherKey = (key: MatcherClassKey) =>\n    HiddenMatchers.includes(key as HiddenMatcherKey);\n\nconst HiddenHandlers = [\n    'json-rpc-response', // Only used internally, by Ethereum rules\n    'rtc-peer-proxy', // Not usable interactively\n    'callback',\n    'stream',\n    'wait-for-rtc-track' // Not super useful here I think\n] as const;\n\nconst MatcherLimitedHandlers: {\n    [K in HandlerClassKey]?: ((matcher: InitialMatcher) => boolean)\n} = {\n    // Ethereum interaction-specific handlers:\n    'eth-call-result': (matcher: InitialMatcher) =>\n        matcher instanceof EthereumMethodMatcher &&\n        matcher.methodName === 'eth_call',\n    'eth-number-result': (matcher: InitialMatcher) =>\n        matcher instanceof EthereumMethodMatcher &&\n        [\n            'eth_getBalance',\n            'eth_blockNumber',\n            'eth_gasPrice'\n        ].includes(matcher.methodName),\n    'eth-hash-result': (matcher: InitialMatcher) =>\n        matcher instanceof EthereumMethodMatcher &&\n        [\n            'eth_sendRawTransaction',\n            'eth_sendTransaction'\n        ].includes(matcher.methodName),\n    'eth-receipt-result': (matcher: InitialMatcher) =>\n        matcher instanceof EthereumMethodMatcher &&\n        matcher.methodName === 'eth_getTransactionReceipt',\n    'eth-block-result': (matcher: InitialMatcher) =>\n        matcher instanceof EthereumMethodMatcher &&\n        [\n            'eth_getBlockByHash',\n            'eth_getBlockByNumber'\n        ].includes(matcher.methodName),\n\n    // IPFS interaction-specific handlers:\n    'ipfs-cat-text': (matcher: InitialMatcher) =>\n        matcher instanceof IpfsInteractionMatcher &&\n        matcher.interactionName === 'cat',\n    'ipfs-cat-file': (matcher: InitialMatcher) =>\n        matcher instanceof IpfsInteractionMatcher &&\n        matcher.interactionName === 'cat',\n    'ipfs-add-result': (matcher: InitialMatcher) =>\n        matcher instanceof IpfsInteractionMatcher &&\n        matcher.interactionName === 'add',\n    'ipns-resolve-result': (matcher: InitialMatcher) =>\n        matcher instanceof IpfsInteractionMatcher &&\n        matcher.interactionName === 'name/resolve',\n    'ipns-publish-result': (matcher: InitialMatcher) =>\n        matcher instanceof IpfsInteractionMatcher &&\n        matcher.interactionName === 'name/publish',\n    'ipfs-pins-result': (matcher: InitialMatcher) =>\n        matcher instanceof IpfsInteractionMatcher &&\n        [\n            'pin/add',\n            'pin/rm'\n        ].includes(matcher.interactionName),\n    'ipfs-pin-ls-result': (matcher: InitialMatcher) =>\n        matcher instanceof IpfsInteractionMatcher &&\n        matcher.interactionName === 'pin/ls',\n};\n\ntype HiddenHandlerKey = typeof HiddenHandlers[number];\nexport type AvailableHandlerKey = Exclude<HandlerClassKey, HiddenHandlerKey>;\nexport type AvailableHandler = typeof HandlerLookup[AvailableHandlerKey];\n\nexport const getAvailableHandlers = (\n    ruleType: RuleType,\n    initialMatcher: InitialMatcher | undefined\n): AvailableHandler[] => {\n    return Object.values(HandlersByType[ruleType])\n        .filter((handler) => {\n            const handlerKey = HandlerClassKeyLookup.get(handler)!;\n\n            if (HiddenHandlers.includes(handlerKey as HiddenHandlerKey)) return false;\n\n            // Some handlers require a specific initial matcher, or they're not available.\n            // In those cases, we check the initial matcher is valid:\n            const matcherCheck = MatcherLimitedHandlers[handlerKey];\n            if (\n                matcherCheck !== undefined &&\n                (!initialMatcher || !matcherCheck(initialMatcher))\n            ) return false;\n\n            return serverSupports(PartVersionRequirements[handlerKey]);\n        });\n};\n\nconst FinalHandlerSteps = [\n    'echo-rtc',\n    'rtc-peer-proxy',\n    'rtc-dynamic-proxy',\n    'close-rtc-connection'\n] as const;\n\n// Handlers are final if a) they're not steps, just normal handlers, or b) if they are steps, but\n// they're final steps that preclude any further interactions (e.g. closing a connection).\nexport const isFinalHandler = (handler: Handler) => {\n    const handlerKey = getRulePartKey(handler) as any; // Any -> can't includes() const arrays otherwise\n\n    return !Object.keys(HandlerSteps).includes(handlerKey) ||\n        FinalHandlerSteps.includes(handlerKey);\n}\n\nconst PaidHandlerClasses: HandlerClass[] = [\n    StaticResponseHandler,\n    FromFileResponseHandler,\n    ForwardToHostHandler,\n    TransformingHandler,\n    TimeoutHandler,\n    CloseConnectionHandler,\n    ResetConnectionHandler,\n    EchoWebSocketHandlerDefinition,\n    RejectWebSocketHandlerDefinition,\n    ListenWebSocketHandlerDefinition\n];\n\nexport const isPaidHandler = (\n    ruleType: RuleType,\n    handler: Handler\n) => {\n    if (ruleType !== 'http' && ruleType !== 'websocket') return false;\n    return _.some(PaidHandlerClasses, (cls) => handler instanceof cls);\n}\n\nexport const isPaidHandlerClass = (\n    ruleType: RuleType,\n    handlerClass: HandlerClass\n) => {\n    if (ruleType !== 'http' && ruleType !== 'websocket') return false;\n    return PaidHandlerClasses.includes(handlerClass);\n}\n\n/// --- Rules ---\n\nexport type HtkMockRule = (\n    | HttpMockRule\n    | WebSocketMockRule\n    | EthereumMockRule\n    | IpfsMockRule\n    | RTCMockRule\n) & {\n    title?: string;\n};\n\nexport type RuleType = HtkMockRule['type'];\n\nconst matchRuleType = <T extends RuleType>(\n    ...types: T[]\n) => (type: string): type is T =>\n    types.includes(type as T);\n\nconst matchRule = <T extends RuleType>(\n    matcher: (type: string) => type is T\n) => (rule: HtkMockRule): rule is HtkMockRule & { type: T } =>\n    matcher(rule.type);\n\nexport const isHttpCompatibleType = matchRuleType('http', 'ethereum', 'ipfs');\nexport const isHttpBasedRule = matchRule(isHttpCompatibleType);\nexport const isWebSocketRule = matchRule(matchRuleType('websocket'));\nexport const isRTCRule = matchRule(matchRuleType('webrtc'));\n\nexport const isStepPoweredRule = isRTCRule;","import * as _ from 'lodash';\n\nimport { ExchangeMessage } from '../../types';\nimport { Theme } from '../../styles';\nimport { lastHeader } from '../../util/headers';\n\nimport { getBaseContentType } from './content-types';\n\nimport { HTKEventBase } from './event-base';\nimport { HttpExchange, SuccessfulExchange } from '../http/exchange';\n\nexport const getMessageBaseAcceptTypes = (message: ExchangeMessage) =>\n    (lastHeader(message.headers['accept'])?.split(',') || [])\n        .map((acceptType) => getBaseContentType(acceptType));\n\nexport const getMessageBaseContentType = (message: ExchangeMessage) =>\n    getBaseContentType(lastHeader(message.headers['content-type']));\n\nconst isMutatativeExchange = (exchange: HttpExchange) => _.includes([\n    'POST',\n    'PATCH',\n    'PUT',\n    'DELETE'\n], exchange.request.method);\n\nconst isImageExchange = (exchange: SuccessfulExchange) => {\n    const requestAcceptTypes = getMessageBaseAcceptTypes(exchange.request);\n    if (\n        requestAcceptTypes.length > 0 &&\n        requestAcceptTypes.every(type => type.startsWith('image/'))\n    ) {\n        return true;\n    }\n\n    else if (exchange.request.headers['sec-fetch-dest'] === 'image') return true;\n\n    else return getMessageBaseContentType(exchange.response).startsWith('image/');\n}\n\nconst DATA_CONTENT_TYPES = [\n    'application/json',\n    'application/xml',\n    'application/rss',\n    'text/plain', // Not formally 'data', but usually used as such in practice\n    'text/xml',\n    'text/json',\n    'multipart/form-data',\n    'application/x-www-form-urlencoded',\n    'application/x-protobuf'\n];\n\nconst isDataExchange = (exchange: SuccessfulExchange) => {\n    const requestAcceptTypes = getMessageBaseAcceptTypes(exchange.request)\n    if (\n        requestAcceptTypes.length > 0 &&\n        requestAcceptTypes.every(type => DATA_CONTENT_TYPES.includes(type))\n    ) {\n        return true;\n    }\n\n    return _.includes(DATA_CONTENT_TYPES, getMessageBaseContentType(exchange.response));\n}\n\nconst isJSExchange = (exchange: SuccessfulExchange) =>\n    exchange.request.headers['sec-fetch-dest'] === 'script' ||\n    _.includes([\n        'text/javascript',\n        'application/javascript',\n        'application/x-javascript',\n        'application/ecmascript'\n    ], getMessageBaseContentType(exchange.response));\n\nconst isCSSExchange = (exchange: SuccessfulExchange) =>\n    exchange.request.headers['sec-fetch-dest'] === 'style' ||\n    _.includes([\n        'text/css'\n    ], getMessageBaseContentType(exchange.response));\n\nconst isHTMLExchange = (exchange: SuccessfulExchange) =>\n    exchange.request.headers['sec-fetch-dest'] === 'document' ||\n    getMessageBaseContentType(exchange.response) === 'text/html';\n\nconst isFontExchange = (exchange: SuccessfulExchange) =>\n    exchange.request.headers['sec-fetch-dest'] === 'font' ||\n    getMessageBaseContentType(exchange.response).startsWith('font/') ||\n    _.includes([\n        'application/font-woff',\n        'application/x-font-woff',\n        'application/font-otf',\n        'application/font',\n        'application/vnd.ms-fontobject',\n        'application/x-font-ttf',\n        'application/x-font-typetype',\n        'application/x-font-opentype',\n    ], getMessageBaseContentType(exchange.response));\n\nexport const EventCategories = [\n    'image',\n    'js',\n    'css',\n    'html',\n    'font',\n    'data',\n    'rtc-data',\n    'rtc-media',\n    'mutative',\n    'websocket',\n    'incomplete',\n    'aborted',\n    'unknown'\n] as const;\nexport type EventCategory = typeof EventCategories[number];\n\nexport function getEventCategory(event: HTKEventBase): EventCategory {\n    if (event.isHttp()) {\n        if (!event.isCompletedExchange()) {\n            if (isMutatativeExchange(event)) {\n                return 'mutative';\n            } else {\n                return 'incomplete';\n            }\n        } else if (!event.isSuccessfulExchange()) {\n            return 'aborted';\n        } else if (event.isWebSocket()) {\n            return 'websocket';\n        } else if (isMutatativeExchange(event)) {\n            return 'mutative';\n        } else if (isImageExchange(event)) {\n            return 'image';\n        } else if (isJSExchange(event)) {\n            return 'js';\n        } else if (isCSSExchange(event)) {\n            return 'css';\n        } else if (isHTMLExchange(event)) {\n            return 'html';\n        } else if (isFontExchange(event)) {\n            return 'font';\n        } else if (isDataExchange(event)) {\n            return 'data';\n        }\n    } else if (event.isRTCDataChannel()) {\n        return 'rtc-data';\n    } else if (event.isRTCMediaTrack()) {\n        return 'rtc-media';\n    }\n\n    return 'unknown';\n};\n\nexport function describeEventCategory(category: EventCategory) {\n    const categoryColour = getSummaryColour(category);\n    const colourName = _.startCase(_.findKey(highlights, (c) => c === categoryColour)!);\n\n    return `${colourName}: ${({\n        \"mutative\": \"a request that might affect the server state (unlike a GET request)\",\n        \"incomplete\": \"an incomplete request\",\n        \"aborted\": \"an aborted request\",\n        \"image\": \"a request for an image\",\n        \"js\": \"a request for JavaScript\",\n        \"css\": \"a request for CSS\",\n        \"html\": \"a request for HTML\",\n        \"font\": \"a request for a font file\",\n        \"data\": \"an API request\",\n        \"websocket\": \"a WebSocket stream\",\n        \"rtc-data\": \"a WebRTC data stream\",\n        \"rtc-media\": \"a WebRTC media stream\",\n        \"unknown\": \"an unknown type of request\"\n    } as const)[category]}`;\n}\n\nconst highlights = {\n    black: '#000',\n    grey: '#888',\n    red: '#ce3939',\n    lightGreen: '#4caf7d',\n    brightGreen: '#409309',\n    orange: '#ff8c38',\n    yellow: '#e9f05b',\n    lightBlue: '#2fb4e0',\n    darkBlue: '#5a80cc',\n    purple: '#6e40aa',\n    pink: '#dd3a96'\n};\n\nexport function getSummaryColour(exchangeOrCategory: HttpExchange | EventCategory): string {\n    const category = typeof exchangeOrCategory === 'string' ?\n        exchangeOrCategory : exchangeOrCategory.category;\n\n    switch (category) {\n        case 'incomplete':\n        case 'aborted':\n            return highlights.black;\n        case 'mutative':\n            return highlights.red;\n        case 'data':\n        case 'rtc-data':\n            return highlights.purple;\n        case 'websocket':\n            return highlights.lightBlue;\n        case 'image':\n            return highlights.lightGreen;\n        case 'font':\n        case 'rtc-media':\n            return highlights.brightGreen;\n        case 'js':\n            return highlights.orange;\n        case 'css':\n            return highlights.yellow;\n        case 'html':\n            return highlights.darkBlue;\n        case 'unknown':\n            return highlights.grey;\n    }\n}\n\nexport function getStatusColor(status: undefined | 'aborted' | number, theme: Theme): string {\n    if (!status || status === 'aborted' || status < 100 || status >= 600) {\n        // All odd undefined/unknown cases\n        return theme.mainColor;\n    } else if (status >= 500) {\n        return highlights.red;\n    } else if (status >= 400) {\n        return highlights.orange;\n    } else if (status >= 300) {\n        return highlights.darkBlue;\n    } else if (status >= 200) {\n        return highlights.lightGreen;\n    } else if (status === 101) {\n        return highlights.lightBlue; // Almost always a websocket, so special case to match\n    } else if (status >= 100) {\n        return highlights.grey;\n    }\n\n    // Anything else weird.\n    return highlights.black;\n}\n\nexport function getWebSocketCloseColor(closeCode: undefined | 'aborted' | number, theme: Theme): string {\n    // See https://datatracker.ietf.org/doc/html/rfc6455#section-7.4.1 for definitions\n    if (!closeCode || closeCode === 'aborted') {\n        // All odd undefined/unknown cases\n        return theme.mainColor;\n    } else if (closeCode === 1000 || closeCode === 1001) {\n        // Closed OK or due to clean client/server shutdown\n        return highlights.lightGreen;\n    } else if (closeCode >= 1002 && closeCode <= 3000) {\n        // Closed due to some protocol errors\n        return highlights.red;\n    } else if (closeCode >= 3000) {\n        return highlights.orange;\n    }\n\n    // Anything else weird.\n    return highlights.black;\n}\n\nexport function getMethodColor(method: string): string {\n    if (method === 'GET') {\n        return highlights.lightGreen;\n    } else if (method === 'POST') {\n        return highlights.orange;\n    } else if (method === 'DELETE') {\n        return highlights.red;\n    } else if (method === 'PUT') {\n        return highlights.purple;\n    } else if (method === 'PATCH') {\n        return highlights.pink;\n    } else if (method === 'HEAD') {\n        return highlights.darkBlue;\n    } else if (method === 'OPTIONS') {\n        return highlights.lightBlue;\n    } else {\n        return highlights.grey;\n    }\n}","import * as _ from 'lodash';\n\nimport {\n    byteStreamToLines,\n    emptyStream,\n    parseJsonLinesStream\n} from '../util/streams';\n\nimport { RawHeaders } from '../types';\nimport {\n    ServerConfig,\n    NetworkInterfaces,\n    ServerInterceptor,\n    ApiError\n} from './server-api-types';\n\nimport {\n    RequestDefinition,\n    RequestOptions\n} from '../model/send/send-request-model';\nimport {\n    ResponseStreamEvent\n} from '../model/send/send-response-model';\n\nexport class RestApiClient {\n\n    constructor(\n        private authToken?: string\n    ) {}\n\n    private async apiRequest(\n        method: string,\n        path: string,\n        query: Record<string, number | string> = {},\n        body?: object\n    ) {\n        const operationName = `${method} ${path}`;\n\n        const response = await fetch(`http://127.0.0.1:45457${path}${\n            Object.keys(query).length\n                ? '?' + new URLSearchParams(_.mapValues(query, (v) => v.toString())).toString()\n                : ''\n        }`, {\n            method,\n            headers: {\n                ...(this.authToken ? {\n                    'Authorization': `Bearer ${this.authToken}`,\n                } : {}),\n                'content-type': 'application/json'\n            },\n            body: body\n                ? JSON.stringify(body)\n                : undefined\n        }).catch((e) => {\n            throw new ApiError(`fetch failed with '${e.message ?? e}'`, operationName);\n        });\n\n        if (!response.ok) {\n            const errorBody: {\n                error?: {\n                    message?: string,\n                    code?: string\n                }\n            } | null = await response.json().catch(e => null);\n\n            console.error(response.status, errorBody);\n\n            throw new ApiError(\n                `unexpected ${response.status} ${response.statusText} - ${\n                    errorBody?.error?.code\n                        ? `${errorBody?.error?.code} -`\n                        : ''\n                }${\n                    errorBody?.error?.message ?? '[unknown]'\n                }`,\n                operationName,\n                response.status\n            );\n        }\n\n        return response;\n    }\n\n    private async apiJsonRequest<T extends {}>(\n        method: string,\n        path: string,\n        query: Record<string, number | string> = {},\n        body?: object\n    ): Promise<T> {\n        return await (\n            await this.apiRequest(method, path, query, body)\n        ).json() as T;\n    }\n\n    private async apiNdJsonRequest<T extends {}>(\n        method: string,\n        path: string,\n        query: Record<string, number | string> = {},\n        body?: object\n    ): Promise<ReadableStream<T>> {\n        const response = await this.apiRequest(method, path, query, body);\n\n        if (!response.body) return emptyStream();\n\n        return parseJsonLinesStream(\n            byteStreamToLines(response.body)\n        );\n    }\n\n    async getServerVersion(): Promise<string> {\n        const response = await this.apiJsonRequest<{\n            version: string\n        }>('get', '/version');\n        return response.version;\n    }\n\n    async getConfig(proxyPort: number) {\n        const response = await this.apiJsonRequest<{\n            config: ServerConfig\n        }>('GET', '/config', { proxyPort: proxyPort });\n\n        return response.config;\n    }\n\n    async getNetworkInterfaces() {\n        const response = await this.apiJsonRequest<{\n            networkInterfaces: NetworkInterfaces\n        }>('GET', '/config/network-interfaces');\n\n        return response.networkInterfaces;\n    }\n\n    async getInterceptors(proxyPort: number) {\n        const response = await this.apiJsonRequest<{\n            interceptors: ServerInterceptor[]\n        }>('GET', '/interceptors', { proxyPort });\n\n        return response.interceptors;\n    }\n\n    async getDetailedInterceptorMetadata<M extends unknown>(id: string): Promise<M | undefined> {\n        const response = await this.apiJsonRequest<{\n            interceptorMetadata: M\n        }>('GET', `/interceptors/${id}/metadata`);\n\n        return response.interceptorMetadata;\n    }\n\n    async activateInterceptor(id: string, proxyPort: number, options?: any) {\n        const response = await this.apiJsonRequest<{\n            result: { success: boolean, metadata: unknown }\n        }>('POST', `/interceptors/${id}/activate/${proxyPort}`, {}, options);\n\n        return response.result;\n    }\n\n    async sendRequest(\n        requestDefinition: RequestDefinition,\n        requestOptions: RequestOptions\n    ) {\n        const requestDefinitionData = {\n            ...requestDefinition,\n            rawBody: requestDefinition.rawBody?.toString('base64')\n        }\n\n        const requestOptionsData = {\n            ...requestOptions,\n            ...(requestOptions.clientCertificate ? {\n                clientCertificate: {\n                    ...requestOptions.clientCertificate,\n                    pfx: requestOptions.clientCertificate.pfx.toString('base64')\n                }\n            } : {})\n        }\n\n        const responseDataStream = await this.apiNdJsonRequest<ResponseStreamEventData>(\n            'POST', '/client/send', {}, {\n                request: requestDefinitionData,\n                options: requestOptionsData\n            }\n        );\n\n        const dataStreamReader = responseDataStream.getReader();\n        return new ReadableStream<ResponseStreamEvent>({\n            async pull(controller) {\n                const { done, value } = await dataStreamReader.read();\n                if (done) return controller.close();\n\n                if (value.type === 'response-body-part') {\n                    controller.enqueue({\n                        ...value,\n                        rawBody: Buffer.from(value.rawBody, 'base64')\n                    });\n                } else {\n                    controller.enqueue(value);\n                }\n            },\n            cancel(reason) {\n                responseDataStream.cancel(reason);\n            }\n        });\n    }\n\n    async triggerServerUpdate() {\n        await this.apiJsonRequest<{}>('POST', '/update');\n    }\n}\n\ntype ResponseStreamEventData =\n    | RequestStartData\n    | ResponseHeadData\n    | ResponseBodyPartData\n    | ResponseEndData;\n\ninterface RequestStartData {\n    type: 'request-start';\n    startTime: number;\n    timestamp: number;\n}\n\ninterface ResponseHeadData {\n    type: 'response-head';\n    statusCode: number;\n    statusMessage?: string;\n    headers: RawHeaders;\n    timestamp: number;\n}\n\ninterface ResponseBodyPartData {\n    type: 'response-body-part';\n    rawBody: string; // base64\n    timestamp: number;\n}\n\ninterface ResponseEndData {\n    type: 'response-end';\n    timestamp: number;\n}\n\n","import * as Mockttp from 'mockttp';\nimport * as serializr from 'serializr';\n\nimport { RawHeaders } from \"../../types\";\nimport { EditableContentType } from \"../events/content-types\";\n\n// This is our model of a Request for sending. Smilar to the API model,\n// but not identical, as we add extra UI metadata etc.\nexport interface RequestInput {\n    method: string;\n    url: string;\n\n    /**\n     * The raw headers to send. These will be sent exactly as provided - no headers\n     * will be added automatically.\n     *\n     * Note that this means omitting the 'Host' header may cause problems, as will\n     * omitting both 'Content-Length' and 'Transfer-Encoding' on requests with\n     * bodies.\n     */\n    headers: RawHeaders;\n\n    requestContentType: EditableContentType;\n    rawBody: Buffer;\n}\n\n// The schema to use to serialize the above as JSON.\nexport const requestInputSchema = serializr.createSimpleSchema({\n    url: serializr.raw(),\n    method: serializr.raw(),\n    headers: serializr.raw(),\n    requestContentType: serializr.raw(),\n    // Serialize as Base64 - needs to be something we can put into JSON:\n    rawBody: serializr.custom(\n        (buffer) => buffer.toString('base64'),\n        (base64Data) => Buffer.from(base64Data, 'base64')\n    )\n});\n\n// These are the types that the sever client API expects. They are _not_ the same as\n// the Input type above, which is more flexible and includes various UI concerns that\n// we don't need to share with the server to actually send the request.\nexport interface RequestDefinition {\n    method: string;\n    url: string;\n    headers: RawHeaders;\n    rawBody?: Buffer;\n}\n\nexport interface RequestOptions {\n    ignoreHostHttpsErrors?: string[] | boolean;\n    trustAdditionalCAs?: Array<{ cert: string }>;\n    clientCertificate?: { pfx: Buffer, passphrase?: string };\n    proxyConfig?: ClientProxyConfig;\n    lookupOptions?: { servers?: string[] };\n}\n\nexport const RULE_PARAM_REF_KEY = '__rule_param_reference__';\ntype ClientProxyRuleParamReference = { [RULE_PARAM_REF_KEY]: string };\n\nexport type ClientProxyConfig =\n    | undefined // No Docker, no user or system proxy\n    | Mockttp.ProxySetting // User or system proxy\n    | ClientProxyRuleParamReference // Docker proxy (must be dereferenced)\n    | Array<Mockttp.ProxySetting | ClientProxyRuleParamReference> // Both, ordered","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { observable, autorun, action } from 'mobx';\nimport { disposeOnUnmount, observer } from 'mobx-react';\nimport type { SchemaObject } from 'openapi-directory';\nimport * as portals from 'react-reverse-portal';\n\nimport { ExchangeMessage } from '../../../types';\n\nimport { ErrorLike } from '../../../util/error';\nimport { getHeaderValue, lastHeader } from '../../../util/headers';\n\nimport { ViewableContentType, getCompatibleTypes } from '../../../model/events/content-types';\n\nimport { CollapsibleCard, ExpandableCardProps } from '../../common/card';\n\nimport {\n    EditorCardContent,\n    ReadonlyBodyCardHeader,\n    getBodyDownloadFilename,\n    BodyDecodingErrorBanner\n} from '../../editor/body-card-components';\n\nimport { LoadingCard } from '../../common/loading-card';\nimport { ContentViewer } from '../../editor/content-viewer';\nimport { SelfSizedEditor } from '../../editor/base-editor';\n\n// A selection of content types you might want to try out, to explore your encoded data:\nconst ENCODED_DATA_CONTENT_TYPES = ['text', 'raw', 'base64', 'image'] as Array<ViewableContentType>;\n\n@observer\nexport class HttpBodyCard extends React.Component<ExpandableCardProps & {\n    title: string,\n    direction?: 'left' | 'right',\n    onCollapseToggled: () => void,\n\n    isPaidUser: boolean,\n    url: string,\n    message: ExchangeMessage,\n    apiBodySchema?: SchemaObject,\n    editorNode: portals.HtmlPortalNode<typeof SelfSizedEditor>\n}> {\n\n    @observable\n    private selectedContentType: ViewableContentType | undefined;\n\n    componentDidMount() {\n        disposeOnUnmount(this, autorun(() => {\n            const message = this.props.message;\n\n            if (!message) {\n                this.onChangeContentType(undefined);\n                return;\n            }\n        }));\n    }\n\n    @action.bound\n    onChangeContentType(contentType: ViewableContentType | undefined) {\n        if (contentType === this.props.message.contentType) {\n            this.selectedContentType = undefined;\n        } else {\n            this.selectedContentType = contentType;\n        }\n    }\n\n    render() {\n        const {\n            title,\n            url,\n            message,\n            apiBodySchema,\n            direction,\n            isPaidUser,\n            collapsed,\n            expanded,\n            onCollapseToggled,\n            onExpandToggled\n        } = this.props;\n\n        const compatibleContentTypes = getCompatibleTypes(\n            message.contentType,\n            lastHeader(message.headers['content-type']),\n            message.body\n        );\n        const decodedContentType = compatibleContentTypes.includes(this.selectedContentType!)\n            ? this.selectedContentType!\n            : message.contentType;\n\n        const decodedBody = message.body.decoded;\n\n        if (decodedBody) {\n            // We have successfully decoded the body content, show it:\n            return <CollapsibleCard\n                direction={direction}\n                collapsed={collapsed}\n                onCollapseToggled={onCollapseToggled}\n                expanded={expanded}\n            >\n                <header>\n                    <ReadonlyBodyCardHeader\n                        body={decodedBody}\n                        mimeType={getHeaderValue(message.headers, 'content-type')}\n                        downloadFilename={getBodyDownloadFilename(url, message.headers)}\n\n                        title={title}\n                        expanded={!!expanded}\n                        onExpandToggled={onExpandToggled}\n                        onCollapseToggled={onCollapseToggled}\n\n                        selectedContentType={decodedContentType}\n                        contentTypeOptions={compatibleContentTypes}\n                        onChangeContentType={this.onChangeContentType}\n\n                        isPaidUser={isPaidUser}\n                    />\n                </header>\n                <EditorCardContent>\n                    <ContentViewer\n                        contentId={`${message.id}-${direction}`}\n                        editorNode={this.props.editorNode}\n                        rawContentType={lastHeader(message.headers['content-type'])}\n                        contentType={decodedContentType}\n                        schema={apiBodySchema}\n                        expanded={!!expanded}\n                        cache={message.cache}\n                    >\n                        {decodedBody}\n                    </ContentViewer>\n                </EditorCardContent>\n            </CollapsibleCard>;\n        } else if (!decodedBody && message.body.decodingError) {\n            // We have failed to decode the body content! Show the error & raw encoded data instead:\n            const error = message.body.decodingError as ErrorLike;\n            const encodedBody = Buffer.isBuffer(message.body.encoded)\n                ? message.body.encoded\n                : undefined;\n\n            const encodedDataContentType = ENCODED_DATA_CONTENT_TYPES.includes(this.selectedContentType!)\n                ? this.selectedContentType!\n                : 'text';\n\n            return <CollapsibleCard\n                direction={direction}\n                collapsed={collapsed}\n                onCollapseToggled={onCollapseToggled}\n                expanded={expanded}\n            >\n                <header>\n                    <ReadonlyBodyCardHeader\n                        body={encodedBody}\n                        mimeType={'application/octet-stream'} // Ignore content type, as it's encoded\n                        downloadFilename={getBodyDownloadFilename(url, message.headers)}\n\n                        title={title}\n                        expanded={expanded}\n                        onExpandToggled={onExpandToggled}\n                        onCollapseToggled={onCollapseToggled}\n\n                        selectedContentType={encodedDataContentType}\n                        contentTypeOptions={ENCODED_DATA_CONTENT_TYPES}\n                        onChangeContentType={this.onChangeContentType}\n\n                        isPaidUser={isPaidUser}\n                    />\n                </header>\n                <BodyDecodingErrorBanner\n                    direction={this.props.direction}\n                    error={error}\n                    headers={message.rawHeaders}\n                />\n                { encodedBody &&\n                    <EditorCardContent>\n                        <ContentViewer\n                            contentId={`${message.id}-${direction}`}\n                            editorNode={this.props.editorNode}\n                            contentType={encodedDataContentType}\n                            expanded={!!expanded}\n                            cache={message.cache}\n                        >\n                            { encodedBody }\n                        </ContentViewer>\n                    </EditorCardContent>\n                }\n            </CollapsibleCard>;\n        } else {\n            // No body content, but no error yet, show a loading spinner:\n            return <LoadingCard\n                direction={direction}\n                collapsed={collapsed}\n                onCollapseToggled={onCollapseToggled}\n                expanded={expanded}\n            >\n                <header>\n                    <ReadonlyBodyCardHeader\n                        body={undefined}\n\n                        title={title}\n                        expanded={!!expanded}\n                        onExpandToggled={onExpandToggled}\n                        onCollapseToggled={onCollapseToggled}\n\n                        selectedContentType={decodedContentType}\n                        contentTypeOptions={compatibleContentTypes}\n                        onChangeContentType={this.onChangeContentType}\n                        isPaidUser={isPaidUser}\n                    />\n                </header>\n            </LoadingCard>;\n        }\n    }\n\n}","import { observable, createAtom, IAtom, computed, IComputedValueOptions, IComputedValue } from 'mobx';\nimport { IPromiseBasedObservable, fromPromise, PromiseState } from 'mobx-utils';\n\nimport { Omit } from '../types';\nimport { getDeferred } from './promise';\n\nexport type ObservablePromise<T> =\n    Omit<\n        IPromiseBasedObservable<T>,\n        'then' | 'catch' | 'value'\n    > & {\n        value: T | Error | undefined,\n        then<TResult1 = T, TResult2 = never>(\n            onfulfilled?: ((value: T) => TResult1 | PromiseLike<TResult1>) | undefined | null,\n            onrejected?: ((reason: any) => TResult2 | PromiseLike<TResult2>) | undefined | null\n        ): ObservablePromise<TResult1 | TResult2>;\n        catch<TResult = never>(\n            onrejected?: ((reason: any) => TResult | PromiseLike<TResult>) | undefined | null\n        ): ObservablePromise<T | TResult>;\n    };\n\nexport function observablePromise<T>(p: Promise<T> |  ObservablePromise<T>): ObservablePromise<T> {\n    const observable = fromPromise(p) as ObservablePromise<T>;\n\n    const originalThen = observable.then;\n    observable.then = function (this: ObservablePromise<T>): any {\n        const result = originalThen.apply(this, arguments as any);\n        return observablePromise(result);\n    }\n\n    const originalCatch = observable.catch;\n    observable.catch = <any>function (this: ObservablePromise<T>) {\n        const result = originalCatch.apply(this, arguments as any);\n        return observablePromise(result);\n    }\n\n    return observable;\n}\n\nexport function isObservablePromise<T>(p: any): p is ObservablePromise<T> {\n    return typeof p === 'object' &&\n        'then' in p &&\n        'catch' in p &&\n        'case' in p &&\n        'value' in p &&\n        'state' in p;\n}\n\n// Creates an observable promise which doesn't run until somebody tries\n// to check the value or wait for it to resolve somehow.\nexport function lazyObservablePromise<T>(p: () => PromiseLike<T>): ObservablePromise<T> {\n    const { resolve: trigger, promise: triggerPromise } = getDeferred();\n\n    const lazyPromise = observablePromise(triggerPromise.then(p));\n\n    ([\n        'then',\n        'catch',\n        'case'\n    ] as Array<'then' | 'catch' | 'case'>).forEach((methodName) => {\n        const originalMethod = lazyPromise[methodName] as Function;\n        lazyPromise[methodName] = function (this: ObservablePromise<T>): any {\n            trigger();\n            return originalMethod.apply(this, arguments);\n        };\n    });\n\n    let value = observable.box<T | Error | undefined>();\n    Object.defineProperty(lazyPromise, 'value', {\n        get: () => {\n            trigger();\n            return value.get();\n        },\n        set: (newValue) => {\n            trigger();\n            value.set(newValue);\n        }\n    });\n\n    let state = observable.box<PromiseState>();\n    Object.defineProperty(lazyPromise, 'state', {\n        get: () => {\n            trigger();\n            return state.get();\n        },\n        set: (newState) => {\n            trigger();\n            state.set(newState);\n        }\n    });\n\n    return lazyPromise;\n}\n\nfunction debounced<T>(fn: () => T, timeoutMs: number): () => T {\n    let cachedValue: { value: T, atom: IAtom } | undefined;\n\n    return function (this: any) {\n        if (cachedValue) {\n            cachedValue.atom.reportObserved();\n        } else {\n            // Calculate and cache the result:\n            cachedValue = {\n                value: fn.apply(this),\n                atom: createAtom(\"DebounceAtom\")\n            };\n\n            // Batch subsequent runs for the next timeoutMs:\n            setTimeout(() => {\n                const { atom } = cachedValue!;\n                cachedValue = undefined;\n                atom.reportChanged(); // Ping subscribers to update\n            }, timeoutMs);\n        }\n        return cachedValue.value;\n    }\n}\n\nexport function debounceComputed<T>(timeoutMs: number, computedOptions?: IComputedValueOptions<T>): MethodDecorator;\nexport function debounceComputed<T>(callback: () => T, timeoutMs: number, computedOptions?: IComputedValueOptions<T>): IComputedValue<T>;\nexport function debounceComputed<T>(\n    cbOrTimeout: number | (() => T),\n    optionsOrTimeout?: IComputedValueOptions<T> | number,\n    maybeOptions?: IComputedValueOptions<T>\n): MethodDecorator | IComputedValue<T> {\n    let fn: () => T;\n    let timeoutMs: number;\n    let computedOptions: IComputedValueOptions<T>;\n\n    if (typeof cbOrTimeout === 'number') {\n        timeoutMs = cbOrTimeout;\n        computedOptions = (optionsOrTimeout as IComputedValueOptions<T>) ?? {};\n\n        return <T>(target: any, key: string | symbol, descriptor: TypedPropertyDescriptor<T>): void => {\n            if (!descriptor.get) throw new Error('debounceComputed requires a getter');\n            return computed(computedOptions)(target, key, {\n                ...descriptor,\n                get: debounced(descriptor.get, timeoutMs)\n            });\n        };\n    } else {\n        fn = cbOrTimeout;\n        timeoutMs = optionsOrTimeout as number;\n        computedOptions = maybeOptions ?? {};\n\n        return computed(debounced(fn, timeoutMs), computedOptions);\n    }\n}","/*\n * SPDX-FileCopyrightText: 2022 Tim Perry <tim@httptoolkit.com>\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport _ from 'lodash';\nimport {\n    matchers,\n    completionCheckers,\n    RequestRuleData\n} from 'mockttp';\nimport * as serializr from 'serializr';\n\nimport { byteLength } from '../../../util';\nimport {\n    HttpHandlerLookup\n} from './http-rule-definitions';\n\nexport const IpfsInteractions = {\n    'cat': \"Read IPFS content\",\n    'add': 'Add a file or directory to IPFS',\n    'name/resolve': 'Resolve an IPNS name',\n    'name/publish': 'Publish an IPNS name',\n    'pin/add': 'Pin some IPFS content',\n    'pin/rm': 'Unpin some IPFS content',\n    'pin/ls': 'List the pinned IPFS content'\n};\n\nexport type IpfsInteraction = keyof typeof IpfsInteractions;\n\nexport class IpfsInteractionMatcher extends matchers.SimplePathMatcher {\n\n    readonly uiType = 'ipfs-interaction';\n\n    constructor(\n        public readonly interactionName: IpfsInteraction = 'cat',\n    ) {\n        super(`/api/v0/${interactionName}`);\n    }\n\n    explain() {\n        return `IPFS ${this.interactionName} requests`;\n    }\n\n}\n\nexport const IpfsArgDescription: {\n    [I in IpfsInteraction]?: { argType: string, placeholder: string }\n} = {\n    'cat': {\n        argType: 'IPFS path',\n        placeholder: 'The path to the IPFS object(s) to be read'\n    },\n    'name/resolve': {\n        // ^ Technically not required, but very unusual to not specify I think\n        argType: 'IPNS name',\n        placeholder: 'The IPNS name to resolve'\n    },\n    'name/publish': {\n        argType: 'IPFS path',\n        placeholder: 'The IPFS path of the object to be published'\n    },\n    'pin/add': {\n        argType: 'IPFS path',\n        placeholder: 'The IPFS path to the object(s) to be pinned',\n    },\n    'pin/rm': {\n        argType: 'IPFS path',\n        placeholder: 'The IPFS path to the object(s) to be unpinned'\n    }\n};\n\nexport const shouldSuggestArgMatcher = (interaction: IpfsInteraction) =>\n    Object.keys(IpfsArgDescription).includes(interaction);\n\nexport class IpfsArgMatcher extends matchers.QueryMatcher {\n\n    readonly uiType = 'ipfs-arg';\n\n    constructor(\n        public readonly interaction: IpfsInteraction,\n        public readonly argValue: string | undefined = undefined,\n    ) {\n        super(argValue ? { arg: argValue } : {});\n    }\n\n    explain() {\n        return `for ${\n            this.argValue\n            ?? `any ${IpfsArgDescription[this.interaction]?.argType ?? 'value'}`\n        }`;\n    }\n\n}\n\nconst buildIpfsFixedValueDefaultHeaders = (body?: string | Buffer) => ({\n    'cache-control': 'no-cache',\n    'connection': 'close',\n    'date': new Date().toUTCString(),\n    'content-type': 'application/json; charset=utf-8',\n    ...(body !== undefined\n        ? { 'content-length': byteLength(body).toString() }\n        : {}\n    )\n});\n\nconst buildIpfsStreamDefaultHeaders = () => ({\n    'cache-control': 'no-cache',\n    'connection': 'close',\n    'date': new Date().toUTCString(),\n    'content-type': 'application/json; charset=utf-8',\n    'transfer-encoding': 'chunked',\n    // 'trailer': 'X-Stream-Error',\n    // ^ This is normally present but we skip it for now, since it causes issues with Node 18:\n    // https://github.com/nodejs/undici/issues/1418\n    'x-chunked-output': '1'\n});\n\n// When extending simple handlers, we need to provide a schema to avoid this being deserialized using\n// StaticResponseHandler's explicit schema, which is required to handle buffers nicely, but results\n// in the wrong class for the deserialized instances.\nconst simpleHandlerSchema = serializr.getDefaultModelSchema(HttpHandlerLookup['simple']);\n\nexport class IpfsCatTextHandler extends HttpHandlerLookup['simple'] {\n\n    readonly uiType = 'ipfs-cat-text';\n\n    constructor(\n        public readonly result: string | Buffer\n    ) {\n        super(\n            200,\n            undefined,\n            result,\n            buildIpfsFixedValueDefaultHeaders(result)\n        );\n    }\n\n    explain() {\n        return `Return fixed IPFS content`;\n    }\n\n}\nserializr.createModelSchema(IpfsCatTextHandler, simpleHandlerSchema.props, () => new IpfsCatTextHandler(''));\n\nexport class IpfsCatFileHandler extends HttpHandlerLookup['file'] {\n\n    readonly uiType = 'ipfs-cat-file';\n\n    constructor(\n        public readonly path: string\n    ) {\n        super(\n            200,\n            undefined,\n            path,\n            buildIpfsFixedValueDefaultHeaders()\n        );\n    }\n\n    explain() {\n        return `Return IPFS content from ${this.path || 'a file'}`;\n    }\n\n}\n\nexport class IpfsAddResultHandler extends HttpHandlerLookup['simple'] {\n\n    readonly uiType = 'ipfs-add-result';\n\n    constructor(\n        public readonly result: Array<{ Name: string, Hash: string }> = [{\n            Name: 'uploaded-file.txt',\n            Hash: 'QmXoypizjW3WknFiJnKLwHCnL72vedxjQkDDP1mXWo6uco'\n        }]\n    ) {\n        super(\n            200,\n            undefined,\n            result.map(json => JSON.stringify(json)).join('\\n'),\n            buildIpfsStreamDefaultHeaders()\n        )\n    }\n\n    explain() {\n        return `Return ${\n            this.result.length === 0\n                ? 'an empty'\n                : 'fixed'\n         } IPFS add result${\n            this.result.length > 1\n                ? 's'\n                : ''\n        }`;\n    }\n\n}\n\nserializr.createModelSchema(IpfsAddResultHandler, simpleHandlerSchema.props, () => new IpfsAddResultHandler());\n\nexport class IpnsResolveResultHandler extends HttpHandlerLookup['simple'] {\n\n    readonly uiType = 'ipns-resolve-result';\n\n    constructor(\n        public readonly result: object = {\n            Path: '/ipfs/QmXoypizjW3WknFiJnKLwHCnL72vedxjQkDDP1mXWo6uco'\n        }\n    ) {\n        super(\n            200,\n            undefined,\n            JSON.stringify(result),\n            buildIpfsFixedValueDefaultHeaders(JSON.stringify(result))\n        )\n    }\n\n    explain() {\n        return `Return a fixed IPNS resolved address`;\n    }\n\n}\n\nserializr.createModelSchema(IpnsResolveResultHandler, simpleHandlerSchema.props, () => new IpnsResolveResultHandler());\n\nexport class IpnsPublishResultHandler extends HttpHandlerLookup['simple'] {\n\n    readonly uiType = 'ipns-publish-result';\n\n    constructor(\n        public readonly result: object = {\n            Name: 'QmY7Yh4UquoXHLPFo2XbhXkhBvFoPwmQUSa92pxnxjQuPU',\n            Value: '/ipfs/QmXoypizjW3WknFiJnKLwHCnL72vedxjQkDDP1mXWo6uco'\n        }\n    ) {\n        super(\n            200,\n            undefined,\n            JSON.stringify(result),\n            buildIpfsFixedValueDefaultHeaders(JSON.stringify(result))\n        )\n    }\n\n    explain() {\n        return `Return a fixed IPNS resolve result`;\n    }\n\n}\n\nserializr.createModelSchema(IpnsPublishResultHandler, simpleHandlerSchema.props, () => new IpnsPublishResultHandler());\n\nexport class IpfsPinsResultHandler extends HttpHandlerLookup['simple'] {\n\n    readonly uiType = 'ipfs-pins-result';\n\n    constructor(\n        public readonly result: object = {\n            Pins: [\n                'QmXoypizjW3WknFiJnKLwHCnL72vedxjQkDDP1mXWo6uco'\n            ]\n        }\n    ) {\n        super(\n            200,\n            undefined,\n            JSON.stringify(result),\n            buildIpfsFixedValueDefaultHeaders(JSON.stringify(result))\n        )\n    }\n\n    explain() {\n        return `Return fixed IPFS pinning results`;\n    }\n\n}\n\nserializr.createModelSchema(IpfsPinsResultHandler, simpleHandlerSchema.props, () => new IpfsPinsResultHandler());\n\nexport class IpfsPinLsResultHandler extends HttpHandlerLookup['simple'] {\n\n    readonly uiType = 'ipfs-pin-ls-result';\n\n    constructor(\n        public readonly result: Array<{ Type: string, Cid: string }> = [\n            { Type: 'direct', Cid: 'QmXoypizjW3WknFiJnKLwHCnL72vedxjQkDDP1mXWo6uco' }\n        ]\n    ) {\n        super(\n            200,\n            undefined,\n            result.map(json => JSON.stringify(json)).join('\\n'),\n            buildIpfsStreamDefaultHeaders()\n        )\n    }\n\n    explain() {\n        return `Return fixed list of IPFS pins`;\n    }\n\n}\n\nserializr.createModelSchema(IpfsPinLsResultHandler, simpleHandlerSchema.props, () => new IpfsPinLsResultHandler());\n\nexport const IpfsMatcherLookup = {\n    'ipfs-interaction': IpfsInteractionMatcher,\n    'ipfs-arg': IpfsArgMatcher,\n    'query': matchers.QueryMatcher,\n    'exact-query-string': matchers.ExactQueryMatcher,\n\n    // The subset of relevant HTTP matchers:\n    'protocol': matchers.ProtocolMatcher,\n    'host': matchers.HostMatcher,\n    'hostname': matchers.HostnameMatcher,\n    'port': matchers.PortMatcher,\n    'header': matchers.HeaderMatcher,\n    'cookie': matchers.CookieMatcher\n};\n\nexport const IpfsInitialMatcherClasses = [\n    IpfsInteractionMatcher\n];\n\nexport const IpfsHandlerLookup = {\n    'ipfs-cat-text': IpfsCatTextHandler,\n    'ipfs-cat-file': IpfsCatFileHandler,\n    'ipfs-add-result': IpfsAddResultHandler,\n    'ipns-publish-result': IpnsPublishResultHandler,\n    'ipns-resolve-result': IpnsResolveResultHandler,\n    'ipfs-pins-result': IpfsPinsResultHandler,\n    'ipfs-pin-ls-result': IpfsPinLsResultHandler,\n\n    'passthrough': HttpHandlerLookup['passthrough'],\n    'forward-to-host': HttpHandlerLookup['forward-to-host'],\n    'timeout': HttpHandlerLookup['timeout'],\n    'close-connection': HttpHandlerLookup['close-connection'],\n    'request-breakpoint': HttpHandlerLookup['request-breakpoint'],\n    'response-breakpoint': HttpHandlerLookup['response-breakpoint'],\n    'request-and-response-breakpoint': HttpHandlerLookup['request-and-response-breakpoint']\n};\n\ntype IpfsMatcherClass = typeof IpfsMatcherLookup[keyof typeof IpfsMatcherLookup];\nexport type IpfsMatcher = InstanceType<IpfsMatcherClass>;\nexport type IpfsInitialMatcher = InstanceType<typeof IpfsInitialMatcherClasses[number]>;\n\ntype IpfsHandlerClass = typeof IpfsHandlerLookup[keyof typeof IpfsHandlerLookup];\ntype IpfsHandler = InstanceType<IpfsHandlerClass>;\n\nexport interface IpfsMockRule extends Omit<RequestRuleData, 'matchers'> {\n    id: string;\n    type: 'ipfs';\n    activated: boolean;\n    matchers: Array<IpfsMatcher> & { 0?: IpfsInteractionMatcher };\n    handler: IpfsHandler;\n    completionChecker: completionCheckers.Always; // HTK rules all *always* match\n}","import * as React from 'react';\n\nimport { styled } from '../../styles'\nimport { Icon, IconProp } from '../../icons';\n\nimport { UnstyledButton, UnstyledButtonLink } from './inputs';\n\nexport const IconButton = styled((p: {\n    className?: string,\n    title: string,\n    icon: IconProp,\n    disabled?: boolean,\n    fixedWidth?: boolean,\n    onClick: (e: React.MouseEvent<HTMLButtonElement>) => void\n}) =>\n    <UnstyledButton\n        className={p.className}\n        title={p.title}\n        tabIndex={p.disabled ? -1 : 0}\n        disabled={p.disabled}\n        onClick={p.onClick}\n    >\n        <Icon\n            icon={p.icon}\n            fixedWidth={p.fixedWidth ? true : false}\n        />\n    </UnstyledButton>\n)`\n    color: ${p => p.theme.mainColor};\n    font-size: ${p => p.theme.textSize};\n    padding: 5px 10px;\n\n    &:disabled {\n        opacity: 0.5;\n    }\n\n    &:not([disabled]) {\n        &:hover, &:focus {\n            outline: none;\n            color: ${p => p.theme.popColor};\n        }\n    }\n`;\n\nexport const IconButtonLink = styled((p: {\n    className?: string,\n    title: string,\n    icon: IconProp,\n    fixedWidth?: boolean,\n    href: string,\n    target?: string,\n    rel?: string\n}) =>\n    <UnstyledButtonLink\n        className={p.className}\n        title={p.title}\n        href={p.href}\n        target={p.target}\n        rel={p.rel}\n    >\n        <Icon\n            icon={p.icon}\n            fixedWidth={p.fixedWidth ? true : false}\n        />\n    </UnstyledButtonLink>\n)`\n    color: ${p => p.theme.mainColor};\n    font-size: ${p => p.theme.textSize};\n    padding: 5px 10px;\n\n    &:hover, &:focus {\n        outline: none;\n        color: ${p => p.theme.popColor};\n    }\n`;","/*\n * SPDX-FileCopyrightText: 2022 Tim Perry <tim@httptoolkit.com>\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport _ from 'lodash';\nimport {\n    matchers,\n    completionCheckers,\n    RequestRuleData\n} from 'mockttp';\nimport {\n    HttpHandlerLookup\n} from './http-rule-definitions';\nimport { encodeAbi } from './ethereum-abi';\n\nexport const EthereumMethods = {\n    'eth_call': 'Call a contract method (without a transaction)',\n    'eth_sendRawTransaction': 'Submit a signed transaction',\n    'eth_sendTransaction': 'Submit an unsigned transaction',\n    'eth_getTransactionReceipt': 'Return the receipt of a submitted transaction',\n    'eth_getBalance': 'Return the balance of an account',\n    'eth_gasPrice': 'Return the current gas price',\n    'eth_blockNumber': 'Return the latest block number',\n    'eth_getBlockByNumber': 'Return information about a block by number',\n    'eth_getBlockByHash': 'Return information about a block by hash'\n};\n\nexport type EthereumMethod = keyof typeof EthereumMethods;\n\nexport class EthereumMethodMatcher extends matchers.JsonBodyFlexibleMatcher {\n\n    readonly uiType = 'eth-method';\n\n    constructor(\n        public readonly methodName: EthereumMethod = 'eth_call'\n    ) {\n        super({\n            jsonrpc: '2.0',\n            method: methodName\n        });\n    }\n\n    explain() {\n        return `Ethereum ${this.methodName} requests`;\n    }\n\n}\n\nexport class EthereumParamsMatcher extends matchers.JsonBodyFlexibleMatcher {\n\n    readonly uiType = 'eth-params';\n\n    constructor(\n        public readonly params: any[]\n    ) {\n        super({ params });\n    }\n\n    explain() {\n        return `matching ${JSON.stringify(this.params)}`;\n    }\n\n}\n\nexport class EthereumCallResultHandler extends HttpHandlerLookup['json-rpc-response'] {\n\n    readonly uiType = 'eth-call-result';\n\n    constructor(\n        public readonly outputTypes: string[],\n        public readonly values: unknown[]\n    ) {\n        super({\n            result: encodeAbi(outputTypes, values)\n        });\n    }\n\n    explain() {\n        if (!this.values.length) {\n            return `Return an empty eth_call result`;\n        } else {\n            return `Return an eth_call result of ${this.values.join(', ')}`;\n        }\n    }\n\n}\n\nexport class EthereumNumberResultHandler extends HttpHandlerLookup['json-rpc-response'] {\n\n    readonly uiType = 'eth-number-result';\n\n    constructor(\n        public readonly value: number\n    ) {\n        super({\n            result: `0x${value.toString(16)}`\n        });\n    }\n\n    explain() {\n        return `Return ${this.value}`;\n    }\n\n}\n\nexport class EthereumHashResultHandler extends HttpHandlerLookup['json-rpc-response'] {\n\n    readonly uiType = 'eth-hash-result';\n\n    constructor(\n        public readonly value: string\n    ) {\n        super({\n            result: value\n        });\n    }\n\n    explain() {\n        return `Return transaction hash ${this.value}`;\n    }\n\n}\n\nexport class EthereumReceiptResultHandler extends HttpHandlerLookup['json-rpc-response'] {\n\n    readonly uiType = 'eth-receipt-result';\n\n    constructor(\n        public readonly receiptValue: object = {\n            // Default value, used to initialize a helpful placeholder\n            status: '0x1',\n            transactionHash: '012345',\n            blockNumber: '0x100',\n            blockHash: '0x1',\n            from: '0x0',\n            to: '0x0',\n            cumulativeGasUsed: '0x1',\n            gasUsed: '0x1',\n            effectiveGasPrice: '0x0',\n            contractAddress: null,\n            logs: [],\n            logsBloom: '0x0',\n            type: '0x0'\n        }\n    ) {\n        super({\n            result: receiptValue\n        });\n    }\n\n    explain() {\n        return `Return a fixed transaction receipt`;\n    }\n\n}\n\nexport class EthereumBlockResultHandler extends HttpHandlerLookup['json-rpc-response'] {\n\n    readonly uiType = 'eth-block-result';\n\n    constructor(\n        public readonly blockValue: object = {\n            // Default value, used to initialize a helpful placeholder\n            \"difficulty\": \"0x1\",\n            \"extraData\": \"0x0\",\n            \"gasLimit\": \"0x1\",\n            \"gasUsed\": \"0x1\",\n            \"hash\": \"0x1234\",\n            \"logsBloom\": \"0x0\",\n            \"miner\": \"0x1\",\n            \"mixHash\": \"0x0\",\n            \"nonce\": \"0x0\",\n            \"number\": \"0x0\",\n            \"parentHash\": \"0x1\",\n            \"receiptsRoot\": \"0x1\",\n            \"sha3Uncles\": \"0x1\",\n            \"size\": \"0x1\",\n            \"stateRoot\": \"0x1\",\n            \"timestamp\": \"0x1\",\n            \"totalDifficulty\": \"0x1\",\n            \"transactions\": [\n                \"0x1234\"\n            ],\n            \"transactionsRoot\": \"0x1\",\n            \"uncles\": []\n        }\n    ) {\n        super({\n            result: blockValue\n        });\n    }\n\n    explain() {\n        return `Return fixed block data`;\n    }\n\n}\n\nexport class EthereumErrorHandler extends HttpHandlerLookup['json-rpc-response'] {\n\n    readonly uiType = 'eth-error';\n\n    constructor(\n        public readonly message: string,\n        public readonly data = '0x',\n        public readonly code = -32099,\n        public readonly name: string | undefined = undefined\n    ) {\n        super({\n            error: {\n                message,\n                data,\n                code,\n                name\n            }\n        });\n    }\n\n    explain() {\n        return `Fail with ${this.message\n            ? `\"${this.message}\"`\n            : `code ${this.code}`\n        }`;\n    }\n\n}\n\nexport const EthereumMatcherLookup = {\n    'eth-method': EthereumMethodMatcher, // N.b. this is JSON-RPC method, not HTTP method\n    'eth-params': EthereumParamsMatcher,\n\n    // The subset of relevant HTTP matchers:\n    'protocol': matchers.ProtocolMatcher,\n    'host': matchers.HostMatcher,\n    'hostname': matchers.HostnameMatcher,\n    'port': matchers.PortMatcher,\n    'simple-path': matchers.SimplePathMatcher,\n    'regex-path': matchers.RegexPathMatcher,\n    'header': matchers.HeaderMatcher,\n    'query': matchers.QueryMatcher,\n    'exact-query-string': matchers.ExactQueryMatcher,\n    'cookie': matchers.CookieMatcher\n};\n\nexport const EthereumInitialMatcherClasses = [\n    EthereumMethodMatcher\n];\n\nexport const EthereumHandlerLookup = {\n    'eth-call-result': EthereumCallResultHandler,\n    'eth-number-result': EthereumNumberResultHandler,\n    'eth-hash-result': EthereumHashResultHandler,\n    'eth-receipt-result': EthereumReceiptResultHandler,\n    'eth-block-result': EthereumBlockResultHandler,\n    'eth-error': EthereumErrorHandler,\n\n    'passthrough': HttpHandlerLookup['passthrough'],\n    'forward-to-host': HttpHandlerLookup['forward-to-host'],\n    'timeout': HttpHandlerLookup['timeout'],\n    'close-connection': HttpHandlerLookup['close-connection'],\n    'request-breakpoint': HttpHandlerLookup['request-breakpoint'],\n    'response-breakpoint': HttpHandlerLookup['response-breakpoint'],\n    'request-and-response-breakpoint': HttpHandlerLookup['request-and-response-breakpoint']\n};\n\ntype EthereumMatcherClass = typeof EthereumMatcherLookup[keyof typeof EthereumMatcherLookup];\nexport type EthereumMatcher = InstanceType<EthereumMatcherClass>;\nexport type EthereumInitialMatcher = InstanceType<typeof EthereumInitialMatcherClasses[number]>;\n\ntype EthereumHandlerClass = typeof EthereumHandlerLookup[keyof typeof EthereumHandlerLookup];\ntype EthereumHandler = InstanceType<EthereumHandlerClass>;\n\nexport interface EthereumMockRule extends Omit<RequestRuleData, 'matchers'> {\n    id: string;\n    type: 'ethereum';\n    activated: boolean;\n    matchers: Array<EthereumMatcher> & { 0?: EthereumMethodMatcher };\n    handler: EthereumHandler;\n    completionChecker: completionCheckers.Always; // HTK rules all *always* match\n}","export function clear() {\n    return new Promise((resolve, reject) => {\n        try {\n            window.localStorage.clear()\n            resolve(null)\n        } catch (err) {\n            reject(err)\n        }\n    })\n}\n\nexport function getItem(key: string): Promise<string | null> {\n    return new Promise((resolve, reject) => {\n        try {\n            const value = window.localStorage.getItem(key)\n            resolve(value)\n        } catch (err) {\n            reject(err)\n        }\n    })\n}\n\nexport function removeItem(key: string) {\n    return new Promise((resolve, reject) => {\n        try {\n            window.localStorage.removeItem(key)\n            resolve(null)\n        } catch (err) {\n            reject(err)\n        }\n    })\n}\n\nexport function setItem(key: string, value: string) {\n    return new Promise((resolve, reject) => {\n        try {\n            window.localStorage.setItem(key, value)\n            resolve(null)\n        } catch (err) {\n            reject(err)\n        }\n    })\n}","import {\n    list as _list,\n    map as _map,\n    object as _object,\n    custom\n} from 'serializr'\n\nfunction _walk(v: any) {\n    if (typeof v === 'object' && v) Object.keys(v).map(k => _walk(v[k]))\n    return v\n}\n\nfunction _default() {\n    return custom(_walk, (v: any) => v)\n}\n\nfunction object(s: any) {\n    return s ? _object(s) : _default()\n}\n\nfunction list(s: any) {\n    return _list(object(s))\n}\n\nfunction map(s: any) {\n    return _map(object(s))\n}\n\nexport type Types = 'object' | 'list' | 'map'\nexport const types: { [key: string]: ((s?: any) => any) } = { object, list, map }","import {\n    createSimpleSchema, setDefaultModelSchema,\n} from 'serializr';\n\nimport { types } from './types';\n\nexport function persistObject(target: any, schema: any) {\n    const model = createModel(schema);\n    setDefaultModelSchema(target, model);\n    return target;\n}\n\nfunction createModel(params: any) {\n    const schema: { [key: string]: any } = {};\n    Object.keys(params).forEach(key => {\n        if (typeof params[key] === 'object') {\n            if (params[key].type in types) {\n                if (typeof params[key].schema === 'object') {\n                    schema[key] = types[params[key].type](createModel(params[key].schema));\n                } else {\n                    schema[key] = types[params[key].type](params[key].schema);\n                }\n            }\n        } else if (params[key] === true) {\n            schema[key] = true;\n        }\n    });\n\n    return createSimpleSchema(schema);\n}","// Based on mobx-persist: https://github.com/pinqy520/mobx-persist\n// Sadly now unmaintained.\n\nimport * as _ from 'lodash';\nimport {\n    reaction,\n    runInAction\n} from 'mobx';\nimport {\n    serialize,\n    update,\n    serializable,\n    getDefaultModelSchema\n} from 'serializr';\nimport * as Storage from './storage';\nimport { types, Types } from './types';\nimport { persistObject } from './persist-object';\n\n// @persist decorator:\nexport function persist(type: Types, schema?: any): (target: Object, key: string, baseDescriptor?: PropertyDescriptor) => void // two\nexport function persist(target: Object, key: string, baseDescriptor?: PropertyDescriptor): void // method decorator\nexport function persist(schema: Object): <T>(target: T) => T // object\nexport function persist(...args: any[]): any {\n    const [a, b] = args\n    if (a in types) {\n        return serializable(types[a](b));\n    } else if (args.length === 1) {\n        return (target: any) => persistObject(target, a);\n    } else {\n        return serializable.apply(null, args as any);\n    }\n}\n\n// Rehydration function:\nexport async function hydrate<T extends Object>(options: {\n    key: string,\n    store: T,\n    storage?: typeof Storage,\n    jsonify?: boolean,\n    dataTransform?: (data: any) => any,\n    customArgs?: any\n}): Promise<void> {\n    const { key, store, storage, jsonify, dataTransform, customArgs } = _.defaults(options, {\n        customArgs: {},\n        storage: Storage,\n        jsonify: true,\n        dataTransform: _.identity\n    });\n\n    const schema = getDefaultModelSchema(store as any);\n\n    // Load existing data, if available, and apply it to the store\n    const rawData = await storage.getItem(key);\n    if (rawData) {\n        const data = jsonify ? JSON.parse(rawData) : rawData;\n\n        if (data && typeof data === 'object') {\n            runInAction(() => {\n                update(schema, store, dataTransform(data), undefined, customArgs);\n            });\n        }\n    }\n\n    // Whenever the serialized result changes, store it:\n    reaction(\n        () => serialize(schema, store),\n        (data: any) => storage.setItem(\n            key,\n            jsonify ? JSON.stringify(data) : data\n        )\n    );\n}\n\n","\nimport { styled } from '../../styles';\n\nimport { Content } from './text-content';\n\nexport const CardErrorBanner = styled(Content)<{\n    direction?: 'left' | 'right'\n}>`\n    ${p => p.direction === 'left'\n            ? 'margin: 0 -20px 0 -15px;'\n        : p.direction === 'right'\n            ? 'margin: 0 -15px 0 -20px;'\n        : 'margin: 0 -20px 0 -20px;'\n    }\n\n    padding: 10px 30px 0;\n\n    font-size: ${p => p.theme.textSize};\n    color: ${p => p.theme.mainColor};\n    background-color: ${p => p.theme.warningBackground};\n    border-top: solid 1px ${p => p.theme.containerBorder};\n\n    svg {\n        margin-left: 0;\n    }\n`;","import * as _ from 'lodash';\nimport * as React from 'react';\n\nimport { Headers, RawHeaders } from '../../types';\nimport { styled } from '../../styles';\nimport { WarningIcon } from '../../icons';\n\nimport { getHeaderValue } from '../../util/headers';\nimport { saveFile } from '../../util/ui';\nimport { ErrorLike } from '../../util/error';\n\nimport {\n    EditableContentType,\n    ViewableContentType,\n    getContentEditorName\n} from '../../model/events/content-types';\nimport { getReadableSize } from '../../model/events/bodies';\n\nimport { CollapsibleCardHeading, ExpandState } from '../common/card';\nimport { CollapsingButtons } from '../common/collapsing-buttons';\nimport { Pill, PillSelector } from '../common/pill';\nimport { ExpandShrinkButton } from '../common/expand-shrink-button';\nimport { IconButton } from '../common/icon-button';\nimport { CardErrorBanner } from '../common/card-error-banner';\nimport { ContentMonoValue } from '../common/text-content';\nimport { FormatButton } from '../common/format-button';\n\n// This contains all the components of a card that shows a body viewer (typically for\n// HTTP, but not always) but exported individually so they can be recombined & tweaked\n// in slightly different ways in each case.\n\nexport const EditorCardContent = styled.div`\n    margin: 0 -20px -20px -20px;\n    border-top: solid 1px ${p => p.theme.containerBorder};\n    background-color: ${p => p.theme.highlightBackground};\n    color: ${p => p.theme.highlightColor};\n\n    .monaco-editor-overlaymessage {\n        display: none;\n    }\n\n    position: relative;\n    flex-grow: 1;\n\n    /*\n    Allows shrinking smaller than content, to allow scrolling overflow e.g. for\n    scrollable URL param content\n    */\n    min-height: 0;\n`;\n\nexport const ContainerSizedEditorCardContent = styled(EditorCardContent)`\n    flex-shrink: 1;\n`;\n\nexport function getBodyDownloadFilename(url: string, headers: Headers | RawHeaders): string | undefined {\n    const contentDisposition = getHeaderValue(headers, 'content-disposition') || \"\";\n    const filenameMatch = / filename=\"([^\"]+)\"/.exec(contentDisposition);\n\n    if (filenameMatch) {\n        const suggestedFilename = filenameMatch[1];\n        return _.last(_.last(suggestedFilename.split('/') as string[])!.split('\\\\')); // Strip any path info\n    }\n\n    const urlBaseName = _.last(url.split('/'));\n    if (urlBaseName?.includes(\".\")) return urlBaseName;\n}\n\nexport const ReadonlyBodyCardHeader = (props: {\n    body: Buffer | undefined,\n    mimeType?: string,\n    downloadFilename?: string,\n\n    title: string,\n    expanded: ExpandState,\n    onExpandToggled: () => void,\n    onCollapseToggled?: () => void,\n\n    selectedContentType: ViewableContentType,\n    contentTypeOptions: readonly ViewableContentType[],\n    onChangeContentType: (contentType: ViewableContentType) => void,\n\n    isPaidUser: boolean\n}) => {\n    const { body } = props;\n\n    return <>\n        { body && /* Body may be undefined during decoding */ <>\n            <CollapsingButtons>\n                <ExpandShrinkButton\n                    expanded={props.expanded}\n                    onClick={props.onExpandToggled}\n                />\n                <IconButton\n                    icon={['fas', 'download']}\n                    title={\n                        props.isPaidUser\n                            ? \"Save this body as a file\"\n                            : \"With Pro: Save this body as a file\"\n                    }\n                    disabled={!props.isPaidUser}\n                    onClick={() => saveFile(\n                        props.downloadFilename || \"\",\n                        props.mimeType || 'application/octet-stream',\n                        body\n                    )}\n                />\n            </CollapsingButtons>\n            <Pill>{ getReadableSize(body.byteLength) }</Pill>\n        </> }\n        <PillSelector<ViewableContentType>\n            onChange={props.onChangeContentType}\n            value={props.selectedContentType}\n            options={props.contentTypeOptions}\n            nameFormatter={getContentEditorName}\n        />\n        <CollapsibleCardHeading onCollapseToggled={props.onCollapseToggled}>\n            { props.title }\n        </CollapsibleCardHeading>\n    </>;\n};\n\nexport const EditableBodyCardHeader = (props: {\n    body: Buffer,\n    onBodyFormatted: (bodyString: string) => void,\n\n    title: string,\n    expanded: ExpandState,\n    onExpandToggled: () => void,\n    onCollapseToggled?: () => void,\n\n    selectedContentType: EditableContentType,\n    contentTypeOptions: readonly EditableContentType[],\n    onChangeContentType: (contentType: EditableContentType) => void\n}) => {\n    const { body } = props;\n\n    return <>\n        <CollapsingButtons>\n            <ExpandShrinkButton\n                expanded={props.expanded}\n                onClick={props.onExpandToggled}\n            />\n            <FormatButton\n                format={props.selectedContentType}\n                content={body}\n                onFormatted={props.onBodyFormatted}\n            />\n        </CollapsingButtons>\n\n        <Pill>{ getReadableSize(body) }</Pill>\n        <PillSelector<EditableContentType>\n            onChange={props.onChangeContentType}\n            value={props.selectedContentType}\n            options={props.contentTypeOptions}\n            nameFormatter={getContentEditorName}\n        />\n\n        <CollapsibleCardHeading onCollapseToggled={props.onCollapseToggled}>\n            { props.title }\n        </CollapsibleCardHeading>\n    </>;\n};\n\nconst EncodingErrorMessage = styled(ContentMonoValue)`\n    padding: 0;\n    margin: 10px 0;\n`;\n\nexport const BodyDecodingErrorBanner = (props: {\n    direction?: 'left' | 'right',\n    error: ErrorLike,\n    headers: Headers | RawHeaders\n}) => <CardErrorBanner direction={props.direction}>\n    <p>\n        <WarningIcon/> Body decoding failed for encoding '{\n            getHeaderValue(props.headers, 'content-encoding')\n        }' due to:\n    </p>\n    <EncodingErrorMessage>\n        { props.error.code\n            ? `${props.error.code}: `\n            : ''\n        }{ props.error.message || props.error.toString() }\n    </EncodingErrorMessage>\n    <p>\n        This typically means either the <code>content-encoding</code> header is incorrect or\n        unsupported, or the body was corrupted. The raw content (not decoded) is shown below.\n    </p>\n</CardErrorBanner>","/**\n * The docs included here come from MDN content, originally distributed under their\n * CC-BY-SA 2.5 license: https://creativecommons.org/licenses/by-sa/2.5/\n *\n * This license permits usage and derivative works under later equivalent versions\n * of the same license, and as such the original content used here is used under\n * the terms of CC-BY-SA 4.0: https://creativecommons.org/licenses/by-sa/4.0/.\n *\n * CC-BY-SA 4.0 allows derivative works to be licensed under other BY-SA compatible\n * licenses, and Creative Commons have approved GPLv3 as being an essentially\n * equivalent compatible license. As such, this derivative work is published here\n * under GPLv3 license: https://www.gnu.org/licenses/gpl-3.0.html\n *\n * This doesn't match the rest of this repository (licensed under AGPLv3), but\n * the AGPLv3 license has a specific clause that makes it compatible with\n * GPLv3 content, allowing us to combine both in a single project.\n */\n\ninterface MdnDocsData {\n    mdnSlug: string;\n    name: string;\n    summary: string;\n}\n\n/*\n * https://developer.mozilla.org/en-US/docs/Web/HTTP/Status$children?expand&summary\n * Transformed with:\n *\n * let _ = require('lodash');\n * let statuses = require('./statuses.json');\n *\n * let output = (_(statuses.subpages)\n * .keyBy(p => p.label.split(' ')[0])\n * .mapValues((p, k) => ({\n *     name: p.title,\n *     mdnSlug: p.slug,\n *     summary: p.summary\n *     .replace(/<(.|\\n)*?>/g, '')\n *     .replace(/&lt;/g, '<')\n *     .replace(/&gt;/g, '>')\n *     .replace('HyperText Transfer Protocol (HTTP)', 'HTTP')\n * }))\n * .value())\n * console.log(JSON.stringify(output, null, 4));\n */\nconst STATUSES: { [key: string]: MdnDocsData | undefined } = {\n    \"100\": {\n        \"name\": \"100 Continue\",\n        \"mdnSlug\": \"Web/HTTP/Status/100\",\n        \"summary\": \"The HTTP 100 Continue informational status response code indicates that everything so far is OK and that the client should continue with the request or ignore it if it is already finished.\"\n    },\n    \"101\": {\n        \"name\": \"101 Switching Protocols\",\n        \"mdnSlug\": \"Web/HTTP/Status/101\",\n        \"summary\": \"The HTTP 101 Switching Protocols response code indicates the protocol the server is switching to as requested by a client which sent the message including the Upgrade request header.\"\n    },\n    \"103\": {\n        \"name\": \"103 Early Hints\",\n        \"mdnSlug\": \"Web/HTTP/Status/103\",\n        \"summary\": \"The HTTP 103 Early Hints information response status code is primarily intended to be used with the Link header to allow the user agent to start preloading resources while the server is still preparing a response.\"\n    },\n    \"200\": {\n        \"name\": \"200 OK\",\n        \"mdnSlug\": \"Web/HTTP/Status/200\",\n        \"summary\": \"The HTTP 200 OK success status response code indicates that the request has succeeded. A 200 response is cacheable by default.\"\n    },\n    \"201\": {\n        \"name\": \"201 Created\",\n        \"mdnSlug\": \"Web/HTTP/Status/201\",\n        \"summary\": \"The HTTP 201 Created success status response code indicates that the request has succeeded and has led to the creation of a resource. The new resource is effectively created before this response is sent back and the new resource is returned in the body of the message, its location being either the URL of the request, or the content of the Location header.\"\n    },\n    \"202\": {\n        \"name\": \"202 Accepted\",\n        \"mdnSlug\": \"Web/HTTP/Status/202\",\n        \"summary\": \"The HTTP 202 Accepted response status code indicates that the request has been accepted for processing, but the processing has not been completed; in fact, processing may not have started yet. The request might or might not eventually be acted upon, as it might be disallowed when processing actually takes place.\"\n    },\n    \"203\": {\n        \"name\": \"203 Non-Authoritative Information\",\n        \"mdnSlug\": \"Web/HTTP/Status/203\",\n        \"summary\": \"The HTTP 203 Non-Authoritative Information response status indicates that the request was successful but the enclosed payload has been modified by a transforming proxy from that of the origin server's 200 (OK) response .\"\n    },\n    \"204\": {\n        \"name\": \"204 No Content\",\n        \"mdnSlug\": \"Web/HTTP/Status/204\",\n        \"summary\": \"The HTTP 204 No Content success status response code indicates that the request has succeeded, but that the client doesn't need to go away from its current page. A 204 response is cacheable by default. An ETag header is included in such a response.\"\n    },\n    \"205\": {\n        \"name\": \"205 Reset Content\",\n        \"mdnSlug\": \"Web/HTTP/Status/205\",\n        \"summary\": \"The HTTP 205 Reset Content response status tells the client to reset the document view, so for example to clear the content of a form, reset a canvas state, or to refresh the UI.\"\n    },\n    \"206\": {\n        \"name\": \"206 Partial Content\",\n        \"mdnSlug\": \"Web/HTTP/Status/206\",\n        \"summary\": \"The HTTP 206 Partial Content success status response code indicates that the request has succeeded and has the body contains the requested ranges of data, as described in the Range header of the request.\"\n    },\n    \"300\": {\n        \"name\": \"300 Multiple Choices\",\n        \"mdnSlug\": \"Web/HTTP/Status/300\",\n        \"summary\": \"The HTTP 300 Multiple Choices redirect status response code indicates that the request has more than one possible responses. The user-agent or the user should choose one of them. As there is no standardized way of choosing one of the responses, this response code is very rarely used.\"\n    },\n    \"301\": {\n        \"name\": \"301 Moved Permanently\",\n        \"mdnSlug\": \"Web/HTTP/Status/301\",\n        \"summary\": \"The HTTP 301 Moved Permanently redirect status response code indicates that the resource requested has been definitively moved to the URL given by the Location headers. A browser redirects to this page and search engines update their links to the resource (in 'SEO-speak', it is said that the 'link-juice' is sent to the new URL).\"\n    },\n    \"302\": {\n        \"name\": \"302 Found\",\n        \"mdnSlug\": \"Web/HTTP/Status/302\",\n        \"summary\": \"The HTTP 302 Found redirect status response code indicates that the resource requested has been temporarily moved to the URL given by the Location header. A browser redirects to this page but search engines don't update their links to the resource (in 'SEO-speak', it is said that the 'link-juice' is not sent to the new URL).\"\n    },\n    \"303\": {\n        \"name\": \"303 See Other\",\n        \"mdnSlug\": \"Web/HTTP/Status/303\",\n        \"summary\": \"The HTTP 303 See Other redirect status response code indicates that the redirects don't link to the newly uploaded resources, but to another page (such as a confirmation page or an upload progress page). This response code is usually sent back as a result of PUT or POST. The method used to display this redirected page is always GET.\"\n    },\n    \"304\": {\n        \"name\": \"304 Not Modified\",\n        \"mdnSlug\": \"Web/HTTP/Status/304\",\n        \"summary\": \"The HTTP 304 Not Modified client redirection response code indicates that there is no need to retransmit the requested resources. It is an implicit redirection to a cached resource. This happens when the request method is safe, like a GET or a HEAD request, or when the request is conditional and uses a If-None-Match or a If-Modified-Since header.\"\n    },\n    \"307\": {\n        \"name\": \"307 Temporary Redirect\",\n        \"mdnSlug\": \"Web/HTTP/Status/307\",\n        \"summary\": \"The method and the body of the original request are reused to perform the redirected request. In the cases where you want the method used to be changed to GET, use 303 See Other instead. This is useful when you want to give an answer to a PUT method that is not the uploaded resources, but a confirmation message (like \\\"You successfully uploaded XYZ\\\").\"\n    },\n    \"308\": {\n        \"name\": \"308 Permanent Redirect\",\n        \"mdnSlug\": \"Web/HTTP/Status/308\",\n        \"summary\": \"The request method and the body will not be altered, whereas 301 may incorrectly sometimes be changed to a GET method.\"\n    },\n    \"400\": {\n        \"name\": \"400 Bad Request\",\n        \"mdnSlug\": \"Web/HTTP/Status/400\",\n        \"summary\": \"The HTTP 400 Bad Request response status code indicates that the server cannot or will not process the request due to something that is perceived to be a client error (e.g., malformed request syntax, invalid request message framing, or deceptive request routing).\"\n    },\n    \"401\": {\n        \"name\": \"401 Unauthorized\",\n        \"mdnSlug\": \"Web/HTTP/Status/401\",\n        \"summary\": \"The HTTP 401 Unauthorized client error status response code indicates that the request has not been applied because it lacks valid authentication credentials for the target resource.\"\n    },\n    \"402\": {\n        \"name\": \"402 Payment Required\",\n        \"mdnSlug\": \"Web/HTTP/Status/402\",\n        \"summary\": \"The HTTP 402 Payment Required is a nonstandard client error status response code that is reserved for future use.\"\n    },\n    \"403\": {\n        \"name\": \"403 Forbidden\",\n        \"mdnSlug\": \"Web/HTTP/Status/403\",\n        \"summary\": \"The HTTP 403 Forbidden client error status response code indicates that the server understood the request but refuses to authorize it.\"\n    },\n    \"404\": {\n        \"name\": \"404 Not Found\",\n        \"mdnSlug\": \"Web/HTTP/Status/404\",\n        \"summary\": \"The HTTP 404 Not Found client error response code indicates that the server can't find the requested resource. Links that lead to a 404 page are often called broken or dead links and can be subject to link rot.\"\n    },\n    \"405\": {\n        \"name\": \"405 Method Not Allowed\",\n        \"mdnSlug\": \"Web/HTTP/Status/405\",\n        \"summary\": \"The HTTP 405 Method Not Allowed response status code indicates that the request method is known by the server but is not supported by the target resource.\"\n    },\n    \"406\": {\n        \"name\": \"406 Not Acceptable\",\n        \"mdnSlug\": \"Web/HTTP/Status/406\",\n        \"summary\": \"The HTTP 406 Not Acceptable client error response code indicates that the server cannot produce a response matching the list of acceptable values defined in the request's proactive content negotiation headers, and that the server is unwilling to supply a default representation.\"\n    },\n    \"407\": {\n        \"name\": \"407 Proxy Authentication Required\",\n        \"mdnSlug\": \"Web/HTTP/Status/407\",\n        \"summary\": \"The HTTP 407 Proxy Authentication Required  client error status response code indicates that the request has not been applied because it lacks valid authentication credentials for a proxy server that is between the browser and the server that can access the requested resource.\"\n    },\n    \"408\": {\n        \"name\": \"408 Request Timeout\",\n        \"mdnSlug\": \"Web/HTTP/Status/408\",\n        \"summary\": \"The HTTP 408 Request Timeout response status code means that the server would like to shut down this unused connection. It is sent on an idle connection by some servers, even without any previous request by the client.\"\n    },\n    \"409\": {\n        \"name\": \"409 Conflict\",\n        \"mdnSlug\": \"Web/HTTP/Status/409\",\n        \"summary\": \"The HTTP 409 Conflict response status code indicates a request conflict with current state of the target resource.\"\n    },\n    \"410\": {\n        \"name\": \"410 Gone\",\n        \"mdnSlug\": \"Web/HTTP/Status/410\",\n        \"summary\": \"The HTTP 410 Gone client error response code indicates that access to the target resource is no longer available at the origin server and that this condition is likely to be permanent.\"\n    },\n    \"411\": {\n        \"name\": \"411 Length Required\",\n        \"mdnSlug\": \"Web/HTTP/Status/411\",\n        \"summary\": \"The HTTP 411 Length Required client error response code indicates that the server refuses to accept the request without a defined Content-Length header.\"\n    },\n    \"412\": {\n        \"name\": \"412 Precondition Failed\",\n        \"mdnSlug\": \"Web/HTTP/Status/412\",\n        \"summary\": \"The HTTP 412 Precondition Failed client error response code indicates that access to the target resource has been denied. This happens with conditional requests on methods other than GET or HEAD when the condition defined by the If-Unmodified-Since or If-None-Match headers is not fulfilled. In that case, the request, usually an upload or a modification of a resource, cannot be made and this error response is sent back.\"\n    },\n    \"413\": {\n        \"name\": \"413 Payload Too Large\",\n        \"mdnSlug\": \"Web/HTTP/Status/413\",\n        \"summary\": \"The HTTP 413 Payload Too Large response status code indicates that the request entity is larger than limits defined by server; the server might close the connection or return a Retry-After header field.\"\n    },\n    \"414\": {\n        \"name\": \"414 URI Too Long\",\n        \"mdnSlug\": \"Web/HTTP/Status/414\",\n        \"summary\": \"The HTTP 414 URI Too Long response status code indicates that the URI requested by the client is longer than the server is willing to interpret.\"\n    },\n    \"415\": {\n        \"name\": \"415 Unsupported Media Type\",\n        \"mdnSlug\": \"Web/HTTP/Status/415\",\n        \"summary\": \"The HTTP 415 Unsupported Media Type client error response code indicates that the server refuses to accept the request because the payload format is in an unsupported format.\"\n    },\n    \"416\": {\n        \"name\": \"416 Range Not Satisfiable\",\n        \"mdnSlug\": \"Web/HTTP/Status/416\",\n        \"summary\": \"The HTTP 416 Range Not Satisfiable error response code indicates that a server cannot serve the requested ranges. The most likely reason is that the document doesn't contain such ranges, or that the Range header value, though syntactically correct, doesn't make sense.\"\n    },\n    \"417\": {\n        \"name\": \"417 Expectation Failed\",\n        \"mdnSlug\": \"Web/HTTP/Status/417\",\n        \"summary\": \"The HTTP 417 Expectation Failed client error response code indicates that the expectation given in the request's Expect header could not be met.\"\n    },\n    \"418\": {\n        \"name\": \"418 I'm a teapot\",\n        \"mdnSlug\": \"Web/HTTP/Status/418\",\n        \"summary\": \"The HTTP 418 I'm a teapot client error response code indicates that the server refuses to brew coffee because it is, permanently, a teapot. A combined coffee/tea pot that is temporarily out of coffee should instead return 503. This error is a reference to Hyper Text Coffee Pot Control Protocol defined in April Fools' jokes in 1998 and 2014.\"\n    },\n    \"422\": {\n        \"name\": \"422 Unprocessable Entity\",\n        \"mdnSlug\": \"Web/HTTP/Status/422\",\n        \"summary\": \"The HTTP 422 Unprocessable Entity response status code indicates that the server understands the content type of the request entity, and the syntax of the request entity is correct, but it was unable to process the contained instructions.\"\n    },\n    \"425\": {\n        \"name\": \"425 Too Early\",\n        \"mdnSlug\": \"Web/HTTP/Status/425\",\n        \"summary\": \"The HTTP 425 Too Early response status code indicates that the server is unwilling to risk processing a request that might be replayed, which creates the potential for a replay attack.\"\n    },\n    \"426\": {\n        \"name\": \"426 Upgrade Required\",\n        \"mdnSlug\": \"Web/HTTP/Status/426\",\n        \"summary\": \"The HTTP 426 Upgrade Required client error response code indicates that the server refuses to perform the request using the current protocol but might be willing to do so after the client upgrades to a different protocol.\"\n    },\n    \"428\": {\n        \"name\": \"428 Precondition Required\",\n        \"mdnSlug\": \"Web/HTTP/Status/428\",\n        \"summary\": \"The HTTP 428 Precondition Required response status code indicates that the server requires the request to be conditional.\"\n    },\n    \"429\": {\n        \"name\": \"429 Too Many Requests\",\n        \"mdnSlug\": \"Web/HTTP/Status/429\",\n        \"summary\": \"The HTTP 429 Too Many Requests response status code indicates the user has sent too many requests in a given amount of time (\\\"rate limiting\\\").\"\n    },\n    \"431\": {\n        \"name\": \"431 Request Header Fields Too Large\",\n        \"mdnSlug\": \"Web/HTTP/Status/431\",\n        \"summary\": \"The HTTP 431 Request Header Fields Too Large response status code indicates that the server refuses to process the request because the request’s HTTP headers are too long.\"\n    },\n    \"451\": {\n        \"name\": \"451 Unavailable For Legal Reasons\",\n        \"mdnSlug\": \"Web/HTTP/Status/451\",\n        \"summary\": \"The HTTP 451 Unavailable For Legal Reasons client error response code indicates that the user requested a resource that is not available due to legal reasons, such as a web page for which a legal action has been issued.\"\n    },\n    \"500\": {\n        \"name\": \"500 Internal Server Error\",\n        \"mdnSlug\": \"Web/HTTP/Status/500\",\n        \"summary\": \"The HTTP 500 Internal Server Error server error response code indicates that the server encountered an unexpected condition that prevented it from fulfilling the request.\"\n    },\n    \"501\": {\n        \"name\": \"501 Not Implemented\",\n        \"mdnSlug\": \"Web/HTTP/Status/501\",\n        \"summary\": \"The HTTP 501 Not Implemented server error response code means that the server does not support the functionality required to fulfill the request.\"\n    },\n    \"502\": {\n        \"name\": \"502 Bad Gateway\",\n        \"mdnSlug\": \"Web/HTTP/Status/502\",\n        \"summary\": \"The HTTP 502 Bad Gateway server error response code indicates that the server, while acting as a gateway or proxy, received an invalid response from the upstream server.\"\n    },\n    \"503\": {\n        \"name\": \"503 Service Unavailable\",\n        \"mdnSlug\": \"Web/HTTP/Status/503\",\n        \"summary\": \"The HTTP 503 Service Unavailable server error response code indicates that the server is not ready to handle the request.\"\n    },\n    \"504\": {\n        \"name\": \"504 Gateway Timeout\",\n        \"mdnSlug\": \"Web/HTTP/Status/504\",\n        \"summary\": \"The HTTP 504 Gateway Timeout server error response code indicates that the server, while acting as a gateway or proxy, did not get a response in time from the upstream server that it needed in order to complete the request.\"\n    },\n    \"505\": {\n        \"name\": \"505 HTTP Version Not Supported\",\n        \"mdnSlug\": \"Web/HTTP/Status/505\",\n        \"summary\": \"The HTTP 505 HTTP Version Not Supported response status code indicates that the HTTP version used in the request is not supported by the server.\"\n    },\n    \"506\": {\n        \"name\": \"506 Variant Also Negotiates\",\n        \"mdnSlug\": \"Web/HTTP/Status/506\",\n        \"summary\": \"The HTTP 506 Variant Also Negotiates response status code may be given in the context of Transparent Content Negotiation (see RFC 2295). This protocol enables a client to retrieve the best variant of a given resource, where the server supports multiple variants.\"\n    },\n    \"507\": {\n        \"name\": \"507 Insufficient Storage\",\n        \"mdnSlug\": \"Web/HTTP/Status/507\",\n        \"summary\": \"The HTTP 507 Insufficient Storage response status code may be given in the context of the Web Distributed Authoring and Versioning (WebDAV) protocol (see RFC 4918).\"\n    },\n    \"508\": {\n        \"name\": \"508 Loop Detected\",\n        \"mdnSlug\": \"Web/HTTP/Status/508\",\n        \"summary\": \"The HTTP 508 Loop Detected response status code may be given in the context of the Web Distributed Authoring and Versioning (WebDAV) protocol.\"\n    },\n    \"510\": {\n        \"name\": \"510 Not Extended\",\n        \"mdnSlug\": \"Web/HTTP/Status/510\",\n        \"summary\": \"The HTTP  510 Not Extended response status code is sent in the context of the HTTP Extension Framework, defined in RFC 2774.\"\n    },\n    \"511\": {\n        \"name\": \"511 Network Authentication Required\",\n        \"mdnSlug\": \"Web/HTTP/Status/511\",\n        \"summary\": \"The HTTP 511 Network Authentication Required response status code indicates that the client needs to authenticate to gain network access.\"\n    }\n};\n\ninterface RawDocsData {\n    name: string;\n    summary: string;\n}\n\n// Manually paraphrased from the RFC: https://www.rfc-editor.org/rfc/rfc6455.html#section-7.4.1\nconst WEBSOCKET_CLOSE_CODES: { [key: string]: RawDocsData } = {\n    1000: {\n        \"name\": \"Normal Closure\",\n        \"summary\": \"A normal WebSocket closure, meaning that the purpose for which the connection was established has been fulfilled.\"\n    },\n    1001: {\n        \"name\": \"Going Away\",\n        \"summary\": \"An endpoint is \\\"going away\\\", such as a server going down or a browser having navigated away from a page.\"\n    },\n    1002: {\n        \"name\": \"Protocol Error\",\n        \"summary\": \"An endpoint terminated the connection due to a protocol error\"\n    },\n    1003: {\n        \"name\": \"Unsupported Data\",\n        \"summary\": \"An endpoint is terminating the connection because it has received a type of data it cannot accept (e.g., an endpoint that understands only text data MAY send this if it receives a binary message).\"\n    },\n    1004: {\n        \"name\": \"Reserved\",\n        \"summary\": \"This close code is not used. A specific meaning might be defined in future.\"\n    },\n    1005: {\n        \"name\": \"No Close Code Received\",\n        \"summary\": \"This is a reserved value that must not be sent by an endpoint. It is designated for use in applications expecting a status code, to indicate that no status code was actually present.\"\n    },\n    1006: {\n        \"name\": \"Abnormal Closure\",\n        \"summary\": \"This is a reserved value that must not be sent by an endpoint. It is designated for use in applications expecting a status code, to indicate that the connection was closed abnormally, e.g., without sending or receiving a Close control frame.\"\n    },\n    1007: {\n        \"name\": \"Invalid Frame Payload Data\",\n        \"summary\": \"An endpoint is terminating the connection because it has received data within a message that was not consistent with the type of the message (e.g., non-UTF-8 data within a text message).\"\n    },\n    1008: {\n        \"name\": \"Policy Violation\",\n        \"summary\": \"An endpoint is terminating the connection because it has received a message that violates its policy. This is a generic status code that can be returned when there is no other more suitable status code (e.g., 1003 or 1009) or if there is a need to hide specific details about the policy.\"\n    },\n    1009: {\n        \"name\": \"Message Too Large\",\n        \"summary\": \"An endpoint is terminating the connection because it has received a message that is too big for it to process.\"\n    },\n    1010: {\n        \"name\": \"Mandatory Extension\",\n        \"summary\": \"The client is terminating the connection because it has expected the server to negotiate one or more extensions, but the server didn't return them in the response message of the WebSocket handshake.  The list of extensions that are needed SHOULD appear in the /reason/ part of the Close frame.\"\n    },\n    1011: {\n        \"name\": \"Internal Error\",\n        \"summary\": \"The server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request.\"\n    },\n    1012: {\n        \"name\": \"Service Restart\",\n        \"summary\": \"The server is terminating the connection because it is restarting.\"\n    },\n    1013: {\n        \"name\": \"Try Again Later\",\n        \"summary\": \"The server is terminating the connection due to a temporary condition, such as being overloaded.\"\n    },\n    1014: {\n        \"name\": \"Bad Gateway\",\n        \"summary\": \"The server was acting as a gateway or proxy, and received an invalid response from an upstream server.\"\n    },\n    1015: {\n        \"name\": \"TLS Handshake\",\n        \"summary\": \"This is a reserved value that must not be sent by an endpoint. It is designated for use in applications expecting a status code, to indicate that the connection was closed due to a failure to perform a TLS handshake (e.g., the server certificate can't be verified).\"\n    }\n};\n\n/*\n * Taken from https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers$children?expand\n * Transformed with:\n *\n * let _ = require('lodash');\n * let headers = require('./headers.json');\n *\n * let output = (_(headers.subpages)\n * .filter(p => p.title !== 'Index')\n * .keyBy(p => p.title.toLowerCase())\n * .mapValues((p, k) => ({\n *   mdnSlug: p.slug,\n *   name: p.title,\n *   summary: p.summary\n *   .replace(/<(.|\\n)*?>/g, '')\n *   .replace(/&lt;/g, '<')\n *   .replace(/&gt;/g, '>')\n *   .split(/\\.( |$)/)[0] + '.'\n * }))\n * .value())\n * console.log(JSON.stringify(output, null, 4));\n */\nconst HEADERS: { [key: string]: MdnDocsData | undefined } = {\n    \"accept\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Accept\",\n        \"name\": \"Accept\",\n        \"summary\": \"The Accept request HTTP header advertises which content types, expressed as MIME types, the client is able to understand.\"\n    },\n    \"accept-ch\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Accept-CH\",\n        \"name\": \"Accept-CH\",\n        \"summary\": \"The Accept-CH header is set by the server to specify which Client Hints headers a client should include in subsequent requests.\"\n    },\n    \"accept-ch-lifetime\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Accept-CH-Lifetime\",\n        \"name\": \"Accept-CH-Lifetime\",\n        \"summary\": \"The Accept-CH-Lifetime header is set by the server to specify the persistence of Accept-CH header value that specifies for which Client Hints headers client should include in subsequent requests.\"\n    },\n    \"accept-charset\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Accept-Charset\",\n        \"name\": \"Accept-Charset\",\n        \"summary\": \"The Accept-Charset request HTTP header advertises which character encodings the client understands.\"\n    },\n    \"accept-encoding\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Accept-Encoding\",\n        \"name\": \"Accept-Encoding\",\n        \"summary\": \"The Accept-Encoding request HTTP header advertises which content encoding, usually a compression algorithm, the client is able to understand.\"\n    },\n    \"accept-language\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Accept-Language\",\n        \"name\": \"Accept-Language\",\n        \"summary\": \"The Accept-Language request HTTP header advertises which languages the client is able to understand, and which locale variant is preferred.\"\n    },\n    \"accept-patch\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Accept-Patch\",\n        \"name\": \"Accept-Patch\",\n        \"summary\": \"The Accept-Patch response HTTP header advertises which media-type the server is able to understand.\"\n    },\n    \"accept-ranges\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Accept-Ranges\",\n        \"name\": \"Accept-Ranges\",\n        \"summary\": \"The Accept-Ranges response HTTP header is a marker used by the server to advertise its support of partial requests.\"\n    },\n    \"access-control-allow-credentials\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Access-Control-Allow-Credentials\",\n        \"name\": \"Access-Control-Allow-Credentials\",\n        \"summary\": \"The Access-Control-Allow-Credentials response header tells browsers whether to expose the response to frontend JavaScript code when the request's credentials mode (Request.credentials) is include.\"\n    },\n    \"access-control-allow-headers\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Access-Control-Allow-Headers\",\n        \"name\": \"Access-Control-Allow-Headers\",\n        \"summary\": \"The Access-Control-Allow-Headers response header is used in response to a preflight request which includes the Access-Control-Request-Headers to indicate which HTTP headers can be used during the actual request.\"\n    },\n    \"access-control-allow-methods\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Access-Control-Allow-Methods\",\n        \"name\": \"Access-Control-Allow-Methods\",\n        \"summary\": \"The Access-Control-Allow-Methods response header specifies the method or methods allowed when accessing the resource in response to a preflight request.\"\n    },\n    \"access-control-allow-origin\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Access-Control-Allow-Origin\",\n        \"name\": \"Access-Control-Allow-Origin\",\n        \"summary\": \"The Access-Control-Allow-Origin response header indicates whether the response can be shared with requesting code from the given origin.\"\n    },\n    \"access-control-expose-headers\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Access-Control-Expose-Headers\",\n        \"name\": \"Access-Control-Expose-Headers\",\n        \"summary\": \"The Access-Control-Expose-Headers response header indicates which headers can be exposed as part of the response by listing their names.\"\n    },\n    \"access-control-max-age\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Access-Control-Max-Age\",\n        \"name\": \"Access-Control-Max-Age\",\n        \"summary\": \"The Access-Control-Max-Age response header indicates how long the results of a preflight request (that is the information contained in the Access-Control-Allow-Methods and Access-Control-Allow-Headers headers) can be cached.\"\n    },\n    \"access-control-request-headers\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Access-Control-Request-Headers\",\n        \"name\": \"Access-Control-Request-Headers\",\n        \"summary\": \"The Access-Control-Request-Headers request header is used by browsers when issuing a preflight request, to let the server know which HTTP headers the client might send when the actual request is made.\"\n    },\n    \"access-control-request-method\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Access-Control-Request-Method\",\n        \"name\": \"Access-Control-Request-Method\",\n        \"summary\": \"The Access-Control-Request-Method request header is used by browsers when issuing a preflight request, to let the server know which HTTP method will be used when the actual request is made.\"\n    },\n    \"age\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Age\",\n        \"name\": \"Age\",\n        \"summary\": \"The Age header contains the time in seconds the object has been in a proxy cache.\"\n    },\n    \"allow\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Allow\",\n        \"name\": \"Allow\",\n        \"summary\": \"The Allow header lists the set of methods supported by a resource.\"\n    },\n    \"alt-svc\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Alt-Svc\",\n        \"name\": \"Alt-Svc\",\n        \"summary\": \"The Alt-Svc HTTP response header is used to advertise alternative services through which the same resource can be reached.\"\n    },\n    \"authorization\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Authorization\",\n        \"name\": \"Authorization\",\n        \"summary\": \"The HTTP Authorization request header contains the credentials to authenticate a user agent with a server, usually, but not necessarily, after the server has responded with a 401 Unauthorized status and the WWW-Authenticate header.\"\n    },\n    \"cache-control\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Cache-Control\",\n        \"name\": \"Cache-Control\",\n        \"summary\": \"The Cache-Control HTTP header holds directives (instructions) for caching in both requests and responses.\"\n    },\n    \"clear-site-data\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Clear-Site-Data\",\n        \"name\": \"Clear-Site-Data\",\n        \"summary\": \"The Clear-Site-Data header clears browsing data (cookies, storage, cache) associated with the requesting website.\"\n    },\n    \"connection\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Connection\",\n        \"name\": \"Connection\",\n        \"summary\": \"The Connection general header controls whether or not the network connection stays open after the current transaction finishes.\"\n    },\n    \"content-disposition\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Content-Disposition\",\n        \"name\": \"Content-Disposition\",\n        \"summary\": \"In a regular HTTP response, the Content-Disposition response header is a header indicating if the content is expected to be displayed inline in the browser, that is, as a Web page or as part of a Web page, or as an attachment, that is downloaded and saved locally.\"\n    },\n    \"content-encoding\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Content-Encoding\",\n        \"name\": \"Content-Encoding\",\n        \"summary\": \"The Content-Encoding entity header is used to compress the media-type.\"\n    },\n    \"content-language\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Content-Language\",\n        \"name\": \"Content-Language\",\n        \"summary\": \"The Content-Language entity header is used to describe the language(s) intended for the audience, so that it allows a user to differentiate according to the users' own preferred language.\"\n    },\n    \"content-length\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Content-Length\",\n        \"name\": \"Content-Length\",\n        \"summary\": \"The Content-Length entity header indicates the size of the entity-body, in bytes, sent to the recipient.\"\n    },\n    \"content-location\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Content-Location\",\n        \"name\": \"Content-Location\",\n        \"summary\": \"The Content-Location header indicates an alternate location for the returned data.\"\n    },\n    \"content-range\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Content-Range\",\n        \"name\": \"Content-Range\",\n        \"summary\": \"The Content-Range response HTTP header indicates where in a full body message a partial message belongs.\"\n    },\n    \"content-security-policy\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Content-Security-Policy\",\n        \"name\": \"Content-Security-Policy\",\n        \"summary\": \"The HTTP Content-Security-Policy response header allows web site administrators to control resources the user agent is allowed to load for a given page.\"\n    },\n    \"content-security-policy-report-only\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Content-Security-Policy-Report-Only\",\n        \"name\": \"Content-Security-Policy-Report-Only\",\n        \"summary\": \"The HTTP Content-Security-Policy-Report-Only response header allows web developers to experiment with policies by monitoring (but not enforcing) their effects.\"\n    },\n    \"content-type\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Content-Type\",\n        \"name\": \"Content-Type\",\n        \"summary\": \"The Content-Type entity header is used to indicate the media type of the resource.\"\n    },\n    \"cookie\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Cookie\",\n        \"name\": \"Cookie\",\n        \"summary\": \"The Cookie HTTP request header contains stored HTTP cookies previously sent by the server with the Set-Cookie header.\"\n    },\n    \"cookie2\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Cookie2\",\n        \"name\": \"Cookie2\",\n        \"summary\": \"The obsolete Cookie2 HTTP request header used to advise the server that the user agent understands \\\"new-style\\\" cookies, but nowadays user agents will use the Cookie header instead, not this one.\"\n    },\n    \"cross-origin-embedder-policy\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Cross-Origin-Embedder-Policy\",\n        \"name\": \"Cross-Origin-Embedder-Policy\",\n        \"summary\": \"The HTTP Cross-Origin-Embedder-Policy (COEP) response header prevents a document from loading any cross-origin resources that don't explicitly grant the document permission (using CORP or CORS).\"\n    },\n    \"cross-origin-opener-policy\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Cross-Origin-Opener-Policy\",\n        \"name\": \"Cross-Origin-Opener-Policy\",\n        \"summary\": \"The HTTP Cross-Origin-Opener-Policy (COOP) response header allows you to ensure a top-level document does not share a browsing context group with cross-origin documents.\"\n    },\n    \"cross-origin-resource-policy\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Cross-Origin-Resource-Policy\",\n        \"name\": \"Cross-Origin-Resource-Policy\",\n        \"summary\": \"The HTTP Cross-Origin-Resource-Policy response header conveys a desire that the browser blocks no-cors cross-origin/cross-site requests to the given resource.\"\n    },\n    \"dnt\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/DNT\",\n        \"name\": \"DNT\",\n        \"summary\": \"The DNT (Do Not Track) request header indicates the user's tracking preference.\"\n    },\n    \"dpr\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/DPR\",\n        \"name\": \"DPR\",\n        \"summary\": \"The DPR header is a Client Hints headers which represents the client device pixel ratio (DPR), which is the the number of physical device pixels corresponding to every CSS pixel.\"\n    },\n    \"date\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Date\",\n        \"name\": \"Date\",\n        \"summary\": \"The Date general HTTP header contains the date and time at which the message was originated.\"\n    },\n    \"device-memory\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Device-Memory\",\n        \"name\": \"Device-Memory\",\n        \"summary\": \"The Device-Memory header is a Device Memory API header that works like Client Hints header which represents the approximate amount of RAM client device has.\"\n    },\n    \"digest\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Digest\",\n        \"name\": \"Digest\",\n        \"summary\": \"The Digest response HTTP header provides a digest of the requested resource.\"\n    },\n    \"etag\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/ETag\",\n        \"name\": \"ETag\",\n        \"summary\": \"The ETag HTTP response header is an identifier for a specific version of a resource.\"\n    },\n    \"early-data\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Early-Data\",\n        \"name\": \"Early-Data\",\n        \"summary\": \"The Early-Data header is set by an intermediary to indicate that the request has been conveyed in TLS early data, and also indicates that the intermediary understands the 425 (Too Early) status code.\"\n    },\n    \"expect\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Expect\",\n        \"name\": \"Expect\",\n        \"summary\": \"The Expect HTTP request header indicates expectations that need to be fulfilled by the server in order to properly handle the request.\"\n    },\n    \"expect-ct\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Expect-CT\",\n        \"name\": \"Expect-CT\",\n        \"summary\": \"The Expect-CT header lets sites opt in to reporting and/or enforcement of Certificate Transparency requirements, to prevent the use of misissued certificates for that site from going unnoticed.\"\n    },\n    \"expires\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Expires\",\n        \"name\": \"Expires\",\n        \"summary\": \"The Expires header contains the date/time after which the response is considered stale.\"\n    },\n    \"feature-policy\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Feature-Policy\",\n        \"name\": \"Feature-Policy\",\n        \"summary\": \"The HTTP Feature-Policy header provides a mechanism to allow and deny the use of browser features in its own frame, and in content within any <iframe> elements in the document.\"\n    },\n    \"forwarded\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Forwarded\",\n        \"name\": \"Forwarded\",\n        \"summary\": \"The Forwarded header contains information from the reverse proxy servers that is altered or lost when a proxy is involved in the path of the request.\"\n    },\n    \"from\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/From\",\n        \"name\": \"From\",\n        \"summary\": \"The From request header contains an Internet email address for a human user who controls the requesting user agent.\"\n    },\n    \"host\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Host\",\n        \"name\": \"Host\",\n        \"summary\": \"The Host request header specifies the host and port number of the server to which the request is being sent.\"\n    },\n    \"if-match\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/If-Match\",\n        \"name\": \"If-Match\",\n        \"summary\": \"The If-Match HTTP request header makes the request conditional.\"\n    },\n    \"if-modified-since\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/If-Modified-Since\",\n        \"name\": \"If-Modified-Since\",\n        \"summary\": \"The If-Modified-Since request HTTP header makes the request conditional: the server will send back the requested resource, with a 200 status, only if it has been last modified after the given date.\"\n    },\n    \"if-none-match\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/If-None-Match\",\n        \"name\": \"If-None-Match\",\n        \"summary\": \"The If-None-Match HTTP request header makes the request conditional.\"\n    },\n    \"if-range\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/If-Range\",\n        \"name\": \"If-Range\",\n        \"summary\": \"The If-Range HTTP request header makes a range request conditional: if the condition is fulfilled, the range request will be issued and the server sends back a 206 Partial Content answer with the appropriate body.\"\n    },\n    \"if-unmodified-since\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/If-Unmodified-Since\",\n        \"name\": \"If-Unmodified-Since\",\n        \"summary\": \"The If-Unmodified-Since request HTTP header makes the request conditional: the server will send back the requested resource, or accept it in the case of a POST or another non-safe method, only if it has not been last modified after the given date.\"\n    },\n    \"keep-alive\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Keep-Alive\",\n        \"name\": \"Keep-Alive\",\n        \"summary\": \"The Keep-Alive general header allows the sender to hint about how the connection may be used to set a timeout and a maximum amount of requests.\"\n    },\n    \"large-allocation\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Large-Allocation\",\n        \"name\": \"Large-Allocation\",\n        \"summary\": \"The non-standard Large-Allocation response header tells the browser that the page being loaded is going to want to perform a large allocation.\"\n    },\n    \"last-modified\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Last-Modified\",\n        \"name\": \"Last-Modified\",\n        \"summary\": \"The Last-Modified response HTTP header contains the date and time at which the origin server believes the resource was last modified.\"\n    },\n    \"link\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Link\",\n        \"name\": \"Link\",\n        \"summary\": \"The HTTP Link entity-header field provides a means for serialising one or more links in HTTP headers.\"\n    },\n    \"location\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Location\",\n        \"name\": \"Location\",\n        \"summary\": \"The Location response header indicates the URL to redirect a page to.\"\n    },\n    \"nel\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/NEL\",\n        \"name\": \"NEL\",\n        \"summary\": \"The HTTP NEL response header is used to configure network request logging.\"\n    },\n    \"origin\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Origin\",\n        \"name\": \"Origin\",\n        \"summary\": \"The Origin request header indicates where a fetch originates from.\"\n    },\n    \"pragma\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Pragma\",\n        \"name\": \"Pragma\",\n        \"summary\": \"The Pragma HTTP/1.0 general header is an implementation-specific header that may have various effects along the request-response chain.\"\n    },\n    \"proxy-authenticate\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Proxy-Authenticate\",\n        \"name\": \"Proxy-Authenticate\",\n        \"summary\": \"The HTTP Proxy-Authenticate response header defines the authentication method that should be used to gain access to a resource behind a proxy server.\"\n    },\n    \"proxy-authorization\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Proxy-Authorization\",\n        \"name\": \"Proxy-Authorization\",\n        \"summary\": \"The HTTP Proxy-Authorization request header contains the credentials to authenticate a user agent to a proxy server, usually after the server has responded with a 407 Proxy Authentication Required status and the Proxy-Authenticate header.\"\n    },\n    \"public-key-pins\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Public-Key-Pins\",\n        \"name\": \"Public-Key-Pins\",\n        \"summary\": \"The HTTP Public-Key-Pins response header used to associate a specific cryptographic public key with a certain web server to decrease the risk of MITM attacks with forged certificates, however, it has been removed from modern browsers and is no longer supported.\"\n    },\n    \"public-key-pins-report-only\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Public-Key-Pins-Report-Only\",\n        \"name\": \"Public-Key-Pins-Report-Only\",\n        \"summary\": \"The HTTP Public-Key-Pins-Report-Only response header was used to send reports of pinning violation to the report-uri specified in the header but, unlike Public-Key-Pins still allows browsers to connect to the server if the pinning is violated.\"\n    },\n    \"range\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Range\",\n        \"name\": \"Range\",\n        \"summary\": \"The Range HTTP request header indicates the part of a document that the server should return.\"\n    },\n    \"referer\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Referer\",\n        \"name\": \"Referer\",\n        \"summary\": \"The Referer request header contains the address of the page making the request.\"\n    },\n    \"referrer-policy\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Referrer-Policy\",\n        \"name\": \"Referrer-Policy\",\n        \"summary\": \"The Referrer-Policy HTTP header controls how much referrer information (sent via the Referer header) should be included with requests.\"\n    },\n    \"retry-after\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Retry-After\",\n        \"name\": \"Retry-After\",\n        \"summary\": \"The Retry-After response HTTP header indicates how long the user agent should wait before making a follow-up request.\"\n    },\n    \"save-data\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Save-Data\",\n        \"name\": \"Save-Data\",\n        \"summary\": \"The Save-Data header field is a boolean which, in requests, indicates the client's preference for reduced data usage.\"\n    },\n    \"sec-fetch-dest\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Sec-Fetch-Dest\",\n        \"name\": \"Sec-Fetch-Dest\",\n        \"summary\": \"The Sec-Fetch-Dest fetch metadata header indicates the request's destination, that is how the fetched data will be used.\"\n    },\n    \"sec-fetch-mode\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Sec-Fetch-Mode\",\n        \"name\": \"Sec-Fetch-Mode\",\n        \"summary\": \"The Sec-Fetch-Mode fetch metadata header indicates the request's mode.\"\n    },\n    \"sec-fetch-site\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Sec-Fetch-Site\",\n        \"name\": \"Sec-Fetch-Site\",\n        \"summary\": \"The Sec-Fetch-Site fetch metadata header indicates the relationship between a request initiator's origin and the origin of the resource.\"\n    },\n    \"sec-fetch-user\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Sec-Fetch-User\",\n        \"name\": \"Sec-Fetch-User\",\n        \"summary\": \"The Sec-Fetch-User fetch metadata header indicates whether or not a navigation request was triggered by a user activation.\"\n    },\n    \"sec-websocket-accept\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Sec-WebSocket-Accept\",\n        \"name\": \"Sec-WebSocket-Accept\",\n        \"summary\": \"The Sec-WebSocket-Accept header is used in the websocket opening handshake.\"\n    },\n    \"server\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Server\",\n        \"name\": \"Server\",\n        \"summary\": \"The Server header describes the software used by the origin server that handled the request — that is, the server that generated the response.\"\n    },\n    \"server-timing\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Server-Timing\",\n        \"name\": \"Server-Timing\",\n        \"summary\": \"The Server-Timing header communicates one or more metrics and descriptions for a given request-response cycle.\"\n    },\n    \"set-cookie\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Set-Cookie\",\n        \"name\": \"Set-Cookie\",\n        \"summary\": \"The Set-Cookie HTTP response header is used to send a cookie from the server to the user agent, so the user agent can send it back to the server later.\"\n    },\n    \"set-cookie2\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Set-Cookie2\",\n        \"name\": \"Set-Cookie2\",\n        \"summary\": \"The obsolete Set-Cookie2 HTTP response header used to send cookies from the server to the user agent, but has been deprecated by the specification.\"\n    },\n    \"sourcemap\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/SourceMap\",\n        \"name\": \"SourceMap\",\n        \"summary\": \"The SourceMap HTTP response header links generated code to a source map, enabling the browser to reconstruct the original source and present the reconstructed original in the debugger.\"\n    },\n    \"strict-transport-security\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Strict-Transport-Security\",\n        \"name\": \"Strict-Transport-Security\",\n        \"summary\": \"The HTTP Strict-Transport-Security response header (often abbreviated as HSTS) lets a web site tell browsers that it should only be accessed using HTTPS, instead of using HTTP.\"\n    },\n    \"te\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/TE\",\n        \"name\": \"TE\",\n        \"summary\": \"The TE request header specifies the transfer encodings the user agent is willing to accept.\"\n    },\n    \"timing-allow-origin\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Timing-Allow-Origin\",\n        \"name\": \"Timing-Allow-Origin\",\n        \"summary\": \"The Timing-Allow-Origin response header specifies origins that are allowed to see values of attributes retrieved via features of the Resource Timing API, which would otherwise be reported as zero due to cross-origin restrictions.\"\n    },\n    \"tk\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Tk\",\n        \"name\": \"Tk\",\n        \"summary\": \"The Tk response header indicates the tracking status that applied to the corresponding request.\"\n    },\n    \"trailer\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Trailer\",\n        \"name\": \"Trailer\",\n        \"summary\": \"The Trailer response header allows the sender to include additional fields at the end of chunked messages in order to supply metadata that might be dynamically generated while the message body is sent, such as a message integrity check, digital signature, or post-processing status.\"\n    },\n    \"transfer-encoding\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Transfer-Encoding\",\n        \"name\": \"Transfer-Encoding\",\n        \"summary\": \"The Transfer-Encoding header specifies the form of encoding used to safely transfer the payload body to the user.\"\n    },\n    \"upgrade-insecure-requests\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Upgrade-Insecure-Requests\",\n        \"name\": \"Upgrade-Insecure-Requests\",\n        \"summary\": \"The HTTP Upgrade-Insecure-Requests request header sends a signal to the server expressing the client’s preference for an encrypted and authenticated response, and that it can successfully handle the upgrade-insecure-requests CSP directive.\"\n    },\n    \"user-agent\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/User-Agent\",\n        \"name\": \"User-Agent\",\n        \"summary\": \"The User-Agent request header is a characteristic string that lets servers and network peers identify the application, operating system, vendor, and/or version of the requesting user agent.\"\n    },\n    \"vary\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Vary\",\n        \"name\": \"Vary\",\n        \"summary\": \"The Vary HTTP response header determines how to match future request headers to decide whether a cached response can be used rather than requesting a fresh one from the origin server.\"\n    },\n    \"via\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Via\",\n        \"name\": \"Via\",\n        \"summary\": \"The Via general header is added by proxies, both forward and reverse proxies, and can appear in the request headers and the response headers.\"\n    },\n    \"www-authenticate\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/WWW-Authenticate\",\n        \"name\": \"WWW-Authenticate\",\n        \"summary\": \"The HTTP WWW-Authenticate response header defines the authentication method that should be used to gain access to a resource.\"\n    },\n    \"want-digest\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Want-Digest\",\n        \"name\": \"Want-Digest\",\n        \"summary\": \"The Want-Digest HTTP header is primarily used in a HTTP request, to ask the responder to provide a digest of the requested resource using the Digest response header.\"\n    },\n    \"warning\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/Warning\",\n        \"name\": \"Warning\",\n        \"summary\": \"The Warning general HTTP header contains information about possible problems with the status of the message.\"\n    },\n    \"x-content-type-options\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/X-Content-Type-Options\",\n        \"name\": \"X-Content-Type-Options\",\n        \"summary\": \"The X-Content-Type-Options response HTTP header is a marker used by the server to indicate that the MIME types advertised in the Content-Type headers should not be changed and be followed.\"\n    },\n    \"x-dns-prefetch-control\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/X-DNS-Prefetch-Control\",\n        \"name\": \"X-DNS-Prefetch-Control\",\n        \"summary\": \"The X-DNS-Prefetch-Control HTTP response header controls DNS prefetching, a feature by which browsers proactively perform domain name resolution on both links that the user may choose to follow as well as URLs for items referenced by the document, including images, CSS, JavaScript, and so forth.\"\n    },\n    \"x-forwarded-for\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/X-Forwarded-For\",\n        \"name\": \"X-Forwarded-For\",\n        \"summary\": \"The X-Forwarded-For (XFF) header is a de-facto standard header for identifying the originating IP address of a client connecting to a web server through an HTTP proxy or a load balancer.\"\n    },\n    \"x-forwarded-host\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/X-Forwarded-Host\",\n        \"name\": \"X-Forwarded-Host\",\n        \"summary\": \"The X-Forwarded-Host (XFH) header is a de-facto standard header for identifying the original host requested by the client in the Host HTTP request header.\"\n    },\n    \"x-forwarded-proto\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/X-Forwarded-Proto\",\n        \"name\": \"X-Forwarded-Proto\",\n        \"summary\": \"The X-Forwarded-Proto (XFP) header is a de-facto standard header for identifying the protocol (HTTP or HTTPS) that a client used to connect to your proxy or load balancer.\"\n    },\n    \"x-frame-options\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/X-Frame-Options\",\n        \"name\": \"X-Frame-Options\",\n        \"summary\": \"The X-Frame-Options HTTP response header can be used to indicate whether or not a browser should be allowed to render a page in a <frame>, <iframe>, <embed> or <object>.\"\n    },\n    \"x-xss-protection\": {\n        \"mdnSlug\": \"Web/HTTP/Headers/X-XSS-Protection\",\n        \"name\": \"X-XSS-Protection\",\n        \"summary\": \"The HTTP X-XSS-Protection response header is a feature of Internet Explorer, Chrome and Safari that stops pages from loading when they detect reflected cross-site scripting (XSS) attacks.\"\n    }\n};\n\n/*\n * Taken from https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods$children?expand\n * Transformed with:\n *\n * let _ = require('lodash');\n * let methods = require('./methods.json');\n * let output = (_(methods.subpages)\n * .keyBy(p => p.title.toLowerCase())\n * .mapValues((p, k) => ({\n *     mdnSlug: p.slug,\n *     name: p.title,\n *     summary: p.summary\n *     .replace(/<(.|\\n)*?>/g, '')\n *     .replace(/&lt;/g, '<')\n *     .replace(/&gt;/g, '>')\n *     .split(/\\.( |$)/)[0] + '.'\n * }))\n * .value())\n * console.log(JSON.stringify(output, null, 4));\n */\nconst METHODS: { [key: string]: MdnDocsData | undefined } = {\n    \"connect\": {\n        \"mdnSlug\": \"Web/HTTP/Methods/CONNECT\",\n        \"name\": \"CONNECT\",\n        \"summary\": \"The HTTP CONNECT method starts two-way communications with the requested resource.\"\n    },\n    \"delete\": {\n        \"mdnSlug\": \"Web/HTTP/Methods/DELETE\",\n        \"name\": \"DELETE\",\n        \"summary\": \"The HTTP DELETE request method deletes the specified resource.\"\n    },\n    \"get\": {\n        \"mdnSlug\": \"Web/HTTP/Methods/GET\",\n        \"name\": \"GET\",\n        \"summary\": \"The HTTP GET method requests a representation of the specified resource.\"\n    },\n    \"head\": {\n        \"mdnSlug\": \"Web/HTTP/Methods/HEAD\",\n        \"name\": \"HEAD\",\n        \"summary\": \"The HTTP HEAD method requests the headers that would be returned if the HEAD request's URL was instead requested with the HTTP GET method.\"\n    },\n    \"options\": {\n        \"mdnSlug\": \"Web/HTTP/Methods/OPTIONS\",\n        \"name\": \"OPTIONS\",\n        \"summary\": \"The HTTP OPTIONS method requests permitted communication options for a given URL or server.\"\n    },\n    \"patch\": {\n        \"mdnSlug\": \"Web/HTTP/Methods/PATCH\",\n        \"name\": \"PATCH\",\n        \"summary\": \"The HTTP PATCH request method applies partial modifications to a resource.\"\n    },\n    \"post\": {\n        \"mdnSlug\": \"Web/HTTP/Methods/POST\",\n        \"name\": \"POST\",\n        \"summary\": \"The HTTP POST method sends data to the server.\"\n    },\n    \"put\": {\n        \"mdnSlug\": \"Web/HTTP/Methods/PUT\",\n        \"name\": \"PUT\",\n        \"summary\": \"The HTTP PUT request method creates a new resource or replaces a representation of the target resource with the request payload.\"\n    },\n    \"trace\": {\n        \"mdnSlug\": \"Web/HTTP/Methods/TRACE\",\n        \"name\": \"TRACE\",\n        \"summary\": \"The HTTP TRACE method performs a message loop-back test along the path to the target resource, providing a useful debugging mechanism.\"\n    }\n};\n\ntype DocsInfo = {\n    url: string,\n    name: string;\n    summary: string;\n};\n\nfunction getDocs(\n    data: { [key: string]: MdnDocsData | undefined },\n    key: string\n): DocsInfo | undefined {\n    const docsInfo = data[key];\n\n    if (!docsInfo) return undefined;\n    return {\n        url: `https://developer.mozilla.org/en-US/docs/${docsInfo.mdnSlug}`,\n        name: docsInfo.name,\n        summary: docsInfo.summary\n    };\n}\n\nexport function getHeaderDocs(headerName: string) {\n    return getDocs(HEADERS, headerName.toLowerCase());\n}\n\ntype StatusDocsInfo = DocsInfo & { message: string };\n\nexport function getStatusDocs(statusCode: string | number) {\n    const statusDocs = getDocs(STATUSES, statusCode.toString()) as Partial<StatusDocsInfo>;\n    if (!statusDocs) return;\n\n    statusDocs.message = statusDocs.name!.split(' ').slice(1).join(' ');\n    return statusDocs as StatusDocsInfo;\n}\n\nexport function getWebSocketCloseCodeDocs(closeCode: string | number | undefined) {\n    if (!closeCode) return;\n    return WEBSOCKET_CLOSE_CODES[closeCode.toString()];\n}\n\nexport function getMethodDocs(methodName: string) {\n    return getDocs(METHODS, methodName.toLowerCase());\n}\n\nexport function getStatusMessage(statusCode: number | undefined) {\n    if (!statusCode) return '';\n\n    const statusData = STATUSES[statusCode.toString()];\n\n    if (!statusData) return '';\n    return statusData.name.slice(4); // Drop the 'XXX ' prefix.\n}","import * as _ from 'lodash';\nimport { MessageBody } from '../../types';\n\n// Simplify a mime type as much as we can, without throwing any errors\nexport const getBaseContentType = (mimeType: string | undefined) => {\n    const typeWithoutParams = (mimeType || '').split(';')[0];\n    const [type, combinedSubTypes] = typeWithoutParams.split(/\\/(.+)/);\n\n    if (!combinedSubTypes) return type;\n\n    // A list of types from most specific to most generic: [svg, xml] for image/svg+xml\n    const subTypes = combinedSubTypes.split('+');\n\n    const possibleTypes = subTypes.map(st => type + '/' + st);\n    return _.find(possibleTypes, t => !!mimeTypeToContentTypeMap[t]) ||\n        _.last(possibleTypes)!; // If we recognize none - return the most generic\n}\n\nexport type ViewableContentType =\n    | 'raw'\n    | 'text'\n    | 'url-encoded'\n    | 'base64'\n    | 'json'\n    | 'xml'\n    | 'html'\n    | 'css'\n    | 'javascript'\n    | 'markdown'\n    | 'yaml'\n    | 'image';\n\nexport const EditableContentTypes = [\n    'text',\n    'json',\n    'xml',\n    'html',\n    'css',\n    'javascript'\n] as const;\n\nexport type EditableContentType = (\n    typeof EditableContentTypes\n) extends ReadonlyArray<infer T> ? T : never;\n\nconst mimeTypeToContentTypeMap: { [mimeType: string]: ViewableContentType } = {\n    'application/json': 'json',\n    'text/json': 'json',\n\n    'application/xml': 'xml',\n    'text/xml': 'xml',\n    'application/rss': 'xml',\n\n    'application/javascript': 'javascript',\n    'application/x-javascript': 'javascript',\n    'application/ecmascript': 'javascript',\n    'text/javascript': 'javascript',\n\n    'text/plain': 'text',\n    'text/csv': 'text',\n\n    'application/x-www-form-urlencoded': 'url-encoded',\n\n    'text/markdown': 'markdown',\n    'text/x-markdown': 'markdown',\n\n    'text/x-yaml': 'yaml',\n    'text/yaml': 'yaml',\n    'application/yaml': 'yaml',\n\n    'image/png': 'image',\n    'image/gif': 'image',\n    'image/jpg': 'image',\n    'image/jpeg': 'image',\n    'image/svg': 'image',\n    'image/tiff': 'image',\n    'image/webp': 'image',\n    'image/avif': 'image',\n    'image/x-icon': 'image',\n    'image/vnd.microsoft.icon': 'image',\n\n    'text/css': 'css',\n\n    'text/html': 'html',\n    'application/xhtml': 'html',\n\n    'application/octet-stream': 'raw'\n} as const;\n\nexport function getContentType(mimeType: string | undefined): ViewableContentType | undefined {\n    const baseContentType = getBaseContentType(mimeType);\n    return mimeTypeToContentTypeMap[baseContentType!];\n}\n\nexport function getEditableContentType(mimeType: string | undefined): EditableContentType | undefined {\n    const baseContentType = getBaseContentType(mimeType);\n    const viewableContentType = mimeTypeToContentTypeMap[baseContentType!];\n\n    if (EditableContentTypes.includes(viewableContentType as any)) {\n        return viewableContentType as EditableContentType;\n    }\n}\n\nexport function getContentEditorName(contentType: ViewableContentType): string {\n    return contentType === 'raw' ? 'Hex'\n        : contentType === 'json' ? 'JSON'\n        : contentType === 'url-encoded' ? 'URL-Encoded'\n        : _.capitalize(contentType);\n}\n\nexport function getDefaultMimeType(contentType: ViewableContentType): string {\n    // Uses the *first* mime type listed for this key in our map\n    return _.findKey(mimeTypeToContentTypeMap, (c) => c === contentType)!;\n}\n\nfunction isValidBase64Byte(byte: number) {\n    return (byte >= 65 && byte <= 90) || // A-Z\n        (byte >= 97 && byte <= 122) ||   // a-z\n        (byte >= 48 && byte <= 57) ||    // 0-9\n        byte === 43 ||                   // +\n        byte === 47 ||                   // /\n        byte === 61;                     // =\n}\n\nexport function getCompatibleTypes(\n    contentType: ViewableContentType,\n    rawContentType: string | undefined,\n    body: MessageBody | Buffer | undefined\n): ViewableContentType[] {\n    let types = new Set([contentType]);\n\n    if (body && !Buffer.isBuffer(body)) {\n        body = body.decoded;\n    }\n\n    // Examine the first char of the body, assuming it's ascii\n    const firstChar = body && body.slice(0, 1).toString('ascii');\n\n    // Allow optionally formatting non-JSON as JSON, if it looks like it might be\n    if (firstChar === '{' || firstChar === '[') {\n        types.add('json');\n    }\n\n    // Allow optionally formatting non-XML as XML, if it looks like it might be\n    if (firstChar === '<') {\n        types.add('xml');\n    }\n\n    // SVGs can always be shown as XML\n    if (rawContentType && rawContentType.startsWith('image/svg')) {\n        types.add('xml');\n    }\n\n    if (\n        body &&\n        body.length > 0 &&\n        body.length % 4 === 0 && // Multiple of 4 bytes\n        body.length < 1000 * 100 && // < 100 KB of content\n        body.every(isValidBase64Byte)\n    ) {\n        types.add('base64');\n    }\n\n    // Lastly, anything can be shown raw or as text, if you like:\n    types.add('text');\n    types.add('raw');\n\n    return Array.from(types);\n}","import * as serializr from 'serializr';\nimport { asBuffer, recursiveMapValues } from '../util';\n\nexport const serializeAsTag = (getTag: (value: any) => any) =>\n    serializr.custom(\n        getTag,\n        () => serializr.SKIP\n    );\n\nexport const serializeRegex = serializr.custom(\n    (value: RegExp) => ({ source: value.source, flags: value.flags }),\n    (value: { source: string, flags: string }) => new RegExp(value.source, value.flags)\n);\n\nexport const serializeBuffer = serializr.custom(\n    (buffer: string | Buffer | Uint8Array | undefined): string | undefined => buffer !== undefined\n        ? asBuffer(buffer).toString('base64')\n        : undefined,\n    (data: string | undefined): Buffer | undefined => data !== undefined\n        ? Buffer.from(data, 'base64')\n        : undefined\n);\n\nconst undefinedPlaceholder = \"__http_toolkit_undefined_placeholder__\";\nexport const serializeWithUndefineds = serializr.custom(\n    (value: {}): string | undefined => value\n        ? JSON.stringify(value, (k, v) =>\n            v === undefined ? undefinedPlaceholder : v\n        )\n        : undefined,\n    (data: string): unknown => !!data\n        ? recursiveMapValues(\n            JSON.parse(data),\n            (v) => v === undefinedPlaceholder ? undefined : v // Can't do this in parse - it drops undef values\n        )\n        : undefined\n);\n\n// Bit of a hack to let us call propSchema.deserializer easily in sync code,\n// without having to fight to collate values from callbacks. Only works for\n// propSchemas that call the callback synchronously.\nfunction syncDeserialize(\n    propSchema: serializr.PropSchema,\n    value: any,\n    context: any\n) {\n    let result: any;\n    let error: any;\n\n    propSchema.deserializer(value, (err, data) => {\n        if (err) error = err;\n        else result = data;\n    }, context, undefined);\n\n    // Requires that the callback was already called!\n    if (error) {\n        throw error;\n    } else {\n        return result;\n    }\n}\n\nexport const serializeMap = (keySchema: serializr.PropSchema, valueSchema: serializr.PropSchema) =>\n    serializr.custom(\n        (map: Map<any, any>) => Array.from(map.entries()).map((entry) =>\n            [\n                keySchema.serializer(entry[0]),\n                valueSchema.serializer(entry[1])\n            ]\n        ),\n        (\n            mapAsArray: any[],\n            context: any,\n            _oldValue: any,\n            callback: (err: any, result: any) => void\n        ) => callback(null,\n            new Map(\n                mapAsArray.map((entry) => [\n                    syncDeserialize(keySchema, entry[0], context),\n                    syncDeserialize(valueSchema, entry[1], context),\n                ]\n            )\n        ))\n    )\n\nexport const hasSerializrSchema = (obj: any) => !!serializr.getDefaultModelSchema(obj);\n\nexport const rawSchema = serializr.createSimpleSchema({ \"*\": true });","import { IObservableValue, observable, action } from 'mobx';\n\nimport { testEncodingsAsync } from '../../services/ui-worker-api';\nimport { ExchangeMessage } from '../../types';\n\nexport function getReadableSize(input: number | Buffer | string, siUnits = true) {\n    const bytes = Buffer.isBuffer(input)\n            ? input.byteLength\n        : typeof input === 'string'\n            ? input.length\n        : input;\n\n    let thresh = siUnits ? 1000 : 1024;\n\n    let units = siUnits\n        ? ['bytes', 'kB','MB','GB','TB','PB','EB','ZB','YB']\n        : ['bytes', 'KiB','MiB','GiB','TiB','PiB','EiB','ZiB','YiB'];\n\n    let unitIndex = bytes === 0 ? 0 :\n        Math.floor(Math.log(bytes) / Math.log(thresh));\n\n    let unitName = bytes === 1 ? 'byte' : units[unitIndex];\n\n    return (bytes / Math.pow(thresh, unitIndex)).toFixed(1).replace(/\\.0$/, '') + ' ' + unitName;\n}\n\nconst EncodedSizesCacheKey = Symbol('encoded-body-test');\ntype EncodedBodySizes = { [encoding: string]: number };\ntype EncodedSizesCache = Map<typeof EncodedSizesCacheKey,\n    IObservableValue<EncodedBodySizes | undefined> | undefined\n>;\n\nexport function testEncodings(message: ExchangeMessage): EncodedBodySizes | undefined {\n    if (!message.body.decoded) return;\n\n    const encodedSizesCache = <EncodedSizesCache> message.cache;\n    const existingObservable = encodedSizesCache.get(EncodedSizesCacheKey);\n\n    if (existingObservable) return existingObservable.get();\n    else {\n        const sizesObservable = observable.box<EncodedBodySizes | undefined>();\n        encodedSizesCache.set(EncodedSizesCacheKey, sizesObservable);\n\n        testEncodingsAsync(message.body.decoded)\n        .then(action((testResults: EncodedBodySizes) => {\n            sizesObservable.set(testResults)\n        }))\n        // Ignore errors for now - we just never resolve if testing something unencodable\n        .catch(() => {});\n\n        // Will be undefined, but ensures we're subscribed to the observable\n        return sizesObservable.get();\n    }\n}","import * as _ from 'lodash';\nimport {\n    WebSocketRuleData,\n    webSocketHandlerDefinitions as wsHandlers,\n    matchers,\n    completionCheckers,\n    Method\n} from 'mockttp';\nimport * as serializr from 'serializr';\n\nimport { RulesStore } from '../rules-store';\n\nimport { MethodNames } from '../../http/methods';\nimport { serializeAsTag } from '../../serialization';\nimport {\n    HttpMatcherLookup,\n    HttpMatcher,\n    WildcardMatcher\n} from './http-rule-definitions';\n\n// Convenient re-export for various built-in handler definitions:\nexport const {\n    EchoWebSocketHandlerDefinition,\n    RejectWebSocketHandlerDefinition,\n    ListenWebSocketHandlerDefinition\n} = wsHandlers;\nexport type EchoWebSocketHandlerDefinition = wsHandlers.EchoWebSocketHandlerDefinition;\nexport type RejectWebSocketHandlerDefinition = wsHandlers.RejectWebSocketHandlerDefinition;\nexport type ListenWebSocketHandlerDefinition = wsHandlers.ListenWebSocketHandlerDefinition;\n\nexport class WebSocketWildcardMatcher extends WildcardMatcher {\n\n    readonly uiType = 'ws-wildcard';\n\n    explain() {\n        return 'Any WebSocket';\n    }\n\n}\n\nexport class DefaultWebSocketWildcardMatcher extends WildcardMatcher {\n\n    readonly uiType = 'default-ws-wildcard';\n\n    explain() {\n        return 'Any other WebSockets';\n    }\n}\n\nexport class WebSocketMethodMatcher extends matchers.MethodMatcher {\n\n    explain() {\n        return `started with ${Method[this.method]}`;\n    }\n\n}\n\nexport class WebSocketPassThroughHandler extends wsHandlers.PassThroughWebSocketHandlerDefinition {\n\n    constructor(rulesStore: RulesStore) {\n        super(rulesStore.activePassthroughOptions);\n    }\n\n}\n\nserializr.createModelSchema(WebSocketPassThroughHandler, {\n    type: serializr.primitive()\n}, (context) => new WebSocketPassThroughHandler(context.args.rulesStore));\n\nexport class WebSocketForwardToHostHandler extends wsHandlers.PassThroughWebSocketHandlerDefinition {\n\n    readonly uiType = 'ws-forward-to-host';\n\n    constructor(forwardToLocation: string, updateHostHeader: boolean, rulesStore: RulesStore) {\n        super({\n            ...rulesStore.activePassthroughOptions,\n            forwarding: {\n                targetHost: forwardToLocation,\n                updateHostHeader: updateHostHeader\n            }\n        });\n    }\n\n}\n\nserializr.createModelSchema(WebSocketForwardToHostHandler, {\n    uiType: serializeAsTag(() => 'ws-forward-to-host'),\n    type: serializr.primitive(),\n    forwarding: serializr.map(serializr.primitive())\n}, (context) => {\n    const data = context.json;\n    return new WebSocketForwardToHostHandler(\n        data.forwarding.targetHost,\n        data.forwarding.updateHostHeader,\n        context.args.rulesStore\n    );\n});\n\nexport const WebSocketMatcherLookup = {\n    ..._.omit(HttpMatcherLookup, MethodNames),\n    'method': WebSocketMethodMatcher, // Unlike HTTP rules, WS uses a single method matcher\n\n    // Replace the wildcard matchers with our own WebSocket versions:\n    'ws-wildcard': WebSocketWildcardMatcher,\n    'default-ws-wildcard': DefaultWebSocketWildcardMatcher\n};\n\nexport const WebSocketInitialMatcherClasses = [\n    WebSocketWildcardMatcher\n];\n\nexport const WebSocketHandlerLookup = {\n    ...wsHandlers.WsHandlerDefinitionLookup,\n    'ws-passthrough': WebSocketPassThroughHandler,\n    'ws-forward-to-host': WebSocketForwardToHostHandler\n};\n\ntype WebSocketHandlerClass = typeof WebSocketHandlerLookup[keyof typeof WebSocketHandlerLookup];\ntype WebSocketHandler = InstanceType<WebSocketHandlerClass>;\n\nexport interface WebSocketMockRule extends Omit<WebSocketRuleData, 'matchers'> {\n    id: string;\n    type: 'websocket';\n    activated: boolean;\n    // WebSockets use the same HTTP matchers, but require an initial WebSocket matcher:\n    matchers: Array<HttpMatcher> & {\n        0?: WebSocketWildcardMatcher | DefaultWebSocketWildcardMatcher\n    };\n    handler: WebSocketHandler;\n    completionChecker: completionCheckers.Always; // HTK rules all *always* match\n};","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"app.worker.js\");\n}\n","/*\n * SPDX-FileCopyrightText: 2022 Tim Perry <tim@httptoolkit.com>\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport {\n    PluggableAdmin\n} from 'mockttp';\nimport {\n    MatcherDefinitions,\n    HandlerStepDefinitions\n} from 'mockrtc';\n\nexport const { Serializable } = PluggableAdmin.Serialization;\n\nexport class RTCWildcardMatcher extends Serializable {\n\n    readonly type = 'rtc-wildcard';\n\n    explain() {\n        return 'WebRTC connections';\n    }\n\n}\n\n// Convenient re-export for various built-in matcher definitions:\nexport const {\n    HasDataChannelMatcherDefinition,\n    HasVideoTrackMatcherDefinition,\n    HasAudioTrackMatcherDefinition,\n    HasMediaTrackMatcherDefinition\n} = MatcherDefinitions;\nexport type HasDataChannelMatcherDefinition = MatcherDefinitions.HasDataChannelMatcherDefinition;\nexport type HasVideoTrackMatcherDefinition = MatcherDefinitions.HasVideoTrackMatcherDefinition;\nexport type HasAudioTrackMatcherDefinition = MatcherDefinitions.HasAudioTrackMatcherDefinition;\nexport type HasMediaTrackMatcherDefinition = MatcherDefinitions.HasMediaTrackMatcherDefinition;\n\nexport const RTCMatcherLookup = {\n    ...MatcherDefinitions.MatcherDefinitionLookup,\n\n    'rtc-wildcard': RTCWildcardMatcher\n};\n\nexport const RTCInitialMatcherClasses = [\n    RTCWildcardMatcher\n];\n\n// Convenient re-export for various built-in step definitions:\nexport const {\n    DynamicProxyStepDefinition,\n    EchoStepDefinition,\n    CloseStepDefinition,\n    WaitForMediaStepDefinition,\n    WaitForDurationStepDefinition,\n    WaitForChannelStepDefinition,\n    WaitForMessageStepDefinition,\n    CreateChannelStepDefinition,\n    SendStepDefinition\n} = HandlerStepDefinitions;\nexport type DynamicProxyStepDefinition = HandlerStepDefinitions.DynamicProxyStepDefinition;\nexport type EchoStepDefinition = HandlerStepDefinitions.EchoStepDefinition;\nexport type CloseStepDefinition = HandlerStepDefinitions.CloseStepDefinition;\nexport type WaitForMediaStepDefinition = HandlerStepDefinitions.WaitForMediaStepDefinition;\nexport type WaitForDurationStepDefinition = HandlerStepDefinitions.WaitForDurationStepDefinition;\nexport type WaitForChannelStepDefinition = HandlerStepDefinitions.WaitForChannelStepDefinition;\nexport type WaitForMessageStepDefinition = HandlerStepDefinitions.WaitForMessageStepDefinition;\nexport type CreateChannelStepDefinition = HandlerStepDefinitions.CreateChannelStepDefinition;\nexport type SendStepDefinition = HandlerStepDefinitions.SendStepDefinition;\n\nexport const RTCStepLookup = {\n    ...HandlerStepDefinitions.StepDefinitionLookup\n};\n\ntype RTCMatcherClass = typeof RTCMatcherLookup[keyof typeof RTCMatcherLookup];\nexport type RTCMatcher = InstanceType<RTCMatcherClass>;\nexport type RTCInitialMatcher = InstanceType<typeof RTCInitialMatcherClasses[number]>;\n\nexport type RTCStepClass = typeof RTCStepLookup[keyof typeof RTCStepLookup];\nexport type RTCStep = InstanceType<RTCStepClass>;\n\nexport interface RTCMockRule {\n    id: string;\n    type: 'webrtc';\n    activated: boolean;\n    matchers: Array<RTCMatcher> & { 0?: RTCInitialMatcher };\n    steps: RTCStep[];\n};","export function delay(numberMs: number) {\n    return new Promise((resolve) => setTimeout(resolve, numberMs));\n}\n\nexport function attempt<T>(fn: () => T): Promise<T> {\n    try {\n        const result = fn();\n        return Promise.resolve(result);\n    } catch (e) {\n        return Promise.reject(e);\n    }\n}\n\nexport interface Deferred<T> {\n    resolve: (arg: T) => void,\n    reject: (e?: Error) => void,\n    promise: Promise<T>\n}\n\nexport function getDeferred<T = void>(): Deferred<T> {\n    let resolve: undefined | ((arg: T) => void) = undefined;\n    let reject: undefined | ((e?: Error) => void) = undefined;\n\n    let promise = new Promise<T>((resolveCb, rejectCb) => {\n        resolve = resolveCb;\n        reject = rejectCb;\n    });\n\n    // TS thinks we're using these before they're assigned, which is why\n    // we need the undefined types, and the any here.\n    return { resolve, reject, promise } as any;\n}","import deserializeError from 'deserialize-error';\nimport { EventEmitter } from 'events';\nimport type { SUPPORTED_ENCODING } from 'http-encoding';\n\nimport type {\n    BackgroundRequest,\n    BackgroundResponse,\n    DecodeRequest,\n    DecodeResponse,\n    BuildApiResponse,\n    BuildApiRequest,\n    TestEncodingsRequest,\n    TestEncodingsResponse,\n    EncodeRequest,\n    EncodeResponse,\n    ValidatePKCSRequest,\n    ValidatePKCSResponse,\n    FormatRequest,\n    FormatResponse,\n    ParseCertRequest,\n    ParseCertResponse\n} from './ui-worker';\nimport Worker from 'worker-loader!./ui-worker';\n\nimport { Omit } from '../types';\nimport type { ApiMetadata, ApiSpec } from '../model/api/api-interfaces';\nimport { WorkerFormatterKey } from './ui-worker-formatters';\n\nconst worker = new Worker();\n\nlet messageId = 0;\nfunction getId() {\n    return messageId++;\n}\n\nconst emitter = new EventEmitter();\n\nworker.addEventListener('message', (event) => {\n    emitter.emit(event.data.id.toString(), event.data);\n});\n\nfunction callApi<\n    T extends BackgroundRequest,\n    R extends BackgroundResponse\n>(request: Omit<T, 'id'>, transfer: any[] = []): Promise<R> {\n    const id = getId();\n\n    return new Promise<R>((resolve, reject) => {\n        worker.postMessage(Object.assign({ id }, request), transfer);\n\n        emitter.once(id.toString(), (data: R) => {\n            if (data.error) {\n                reject(deserializeError(data.error));\n            } else {\n                resolve(data);\n            }\n        });\n    });\n}\n\n/**\n * Takes a body, asynchronously decodes it and returns the decoded buffer.\n *\n * Note that this requires transferring the _encoded_ body to a web worker,\n * so after this is run the encoded the buffer will become empty, if any\n * decoding is actually required.\n *\n * The method returns an object containing the new decoded buffer and the\n * original encoded data (transferred back) in a new buffer.\n */\nexport async function decodeBody(encodedBuffer: Buffer, encodings: string[]) {\n    if (\n        encodings.length === 0 || // No encoding\n        (encodings.length === 1 && encodings[0] === 'identity') || // No-op only encoding\n        encodedBuffer.length === 0 // Empty body (e.g. HEAD, 204, etc)\n    ) {\n        // Shortcut to skip decoding when we know it's not required:\n        return { encoded: encodedBuffer, decoded: encodedBuffer };\n    }\n\n    try {\n        const result = await callApi<DecodeRequest, DecodeResponse>({\n            type: 'decode',\n            buffer: encodedBuffer.buffer as ArrayBuffer,\n            encodings\n        }, [encodedBuffer.buffer]);\n\n        return {\n            encoded: Buffer.from(result.inputBuffer),\n            decoded: Buffer.from(result.decodedBuffer)\n        };\n    } catch (e: any) {\n        // In general, the worker should return the original encoded buffer to us, so we can\n        // show it to the user to help them debug encoding issues:\n        if (e.inputBuffer) {\n            e.inputBuffer = Buffer.from(e.inputBuffer);\n        }\n        throw e;\n    }\n}\n\nexport async function encodeBody(decodedBuffer: Buffer, encodings: string[]) {\n    if (\n        encodings.length === 0 ||\n        (encodings.length === 1 && encodings[0] === 'identity')\n    ) {\n        // Shortcut to skip encoding when we know it's not required\n        return decodedBuffer;\n    }\n\n    const result = await callApi<EncodeRequest, EncodeResponse>({\n        type: 'encode',\n        buffer: decodedBuffer.buffer as ArrayBuffer,\n        encodings: encodings as SUPPORTED_ENCODING[]\n    });\n\n    return Buffer.from(result.encodedBuffer);\n}\n\nexport async function testEncodingsAsync(decodedBuffer: Buffer) {\n    return (await callApi<TestEncodingsRequest, TestEncodingsResponse>({\n        type: 'test-encodings',\n        decodedBuffer: decodedBuffer\n    })).encodingSizes;\n}\n\nexport async function buildApiMetadataAsync(\n    spec: ApiSpec,\n    baseUrlOverrides?: string[]\n): Promise<ApiMetadata> {\n    return (await callApi<BuildApiRequest, BuildApiResponse>({\n        type: 'build-api',\n        spec,\n        baseUrlOverrides\n    })).api;\n}\n\nexport async function validatePKCS(buffer: ArrayBuffer, passphrase: string | undefined) {\n    return (await callApi<ValidatePKCSRequest, ValidatePKCSResponse>({\n        type: 'validate-pkcs12',\n        buffer,\n        passphrase\n    })).result;\n}\n\nexport async function parseCert(buffer: ArrayBuffer) {\n    return (await callApi<ParseCertRequest, ParseCertResponse>({\n        type: 'parse-cert',\n        buffer\n    })).result;\n}\n\nexport async function formatBufferAsync(buffer: ArrayBuffer, format: WorkerFormatterKey) {\n    return (await callApi<FormatRequest, FormatResponse>({\n        type: 'format',\n        buffer,\n        format\n    })).formatted;\n}","/*\n * SPDX-FileCopyrightText: 2022 Tim Perry <tim@httptoolkit.com>\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport {\n    ContentDescriptorObject,\n    JSONSchemaObject,\n    MethodObject,\n    OpenrpcDocument\n} from \"@open-rpc/meta-schema\";\nimport { SchemaObject } from \"openapi-directory\";\nimport { HtkResponse, Html, HttpExchange } from \"../../types\";\nimport { ErrorLike, isErrorLike } from \"../../util/error\";\nimport { fromMarkdown } from \"../ui/markdown\";\nimport {\n    ApiExchange,\n    ApiOperation,\n    ApiParameter,\n    ApiRequest,\n    ApiResponse,\n    ApiService\n} from \"./api-interfaces\";\n\nexport type OpenRpcDocument = OpenrpcDocument;\n\nexport interface OpenRpcMetadata {\n    type: 'openrpc';\n    spec: OpenRpcDocument;\n    serverMatcher: RegExp;\n    requestMatchers: { [methodName: string] : MethodObject }; // JSON-RPC method name to method\n}\n\nexport async function parseRpcApiExchange(\n    api: OpenRpcMetadata,\n    exchange: HttpExchange\n): Promise<JsonRpcApiExchange> {\n    try {\n        const body = await exchange.request.body.decodedPromise;\n\n        if (!body?.length) throw new Error(`No JSON-RPC request body`);\n\n        let parsedBody: any;\n        let methodName: string;\n        try {\n            parsedBody = JSON.parse(body?.toString());\n            if (parsedBody.jsonrpc !== '2.0') throw new Error(\n                `JSON-RPC request body had bad 'jsonrpc' field: ${parsedBody.jsonrpc}`\n            );\n\n            methodName = parsedBody.method;\n        } catch (e) {\n            console.warn(e);\n            throw new Error('Could not parse JSON-RPC request body');\n        }\n\n        const methodSpec = api.requestMatchers[methodName];\n        if (!methodSpec) throw new Error(`Unrecognized JSON-RPC method name: ${methodName}`);\n\n        const operation = {\n            methodSpec,\n            parsedBody\n        };\n\n        return new JsonRpcApiExchange(api, exchange, operation);\n    } catch (error) {\n        return new JsonRpcApiExchange(api, exchange, error as ErrorLike);\n    }\n}\n\ninterface MatchedOperation {\n    methodSpec: MethodObject;\n    parsedBody: any;\n}\n\nexport class JsonRpcApiExchange implements ApiExchange {\n\n    constructor(\n        _api: OpenRpcMetadata,\n        _exchange: HttpExchange,\n        private _rpcMethod: MatchedOperation | ErrorLike\n    ) {\n        this.isBuiltInApi = _api.spec.info['x-httptoolkit-builtin-api'] === true;\n\n        this.service = new JsonRpcApiService(_api);\n\n        if (isErrorLike(_rpcMethod)) {\n            this.operation = {\n                name: 'Unrecognized request to JSON-RPC API',\n                warnings: [_rpcMethod.message ?? _rpcMethod.toString()]\n            };\n            this.request = { parameters: [] };\n        } else {\n            this.operation = new JsonRpcApiOperation(\n                _rpcMethod,\n                _api.spec.externalDocs?.['x-method-base-url'] // Custom extension\n            );\n            this.request = new JsonRpcApiRequest(_rpcMethod, _exchange);\n        }\n    }\n\n    readonly isBuiltInApi: boolean;\n\n    readonly service: ApiService;\n    readonly operation: ApiOperation;\n    readonly request: ApiRequest;\n    response: ApiResponse | undefined;\n\n    updateWithResponse(response: HtkResponse | \"aborted\" | undefined): void {\n        if (\n            response === 'aborted' ||\n            response === undefined ||\n            isErrorLike(this._rpcMethod)\n        ) return;\n\n        this.response = new JsonRpcApiResponse(this._rpcMethod);\n    }\n\n    matchedOperation(): boolean {\n        return this._rpcMethod && !isErrorLike(this._rpcMethod);\n    }\n\n}\n\nexport class JsonRpcApiService implements ApiService {\n\n    constructor(api: OpenRpcMetadata) {\n        this.name = api.spec.info.title;\n        this.shortName = api.spec.info['x-httptoolkit-short-name']\n            ?? this.name.split(' ')[0];\n\n        this.logoUrl = api.spec.info['x-logo']?.url;\n        this.description = fromMarkdown(api.spec.info.description);\n        this.docsUrl = api.spec.externalDocs?.url;\n    }\n\n    readonly shortName: string;\n    readonly name: string;\n    readonly logoUrl?: string | undefined;\n    readonly description?: Html | undefined;\n    readonly docsUrl?: string | undefined;\n\n}\n\nexport class JsonRpcApiOperation implements ApiOperation {\n\n    constructor(\n        rpcMethod: MatchedOperation,\n        methodDocsBaseUrl: string | undefined\n    ) {\n        const { methodSpec } = rpcMethod;\n\n        this.name = methodSpec.name;\n        this.description = fromMarkdown([\n            methodSpec.summary,\n            methodSpec.description\n        ].filter(x => !!x).join('\\n\\n'));\n        this.docsUrl = methodSpec.externalDocs?.url\n            ?? (methodDocsBaseUrl\n                ? methodDocsBaseUrl + methodSpec.name.toLowerCase()\n                : undefined\n            );\n\n        if (methodSpec.deprecated) {\n            this.warnings.push(`The '${this.name}' method is deprecated.`);\n        }\n    }\n\n    name: string;\n    description?: Html | undefined;\n    docsUrl?: string | undefined;\n    warnings: string[] = [];\n\n}\n\nconst capitalizeFirst = (input: string | undefined) =>\n    input\n    ? input.charAt(0).toUpperCase() + input.slice(1)\n    : undefined;\n\nexport class JsonRpcApiRequest implements ApiRequest {\n\n    constructor(rpcMethod: MatchedOperation, exchange: HttpExchange) {\n        const { methodSpec, parsedBody } = rpcMethod;\n\n        this.parameters = (methodSpec.params as ContentDescriptorObject[])\n            .map((param: ContentDescriptorObject, i: number) => {\n                const schema = param.schema as JSONSchemaObject | undefined;\n\n                return {\n                    name: param.name,\n                    description: fromMarkdown([\n                        param.summary,\n                        param.description,\n                        capitalizeFirst(schema?.title),\n                        ...(schema?.oneOf?.length\n                            ? [\n                                'One of:',\n                                (schema.oneOf as JSONSchemaObject[]).map(subschema =>\n                                    `* ${capitalizeFirst(subschema.title)}: ${\n                                        subschema.description || subschema.type || 'unknown'\n                                    }`\n                                ).join('\\n')\n                            ]\n                            : []\n                        )\n                    ].filter(x => !!x).join('\\n\\n')),\n                    in: 'body',\n                    required: !!param.required,\n                    deprecated: !!param.deprecated,\n                    type: schema?.type,\n                    value: parsedBody.params[i],\n                    defaultValue: schema?.default,\n                    enum: schema?.enum || (schema?.items as SchemaObject | undefined)?.enum,\n                    warnings: [\n                        ...(param.deprecated ? [`The '${param.name}' parameter is deprecated.`] : []),\n                        ...(param.required &&\n                            parsedBody.params[i] === undefined &&\n                            (schema && schema.default === undefined)\n                            ? [`The '${param.name}' parameter is required.`]\n                            : []\n                        )\n                    ]\n                };\n            });\n    }\n\n    parameters: ApiParameter[];\n\n}\n\nexport class JsonRpcApiResponse implements ApiResponse {\n\n    constructor(rpcMethod: MatchedOperation) {\n        const resultSpec = rpcMethod.methodSpec.result as ContentDescriptorObject;\n\n        this.description = fromMarkdown(resultSpec.description);\n        this.bodySchema = {\n            type: 'object',\n            properties: {\n                id: { type: 'number' },\n                jsonrpc: { type: 'string', enum: ['2.0'] },\n                result: resultSpec.schema as SchemaObject,\n                error: {\n                    type: 'object',\n                    properties: {\n                        code: { type: 'number' },\n                        message: { type: 'string' }\n                    }\n                }\n            },\n            required: ['id', 'jsonrpc']\n        };\n    }\n\n    description?: Html;\n    bodySchema?: SchemaObject;\n\n}\n","import * as _ from 'lodash';\n\nimport {\n    requestHandlers,\n    MOCKTTP_PARAM_REF,\n    ProxyConfig,\n    ProxySetting,\n    RuleParameterReference,\n    ProxySettingSource\n} from 'mockttp';\nimport * as MockRTC from 'mockrtc';\n\nimport {\n    observable,\n    action,\n    flow,\n    computed,\n    observe,\n    when,\n    reaction,\n    runInAction\n} from 'mobx';\nimport * as uuid from 'uuid/v4';\nimport * as serializr from 'serializr';\nimport { encode as encodeBase64, decode as decodeBase64 } from 'base64-arraybuffer';\nimport * as semver from 'semver';\n\nimport {\n    HttpExchange,\n    MockttpBreakpointedRequest,\n    MockttpBreakpointedResponse\n} from '../../types';\nimport { lazyObservablePromise } from '../../util/observable';\nimport { persist, hydrate } from '../../util/mobx-persist/persist';\nimport { logError } from '../../errors';\n\nimport { AccountStore } from '../account/account-store';\nimport { ProxyStore } from '../proxy-store';\nimport { getDesktopInjectedValue } from '../../services/desktop-api';\nimport { RTC_RULES_SUPPORTED, WEBSOCKET_RULE_RANGE } from '../../services/service-versions';\n\nimport {\n    HtkMockRule,\n    isHttpBasedRule,\n    isWebSocketRule,\n    isRTCRule\n} from './rules';\nimport {\n    HtkMockRuleGroup,\n    flattenRules,\n    ItemPath,\n    isRuleGroup,\n    getItemAtPath,\n    getItemParentByPath,\n    updateItemAtPath,\n    deleteItemAtPath,\n    findItem,\n    findItemPath,\n    HtkMockRuleRoot,\n    isRuleRoot,\n    HtkMockItem,\n    areItemsEqual,\n} from './rules-structure';\nimport {\n    buildDefaultGroupRules,\n    buildDefaultGroupWrapper,\n    buildDefaultRulesRoot,\n    buildForwardingRuleIntegration,\n} from './rule-creation';\nimport {\n    serializeRules,\n    deserializeRules,\n    MockRulesetSchema,\n    DeserializationArgs\n} from './rule-serialization';\nimport { migrateRuleData } from './rule-migrations';\nimport { ParsedCertificate } from '../crypto';\n\nexport type ClientCertificate = {\n    readonly pfx: ArrayBuffer,\n    readonly passphrase?: string,\n    readonly filename: string\n};\n\nconst clientCertificateSchema = serializr.createSimpleSchema({\n    passphrase: serializr.primitive(),\n    filename: serializr.primitive(),\n    pfx: serializr.custom(encodeBase64, decodeBase64)\n});\n\nconst reloadRules = (ruleRoot: HtkMockRuleRoot, rulesStore: RulesStore) => {\n    return deserializeRules(serializeRules(ruleRoot), { rulesStore });\n};\n\nconst dockerProxyRuleParamName = (port: number) =>\n    `docker-tunnel-proxy-${port}`;\n\nexport type UpstreamProxyType =\n    | 'system'\n    | 'direct'\n    | 'http'\n    | 'https'\n    | 'socks4'\n    | 'socks4a'\n    | 'socks5'\n    | 'socks5h';\n\nexport class RulesStore {\n\n    constructor(\n        private readonly accountStore: AccountStore,\n        private readonly proxyStore: ProxyStore,\n        private readonly jumpToExchange: (exchangeId: string) => Promise<HttpExchange>\n    ) { }\n\n    readonly initialized = lazyObservablePromise(async () => {\n        await Promise.all([\n            this.accountStore.initialized,\n            this.proxyStore.initialized\n        ]);\n\n        await this.loadSettings();\n\n        const {\n            setRequestRules,\n            setWebSocketRules,\n            setRTCRules,\n            serverVersion\n        } = this.proxyStore;\n\n        // When the general config options change, reload all rules to re-inject the config\n        // into all the rules that need it.\n        reaction(\n            () => {\n                return this.activePassthroughOptions;\n            },\n            () => {\n                this.rules = reloadRules(this.rules, this);\n                this.draftRules = reloadRules(this.draftRules, this);\n            }\n        );\n\n        // Reset the proxy host if the type is changed to one where no host is required\n        reaction(\n            () => this.upstreamProxyType,\n            (type) => {\n                if (type === 'direct' || type === 'system') {\n                    this.upstreamProxyHost = undefined;\n                }\n            }\n        );\n\n        // Set the server rules, and subscribe future rule changes to update them later.\n        await new Promise<void>((resolve) => {\n            reaction(\n                () => _.cloneDeep( // Clone to retain the pre-serialization definitions.\n                    flattenRules(this.rules)\n                    // Drop inactive or never-matching rules\n                    .filter(r => r.activated && r.matchers.length),\n                ),\n                async (rules) => {\n                    try {\n                        await Promise.all([\n                            setRequestRules(...rules.filter(isHttpBasedRule)),\n                            ...(semver.satisfies(serverVersion, WEBSOCKET_RULE_RANGE)\n                                ? [\n                                    setWebSocketRules(...rules.filter(isWebSocketRule))\n                                ] : []\n                            ),\n                            ...(semver.satisfies(serverVersion, RTC_RULES_SUPPORTED)\n                                ? [\n                                    setRTCRules(...rules.filter(isRTCRule).map(({ matchers, steps }) => ({\n                                        // We skip the first matcher, which is always an unused wildcard:\n                                        matchers: matchers.slice(1) as MockRTC.MatcherDefinitions.MatcherDefinition[],\n                                        steps\n                                    })))\n                                ] : []\n                            )\n                        ]);\n                        resolve();\n                    } catch (e) {\n                        console.log('Failed to activate stored rules', e, JSON.stringify(rules));\n                        logError('Failed to activate configured ruleset');\n                        alert(`Configured rules could not be activated, so were reset to default.`);\n\n                        this.resetRulesToDefault(); // Should trigger the reaction above again, and thereby resolve().\n                    }\n                },\n                { fireImmediately: true }\n            )\n        })\n\n        console.log('Rules store initialized');\n    });\n\n    private async loadSettings() {\n        const { accountStore } = this;\n\n        // Load rule configuration settings from storage\n        await hydrate({\n            key: 'rules-store',\n            store: this,\n            dataTransform: (data: {}) => _.omit(data, 'rules'),\n        });\n\n        try {\n            // Backward compatibility for the previous 'draft' data fields.\n            const rawStoreData = JSON.parse(localStorage.getItem('rules-store') ?? '{}');\n            runInAction(() => {\n                if ('draftWhitelistedCertificateHosts' in rawStoreData) {\n                    this.whitelistedCertificateHosts = rawStoreData.draftWhitelistedCertificateHosts;\n                }\n                if ('draftClientCertificateHostMap' in rawStoreData) {\n                    this.clientCertificateHostMap = rawStoreData.draftClientCertificateHostMap;\n                }\n            });\n        } catch (e) {\n            logError(e);\n        }\n\n        if (accountStore.mightBePaidUser) {\n            // Load the actual rules from storage (separately, so deserialization can use settings loaded above)\n            await hydrate({\n                key: 'rules-store',\n                store: this,\n                dataTransform: (data: { rules: any }) => ({\n                    rules: migrateRuleData(data.rules)\n                }),\n                customArgs: { rulesStore: this } as DeserializationArgs\n            }).catch((err) => {\n                console.log('Failed to load last-run rules',\n                    err,\n                    // Log the full rule data for debugging:\n                    JSON.parse(localStorage.getItem('rules-store') ?? '{}')?.rules\n                );\n\n                logError(err);\n                alert(`Could not load rules from last run.\\n\\n${err}`);\n                // We then continue, which resets the rules exactly as if this was the user's first run.\n            });\n\n            if (!this.rules) {\n                // If rules are somehow undefined (not sure, but seems it can happen, maybe odd data?) reset them:\n                this.resetRulesToDefault();\n            } else {\n                // Drafts are never persisted, so always need resetting to match the just-loaded data:\n                this.resetRuleDrafts();\n\n                // Recreate default rules on startup, even if we're restoring persisted rules\n                const defaultRules = buildDefaultGroupRules(this, this.proxyStore);\n                defaultRules.forEach(r => this.ensureRuleExists(r));\n            }\n        } else {\n            // For free users, reset rules to default (separately, so defaults can use settings loaded above)\n            this.resetRulesToDefault();\n        }\n\n        // Support injection of a default forwarding rule by the desktop app, for integrations\n        this.ensureRuleDoesNotExist('default-forwarding-rule');\n        getDesktopInjectedValue('httpToolkitForwardingDefault').then(action((forwardingConfig: string) => {\n            const [sourceHost, targetHost] = forwardingConfig.split('|');\n            const forwardingRule = buildForwardingRuleIntegration(sourceHost, targetHost, this);\n            this.ensureRuleExists(forwardingRule);\n        }));\n\n        if ((this.upstreamProxyType as string) === 'socks') {\n            runInAction(() => {\n                // Backward compat from when we only supported generic 'socks' proxies, not individual types.\n                this.upstreamProxyType = 'socks5h';\n            });\n        }\n\n        // Every time the user account data is updated from the server, consider resetting\n        // paid settings to the free defaults. This ensures that they're reset on\n        // logout & subscription expiration (even if that happened while the app was\n        // closed), but don't get reset when the app starts with stale account data.\n        observe(accountStore, 'accountDataLastUpdated', () => {\n            if (!accountStore.isPaidUser) {\n                this.whitelistedCertificateHosts = ['localhost'];\n                this.clientCertificateHostMap = {};\n                this.upstreamProxyType = 'system';\n                this.upstreamNoProxyHosts = [];\n\n                // We don't reset the rules on expiry/log out, e.g. to remove paid rule types, but\n                // they won't persist, so they'll disappear next time the app is started up.\n            }\n        });\n    }\n\n    // This is live updated as the corresponding fields change, and so the resulting rules are\n    // updated immediately as this changes too.\n    @computed.struct\n    get activePassthroughOptions(): requestHandlers.PassThroughHandlerOptions {\n        const options: requestHandlers.PassThroughHandlerOptions = { // Check the type to catch changes\n            ignoreHostHttpsErrors: this.whitelistedCertificateHosts,\n            trustAdditionalCAs: this.additionalCaCertificates.map((cert) => ({ cert: cert.rawPEM })),\n            clientCertificateHostMap: _.mapValues(this.clientCertificateHostMap, (cert) => ({\n                pfx: Buffer.from(cert.pfx),\n                passphrase: cert.passphrase\n            })),\n            proxyConfig: this.proxyConfig,\n            lookupOptions: this.proxyStore.dnsServers.length\n                ? { servers: this.proxyStore.dnsServers }\n                : undefined,\n            simulateConnectionErrors: true\n        };\n\n        // Clone to ensure we touch & subscribe to everything here\n        return _.cloneDeep(options);\n    }\n\n    @persist @observable\n    upstreamProxyType: UpstreamProxyType = 'system';\n\n    @persist @observable\n    upstreamProxyHost: string | undefined = undefined;\n\n    @persist('list') @observable\n    upstreamNoProxyHosts: string[] = [];\n\n    @computed\n    get effectiveSystemProxyConfig(): ProxySetting | 'ignored' | 'unparseable' | undefined {\n        const { systemProxyConfig } = this.proxyStore;\n\n        if (!systemProxyConfig) return undefined;\n\n        const { proxyUrl } = systemProxyConfig;\n        try {\n            const parsedProxyUrl = new URL(proxyUrl);\n            const { hostname } = parsedProxyUrl;\n            if (hostname === 'localhost' || hostname.startsWith('127.0.0')) {\n                // Localhost proxy config is ignored\n                return 'ignored';\n            } else {\n                return systemProxyConfig;\n            }\n        } catch (e) {\n            console.log(\"Could not parse proxy\", proxyUrl);\n            logError(e);\n            return 'unparseable';\n        }\n    }\n\n    @computed.struct\n    get userProxyConfig(): ProxySetting | undefined {\n        if (this.upstreamProxyType === 'direct') {\n            return undefined;\n        } else if (this.upstreamProxyType === 'system') {\n            const systemConfig = this.effectiveSystemProxyConfig;\n\n            if (!systemConfig || _.isString(systemConfig)) return undefined;\n            else return systemConfig;\n        } else {\n            return {\n                proxyUrl: `${this.upstreamProxyType}://${this.upstreamProxyHost!}`,\n                noProxy: this.upstreamNoProxyHosts\n            };\n        }\n    }\n\n    @computed.struct\n    get proxyConfig():\n        | ProxySetting\n        | RuleParameterReference<ProxySettingSource>\n        | Array<ProxySetting | RuleParameterReference<ProxySettingSource>>\n        | undefined\n    {\n        const { userProxyConfig } = this;\n        const { httpProxyPort } = this.proxyStore;\n\n        if (this.proxyStore.ruleParameterKeys.includes(dockerProxyRuleParamName(httpProxyPort))) {\n            const dockerProxyConfig = { [MOCKTTP_PARAM_REF]: dockerProxyRuleParamName(httpProxyPort) };\n\n            return userProxyConfig\n                ? [dockerProxyConfig, userProxyConfig]\n                : dockerProxyConfig;\n        } else {\n            return userProxyConfig;\n        }\n    }\n\n    // The currently active list\n    @persist('list') @observable\n    whitelistedCertificateHosts: string[] = ['localhost'];\n\n    // The currently active client certificates\n    @persist('map', clientCertificateSchema) @observable\n    clientCertificateHostMap: { [host: string]: ClientCertificate } = {};\n\n    // The currently active additional CA certificates\n    @persist('list') @observable\n    additionalCaCertificates: Array<ParsedCertificate> = [];\n\n    @persist('object', MockRulesetSchema) @observable\n    rules!: HtkMockRuleRoot;\n\n    @observable\n    draftRules!: HtkMockRuleRoot;\n\n    @action.bound\n    saveRules() {\n        this.rules = this.draftRules;\n        this.resetRuleDrafts();\n    }\n\n    @action.bound\n    resetRuleDrafts() {\n        // Set the rules back to the latest saved version\n        this.draftRules = _.cloneDeep(this.rules);\n    }\n\n    @action.bound\n    resetRulesToDefault() {\n        // Set the rules back to the default settings\n        this.rules = buildDefaultRulesRoot(this, this.proxyStore);\n        this.resetRuleDrafts();\n    }\n\n    @computed\n    get areSomeRulesUnsaved() {\n        return !_.isEqualWith(this.draftRules, this.rules, areItemsEqual);\n    }\n\n    @computed\n    get areSomeRulesNonDefault() {\n        const defaultRules = buildDefaultRulesRoot(this, this.proxyStore);\n        return !_.isEqualWith(this.draftRules, defaultRules, areItemsEqual);\n    }\n\n    @action.bound\n    resetRule(draftItemPath: ItemPath) {\n        // To reset a single rule, we reset the group & content of that rule, resetting only the\n        // position of this one rule (different to save rule: see below). The difference is because\n        // this is a clear & visible change, so doing the smaller move is easy & makes more sense.\n\n        const { draftRules, rules: activeRules } = this;\n\n        const draftRule = getItemAtPath(draftRules, draftItemPath);\n        if (isRuleGroup(draftRule)) throw new Error(\"Can't reset single rule group\");\n        const id = draftRule.id;\n\n        const activeRulePath = findItemPath(activeRules, { id });\n        if (!activeRulePath) throw new Error(\"Can't reset a new rule\");\n\n        const activeRule = getItemAtPath(activeRules, activeRulePath);\n\n        // Update the rule content:\n\n        const activeParent = getItemParentByPath(activeRules, activeRulePath);\n        const currentDraftParent = getItemParentByPath(draftRules, draftItemPath);\n        let targetDraftParent = findItem(draftRules, { id: activeParent.id }) as HtkMockRuleGroup;\n\n        if (!targetDraftParent) {\n            let missingParents = [activeParent];\n            // Loop up until we find a parent that _does_ exist, and then insert all\n            // missing parents from that point.\n            while (missingParents.length) {\n                const missingParentsActivePath = activeRulePath.slice(0, -missingParents.length);\n                const nextActiveParent = getItemParentByPath(activeRules, missingParentsActivePath);\n\n                const targetDraftParentParent = findItem(draftRules, { id: nextActiveParent.id }) as HtkMockRuleGroup;\n\n                if (targetDraftParentParent) {\n                    targetDraftParent = missingParents.reduce(({ draftParent, activeParent }, missingGroup) => {\n                        const newGroup = observable(_.clone({ ...missingGroup, items: [] }));\n\n                        const draftCommonSiblings = _.intersectionBy(draftParent.items, activeParent.items, 'id');\n                        const activeCommonSiblings = _.intersectionBy(activeParent.items, draftParent.items.concat(missingGroup), 'id');\n\n                        const targetSiblingIndex = _.findIndex(activeCommonSiblings, { id: missingGroup.id });\n\n                        if (targetSiblingIndex > 0) {\n                            const targetPredecessor = draftCommonSiblings[targetSiblingIndex - 1];\n                            const targetIndex = _.findIndex(draftParent.items, { id: targetPredecessor.id }) + 1;\n                            draftParent.items.splice(targetIndex, 0, newGroup);\n                        } else {\n                            draftParent.items.unshift(newGroup);\n                        }\n\n                        return {\n                            draftParent: newGroup,\n                            activeParent: missingGroup\n                        };\n                    }, {\n                        draftParent: targetDraftParentParent,\n                        activeParent: nextActiveParent\n                    }).draftParent;\n                    missingParents = [];\n                } else {\n                    missingParents.unshift(nextActiveParent);\n                }\n            }\n        }\n\n        // We now have the active & draft rules, and the draft parent that _should_ contain the draft rule\n\n        const resetRule = _.cloneDeep(activeRule);\n\n        // Update & potentially reparent the rule:\n\n        if (currentDraftParent.id === targetDraftParent.id) {\n            updateItemAtPath(draftRules, draftItemPath, resetRule);\n        } else {\n            // We're moving parent. Before rearranging it, we need to reparent the draft element.\n            _.remove(currentDraftParent.items, { id: resetRule.id });\n            targetDraftParent.items.splice(0, 0, resetRule); // Put it at the start: we'll rearrange below\n            if (currentDraftParent.items.length === 0 && !isRuleRoot(currentDraftParent)) {\n                this.deleteDraftItem(findItemPath(this.draftRules, { id: currentDraftParent.id })!);\n            }\n        }\n\n        // Check the rule's position relative to its siblings, reset it if necessary:\n\n        const draftSiblings = targetDraftParent.items;\n        const activeSiblings = activeParent.items;\n\n        // Find the common (still present in active & draft) items in this group, in two sets:\n        // one by their order in the draft rules, one by their order in the active rules.\n        const draftCommonSiblings = _.intersectionBy(draftSiblings, activeSiblings, 'id');\n        const activeCommonSiblings = _.intersectionBy(activeSiblings, draftSiblings, 'id');\n\n        const targetCommonIndex = _.findIndex(activeCommonSiblings, { id });\n\n        // If this rule is in the right place already, we're done\n        if (_.findIndex(draftCommonSiblings, { id }) === targetCommonIndex) return;\n\n        // Otherwise, the rule is in the wrong group/place in its group.\n\n        // Remove it from its current position:\n        _.remove(draftSiblings, { id });\n        _.remove(draftCommonSiblings, { id });\n\n        // The tricky bit: place it into the first position that gives it the same position\n        // within the common siblings as it has in the set of active rules.\n        if (targetCommonIndex > 0) {\n            const draftItemToFollow = draftCommonSiblings[targetCommonIndex - 1];\n            const targetSiblingIndex = _.findIndex(draftSiblings, { id: draftItemToFollow.id }) + 1;\n            draftSiblings.splice(targetSiblingIndex, 0, resetRule);\n        } else {\n            draftSiblings.unshift(resetRule);\n        }\n    }\n\n    @action.bound\n    saveItem(draftItemPath: ItemPath) {\n        // To update a single item, we update the content of that single item, but if its\n        // position has changed then we update the position of all items. It's very hard\n        // to update the position of one predictably, and the saved state is invisible,\n        // so it's better to just give consistency.\n        // This should do what you expect for simple states (one or two moves), and\n        // is at least predictable & transparent in pathological cases.\n\n        const { draftRules, rules: activeRules } = this;\n\n        const draftItem = getItemAtPath(draftRules, draftItemPath);\n        const draftParent = getItemParentByPath(draftRules, draftItemPath);\n\n        let targetActiveParent = findItem(activeRules, { id: draftParent.id }) as HtkMockRuleGroup;\n        if (!targetActiveParent) {\n            targetActiveParent = this.saveItem(draftItemPath.slice(0, -1)) as HtkMockRuleGroup;\n        }\n\n        const id = draftItem.id;\n        const activeItemPath = findItemPath(activeRules, { id });\n\n        const updatedItem = observable(_.cloneDeep(_.omit(draftItem, 'items')) as HtkMockItem);\n\n        // When saving a single group, save the group itself, don't change the contents\n        if (isRuleGroup(draftItem)) {\n            if (activeItemPath) {\n                const activeItem = getItemAtPath(activeRules, activeItemPath) as HtkMockRuleGroup;\n                (updatedItem as HtkMockRuleGroup).items = _.cloneDeep(activeItem.items);\n            } else {\n                (updatedItem as HtkMockRuleGroup).items = [];\n            }\n        }\n\n        // Insert/update the item in the tree:\n\n        if (activeItemPath) {\n            // The item is active, but maybe moved.\n            const currentActiveParent = getItemParentByPath(activeRules, activeItemPath);\n            if (currentActiveParent === targetActiveParent) {\n                // Update in place, we'll sort below\n                updateItemAtPath(activeRules, activeItemPath, updatedItem);\n            } else {\n                // Parent changed - move the rule, we'll sort it to the exact correct position below\n                const currentIndex = _.last(activeItemPath)!;\n                currentActiveParent.items.splice(currentIndex, 1);\n                targetActiveParent.items.push(updatedItem);\n\n                if (currentActiveParent.items.length === 0 && !isRuleRoot(currentActiveParent)) {\n                    // Parent path may have changed, if target parent an ancestor of the current parent\n                    const updatedCurrentParentPath = findItemPath(activeRules, { id: currentActiveParent.id })!;\n                    deleteItemAtPath(activeRules, updatedCurrentParentPath);\n                }\n            }\n        } else {\n            // The item doesn't exist yet. For now, just append it, and we'll sorted it\n            // into the right position below\n            targetActiveParent.items.push(updatedItem);\n        }\n\n        // Reorder this rule & all its siblings, to match the draft order:\n\n        const draftDeletedRules = _.differenceBy(targetActiveParent.items, draftParent.items, 'id');\n        const activeCommonSiblings = _.intersectionBy(targetActiveParent.items, draftParent.items, 'id');\n        const draftCommonSiblings = _.intersectionBy(draftParent.items, targetActiveParent.items, 'id');\n\n        if (_.findIndex(draftCommonSiblings, { id }) === _.findIndex(activeCommonSiblings, { id })) {\n            // If this rule is effectively in the right place already, we're done\n            return updatedItem;\n        }\n\n        // Sort the existing siblings by their updated positions\n        const sortedItems = _.sortBy(activeCommonSiblings,\n            rule => _.findIndex(draftParent.items, { id: rule.id })\n        );\n\n        // Reinsert draft-deleted rules:\n        draftDeletedRules.forEach((rule) => {\n            const previousIndex = Math.min(\n                targetActiveParent.items.indexOf(rule),\n                targetActiveParent.items.length\n            );\n            sortedItems.splice(previousIndex, 0, rule);\n        });\n\n        targetActiveParent.items = sortedItems;\n\n        return updatedItem;\n    }\n\n    @action.bound\n    addDraftItem(draftItem: HtkMockItem, targetPath?: ItemPath) {\n        if (!targetPath) {\n            // By default, we just append them at the top level\n            this.draftRules.items.unshift(draftItem);\n            return;\n        }\n\n        // Alternatively, we want to insert them at a specific position.\n        const parent = getItemParentByPath(this.draftRules, targetPath);\n        const childPosition = _.last(targetPath)!;\n        parent.items.splice(childPosition, 0, draftItem);\n    }\n\n    @action.bound\n    deleteDraftItem(draftItemPath: ItemPath) {\n        deleteItemAtPath(this.draftRules, draftItemPath);\n    }\n\n    @action.bound\n    moveDraftRule(currentPath: ItemPath, targetPath: ItemPath) {\n        const currentParent = getItemParentByPath(this.draftRules, currentPath);\n        const targetParent = getItemParentByPath(this.draftRules, targetPath);\n\n        const currentIndex = _.last(currentPath)!;\n        const targetIndex = _.last(targetPath)!;\n\n        const [item] = currentParent.items.splice(currentIndex, 1);\n        targetParent.items.splice(targetIndex, 0, item);\n\n        // If the source parent is empty, delete them completely\n        if (currentParent.items.length === 0 && !isRuleRoot(currentParent)) {\n            this.deleteDraftItem(findItemPath(this.draftRules, { id: currentParent.id })!);\n        }\n    }\n\n    @action.bound\n    combineDraftRulesAsGroup(sourcePath: ItemPath, targetPath: ItemPath) {\n        const sourceItem = getItemAtPath(this.draftRules, sourcePath);\n\n        const targetParent = getItemParentByPath(this.draftRules, targetPath);\n        const targetIndex = _.last(targetPath)!;\n        const targetItem = targetParent.items[targetIndex];\n\n        targetParent.items[targetIndex] = {\n            id: uuid(),\n            title: \"New group\",\n            items: [\n                targetItem,\n                sourceItem\n            ]\n        };\n        this.deleteDraftItem(sourcePath);\n    }\n\n    @action.bound\n    updateGroupTitle(groupId: string, newTitle: string) {\n        const draftGroup = findItem(this.draftRules, { id: groupId }) as HtkMockRuleGroup;\n        const activeGroup = findItem(this.rules, { id: groupId }) as (\n            HtkMockRuleGroup | undefined\n        );\n\n        draftGroup.title = newTitle;\n        if (activeGroup) activeGroup.title = newTitle;\n    }\n\n    @action.bound\n    ensureRuleExists(rule: HtkMockItem) {\n        const activeRulePath = findItemPath(this.rules, { id: rule.id });\n        const activeRule = activeRulePath\n            ? getItemAtPath(this.rules, activeRulePath) as HtkMockRule\n            : undefined;\n\n        const draftRulePath = findItemPath(this.draftRules, { id: rule.id });\n        const draftRule = draftRulePath\n            ? getItemAtPath(this.draftRules, draftRulePath) as HtkMockRule\n            : undefined;\n\n        if (areItemsEqual(rule, activeRule) && areItemsEqual(rule, draftRule)) {\n            // Rule is already happily in place.\n            return;\n        }\n\n        if (draftRulePath) {\n            // The draft rule exists, and active doesn't or has changed.\n            updateItemAtPath(this.draftRules, draftRulePath, rule);\n            this.saveItem(draftRulePath);\n            return;\n        }\n\n        // No draft rule at all: build one (creating the default rules group if necessary),\n        // and save it, to update both the active & draft rules.\n\n        let draftDefaultGroupPath = findItemPath(this.draftRules, { id: 'default-group' });\n        if (!draftDefaultGroupPath) {\n            // If there's no draft default rules at all, build one\n            this.draftRules.items.push(buildDefaultGroupWrapper([rule]));\n            draftDefaultGroupPath = [this.draftRules.items.length - 1];\n        } else {\n            const draftDefaultGroup = getItemAtPath(this.draftRules, draftDefaultGroupPath) as HtkMockRuleGroup;\n            draftDefaultGroup.items.unshift(rule);\n        }\n\n        this.saveItem(draftDefaultGroupPath.concat(0));\n    }\n\n    @action.bound\n    ensureRuleDoesNotExist(ruleId: string) {\n        const activeRulePath = findItemPath(this.rules, { id: ruleId });\n        if (activeRulePath) {\n            deleteItemAtPath(this.rules, activeRulePath);\n        }\n\n        const draftRulePath = findItemPath(this.draftRules, { id: ruleId });\n        if (draftRulePath) {\n            deleteItemAtPath(this.draftRules, draftRulePath);\n        }\n    }\n\n    @action.bound\n    loadSavedRules(savedData: any) {\n        this.rules = deserializeRules(savedData, { rulesStore: this });\n        this.resetRuleDrafts();\n    }\n\n    readonly triggerRequestBreakpoint = (request: MockttpBreakpointedRequest) => {\n        return this.triggerBreakpoint(\n            request.id,\n            (exchange: HttpExchange) => exchange.triggerRequestBreakpoint(request)\n        );\n    }\n\n    readonly triggerResponseBreakpoint = (response: MockttpBreakpointedResponse) => {\n        return this.triggerBreakpoint(\n            response.id,\n            (exchange: HttpExchange) => exchange.triggerResponseBreakpoint(response)\n        );\n    }\n\n    private triggerBreakpoint = flow(function * <T>(\n        this: RulesStore,\n        eventId: string,\n        getEditedEvent: (exchange: HttpExchange) => Promise<T>\n    ) {\n        // Jump to the exchange, once the request is completed:\n        const exchange: HttpExchange = yield this.jumpToExchange(eventId);\n\n        // Mark the exchange as breakpointed, and wait for an edited version.\n        // UI will make it editable, add a save button, save will resolve this promise\n        return (yield getEditedEvent(exchange!)) as T;\n    });\n\n}","import * as _ from 'lodash';\nimport { action, flow, observable, runInAction } from 'mobx';\nimport * as uuid from 'uuid/v4';\nimport {\n    MOCKTTP_PARAM_REF,\n    ProxySetting,\n    ProxySettingSource,\n    RuleParameterReference,\n    TimingEvents\n} from 'mockttp';\n\nimport { logError } from '../../errors';\nimport { lazyObservablePromise } from '../../util/observable';\nimport { persist, hydrate } from '../../util/mobx-persist/persist';\nimport { ErrorLike, UnreachableCheck } from '../../util/error';\nimport { rawHeadersToHeaders } from '../../util/headers';\n\nimport { EventsStore } from '../events/events-store';\nimport { RulesStore } from '../rules/rules-store';\nimport * as ServerApi from '../../services/server-api';\n\nimport { HttpExchange } from '../http/exchange';\nimport { ResponseHeadEvent, ResponseStreamEvent } from './send-response-model';\nimport {\n    ClientProxyConfig,\n    RequestInput,\n    requestInputSchema,\n    RULE_PARAM_REF_KEY\n} from './send-request-model';\n\nexport class SendStore {\n\n    constructor(\n        private eventStore: EventsStore,\n        private rulesStore: RulesStore\n    ) {}\n\n    readonly initialized = lazyObservablePromise(async () => {\n        await Promise.all([\n            this.eventStore.initialized,\n            this.rulesStore.initialized\n        ]);\n\n        await hydrate({\n            key: 'send-store',\n            store: this\n        });\n\n        console.log('Send store initialized');\n    });\n\n    @persist('object', requestInputSchema) @observable\n    requestInput: RequestInput = {\n        url: '',\n        method: 'GET',\n        headers: [],\n        requestContentType: 'text',\n        rawBody: Buffer.from([])\n    };\n\n    @observable\n    sentExchange: HttpExchange | undefined;\n\n    readonly sendRequest = async (requestInput: RequestInput) => {\n        const exchangeId = uuid();\n\n        const passthroughOptions = this.rulesStore.activePassthroughOptions;\n\n        const url = new URL(requestInput.url);\n        const effectivePort = getEffectivePort(url);\n        const hostWithPort = `${url.hostname}:${effectivePort}`;\n        const clientCertificate = passthroughOptions.clientCertificateHostMap?.[hostWithPort] ||\n            passthroughOptions.clientCertificateHostMap?.[url.hostname!] ||\n            undefined;\n\n        const requestOptions = {\n            ignoreHostHttpsErrors: passthroughOptions.ignoreHostHttpsErrors,\n            trustAdditionalCAs: this.rulesStore.additionalCaCertificates.map((cert) =>\n                ({ cert: cert.rawPEM })\n            ),\n            clientCertificate,\n            proxyConfig: getProxyConfig(this.rulesStore.proxyConfig),\n            lookupOptions: passthroughOptions.lookupOptions\n        };\n\n        const responseStream = await ServerApi.sendRequest({\n            url: requestInput.url,\n            method: requestInput.method,\n            headers: requestInput.headers,\n            rawBody: requestInput.rawBody\n        }, requestOptions);\n\n        const exchange = this.eventStore.recordSentRequest({\n            id: exchangeId,\n            matchedRuleId: false,\n            method: requestInput.method,\n            url: requestInput.url,\n            protocol: url.protocol.slice(0, -1),\n            path: url.pathname,\n            hostname: url.hostname,\n            headers: rawHeadersToHeaders(requestInput.headers),\n            rawHeaders: requestInput.headers,\n            body: { buffer: requestInput.rawBody },\n            timingEvents: {} as TimingEvents,\n            tags: ['httptoolkit:manually-sent-request']\n        });\n\n        // Keep the exchange up to date as response data arrives:\n        trackResponseEvents(responseStream, exchange)\n        .catch(action((error: ErrorLike) => {\n            exchange.markAborted({\n                id: exchange.id,\n                error: error,\n                timingEvents: {\n                    ...exchange.timingEvents as TimingEvents,\n                    abortedTimestamp: performance.now()\n                },\n                tags: error.code ? [`passthrough-error:${error.code}`] : []\n            });\n        }));\n\n        runInAction(() => {\n            this.sentExchange = exchange;\n        });\n    }\n\n}\n\nconst trackResponseEvents = flow(function * (\n    responseStream: ReadableStream<ResponseStreamEvent>,\n    exchange: HttpExchange\n) {\n    const reader = responseStream.getReader();\n\n    const timingEvents = { ...exchange.timingEvents } as TimingEvents;\n\n    let responseHead: ResponseHeadEvent | undefined;\n    let responseBodyParts: Buffer[] = [];\n\n    while (true) {\n        const { done, value } = (\n            yield reader.read()\n        ) as ReadableStreamReadResult<ResponseStreamEvent>;\n        if (done) return;\n\n        const messageType = value.type;\n        switch (messageType) {\n            case 'request-start':\n                timingEvents.startTime = Date.now();\n                timingEvents.startTimestamp = value.timestamp;\n                timingEvents.bodyReceivedTimestamp = value.timestamp;\n                break;\n            case 'response-head':\n                responseHead = value;\n                timingEvents.headersSentTimestamp = value.timestamp;\n                break;\n            case 'response-body-part':\n                responseBodyParts.push(value.rawBody);\n                break;\n            case 'response-end':\n                if (!responseHead) throw new Error(`Received response-end before response-head!`);\n\n                timingEvents.responseSentTimestamp = value.timestamp;\n\n                exchange.setResponse({\n                    id: exchange.id,\n                    statusCode: responseHead.statusCode,\n                    statusMessage: responseHead.statusMessage ?? '',\n                    headers: rawHeadersToHeaders(responseHead.headers),\n                    rawHeaders: responseHead.headers,\n                    body: { buffer: Buffer.concat(responseBodyParts) },\n                    tags: [],\n                    timingEvents\n                });\n\n                break;\n            case 'error':\n                if (value.error.message) {\n                    throw new Error(value.error.message + (\n                        value.error.code ? ` (${value.error.code})` : ''\n                    ));\n                } else {\n                    logError(`Unknown response error for sent request: ${\n                        JSON.stringify(value.error)\n                    }`);\n                    throw new Error('Unknown response error');\n                }\n            default:\n                throw new UnreachableCheck(messageType);\n        }\n    }\n});\n\nexport const getEffectivePort = (url: { protocol: string | null, port: string | null }) => {\n    if (url.port) {\n        return parseInt(url.port, 10);\n    } else if (url.protocol === 'https:' || url.protocol === 'wss:') {\n        return 443;\n    } else {\n        return 80;\n    }\n}\n\nfunction getProxyConfig(proxyConfig: RulesStore['proxyConfig']): ClientProxyConfig {\n    if (!proxyConfig) return undefined;\n\n    if (_.isArray(proxyConfig)) {\n        return proxyConfig.map((config) => getProxyConfig(config)) as ClientProxyConfig;\n    }\n\n    if (MOCKTTP_PARAM_REF in proxyConfig) {\n        const paramRef = (proxyConfig as RuleParameterReference<ProxySettingSource>)[MOCKTTP_PARAM_REF];\n        return { [RULE_PARAM_REF_KEY]: paramRef };\n    }\n\n    return proxyConfig as ProxySetting;\n}","module.exports = __webpack_public_path__ + \"339233e471b772666625b377b42622f3.svg\";","import * as _ from 'lodash';\nimport type { ProxySetting } from 'mockttp';\n\nimport {\n    serverVersion,\n    versionSatisfies,\n    DETAILED_CONFIG_RANGE,\n    INTERCEPTOR_METADATA,\n    DETAILED_METADATA,\n    PROXY_CONFIG_RANGE,\n    DNS_AND_RULE_PARAM_CONFIG_RANGE\n} from './service-versions';\n\nimport {\n    ServerConfig,\n    NetworkInterfaces,\n    ServerInterceptor,\n    ApiError\n} from './server-api-types';\n\ninterface GraphQLError {\n    locations: Array<{ line: number, column: number }>;\n    message: string;\n    path: Array<string>\n}\n\nexport class GraphQLApiClient {\n\n    constructor(\n        private authToken?: string\n    ) {}\n\n    async graphql<T extends {}>(operationName: string, query: string, variables: unknown) {\n        const response = await fetch('http://127.0.0.1:45457', {\n            method: 'POST',\n            headers: {\n                ...(this.authToken ? {\n                    'Authorization': `Bearer ${this.authToken}`,\n                } : {}),\n                'content-type': 'application/json'\n            },\n            body: JSON.stringify({\n                operationName,\n                query,\n                variables\n            })\n        }).catch((e) => {\n            throw new ApiError(`fetch failed with '${e.message ?? e}'`, operationName);\n        });\n\n        if (!response.ok) {\n            console.error(response);\n            throw new ApiError(\n                `unexpected status ${response.status} ${response.statusText}`,\n                operationName,\n                response.status\n            );\n        }\n\n        const { data, errors } = await response.json() as { data: T, errors?: GraphQLError[] };\n\n        if (errors && errors.length) {\n            console.error(errors);\n\n            const errorCount = errors.length > 1 ? `s (${errors.length})` : '';\n\n            throw new ApiError(\n                `GraphQL error${errorCount}: ${errors.map(e =>\n                    `${e.message} at ${e.path.join('.')}`\n                ).join(', ')}`,\n                operationName\n            );\n        }\n\n        return data;\n    }\n\n    async getServerVersion(): Promise<string> {\n        const response = await this.graphql<{ version: string }>('getVersion', `\n            query getVersion {\n                version\n            }\n        `, {});\n\n        return response.version;\n    }\n\n    async getConfig(proxyPort: number): Promise<ServerConfig> {\n        const response = await this.graphql<{\n            config: {\n                certificatePath: string;\n                certificateContent?: string;\n                certificateFingerprint?: string;\n            }\n            networkInterfaces?: NetworkInterfaces;\n            systemProxy?: ProxySetting;\n            dnsServers?: string[];\n            ruleParameterKeys?: string[];\n        }>('getConfig', `\n            ${versionSatisfies(await serverVersion, DNS_AND_RULE_PARAM_CONFIG_RANGE)\n                ? `query getConfig($proxyPort: Int!) {`\n                : 'query getConfig {'\n            }\n                config {\n                    certificatePath\n                    ${versionSatisfies(await serverVersion, DETAILED_CONFIG_RANGE)\n                    ?  `\n                        certificateContent\n                        certificateFingerprint\n                    ` : ''}\n                }\n\n                ${versionSatisfies(await serverVersion, DETAILED_CONFIG_RANGE)\n                ? `networkInterfaces`\n                : ''}\n\n                ${versionSatisfies(await serverVersion, PROXY_CONFIG_RANGE)\n                ? `systemProxy {\n                    proxyUrl\n                    noProxy\n                }` : ''}\n\n                ${versionSatisfies(await serverVersion, DNS_AND_RULE_PARAM_CONFIG_RANGE)\n                ? `\n                    dnsServers(proxyPort: $proxyPort)\n                    ruleParameterKeys\n                `\n                : ''}\n            }\n        `, { proxyPort: proxyPort });\n\n        return {\n            ...response.config,\n            networkInterfaces: response.networkInterfaces || {},\n            systemProxy: response.systemProxy,\n            dnsServers: response.dnsServers || [],\n            ruleParameterKeys: response.ruleParameterKeys || []\n        }\n    }\n\n    async getNetworkInterfaces(): Promise<NetworkInterfaces> {\n        if (!versionSatisfies(await serverVersion, DETAILED_CONFIG_RANGE)) return {};\n\n        const response = await this.graphql<{\n            networkInterfaces: NetworkInterfaces\n        }>('getNetworkInterfaces', `\n            query getNetworkInterfaces {\n                networkInterfaces\n            }\n        `, {});\n\n        return response.networkInterfaces;\n    }\n\n    async getInterceptors(proxyPort: number): Promise<ServerInterceptor[]> {\n        const response = await this.graphql<{\n            interceptors: ServerInterceptor[]\n        }>('getInterceptors', `\n            query getInterceptors($proxyPort: Int!) {\n                interceptors {\n                    id\n                    version\n                    isActive(proxyPort: $proxyPort)\n                    isActivable\n\n                    ${versionSatisfies(await serverVersion, INTERCEPTOR_METADATA)\n                        ? 'metadata'\n                        : ''\n                    }\n                }\n            }\n        `, { proxyPort });\n\n        return response.interceptors;\n    }\n\n    async getDetailedInterceptorMetadata<M extends unknown>(id: string): Promise<M | undefined> {\n        if (!versionSatisfies(await serverVersion, DETAILED_METADATA)) return undefined;\n\n        const response = await this.graphql<{\n            interceptor: { metadata: M }\n        }>('getDetailedInterceptorMetadata', `\n            query getDetailedInterceptorMetadata($id: ID!) {\n                interceptor(id: $id) {\n                    metadata(type: DETAILED)\n                }\n            }\n        `, { id });\n\n        return response.interceptor.metadata;\n    }\n\n    async activateInterceptor(id: string, proxyPort: number, options?: any) {\n        const response = await this.graphql<{\n            activateInterceptor: boolean | { success: boolean, metadata: unknown }\n        }>('Activate', `\n            mutation Activate($id: ID!, $proxyPort: Int!, $options: Json) {\n                activateInterceptor(id: $id, proxyPort: $proxyPort, options: $options)\n            }\n        `, { id, proxyPort, options });\n\n        const activationResult = response.activateInterceptor;\n\n        if (_.isBoolean(activationResult)) {\n            // Backward compat for a < v0.1.28 server that returns booleans:\n            return { success: activationResult, metadata: undefined };\n        } else {\n            // Modern server that return an object with a success prop:\n            return activationResult;\n        }\n    }\n\n    async triggerServerUpdate() {\n        await this.graphql<{}>('TriggerUpdate', `\n            mutation TriggerUpdate {\n                triggerUpdate\n            }\n        `, { });\n    }\n}","import * as localForage from 'localforage';\n\nimport { RUNNING_IN_WORKER } from '../util';\nimport { delay, getDeferred } from '../util/promise';\nimport {\n    versionSatisfies,\n    SERVER_REST_API_SUPPORTED\n} from './service-versions';\n\nimport { type ServerConfig, type NetworkInterfaces, type ServerInterceptor, ApiError } from './server-api-types';\nexport { ServerConfig, NetworkInterfaces, ServerInterceptor };\n\nimport { GraphQLApiClient } from './server-graphql-api';\nimport { RestApiClient } from './server-rest-api';\nimport { RequestDefinition, RequestOptions } from '../model/send/send-request-model';\n\nconst authTokenPromise = !RUNNING_IN_WORKER\n    // Main UI gets given the auth token directly in its URL:\n    ? Promise.resolve(new URLSearchParams(window.location.search).get('authToken') ?? undefined)\n    // For workers, the new (March 2020) UI shares the auth token with SW via IDB:\n    : localForage.getItem<string>('latest-auth-token')\n        .then((authToken) => {\n            if (authToken) return authToken;\n\n            // Old UI (Jan-March 2020) shares auth token via SW query param:\n            const workerParams = new URLSearchParams(\n                (self as unknown as WorkerGlobalScope).location.search\n            );\n            return workerParams.get('authToken') ?? undefined;\n\n            // Pre-Jan 2020 UI doesn't share auth token - ok with old desktop, fails with 0.1.18+.\n        });\n\nconst serverReady = getDeferred();\nexport const announceServerReady = () => serverReady.resolve();\nexport const waitUntilServerReady = () => serverReady.promise;\n\nconst apiClient: Promise<GraphQLApiClient | RestApiClient> = authTokenPromise.then(async (authToken) => {\n    await waitUntilServerReady();\n\n    const restClient = new RestApiClient(authToken);\n    const graphQLClient = new GraphQLApiClient(authToken);\n\n    // To work out which API is supported, we loop trying to get the version from\n    // each one (may take a couple of tries as the server starts up), and then\n    // check the resulting version to see what's supported.\n\n    let version: string | undefined;\n    while (!version) {\n        version = await restClient.getServerVersion().catch(() => {\n            console.log(\"Couldn't get version from REST API\");\n\n            return graphQLClient.getServerVersion().catch(() => {\n                console.log(\"Couldn't get version from GraphQL API\");\n                return undefined;\n            });\n        });\n\n        if (!version) await delay(100);\n    }\n\n    if (versionSatisfies(version, SERVER_REST_API_SUPPORTED)) {\n        return restClient;\n    } else {\n        return graphQLClient;\n    }\n});\n\nexport async function getServerVersion(): Promise<string> {\n    return (await apiClient).getServerVersion();\n}\n\nexport async function getConfig(proxyPort: number): Promise<ServerConfig> {\n    return (await apiClient).getConfig(proxyPort);\n}\n\nexport async function getNetworkInterfaces(): Promise<NetworkInterfaces> {\n    return (await apiClient).getNetworkInterfaces();\n}\n\nexport async function getInterceptors(proxyPort: number): Promise<ServerInterceptor[]> {\n    return (await apiClient).getInterceptors(proxyPort);\n}\n\nexport async function getDetailedInterceptorMetadata<M extends unknown>(id: string): Promise<M | undefined> {\n    return (await apiClient).getDetailedInterceptorMetadata(id);\n}\n\nexport async function activateInterceptor(id: string, proxyPort: number, options?: any): Promise<unknown> {\n    const result = await (await apiClient).activateInterceptor(id, proxyPort, options);\n\n    if (result.success) {\n        return result.metadata;\n    } else {\n        // Some kind of failure:\n        console.log('Activation result', JSON.stringify(result));\n\n        const error = Object.assign(\n            new ApiError(`failed to activate interceptor ${id}`, `activate-interceptor-${id}`),\n            result\n        );\n\n        throw error;\n    }\n}\n\nexport async function sendRequest(\n    requestDefinition: RequestDefinition,\n    requestOptions: RequestOptions\n) {\n    const client = (await apiClient);\n    if (!(client instanceof RestApiClient)) {\n        throw new Error(\"Requests cannot be sent via the GraphQL API client\");\n    }\n\n    return client.sendRequest(requestDefinition, requestOptions);\n}\n\nexport async function triggerServerUpdate() {\n    return (await apiClient).triggerServerUpdate()\n        // We ignore all errors, this trigger is just advisory\n        .catch(console.log);\n}\n","import * as _ from 'lodash';\nimport * as React from 'react';\nimport { observable, autorun, action } from 'mobx';\nimport { disposeOnUnmount, observer } from 'mobx-react';\nimport * as portals from 'react-reverse-portal';\n\nimport { ExchangeMessage } from '../../types';\n\nimport { ErrorLike } from '../../util/error';\nimport { getHeaderValue, lastHeader } from '../../util/headers';\n\nimport { ViewableContentType, getCompatibleTypes } from '../../model/events/content-types';\n\nimport { ExpandableCardProps } from '../common/card';\nimport { LoadingCard } from '../common/loading-card';\n\nimport {\n    ContainerSizedEditorCardContent,\n    ReadonlyBodyCardHeader,\n    getBodyDownloadFilename,\n    BodyDecodingErrorBanner\n} from '../editor/body-card-components';\nimport { ContentViewer } from '../editor/content-viewer';\n\nimport { SendBodyCardSection } from './send-card-section';\nimport { ContainerSizedEditor } from '../editor/base-editor';\n\n// A selection of content types you might want to try out, to explore your encoded data:\nconst ENCODED_DATA_CONTENT_TYPES = ['text', 'raw', 'base64', 'image'] as const;\n\n// Closely based on the HTTP body card, but not identical (notably: different card container,\n// different editor sizing logic within, and no directions)\n@observer\nexport class SentResponseBodyCard extends React.Component<ExpandableCardProps & {\n    onCollapseToggled: () => void,\n\n    isPaidUser: boolean,\n    url: string,\n    message: ExchangeMessage,\n    editorNode: portals.HtmlPortalNode<typeof ContainerSizedEditor>\n}> {\n\n    @observable\n    private selectedContentType: ViewableContentType | undefined;\n\n    componentDidMount() {\n        disposeOnUnmount(this, autorun(() => {\n            const message = this.props.message;\n\n            if (!message) {\n                this.onChangeContentType(undefined);\n                return;\n            }\n        }));\n    }\n\n    @action.bound\n    onChangeContentType(contentType: ViewableContentType | undefined) {\n        if (contentType === this.props.message.contentType) {\n            this.selectedContentType = undefined;\n        } else {\n            this.selectedContentType = contentType;\n        }\n    }\n\n    render() {\n        const {\n            url,\n            message,\n            isPaidUser,\n            collapsed,\n            expanded,\n            onCollapseToggled,\n            onExpandToggled\n        } = this.props;\n\n        const compatibleContentTypes = getCompatibleTypes(\n            message.contentType,\n            lastHeader(message.headers['content-type']),\n            message.body\n        );\n        const decodedContentType = _.includes(compatibleContentTypes, this.selectedContentType)\n            ? this.selectedContentType!\n            : message.contentType;\n\n        const decodedBody = message.body.decoded;\n\n        if (decodedBody) {\n            // We have successfully decoded the body content, show it:\n            return <SendBodyCardSection\n                collapsed={collapsed}\n                onCollapseToggled={onCollapseToggled}\n                expanded={expanded}\n            >\n                <header>\n                    <ReadonlyBodyCardHeader\n                        body={decodedBody}\n                        mimeType={getHeaderValue(message.headers, 'content-type')}\n                        downloadFilename={getBodyDownloadFilename(url, message.headers)}\n\n                        title='Response body'\n                        expanded={expanded}\n                        onExpandToggled={onExpandToggled}\n                        onCollapseToggled={onCollapseToggled}\n\n                        selectedContentType={decodedContentType}\n                        contentTypeOptions={compatibleContentTypes}\n                        onChangeContentType={this.onChangeContentType}\n\n                        isPaidUser={isPaidUser}\n                    />\n                </header>\n                <ContainerSizedEditorCardContent>\n                    <ContentViewer\n                        contentId={message.id}\n                        editorNode={this.props.editorNode}\n                        rawContentType={lastHeader(message.headers['content-type'])}\n                        contentType={decodedContentType}\n                        expanded={!!expanded}\n                        cache={message.cache}\n                    >\n                        {decodedBody}\n                    </ContentViewer>\n                </ContainerSizedEditorCardContent>\n            </SendBodyCardSection>;\n        } else if (!decodedBody && message.body.decodingError) {\n            // We have failed to decode the body content! Show the error & raw encoded data instead:\n            const error = message.body.decodingError as ErrorLike;\n            const encodedBody = Buffer.isBuffer(message.body.encoded)\n                ? message.body.encoded\n                : undefined;\n\n            const encodedDataContentType = _.includes(ENCODED_DATA_CONTENT_TYPES, this.selectedContentType)\n                ? this.selectedContentType!\n                : 'text';\n\n            return <SendBodyCardSection\n                collapsed={collapsed}\n                onCollapseToggled={onCollapseToggled}\n                expanded={expanded}\n            >\n                <header>\n                    <ReadonlyBodyCardHeader\n                        body={encodedBody}\n                        mimeType={'application/octet-stream'} // Ignore content type, as it's encoded\n                        downloadFilename={getBodyDownloadFilename(url, message.headers)}\n\n                        title='Response body'\n                        expanded={expanded}\n                        onExpandToggled={onExpandToggled}\n                        onCollapseToggled={onCollapseToggled}\n\n                        selectedContentType={encodedDataContentType}\n                        contentTypeOptions={ENCODED_DATA_CONTENT_TYPES}\n                        onChangeContentType={this.onChangeContentType}\n\n                        isPaidUser={isPaidUser}\n                    />\n                </header>\n                <BodyDecodingErrorBanner\n                    error={error}\n                    headers={message.rawHeaders}\n                />\n                { encodedBody &&\n                    <ContainerSizedEditorCardContent>\n                        <ContentViewer\n                            contentId={message.id}\n                            editorNode={this.props.editorNode}\n                            contentType={encodedDataContentType}\n                            expanded={!!expanded}\n                            cache={message.cache}\n                        >\n                            { encodedBody }\n                        </ContentViewer>\n                    </ContainerSizedEditorCardContent>\n                }\n            </SendBodyCardSection>;\n        } else {\n            // No body content, but no error yet, show a loading spinner:\n            return <LoadingCard\n                collapsed={collapsed}\n                onCollapseToggled={onCollapseToggled}\n                expanded={expanded}\n            >\n                <header>\n                    <ReadonlyBodyCardHeader\n                        body={undefined}\n\n                        title='Response body'\n                        expanded={expanded}\n                        onExpandToggled={onExpandToggled}\n                        onCollapseToggled={onCollapseToggled}\n\n                        selectedContentType={decodedContentType}\n                        contentTypeOptions={compatibleContentTypes}\n                        onChangeContentType={this.onChangeContentType}\n                        isPaidUser={isPaidUser}\n                    />\n                </header>\n            </LoadingCard>;\n        }\n    }\n\n}","export function truncate(str: string, length: number) {\n    if (str.length <= length) {\n        return str;\n    } else {\n        return str.slice(0, length - 3) + \"...\";\n    }\n}\n\nexport function joinAnd(val: string[], initialSep = ', ', finalSep = ' and ') {\n    if (val.length === 1) return val[0];\n\n    return val.slice(0, -1).join(initialSep) + finalSep + val[val.length - 1];\n}\n\nconst VOWEL_ISH = ['a', 'e', 'i', 'o', 'u', 'y'];\nexport function aOrAn(value: string) {\n    if (VOWEL_ISH.includes(value[0])) return 'an';\n    else return 'a';\n}\n\nexport function uppercaseFirst(value: string) {\n    return value[0].toUpperCase() + value.slice(1);\n}","import * as _ from 'lodash';\nimport * as uuid from 'uuid/v4'\nimport { observable } from 'mobx';\nimport {\n    matchers,\n    completionCheckers\n} from 'mockttp';\nimport * as querystring from 'querystring';\n\nimport {\n    HttpExchange,\n    HtkRequest,\n    HtkResponse,\n    Headers,\n} from '../../types';\nimport { byteLength, tryParseJson } from '../../util';\nimport * as amIUsingHtml from '../../amiusing.html';\n\nimport { ProxyStore } from '../proxy-store';\nimport { versionSatisfies, FROM_FILE_HANDLER_SERVER_RANGE } from '../../services/service-versions';\nimport { MethodName } from '../http/methods';\nimport { getStatusMessage } from '../http/http-docs';\n\nimport { RulesStore } from './rules-store';\nimport {\n    Handler,\n    HandlerStep,\n    HtkMockRule,\n    InitialMatcher,\n    Matcher,\n    RuleType,\n    isCompatibleMatcher,\n    getRulePartKey\n} from './rules';\nimport {\n    HtkMockItem,\n    HtkMockRuleGroup,\n    HtkMockRuleRoot\n} from './rules-structure';\nimport * as HttpRule from './definitions/http-rule-definitions';\nimport * as WsRule from './definitions/websocket-rule-definitions';\nimport * as EthRule from './definitions/ethereum-rule-definitions';\nimport * as IpfsRule from './definitions/ipfs-rule-definitions';\nimport * as RtcRule from './definitions/rtc-rule-definitions';\n\nexport function getNewRule(rulesStore: RulesStore): HtkMockRule {\n    return observable({\n        id: uuid(),\n        type: 'http', // New rules default to HTTP (i.e. they show HTTP handler options)\n        activated: true,\n        matchers: [],\n        completionChecker: new completionCheckers.Always(),\n        handler: getRuleDefaultHandler('http', rulesStore)\n    });\n}\n\nexport function getRuleDefaultMatchers(\n    type: RuleType,\n    initialMatcher: InitialMatcher,\n    existingMatchers?: Matcher[]\n) {\n    return [\n        initialMatcher, // No need to check type - this must match by definition\n        ...(existingMatchers || [])\n            .slice(1)\n            .filter(m => isCompatibleMatcher(m, type))\n    ];\n}\n\nexport function updateRuleAfterInitialMatcherChange(\n    rule: HtkMockRule\n) {\n    if (rule.type !== 'ipfs') return;\n\n    const ipfsInteraction = rule.matchers[0]?.interactionName;\n    if (!ipfsInteraction) return;\n\n    const argMatcherIndex = rule.matchers.findIndex(m => getRulePartKey(m) === 'ipfs-arg');\n\n    if (IpfsRule.shouldSuggestArgMatcher(ipfsInteraction)) {\n        const newArgMatcher = new IpfsRule.IpfsArgMatcher(ipfsInteraction, undefined);\n        if (argMatcherIndex === -1) {\n            rule.matchers.splice(1, 0, newArgMatcher);\n        } else {\n            rule.matchers.splice(argMatcherIndex, 1, newArgMatcher);\n        }\n    } else if (argMatcherIndex !== -1) {\n        rule.matchers.splice(argMatcherIndex, 1); // Remove the unnecessary arg matcher\n    }\n}\n\nexport function getRuleDefaultHandler(type: 'http', ruleStore: RulesStore): HttpRule.HttpMockRule['handler'];\nexport function getRuleDefaultHandler(type: 'websocket', ruleStore: RulesStore): WsRule.WebSocketMockRule['handler'];\nexport function getRuleDefaultHandler(type: 'ethereum', ruleStore: RulesStore): EthRule.EthereumMockRule['handler'];\nexport function getRuleDefaultHandler(type: 'ipfs', ruleStore: RulesStore): IpfsRule.IpfsMockRule['handler'];\nexport function getRuleDefaultHandler(type: 'webrtc', ruleStore: RulesStore): RtcRule.RTCMockRule['steps'][0];\nexport function getRuleDefaultHandler(type: RuleType, ruleStore: RulesStore): Handler;\nexport function getRuleDefaultHandler(type: RuleType, ruleStore: RulesStore): Handler {\n    switch (type) {\n        case 'http':\n            return new HttpRule.PassThroughHandler(ruleStore);\n        case 'websocket':\n            return new WsRule.WebSocketPassThroughHandler(ruleStore);\n        case 'ethereum':\n            return new HttpRule.PassThroughHandler(ruleStore);\n        case 'ipfs':\n            return new HttpRule.PassThroughHandler(ruleStore);\n        case 'webrtc':\n           return new RtcRule.DynamicProxyStepDefinition();\n    }\n};\n\nfunction buildRequestMatchers(request: HtkRequest) {\n    const hasBody = !!request.body.decoded &&\n        request.body.decoded.length < 10_000;\n    const hasJsonBody = hasBody &&\n        request.contentType === 'json' &&\n        !!tryParseJson(request.body.decoded!.toString());\n\n    const bodyMatcher = hasJsonBody\n        ? [new matchers.JsonBodyMatcher(\n            tryParseJson(request.body.decoded!.toString())!\n        )]\n    : hasBody\n        ? [new matchers.RawBodyMatcher(request.body.decoded!.toString())]\n    : [];\n\n    const urlParts = request.parsedUrl.toString().split('?');\n    const path = urlParts[0];\n    const query = urlParts.slice(1).join('?');\n\n    return [\n        new (HttpRule.MethodMatchers[request.method as MethodName] || HttpRule.WildcardMatcher)(),\n        new matchers.SimplePathMatcher(path),\n        new matchers.QueryMatcher(\n            querystring.parse(query) as ({ [key: string]: string | string[] })\n        ),\n        ...bodyMatcher\n    ];\n}\n\nexport function buildRuleFromRequest(rulesStore: RulesStore, request: HtkRequest): HtkMockRule {\n    return {\n        id: uuid(),\n        type: 'http',\n        activated: true,\n        matchers: buildRequestMatchers(request),\n        handler: new HttpRule.RequestBreakpointHandler(rulesStore),\n        completionChecker: new completionCheckers.Always(),\n    };\n}\n\nexport function buildRuleFromExchange(exchange: HttpExchange): HtkMockRule {\n    const { statusCode, statusMessage, headers } = exchange.isSuccessfulExchange()\n        ? exchange.response\n        : { statusCode: 200, statusMessage: \"OK\", headers: {} as Headers };\n\n    const useResponseBody = (\n        exchange.isSuccessfulExchange() &&\n        // Don't include automatically include the body if it's too large\n        // for manual editing (> 1MB), just for UX reasons\n        exchange.response.body.encoded.byteLength <= 1024 * 1024 &&\n        !!exchange.response.body.decoded // If we can't decode it, don't include it\n    );\n\n    const bodyContent = useResponseBody\n        ? (exchange.response as HtkResponse).body.decoded!\n        : \"A mock response\";\n\n    // Copy headers so we can mutate them independently:\n    const mockRuleHeaders = Object.assign({}, headers);\n\n    delete mockRuleHeaders['date'];\n    delete mockRuleHeaders['expires'];\n    delete mockRuleHeaders[':status']; // Pseudoheaders aren't set directly\n\n    // Problematic for the mock rule UI, so skip for now:\n    delete mockRuleHeaders['content-encoding'];\n\n    if (mockRuleHeaders['content-length']) {\n        mockRuleHeaders['content-length'] = byteLength(bodyContent).toString();\n    }\n\n    return {\n        id: uuid(),\n        type: 'http',\n        activated: true,\n        matchers: buildRequestMatchers(exchange.request),\n        handler: new HttpRule.StaticResponseHandler(\n            statusCode,\n            statusMessage || getStatusMessage(statusCode),\n            bodyContent,\n            mockRuleHeaders\n        ),\n        completionChecker: new completionCheckers.Always(),\n    };\n}\n\nexport const buildDefaultGroupWrapper = (items: HtkMockItem[]): HtkMockRuleGroup => ({\n    id: 'default-group',\n    title: \"Default rules\",\n    collapsed: true,\n    items: items\n});\n\nexport const buildDefaultGroupRules = (\n    rulesStore: RulesStore,\n    proxyStore: ProxyStore\n): HtkMockItem[] => [\n    // Respond to amiusing.httptoolkit.tech with an emphatic YES\n    {\n        id: 'default-amiusing',\n        type: 'http',\n        activated: true,\n        matchers: [\n            new HttpRule.MethodMatchers.GET(),\n            new HttpRule.AmIUsingMatcher()\n        ],\n        completionChecker: new completionCheckers.Always(),\n        handler: new HttpRule.StaticResponseHandler(200, undefined, amIUsingHtml, {\n            'content-type': 'text/html',\n            'cache-control': 'no-store',\n            'httptoolkit-active': 'true'\n        })\n    },\n\n    // Share the server certificate on a convenient URL, assuming it supports that\n    ...(versionSatisfies(proxyStore.serverVersion, FROM_FILE_HANDLER_SERVER_RANGE)\n        ? [{\n            id: 'default-certificate',\n            type: 'http' as 'http',\n            activated: true,\n            matchers: [\n                new HttpRule.MethodMatchers.GET(),\n                new matchers.SimplePathMatcher(\"amiusing.httptoolkit.tech/certificate\")\n            ],\n            completionChecker: new completionCheckers.Always(),\n            handler: new HttpRule.FromFileResponseHandler(200, undefined, proxyStore.certPath, {\n                'content-type': 'application/x-x509-ca-cert'\n            })\n        }] : []\n    ),\n\n    // Pass through all other traffic to the real target\n    {\n        id: 'default-wildcard',\n        type: 'http',\n        activated: true,\n        matchers: [new HttpRule.DefaultWildcardMatcher()],\n        completionChecker: new completionCheckers.Always(),\n        handler: new HttpRule.PassThroughHandler(rulesStore)\n    },\n    {\n        id: 'default-ws-wildcard',\n        type: 'websocket',\n        activated: true,\n        matchers: [new WsRule.DefaultWebSocketWildcardMatcher()],\n        completionChecker: new completionCheckers.Always(),\n        handler: new WsRule.WebSocketPassThroughHandler(rulesStore)\n    }\n];\n\nexport const buildDefaultRulesRoot = (rulesStore: RulesStore, proxyStore: ProxyStore) => ({\n    id: 'root',\n    title: \"HTTP Toolkit Rules\",\n    isRoot: true,\n    items: [\n        buildDefaultGroupWrapper(\n            buildDefaultGroupRules(rulesStore, proxyStore)\n        )\n    ]\n} as HtkMockRuleRoot);\n\nexport const buildForwardingRuleIntegration = (\n    sourceHost: string,\n    targetHost: string,\n    rulesStore: RulesStore\n): HtkMockRule => ({\n    id: 'default-forwarding-rule',\n    type: 'http',\n    activated: true,\n    matchers: [\n        new HttpRule.WildcardMatcher(),\n        new matchers.HostMatcher(sourceHost)\n    ],\n    completionChecker: new completionCheckers.Always(),\n    handler: new HttpRule.ForwardToHostHandler(targetHost, true, rulesStore)\n});","import * as React from 'react';\nimport { styled, warningColor } from './styles';\n\n// Import required FA icons:\nimport {\n    library,\n    IconPrefix,\n    IconName,\n    IconLookup,\n    icon,\n    IconParams,\n    IconProp,\n    SizeProp\n} from '@fortawesome/fontawesome-svg-core';\n\nimport { faSpinner } from '@fortawesome/free-solid-svg-icons/faSpinner';\nimport { faTrashAlt } from '@fortawesome/free-regular-svg-icons/faTrashAlt';\nimport { faArrowLeft } from '@fortawesome/free-solid-svg-icons/faArrowLeft';\nimport { faSearch } from '@fortawesome/free-solid-svg-icons/faSearch';\nimport { faPlug } from '@fortawesome/free-solid-svg-icons/faPlug';\nimport { faNetworkWired } from '@fortawesome/free-solid-svg-icons/faNetworkWired';\nimport { faDesktop } from '@fortawesome/free-solid-svg-icons/faDesktop';\nimport { faTerminal } from '@fortawesome/free-solid-svg-icons/faTerminal';\nimport { faQuestion } from '@fortawesome/free-solid-svg-icons/faQuestion';\nimport { faTimes } from '@fortawesome/free-solid-svg-icons/faTimes';\nimport { faChevronUp } from '@fortawesome/free-solid-svg-icons/faChevronUp';\nimport { faChevronDown } from '@fortawesome/free-solid-svg-icons/faChevronDown';\nimport { faBan } from '@fortawesome/free-solid-svg-icons/faBan';\nimport { faComment } from '@fortawesome/free-regular-svg-icons/faComment';\nimport { faToggleOn } from '@fortawesome/free-solid-svg-icons/faToggleOn';\nimport { faToggleOff } from '@fortawesome/free-solid-svg-icons/faToggleOff';\nimport { faCopy } from '@fortawesome/free-regular-svg-icons/faCopy';\nimport { faExternalLinkAlt } from '@fortawesome/free-solid-svg-icons/faExternalLinkAlt';\nimport { faPlus } from '@fortawesome/free-solid-svg-icons/faPlus';\nimport { faMinus } from '@fortawesome/free-solid-svg-icons/faMinus';\nimport { faExclamationTriangle } from '@fortawesome/free-solid-svg-icons/faExclamationTriangle';\nimport { faLightbulb } from '@fortawesome/free-solid-svg-icons/faLightbulb';\nimport { faCog } from '@fortawesome/free-solid-svg-icons/faCog';\nimport { faStar } from '@fortawesome/free-regular-svg-icons/faStar';\nimport { faMagic } from '@fortawesome/free-solid-svg-icons/faMagic';\nimport { faSun } from '@fortawesome/free-solid-svg-icons/faSun';\nimport { faMoon } from '@fortawesome/free-solid-svg-icons/faMoon';\nimport { faAdjust } from '@fortawesome/free-solid-svg-icons/faAdjust';\nimport { faUpload } from '@fortawesome/free-solid-svg-icons/faUpload';\nimport { faDownload } from '@fortawesome/free-solid-svg-icons/faDownload';\nimport { faPlay } from '@fortawesome/free-solid-svg-icons/faPlay';\nimport { faPause } from '@fortawesome/free-solid-svg-icons/faPause';\nimport { faGem } from '@fortawesome/free-solid-svg-icons/faGem';\nimport { faTheaterMasks } from '@fortawesome/free-solid-svg-icons/faTheaterMasks';\nimport { faGripVertical } from '@fortawesome/free-solid-svg-icons/faGripVertical';\nimport { faUndo } from '@fortawesome/free-solid-svg-icons/faUndo';\nimport { faSave } from '@fortawesome/free-solid-svg-icons/faSave';\nimport { faFolderOpen } from '@fortawesome/free-solid-svg-icons/faFolderOpen';\nimport { faUnlock } from '@fortawesome/free-solid-svg-icons/faUnlock';\nimport { faEdit } from '@fortawesome/free-solid-svg-icons/faEdit';\nimport { faWindowMaximize } from '@fortawesome/free-regular-svg-icons/faWindowMaximize';\nimport { faMobileAlt } from '@fortawesome/free-solid-svg-icons/faMobileAlt';\nimport { faExpand } from '@fortawesome/free-solid-svg-icons/faExpand';\nimport { faCompressArrowsAlt } from '@fortawesome/free-solid-svg-icons/faCompressArrowsAlt';\nimport { faThumbtack } from '@fortawesome/free-solid-svg-icons/faThumbtack';\nimport { faEye } from '@fortawesome/free-solid-svg-icons/faEye';\nimport { faCaretDown } from '@fortawesome/free-solid-svg-icons/faCaretDown';\nimport { faAlignLeft } from '@fortawesome/free-solid-svg-icons/faAlignLeft';\nimport { faClone } from '@fortawesome/free-regular-svg-icons/faClone';\nimport { faCheck } from '@fortawesome/free-solid-svg-icons/faCheck';\nimport { faLevelDownAlt } from '@fortawesome/free-solid-svg-icons/faLevelDownAlt';\nimport { faPaperPlane } from '@fortawesome/free-regular-svg-icons/faPaperPlane';\n\nimport { faChrome } from '@fortawesome/free-brands-svg-icons/faChrome';\nimport { faFirefox } from '@fortawesome/free-brands-svg-icons/faFirefox';\nimport { faDocker } from '@fortawesome/free-brands-svg-icons/faDocker';\nimport { faAndroid } from '@fortawesome/free-brands-svg-icons/faAndroid';\nimport { faApple } from '@fortawesome/free-brands-svg-icons/faApple';\nimport { faSafari } from '@fortawesome/free-brands-svg-icons/faSafari';\nimport { faEdge } from '@fortawesome/free-brands-svg-icons/faEdge';\nimport { faInternetExplorer } from '@fortawesome/free-brands-svg-icons/faInternetExplorer';\nimport { faOpera } from '@fortawesome/free-brands-svg-icons/faOpera';\nimport { faCodeBranch } from '@fortawesome/free-solid-svg-icons/faCodeBranch';\nimport { faNpm } from '@fortawesome/free-brands-svg-icons/faNpm';\nimport { faNodeJs } from '@fortawesome/free-brands-svg-icons/faNodeJs';\nimport { faPhp } from '@fortawesome/free-brands-svg-icons/faPhp';\nimport { faPython } from '@fortawesome/free-brands-svg-icons/faPython';\nimport { faAtom } from '@fortawesome/free-solid-svg-icons/faAtom';\nimport { faGlobe } from '@fortawesome/free-solid-svg-icons/faGlobe';\nimport { faJava } from '@fortawesome/free-brands-svg-icons/faJava';\n\nimport { customSpinnerArc } from './images/custom-spinner';\nimport { braveBrowser } from './images/brave-browser-logo';\nimport { arcBrowser } from './images/arc-browser-logo';\n\nlibrary.add(\n    customSpinnerArc,\n\n    faArrowLeft,\n    faSpinner,\n    faTrashAlt,\n    faSearch,\n    faPlug,\n    faNetworkWired,\n    faDesktop,\n    faTerminal,\n    faQuestion,\n    faTimes,\n    faChevronUp,\n    faChevronDown,\n    faBan,\n    faComment,\n    faToggleOn,\n    faToggleOff,\n    faCopy,\n    faExternalLinkAlt,\n    faPlus,\n    faMinus,\n    faExclamationTriangle,\n    faLightbulb,\n    faCog,\n    faStar,\n    faMagic,\n    faSun,\n    faMoon,\n    faAdjust,\n    faUpload,\n    faDownload,\n    faPlay,\n    faPause,\n    faGem,\n    faTheaterMasks,\n    faGripVertical,\n    faUndo,\n    faSave,\n    faFolderOpen,\n    faUnlock,\n    faEdit,\n    faWindowMaximize,\n    faMobileAlt,\n    faExpand,\n    faCompressArrowsAlt,\n    faThumbtack,\n    faEye,\n    faCaretDown,\n    faAlignLeft,\n    faClone,\n    faCheck,\n    faLevelDownAlt,\n    faPaperPlane,\n\n    faChrome,\n    faFirefox,\n    faDocker,\n    faAndroid,\n    faApple,\n    faSafari,\n    faEdge,\n    faInternetExplorer,\n    faOpera,\n    braveBrowser,\n    arcBrowser,\n    faCodeBranch,\n    faNpm,\n    faNodeJs,\n    faPhp,\n    faPython,\n    faAtom,\n    faGlobe,\n    faJava\n);\n\nexport interface IconProps {\n    icon: ExtendedIconProp;\n    color: string;\n    size?: SizeProp;\n}\n\nexport type SourceIconName = keyof typeof SourceIcons;\n\nexport const SourceIcons = {\n    Chrome: { icon: ['fab', 'chrome'], color: '#1da462' },\n    Chromium: { icon: ['fab', 'chrome'], color: '#4489f4' },\n    Firefox: { icon: ['fab', 'firefox'], color: '#e66000' },\n    Safari: { icon: ['fab', 'safari'], color: '#448aff' },\n    Edge: { icon: ['fab', 'edge'], color: '#2c75be' },\n    IE: { icon: ['fab', 'internet-explorer'], color: '#00baf0' },\n    Opera: { icon: ['fab', 'opera'], color: '#cb0b1e' },\n    Brave: { icon: ['fac', 'brave-browser'], color: '#fb542b' },\n    Arc: { icon: ['fac', 'arc-browser'], color: '#ff536a' },\n    Git: { icon: ['fas', 'code-branch'], color: '#f05033' },\n    Php: { icon: ['fab', 'php'], color: '#8892bf' },\n\n    Ruby: { icon: ['fas', 'gem'], color: '#CC342D' },\n    Faraday: { icon: ['fas', 'gem'], color: '#CC342D' }, // Popular Ruby HTTP lib\n    Excon: { icon: ['fas', 'gem'], color: '#CC342D' }, // Popular Ruby HTTP lib\n    Typhoeus: { icon: ['fas', 'gem'], color: '#CC342D' }, // Popular Ruby HTTP lib\n    Rubybindings: { icon: ['fas', 'gem'], color: '#CC342D' }, // Stripe's Ruby HTTP lib\n\n    Npm: { icon: ['fab', 'npm'], color: '#cc3534' },\n    Node: { icon: ['fab', 'node-js'], color: '#3c873a' },\n    Got: { icon: ['fab', 'node-js'], color: '#3c873a' }, // Popular Node.js HTTP lib\n    Axios: { icon: ['fab', 'node-js'], color: '#3c873a' }, // Popular Node.js HTTP lib\n    Nodebindings: { icon: ['fab', 'node-js'], color: '#3c873a' }, // Stripe's Node.js HTTP lib\n\n    Pip: { icon: ['fab', 'python'], color: '#646464' },\n    Python: { icon: ['fab', 'python'], color: '#4584b6' },\n    Urlfetch: { icon: ['fab', 'python'], color: '#4584b6' }, // Popular Python HTTP lib\n    Pycurl: { icon: ['fab', 'python'], color: '#4584b6' }, // Popular Python HTTP lib\n    Pythonbindings: { icon: ['fab', 'python'], color: '#4584b6' }, // Stripe's Python HTTP lib\n\n    Java: { icon: ['fab', 'java'], color: '#007396' },\n    Reactornetty: { icon: ['fab', 'java'], color: '#007396' }, // Popular Java lib\n    Jetty: { icon: ['fab', 'java'], color: '#007396' }, // Popular Java lib\n    Jakarta: { icon: ['fab', 'java'], color: '#007396' }, // Old name for Apache HttpClient, popular lib\n    Akka: { icon: ['fab', 'java'], color: '#007396' }, // Popular Scala lib\n    Intellij: { icon: ['fab', 'java'], color: '#007396' }, // Java IDE, common target\n    Ktor: { icon: ['fab', 'java'], color: '#007396' }, // Kotlin lib\n    Ahc: { icon: ['fab', 'java'], color: '#007396' }, // AsyncHttpClient, popular Java lib\n\n    Android: { icon: ['fab', 'android'], color: '#78C257' },\n    Okhttp: { icon: ['fab', 'android'], color: '#78C257' }, // Popular Android HTTP lib\n    Fbandroidsdk: { icon: ['fab', 'android'], color: '#78C257' }, // FB Android SDK\n\n    Iphone: { icon: ['fab', 'apple'], color: '#000' },\n    iOS: { icon: ['fab', 'apple'], color: '#000' },\n    Ios: { icon: ['fab', 'apple'], color: '#000' },\n    Ipad: { icon: ['fab', 'apple'], color: '#000' },\n    Darwin: { icon: ['fab', 'apple'], color: '#000' },\n\n    Docker: { icon: ['fab', 'docker'], color: '#0db7ed' },\n    Terminal: { icon: ['fas', 'terminal'], color: '#20c20e' },\n    Network: { icon: ['fas', 'network-wired'], color: '#888' },\n    Electron: { icon: ['fas', 'atom'], color: '#9FEAF9' },\n\n    Desktop: { icon: ['fas', 'desktop'], color: '#888' },\n    Unknown: { icon: ['fas', 'question'], color: '#888' }\n} as const;\n\nimport { FontAwesomeIcon, Props as FAIProps } from '@fortawesome/react-fontawesome';\ntype ExtendedIconProp = IconProp | readonly ['fac', string] | readonly [IconPrefix, IconName];\nexport const Icon = React.memo(\n    FontAwesomeIcon as (props: Omit<FAIProps, 'icon'> & {\n        icon: ExtendedIconProp,\n        onClick?: (event: React.MouseEvent) => void,\n        onKeyPress?: (event: React.KeyboardEvent) => void\n    }) => JSX.Element\n);\nexport type { ExtendedIconProp as IconProp, SizeProp };\n\nexport const SuggestionIcon = styled(Icon).attrs(() => ({\n    icon: ['fas', 'lightbulb']\n}))`\n    margin: 0 6px;\n    color: #2fb4e0;\n`;\n\nexport const suggestionIconHtml = iconHtml(\n    { prefix: 'fas', iconName: 'lightbulb' },\n    {\n        styles: {\n            margin: '0 6px',\n            color: '#2fb4e0'\n        }\n    }\n);\n\nexport const WarningIcon = styled(Icon).attrs(() => ({\n    icon: ['fas', 'exclamation-triangle']\n}))`\n    margin: 0 6px;\n    color: ${p => p.theme.warningColor};\n`;\n\nexport const warningIconHtml = iconHtml(\n    { prefix: 'fas', iconName: 'exclamation-triangle' },\n    {\n        styles: {\n            margin: '0 6px',\n            color: warningColor\n        }\n    }\n);\n\nexport const ArrowIcon = styled(Icon).attrs(() => ({\n    icon: ['fas', 'arrow-left']\n}))`\n    ${(p: { direction: 'left' | 'right' }) =>\n        p.direction === 'right'\n        ? 'transform: rotate(180deg);'\n        : ''\n    }\n    padding: 0 15px;\n`;\n\nfunction iconHtml(iconLookup: IconLookup, options?: IconParams): string {\n    return icon(iconLookup, options).html.join('');\n}","import {\n    IconPrefix,\n    IconDefinition,\n    IconName\n} from '@fortawesome/fontawesome-svg-core';\n\nexport const customSpinnerArc: IconDefinition = {\n    // Based on https://codepen.io/aurer/pen/jEGbA\n    prefix: <IconPrefix>'fac',\n    iconName: <IconName>'spinner-arc',\n    icon: [\n        // height x width\n        50, 50,\n        [],\n        '',\n        // SVG path\n        'M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z'\n    ]\n};","import {\n    IconPrefix,\n    IconDefinition,\n    IconName\n} from '@fortawesome/fontawesome-svg-core';\n\nexport const braveBrowser: IconDefinition = {\n    prefix: <IconPrefix>'fac',\n    iconName: <IconName>'brave-browser',\n    icon: [\n        // height x width\n        11.1, 13.23,\n        [],\n        '',\n        // SVG path\n        'm 5.53752561206,8.23273389478 c 0.07589,0 0.562136,0.174874 0.952332,0.380547 0.39017,0.205699 0.672941,0.351155 0.76334,0.408778 0.09038,0.05764 0.03526,0.166326 -0.04706,0.225614 -0.08235,0.05928 -1.188755,0.932071 -1.296127,1.028532 -0.107394,0.09649 -0.265189,0.255822 -0.372477,0.255822 -0.107288,0 -0.265105,-0.159332 -0.372478,-0.255822 -0.107393,-0.09646 -1.213784,-0.969245 -1.296127,-1.028532 -0.08235,-0.05928 -0.137439,-0.167962 -0.04706,-0.225614 0.09041,-0.05761 0.37317,-0.203079 0.763368,-0.408778 0.390141,-0.205673 0.876414,-0.380547 0.952305,-0.380547 z m 0.0059,-6.216331 c 0.03726,0.001 0.247208,0.01141 0.547814,0.113516 0.332248,0.112822 0.692182,0.253848 0.858305,0.253848 0.166126,0 1.398212,-0.239745 1.398212,-0.239745 0,0 1.460117,1.798085 1.460117,2.182382 0,0.384295 -0.183677,0.485723 -0.368352,0.6855 -0.184673,0.199778 -0.991233,1.072279 -1.094811,1.18431 -0.103578,0.112061 -0.319207,0.28194 -0.192371,0.587712 0.126834,0.305775 0.313945,0.694866 0.105872,1.089514 -0.208099,0.394647 -0.564572,0.658056 -0.792993,0.614507 -0.228419,-0.04357 -0.764862,-0.329155 -0.962134,-0.459604 -0.197272,-0.130452 -0.822508,-0.655744 -0.822508,-0.856734 0,-0.200962 0.646305,-0.561821 0.765694,-0.643814 0.119441,-0.08196 0.664051,-0.399302 0.67521,-0.523856 0.01115,-0.124579 0.0069,-0.161108 -0.153831,-0.468883 -0.160725,-0.307805 -0.450169,-0.71853 -0.401992,-0.991811 0.04818,-0.273252 0.514985,-0.415351 0.848119,-0.543515 0.333078,-0.128132 0.974454,-0.370165 1.054553,-0.407791 0.08015,-0.03766 0.05946,-0.07349 -0.183289,-0.09695 -0.24268,-0.02344 -0.93143,-0.11657 -1.241942,-0.0284 -0.310514,0.08816 -0.841003,0.222315 -0.883974,0.293448 -0.04297,0.07114 -0.08088,0.07353 -0.03675,0.318918 0.0441,0.245385 0.271308,1.422841 0.293347,1.631983 0.02206,0.209143 0.06521,0.347404 -0.156157,0.398964 -0.221387,0.05155 -0.594031,0.141082 -0.722085,0.141082 -0.128053,0 -0.500724,-0.08953 -0.722085,-0.141082 -0.221388,-0.05155 -0.178251,-0.189821 -0.156185,-0.398964 0.02207,-0.209142 0.249242,-1.386598 0.293376,-1.631983 0.0441,-0.245386 0.0061,-0.247783 -0.03675,-0.318918 -0.04297,-0.07114 -0.573487,-0.205278 -0.884001,-0.293448 -0.310513,-0.08816 -0.999234,0.005 -1.241942,0.0284 -0.242707,0.02344 -0.263418,0.05928 -0.18329,0.09695 0.08012,0.03762 0.721504,0.279654 1.054581,0.407791 0.333108,0.128171 0.799944,0.270263 0.848119,0.543515 0.04818,0.273281 -0.241294,0.684006 -0.401992,0.991811 -0.160724,0.307775 -0.164988,0.3443 -0.153829,0.468883 0.01115,0.124552 0.555766,0.441892 0.675182,0.523856 0.119415,0.08199 0.765693,0.442852 0.765693,0.643814 0,0.20099 -0.625209,0.726284 -0.822481,0.856734 -0.197272,0.130452 -0.733713,0.416028 -0.962134,0.459604 -0.22842,0.04355 -0.584894,-0.21986 -0.792992,-0.614507 -0.20807,-0.394648 -0.02096,-0.783739 0.105846,-1.089514 0.126835,-0.305772 -0.08877,-0.475652 -0.192372,-0.587712 -0.103552,-0.112035 -0.910138,-0.984532 -1.094811,-1.18431 -0.184675,-0.199777 -0.368325,-0.301205 -0.368325,-0.6855 0,-0.384297 1.460119,-2.182382 1.460119,-2.182382 0,0 1.232086,0.239745 1.39821,0.239745 0.166123,0 0.526058,-0.141026 0.858306,-0.253848 0.300606,-0.102072 0.510551,-0.112467 0.547815,-0.113516 z m 5.143909,1.157116 0.304561,-0.761542 c 0,0 -0.387622,-0.423078 -0.858308,-0.902568 -0.470683,-0.479489 -1.467428,-0.197436 -1.467428,-0.197436 l -1.135179,-1.311968 h -1.993525 -1.993488 l -1.135179,1.311968 c 0,0 -0.996745,-0.282053 -1.467428,0.197436 -0.470686,0.47949 -0.858308,0.902568 -0.858308,0.902568 l 0.304561,0.761542 -0.387622,1.128209 c 0,0 1.140025,4.398751 1.273616,4.935921 0.263029,1.057696 0.442998,1.466672 1.190555,2.002574 0.747558,0.535898 2.104237,1.466672 2.325735,1.607698 0.221498,0.141026 0.498373,0.38125 0.747558,0.38125 0.249185,0 0.52606,-0.240224 0.747558,-0.38125 0.221498,-0.141026 1.578177,-1.0718 2.325735,-1.607698 0.747557,-0.535902 0.927525,-0.944878 1.190555,-2.002574 0.133563,-0.53717 1.273616,-4.935921 1.273616,-4.935921 z'\n    ]\n};","import {\n    IconPrefix,\n    IconDefinition,\n    IconName\n} from '@fortawesome/fontawesome-svg-core';\n\nexport const arcBrowser: IconDefinition = {\n    prefix: <IconPrefix>'fac',\n    iconName: <IconName>'arc-browser',\n    icon: [\n        // height x width\n        56.4, 67.36,\n        [],\n        '',\n        // SVG path\n        'm 58.458706,45.75 -3.5,-7.36 -6.63,-13.95 -0.01,0.01 c 0,0 0,-0.01 0.01,-0.01 l -9.64,-20.28 a 7.292,7.292 0 0 0 -6.58,-4.16 c -2.81,0 -5.37,1.62 -6.58,4.16 l -9.83,20.68 c 2.76,3.65 7.64,6.65 12.49,7.68 l 3.18,-6.68 c 0.3,-0.63 1.2,-0.63 1.5,0 l 3.11,6.54 h 0.02 -0.02 l 6.33,13.32 3.11,6.54 a 7.28,7.28 0 0 0 6.59,4.16 c 0.65,0 1.3,-0.09 1.94,-0.27 4.39,-1.21 6.47,-6.26 4.51,-10.38 m -22.49,-13.37 c -1.42,0.34 -2.87,0.52 -4.32,0.52 -1.13,0 -2.3,-0.13 -3.47,-0.38 -4.85,-1.03 -9.73,-4.03 -12.49,-7.68 -0.69,-0.91 -1.25,-1.86 -1.64,-2.83 -1.51,-3.73 -5.7600005,-5.53 -9.4900005,-4.03 -3.73000009,1.51 -5.53000009,5.76 -4.03000009,9.49 C 2.2387054,31.71 5.2587055,35.6 9.0487055,38.8 a 37.84,37.84 0 0 0 12.7700005,7.08 c 3.21,1.03 6.54,1.6 9.82,1.6 3.64,0 7.23,-0.63 10.65,-1.78 z m 25.54,-23.1800005 a 7.29,7.29 0 0 0 -8.58,5.7200005 c -0.7,3.5 -2.34,6.759999 -4.6,9.53 l 6.63,13.96 c 6.12,-5.31 10.64,-12.54 12.26,-20.63 0.79,-3.96 -1.77,-7.8000005 -5.71,-8.5800005 M 9.0487055,38.8 l -3.32,6.98 c -1.69,3.549999 -0.42,7.92 3.06,9.769999 3.6900005,1.96 8.2300005,0.43 10.0100005,-3.299999 l 3.03,-6.37 A 37.885,37.885 0 0 1 9.0487055,38.8'\n    ]\n};","import * as Remarkable from 'remarkable';\nimport * as DOMPurify from 'dompurify';\n\nimport { Html } from '../../types';\n\nconst md = new Remarkable({\n    html: true,\n    linkify: true,\n    linkTarget: '_blank' // Links should always open elsewhere\n});\n\n// Add an extra hook to DOMPurify to enforce link target. Without this, DOMPurify strips\n// every link target entirely.\nDOMPurify.addHook('afterSanitizeAttributes', function (node: Element | HTMLElement) {\n    // Closely based on example from https://github.com/cure53/DOMPurify/tree/main/demos#hook-to-open-all-links-in-a-new-window-link\n\n    // Set all elements owning target to target=_blank\n    if (node.hasAttribute('target') || 'target' in node) {\n        node.setAttribute('target', '_blank');\n        node.setAttribute('rel', 'noreferrer'); // Disables both referrer & opener\n    }\n\n    // set non-HTML/MathML links to xlink:show=new\n    if (\n        !node.hasAttribute('target') &&\n        (node.hasAttribute('xlink:href') || node.hasAttribute('href'))\n    ) {\n        node.setAttribute('xlink:show', 'new');\n    }\n});\n\n// Add an extra hook to strip relative URLs (markdown largely comes from external sources,\n// and so should never include relative paths!)\nDOMPurify.addHook('afterSanitizeAttributes', function (node: Element | HTMLElement) {\n    if (node.hasAttribute('href')) {\n        const target = node.getAttribute('href');\n        if (target?.startsWith('/')) node.removeAttribute('href');\n    }\n});\n\nexport function fromMarkdown(input: string): Html;\nexport function fromMarkdown(input: string | undefined): Html | undefined;\nexport function fromMarkdown(input: string | undefined): Html | undefined {\n    if (!input) return undefined;\n    else {\n        const unsafeMarkdown = md.render(input).replace(/\\n$/, '');\n        const safeHtml = DOMPurify.sanitize(unsafeMarkdown);\n        return { __html: safeHtml };\n    }\n}","import * as localForage from 'localforage';\nimport * as semver from 'semver';\n\nimport { RUNNING_IN_WORKER } from '../util';\nimport { lazyObservablePromise } from \"../util/observable\";\nimport { getServerVersion, waitUntilServerReady } from \"./server-api\";\nimport { getDesktopInjectedValue } from \"./desktop-api\";\n\nexport const UI_VERSION = process.env.UI_VERSION || \"Unknown\";\n\nexport const desktopVersion = lazyObservablePromise(async () => {\n    return getDesktopInjectedValue('httpToolkitDesktopVersion');\n    // Note that if we're running in a browser, not the desktop shell, this _never_ resolves.\n});\n\n// The current server version, directly checked against the running\n// server, not available until it starts up.\nexport const serverVersion = lazyObservablePromise(() =>\n    waitUntilServerReady()\n        .then(getServerVersion)\n        .then((version) => {\n            localForage.setItem('last-server-version', version);\n            return version;\n        })\n);\n\n// The last known service version - immediately available (though still async),\n// but reports the previous startup version, not necessarily the latest one.\n// May be undefined if the app has never yet started successfully.\nexport const lastServerVersion =\n    localForage.getItem<string>('last-server-version')\n    // Fallback to previous localStorage data approach, just in case\n    .then((version) => {\n        if (!version && !RUNNING_IN_WORKER) {\n            return localStorage.getItem('last-server-version')\n        }\n        else return version;\n    });\n\nexport function versionSatisfies(version: string | Error | undefined, range: string) {\n    return (typeof version === 'string') &&\n        semver.satisfies(version, range, { includePrerelease: true });\n}\n\n// Notable desktop versions:\nexport const DESKTOP_HEADER_LIMIT_CONFIGURABLE = \"^0.1.20 || ^1.0.0\";\n\n// Notable server versions:\nexport const PORT_RANGE_SERVER_RANGE = '^0.1.14 || ^1.0.0';\nexport const MOCK_SERVER_RANGE = '^0.1.21 || ^1.0.0';\nexport const HOST_MATCHER_SERVER_RANGE = '^0.1.22 || ^1.0.0';\nexport const CLIENT_CERT_SERVER_RANGE = '^0.1.26 || ^1.0.0';\nexport const FROM_FILE_HANDLER_SERVER_RANGE = '^0.1.28 || ^1.0.0';\nexport const DETAILED_CONFIG_RANGE = '^0.1.30 || ^1.0.0';\nexport const INTERCEPTOR_METADATA = '^0.1.31 || ^1.0.0';\nexport const INITIAL_HTTP2_RANGE = '^0.1.44 || ^1.0.0';\nexport const BODY_MATCHING_RANGE = '^1.1.4';\nexport const WEBSOCKET_RULE_RANGE = '^1.1.3';\nexport const DETAILED_METADATA = '^1.2.0';\nexport const PASSTHROUGH_TRANSFORMS_RANGE = '^1.4.0';\nexport const PROXY_CONFIG_RANGE = '^1.4.1';\nexport const CLOSE_IN_BREAKPOINT = '^1.4.2';\nexport const DNS_AND_RULE_PARAM_CONFIG_RANGE = '^1.5.0';\nexport const DOCKER_INTERCEPTION_RANGE = '^1.5.0';\nexport const CUSTOM_CA_TRUST_RANGE = '^1.7.0';\nexport const MULTIPLE_EXISTING_TERMINAL_RANGE = '^1.8.0';\nexport const RAW_BODY_SUPPORTED = '^1.9.0';\nexport const WEBSOCKET_MESSAGING_RULES_SUPPORTED = '^1.9.0';\nexport const WEBRTC_GLOBALLY_ENABLED = '^1.10.3';\nexport const JSONRPC_RESPONSE_RULE_SUPPORTED = '^1.11.0';\nexport const RTC_RULES_SUPPORTED = '^1.11.0';\nexport const TLS_PASSTHROUGH_SUPPORTED = '^1.12.0';\nexport const CONNECTION_RESET_SUPPORTED = '^1.12.0';\nexport const SERVER_REST_API_SUPPORTED = '^1.13.0';\nexport const SERVER_SEND_API_SUPPORTED = '^1.13.0';","import { observable, computed } from 'mobx';\n\nimport {\n    FailedTlsConnection,\n    TlsTunnel,\n    HttpExchange,\n    RTCConnection,\n    RTCDataChannel,\n    RTCMediaTrack,\n    WebSocketStream\n} from '../../types';\n\nimport { getEventCategory } from './categorization';\n\nexport abstract class HTKEventBase {\n\n    abstract get id(): string;\n\n    // These can be overriden by subclasses to allow easy type narrowing:\n    isHttp(): this is HttpExchange { return false; }\n    isWebSocket(): this is WebSocketStream { return false; }\n\n    isTlsFailure(): this is FailedTlsConnection { return false; }\n    isTlsTunnel(): this is TlsTunnel { return false; }\n\n    isRTCConnection(): this is RTCConnection { return false; }\n    isRTCDataChannel(): this is RTCDataChannel { return false; }\n    isRTCMediaTrack(): this is RTCMediaTrack { return false; }\n\n    @computed\n    public get category() {\n        return getEventCategory(this);\n    }\n\n    @observable\n    public searchIndex: string = '';\n\n    @observable\n    public pinned: boolean = false;\n\n    // Logic elsewhere can put values into these caches to cache calculations\n    // about this event weakly, so they GC with the event.\n    // Keyed by symbols only, so we know we never have conflicts.\n    public cache = observable.map(new Map<symbol, unknown>(), { deep: false });\n\n}","import * as _ from 'lodash';\nimport * as React from 'react';\n\nimport { styled } from '../../styles';\nimport { Icon } from '../../icons';\nimport { useSize } from '../../util/ui';\n\nconst VisibleButtonsContainer = styled.div`\n    overflow: hidden;\n    display: flex;\n    flex-direction: inherit;\n`;\n\nconst HiddenButtonsWrapper = styled.div`\n    position: relative;\n`;\n\nconst HiddenButtonsContainer = styled.div`\n    position: absolute;\n    left: 0;\n    top: 100%;\n    z-index: 1;\n    display: flex;\n    flex-direction: column;\n\n    background-color: ${p => p.theme.mainBackground};\n    padding-bottom: 2px;\n\n    opacity: 0;\n    pointer-events: none;\n    &:hover, &:focus-within {\n        opacity: 1;\n        pointer-events: auto;\n    }\n`;\n\nconst ButtonContainer = styled.div`\n    flex-grow: 1;\n    flex-shrink: 1;\n    min-width: 0;\n\n    position: relative;\n    display: flex;\n\n    /* Match the parent (typically card header) flex direction, but justify\n       content in the opposite direction */\n    flex-direction: inherit;\n    justify-content: flex-start;\n`;\n\nconst MenuButton = styled(Icon)`\n    color: ${p => p.theme.mainColor};\n    font-size: ${p => p.theme.textSize};\n    padding: 5px 10px;\n\n    &:hover + ${HiddenButtonsContainer} {\n        opacity: 1;\n        pointer-events: auto;\n    }\n`;\n\nfunction unfocus() {\n    if ('blur' in (document.activeElement || {})) {\n        (document.activeElement as HTMLElement).blur();\n    }\n}\n\nexport const CollapsingButtons = (p: { children: React.ReactNode, className?: string }) => {\n    const containerRef = React.useRef<HTMLDivElement>(null);\n    const spaceAvailable = useSize(containerRef, Infinity);\n\n    containerRef.current?.children\n\n    const childElements = Array.from(\n        containerRef.current?.querySelectorAll('button') || []\n    );\n    const itemWidth = _.max(childElements.map(c => c.clientWidth));\n    const itemSpacesAvailable = itemWidth\n        ? Math.max(Math.floor(spaceAvailable / itemWidth), 1) // Always show at least one button\n        : Infinity;\n\n    const children = React.Children.toArray(p.children);\n\n    const [visibleChildren, hiddenChildren] = itemSpacesAvailable >= children.length\n        ? [children, []]\n        : [children.slice(0, itemSpacesAvailable - 1), children.slice(itemSpacesAvailable - 1)]\n\n    return <ButtonContainer ref={containerRef} className={p.className}>\n        <VisibleButtonsContainer>\n            { visibleChildren }\n        </VisibleButtonsContainer>\n        { hiddenChildren.length > 0 && <HiddenButtonsWrapper>\n            <MenuButton\n                icon={['fas', 'caret-down']}\n                title=\"Show more\"\n            />\n            <HiddenButtonsContainer\n                // Need to ensure that the menu doesn't stick open if you click an item\n                onClick={unfocus}\n            >\n                { hiddenChildren }\n            </HiddenButtonsContainer>\n        </HiddenButtonsWrapper> }\n    </ButtonContainer>\n};","import * as React from 'react';\n\nimport { IconButton } from './icon-button';\nimport { ExpandState } from './card';\n\nexport const ExpandShrinkButton = (p: {\n    expanded: ExpandState | undefined,\n    onClick: () => void\n}) =>\n    <IconButton\n        icon={[\n            'fas',\n            p.expanded ? 'compress-arrows-alt' : 'expand'\n        ]}\n        onClick={p.onClick}\n        title={\n            p.expanded\n                ? \"Shrink this area, so you can see other details\"\n                : \"Expand this area to view it in more detail, hiding other areas\"\n        }\n    />"],"sourceRoot":""}